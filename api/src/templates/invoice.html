<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rechnung {{invoiceNumber}}</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    /* ── Reset & Base ─────────────────────────────────────────────────── */
    *, *::before, *::after {
      margin: 0; padding: 0; box-sizing: border-box;
    }

    :root {
      --ink:      #111827;
      --ink-soft: #4b5563;
      --ink-faint:#9ca3af;
      --accent:   #1e3a5f;
      --accent-2: #2d5282;
      --accent-bg:#f0f4f8;
      --line:     #e5e7eb;
      --line-light:#f3f4f6;
      --white:    #ffffff;
      --green:    #15803d;
      --green-bg: #dcfce7;
      --red:      #dc2626;
      --red-bg:   #fee2e2;
      --blue:     #1d4ed8;
      --blue-bg:  #dbeafe;
    }

    body {
      font-family: 'Inter', 'Helvetica Neue', Helvetica, Arial, sans-serif;
      font-size: 9.5pt;
      line-height: 1.55;
      color: var(--ink);
      background: var(--white);
      -webkit-font-smoothing: antialiased;
    }

    @page {
      size: A4;
      margin: 18mm 16mm 22mm 16mm;
    }

    @media print {
      body { padding: 0; }
    }

    /* ── Wrapper ─────────────────────────────────────────────────────── */
    .invoice {
      max-width: 178mm;
      margin: 0 auto;
      padding: 16px 0;
    }

    /* ── Header ──────────────────────────────────────────────────────── */
    .header {
      display: flex;
      justify-content: flex-end;
      align-items: flex-start;
      margin-bottom: 20px;
    }

    .header-right {
      text-align: right;
    }

    .rechnung-label {
      font-size: 14pt;
      font-weight: 600;
      color: var(--ink-soft);
      letter-spacing: 1px;
      text-transform: uppercase;
      line-height: 1;
      margin-bottom: 6px;
    }

    .invoice-number-badge {
      display: inline-block;
      color: var(--accent);
      font-size: 12pt;
      font-weight: 700;
      letter-spacing: 0.3px;
    }

    /* ── Rule ────────────────────────────────────────────────────────── */
    .rule {
      display: none;
    }

    /* ── Address Section ─────────────────────────────────────────────── */
    .addresses {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      gap: 40px;
    }

    .address-left {
      flex: 1;
      max-width: 55%;
    }

    .address-right {
      flex: 0 0 auto;
      text-align: right;
    }

    /* Window-envelope sender strip */
    .sender-strip {
      font-size: 7.5pt;
      color: var(--ink-faint);
      padding-bottom: 5px;
      margin-bottom: 8px;
      border-bottom: 1px solid var(--line);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .address-label {
      font-size: 7pt;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--accent);
      margin-bottom: 7px;
    }

    .address-content {
      font-size: 9pt;
      line-height: 1.7;
      color: var(--ink-soft);
    }

    .address-content .company-name {
      font-size: 10pt;
      font-weight: 600;
      color: var(--ink);
      display: block;
      margin-bottom: 2px;
    }

    /* ── Meta Grid ───────────────────────────────────────────────────── */
    .meta-band {
      background: var(--accent-bg);
      border: 1px solid #c3d4e8;
      border-radius: 8px;
      padding: 12px 20px;
      margin-bottom: 20px;
    }

    .meta-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
    }

    .meta-item {}

    .meta-label {
      font-size: 7pt;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: var(--accent-2);
      margin-bottom: 4px;
    }

    .meta-value {
      font-size: 10.5pt;
      font-weight: 600;
      color: var(--ink);
      line-height: 1.2;
    }

    /* ── Status Badge ────────────────────────────────────────────────── */
    .status-badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 7.5pt;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.6px;
    }

    .status-draft     { background:#f3f4f6; color:#6b7280; }
    .status-sent      { background: var(--blue-bg);  color: var(--blue);  }
    .status-paid      { background: var(--green-bg); color: var(--green); }
    .status-overdue   { background: var(--red-bg);   color: var(--red);   }
    .status-cancelled { background:#f3f4f6; color:#6b7280; }

    /* ── Line Items Table ────────────────────────────────────────────── */
    .items-section {
      margin-bottom: 16px;
    }

    .items-table {
      width: 100%;
      border-collapse: collapse;
    }

    .items-table thead tr {
      background: var(--accent);
    }

    .items-table th {
      padding: 10px 12px;
      font-size: 7.5pt;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      color: var(--white);
      text-align: left;
    }

    .items-table th.text-right { text-align: right; }
    .items-table th.text-center { text-align: center; }

    .items-table td {
      padding: 12px 12px;
      border-bottom: 1px solid var(--line);
      vertical-align: top;
      color: var(--ink);
    }

    .items-table td.text-right { text-align: right; }
    .items-table td.text-center { text-align: center; }

    .items-table tbody tr:nth-child(even) td {
      background: var(--line-light);
    }

    .items-table tbody tr:last-child td {
      border-bottom: 2px solid var(--accent);
    }

    .item-description {
      font-weight: 500;
      font-size: 9.5pt;
    }

    .item-qty-unit {
      color: var(--ink-soft);
      font-size: 9pt;
    }

    /* ── Totals ──────────────────────────────────────────────────────── */
    .totals-section {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 20px;
    }

    .totals-box {
      width: 260px;
      border: 1px solid var(--line);
      border-radius: 8px;
      overflow: hidden;
    }

    .totals-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 9px 16px;
      font-size: 9.5pt;
    }

    .totals-row + .totals-row {
      border-top: 1px solid var(--line);
    }

    .totals-row.vat {
      color: var(--ink-soft);
      font-size: 9pt;
    }

    .totals-row.total {
      background: var(--accent);
      color: var(--white);
      font-size: 11.5pt;
      font-weight: 700;
    }

    .totals-value {
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }

    .totals-row.total .totals-value {
      font-weight: 700;
    }

    /* ── Paid Watermark ──────────────────────────────────────────────── */
    .invoice-body { position: relative; }

    .paid-stamp {
      position: absolute;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-18deg);
      font-size: 52pt;
      font-weight: 900;
      color: rgba(21, 128, 61, 0.10);
      text-transform: uppercase;
      letter-spacing: 10px;
      pointer-events: none;
      white-space: nowrap;
      border: 6px solid rgba(21, 128, 61, 0.10);
      padding: 8px 24px;
      border-radius: 8px;
    }

    /* ── Payment Info ────────────────────────────────────────────────── */
    .payment-section {
      background: var(--line-light);
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 12px 20px;
      margin-bottom: 16px;
    }

    .payment-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .payment-dot {
      width: 6px;
      height: 6px;
      background: var(--accent);
      border-radius: 50%;
      flex-shrink: 0;
    }

    .payment-title {
      font-size: 8pt;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--accent);
    }

    .payment-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px 32px;
    }

    .payment-row {
      display: flex;
      gap: 8px;
      align-items: baseline;
    }

    .payment-label {
      font-size: 8pt;
      color: var(--ink-faint);
      flex-shrink: 0;
      min-width: 90px;
    }

    .payment-value {
      font-size: 9pt;
      font-weight: 500;
      color: var(--ink);
      font-family: 'SFMono-Regular', 'Consolas', 'Monaco', monospace;
      letter-spacing: 0.3px;
    }

    .payment-value.iban {
      font-size: 8.5pt;
      letter-spacing: 1px;
    }

    /* ── Notes ───────────────────────────────────────────────────────── */
    .notes-section {
      margin-bottom: 28px;
      padding: 14px 16px;
      border-left: 3px solid var(--accent);
      background: var(--accent-bg);
      border-radius: 0 6px 6px 0;
    }

    .notes-title {
      font-size: 7.5pt;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: var(--accent);
      margin-bottom: 6px;
    }

    .notes-content {
      font-size: 9pt;
      color: var(--ink-soft);
      line-height: 1.6;
    }

    /* ── Footer ──────────────────────────────────────────────────────── */
    .footer {
      margin-top: 20px;
      padding-top: 12px;
      border-top: 1px solid var(--line);
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 24px;
    }

    .footer-left {
      font-size: 7.5pt;
      color: var(--ink-faint);
      line-height: 1.7;
    }

    .footer-right {
      text-align: right;
      font-size: 7.5pt;
      color: var(--ink-faint);
      line-height: 1.7;
    }

    .footer-brand {
      font-size: 8pt;
      font-weight: 600;
      color: var(--accent);
      display: block;
      margin-bottom: 2px;
    }
  </style>
</head>
<body>
  <div class="invoice">

    <!-- ═══════════════════ HEADER ═══════════════════ -->
    <div class="header">
      <div class="header-right">
        <div class="rechnung-label">Rechnung</div>
        <div class="invoice-number-badge">{{invoiceNumber}}</div>
      </div>
    </div>

    <hr class="rule">

    <div class="invoice-body">
      {{#if isPaid}}
      <div class="paid-stamp">Bezahlt</div>
      {{/if}}

      <!-- ═══════════════════ ADDRESSES ═══════════════════ -->
      <div class="addresses">

        <!-- LEFT: Recipient -->
        <div class="address-left">
          <div class="address-label">Empfänger</div>
          <div class="address-content">
            {{#if client.company}}
              <span class="company-name">{{client.company}}</span>
              {{#if client.address}}
                {{#if client.address.street}}{{client.address.street}}<br>{{/if}}
                {{#if client.address.zip}}{{client.address.zip}} {{/if}}{{#if client.address.city}}{{client.address.city}}{{/if}}<br>
                {{#if client.address.country}}{{client.address.country}}<br>{{/if}}
              {{/if}}
              {{client.name}}<br>
            {{else}}
              <span class="company-name">{{client.name}}</span>
              {{#if client.address}}
                {{#if client.address.street}}{{client.address.street}}<br>{{/if}}
                {{#if client.address.zip}}{{client.address.zip}} {{/if}}{{#if client.address.city}}{{client.address.city}}{{/if}}<br>
                {{#if client.address.country}}{{client.address.country}}<br>{{/if}}
              {{/if}}
            {{/if}}
            {{#if client.email}}{{client.email}}{{/if}}
            {{#if client.vatId}}<br>USt-IdNr.: {{client.vatId}}{{/if}}
          </div>
        </div>

        <!-- RIGHT: Sender -->
        <div class="address-right">
          <div class="address-label">Absender</div>
          <div class="address-content">
            <span class="company-name">{{seller.name}}</span>
            {{#if seller.title}}{{seller.title}}<br>{{/if}}
            {{seller.address.street}}<br>
            {{seller.address.zip}} {{seller.address.city}}<br>
            {{#if seller.address.country}}{{seller.address.country}}<br>{{/if}}
            {{seller.email}}<br>
            {{#if seller.phone}}{{seller.phone}}<br>{{/if}}
            {{#if seller.vatId}}<br>USt-IdNr.: {{seller.vatId}}{{/if}}
            {{#if seller.taxId}}<br>St.-Nr.: {{seller.taxId}}{{/if}}
          </div>
        </div>
      </div>

      <!-- ═══════════════════ META ═══════════════════ -->
      <div class="meta-band">
        <div class="meta-grid">
          <div class="meta-item">
            <div class="meta-label">Rechnungsdatum</div>
            <div class="meta-value">{{invoiceDate}}</div>
          </div>
          <div class="meta-item">
            <div class="meta-label">Leistungsdatum</div>
            <div class="meta-value">{{serviceDate}}</div>
          </div>
          <div class="meta-item">
            <div class="meta-label">Fällig am</div>
            <div class="meta-value">{{dueDate}}</div>
          </div>
          <div class="meta-item">
            <div class="meta-label">Status</div>
            <div class="meta-value">
              <span class="status-badge status-{{statusClass}}">{{statusLabel}}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- ═══════════════════ LINE ITEMS ═══════════════════ -->
      <div class="items-section">
        <table class="items-table">
          <thead>
            <tr>
              <th style="width:46%">Beschreibung</th>
              <th class="text-center" style="width:10%">Menge</th>
              <th class="text-center" style="width:10%">Einheit</th>
              <th class="text-right" style="width:17%">Einzelpreis</th>
              <th class="text-right" style="width:17%">Betrag</th>
            </tr>
          </thead>
          <tbody>
            {{#each items}}
            <tr>
              <td class="item-description">{{description}}</td>
              <td class="text-center item-qty-unit">{{quantity}}</td>
              <td class="text-center item-qty-unit">{{unitLabel}}</td>
              <td class="text-right">{{unitPriceFormatted}}</td>
              <td class="text-right" style="font-weight:600">{{amountFormatted}}</td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      <!-- ═══════════════════ TOTALS ═══════════════════ -->
      <div class="totals-section">
        <div class="totals-box">
          <div class="totals-row">
            <span>Nettobetrag</span>
            <span class="totals-value">{{subtotalFormatted}}</span>
          </div>
          <div class="totals-row vat">
            <span>USt. {{vatRate}}%</span>
            <span class="totals-value">{{vatAmountFormatted}}</span>
          </div>
          <div class="totals-row total">
            <span>Gesamtbetrag</span>
            <span class="totals-value">{{totalFormatted}}</span>
          </div>
        </div>
      </div>

      <!-- ═══════════════════ PAYMENT INFO ═══════════════════ -->
      <div class="payment-section">
        <div class="payment-header">
          <div class="payment-dot"></div>
          <div class="payment-title">Zahlungsinformationen</div>
        </div>
        <div class="payment-grid">
          <div class="payment-row">
            <span class="payment-label">Empfänger</span>
            <span class="payment-value">{{seller.name}}</span>
          </div>
          <div class="payment-row">
            <span class="payment-label">Bank</span>
            <span class="payment-value">{{seller.bank.name}}</span>
          </div>
          <div class="payment-row">
            <span class="payment-label">IBAN</span>
            <span class="payment-value iban">{{seller.bank.iban}}</span>
          </div>
          <div class="payment-row">
            <span class="payment-label">BIC</span>
            <span class="payment-value">{{seller.bank.bic}}</span>
          </div>
          <div class="payment-row">
            <span class="payment-label">Verwendungszweck</span>
            <span class="payment-value">{{invoiceNumber}}</span>
          </div>
        </div>
      </div>

      <!-- ═══════════════════ NOTES ═══════════════════ -->
      {{#if notes}}
      <div class="notes-section">
        <div class="notes-title">Hinweise</div>
        <div class="notes-content">{{notes}}</div>
      </div>
      {{/if}}

    </div><!-- /.invoice-body -->

    <!-- ═══════════════════ FOOTER ═══════════════════ -->
    <div class="footer">
      <div class="footer-left">
        <span class="footer-brand">{{seller.name}}</span>
        {{seller.address.street}} · {{seller.address.zip}} {{seller.address.city}}<br>
        {{seller.email}}{{#if seller.phone}} · {{seller.phone}}{{/if}}
      </div>
      <div class="footer-right">
        {{#if seller.taxId}}<span>Steuernummer: {{seller.taxId}}</span><br>{{/if}}
        {{#if seller.vatId}}<span>USt-IdNr.: {{seller.vatId}}</span><br>{{/if}}
        <span>Rechnungsnummer: {{invoiceNumber}}</span>
      </div>
    </div>

  </div><!-- /.invoice -->
</body>
</html>
