import{r as c,j as e}from"./vendor-react-wuMqdllU.js";import{u as V,E as B}from"./ExpenseDialog-B2als9YA.js";import{i as T,E as I,a as j,I as O,B as N,A as R}from"./index-JZoliObr.js";import{T as G,a as U,b as A,c as l,d as z,e as o}from"./table-Dp7xfnhx.js";import{C as M}from"./confirm-delete-dialog-CQVr6K2O.js";import{m as W,r as _,V as $,d as q,Q as H,z as Q}from"./vendor-icons-CHGo4Fp8.js";import"./vendor-markdown-C3iCDuOK.js";import"./dialog-BM5s3xjO.js";import"./vendor-radix-BCh4MJnw.js";import"./vendor-floating-ui-BD6aHMKr.js";import"./vendor-forms-B8CBK7X2.js";import"./index-uXN-dP3D.js";import"./vendor-recharts-tRgwS7-V.js";import"./vendor-router-Cm8Qzw9U.js";import"./alert-dialog-WF8eNeVO.js";function m(d){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(d)}function J(d){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(d)}function K({onAddExpense:d,onEditExpense:i,className:u,refreshTrigger:x}){const{expenses:h,isLoading:w,error:f,deleteExpense:b,setSelectedExpense:C,refresh:g}=V(),[n,L]=c.useState(""),[y,D]=c.useState(null);c.useEffect(()=>{x&&x>0&&g()},[x,g]);const v=c.useMemo(()=>{if(!n)return h;const s=n.toLowerCase();return h.filter(t=>t.description.toLowerCase().includes(s)||t.vendor.toLowerCase().includes(s)||t.euerCategory.toLowerCase().includes(s))},[h,n]),E=c.useMemo(()=>v.reduce((s,t)=>({net:s.net+t.netAmount,vat:s.vat+t.vatAmount,gross:s.gross+t.grossAmount}),{net:0,vat:0,gross:0}),[v]),S=s=>{C(s),i==null||i(s)},F=(s,t)=>{s.stopPropagation(),D(t)},P=async()=>{y&&(await b(y),D(null))};return w?e.jsxs("div",{className:T("flex items-center justify-center p-8",u),children:[e.jsx(W,{className:"h-8 w-8 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading..."})]}):f?e.jsxs("div",{className:T("p-8 text-center",u),children:[e.jsx("p",{className:"text-destructive",children:I(f)}),e.jsx(j,{variant:"outline",className:"mt-4",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:T("space-y-4",u),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Expenses"}),e.jsxs(j,{onClick:d,className:"w-full sm:w-auto",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(O,{placeholder:"Search expenses...",value:n,onChange:s=>L(s.target.value),className:"pl-10"})]}),v.length===0?e.jsx("div",{className:"rounded-lg border border-dashed p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:n?"No expense records match your search":"No expense records yet. Add your first expense to get started."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(G,{className:"min-w-[800px]",children:[e.jsx(U,{children:e.jsxs(A,{children:[e.jsx(l,{children:"Date"}),e.jsx(l,{children:"Vendor"}),e.jsx(l,{children:"Description"}),e.jsx(l,{children:"VAT"}),e.jsx(l,{className:"text-right",children:"Net"}),e.jsx(l,{className:"text-right",children:"Vorsteuer"}),e.jsx(l,{className:"text-right",children:"Gross"}),e.jsx(l,{className:"text-center",children:"Receipt"}),e.jsx(l,{className:"w-[50px]"})]})}),e.jsx(z,{children:v.map(s=>e.jsxs(A,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>S(s),children:[e.jsx(o,{className:"font-medium",children:J(s.date)}),e.jsx(o,{children:s.vendor}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.description}),s.vorsteuerClaimed&&e.jsx(N,{variant:"secondary",className:"text-xs",children:"Claimed"}),s.isRecurring&&e.jsx(N,{variant:"outline",className:"text-xs",children:"Recurring"}),s.isGwg&&e.jsx(N,{variant:"default",className:"text-xs",children:"GWG"})]})}),e.jsx(o,{children:e.jsxs(N,{variant:"outline",children:[s.vatRate,"%"]})}),e.jsx(o,{className:"text-right",children:m(s.netAmount)}),e.jsx(o,{className:"text-right",children:m(s.vatAmount)}),e.jsx(o,{className:"text-right font-medium",children:m(s.grossAmount)}),e.jsx(o,{className:"text-center",children:s.receiptPath?e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),t.preventDefault();const r=window.open("about:blank","_blank");R.requestBlob(`/expenses/${s.id}/receipt`).then(k=>{const p=URL.createObjectURL(k);if(r)r.location.href=p;else{const a=document.createElement("a");a.href=p,a.target="_blank",a.click()}}).catch(()=>{r&&r.close(),alert("Failed to view receipt")})},"aria-label":"View receipt",title:"View PDF",children:e.jsx(q,{className:"h-4 w-4 text-muted-foreground hover:text-primary"})}),e.jsx(j,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),t.preventDefault();const r=window.open("about:blank","_blank");R.requestBlob(`/expenses/${s.id}/receipt?download=true`).then(k=>{const p=URL.createObjectURL(k);if(r)r.location.href=p;else{const a=document.createElement("a");a.href=p,a.download=`receipt-${s.id}.pdf`,document.body.appendChild(a),a.click(),document.body.removeChild(a)}}).catch(()=>{r&&r.close(),alert("Failed to download receipt")})},"aria-label":"Download receipt",title:"Download PDF",children:e.jsx(H,{className:"h-4 w-4 text-muted-foreground hover:text-primary"})})]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"â€”"})}),e.jsx(o,{children:e.jsx(j,{variant:"ghost",size:"icon",onClick:t=>F(t,s.id),"aria-label":"Delete",children:e.jsx(Q,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"})})})]},s.id))})]})}),e.jsx("div",{className:"flex justify-start sm:justify-end",children:e.jsxs("div",{className:"rounded-lg bg-muted p-3 sm:p-4 w-full sm:w-auto",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Total"}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 gap-2 sm:gap-4 text-right",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Net"}),e.jsx("div",{className:"font-medium text-sm sm:text-base",children:m(E.net)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Vorsteuer"}),e.jsx("div",{className:"font-medium text-sm sm:text-base",children:m(E.vat)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Gross"}),e.jsx("div",{className:"font-semibold text-sm sm:text-base",children:m(E.gross)})]})]})]})})]}),e.jsx(M,{open:!!y,onOpenChange:s=>!s&&D(null),title:"Delete expense?",description:"This will permanently delete this expense record. This action cannot be undone.",onConfirm:P})]})}function me(){const[d,i]=c.useState(!1),[u,x]=c.useState(null),[h,w]=c.useState(0),f=()=>{x(null),i(!0)},b=n=>{x(n),i(!0)},C=()=>{i(!1),x(null)},g=()=>{w(n=>n+1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsx(K,{onAddExpense:f,onEditExpense:b,refreshTrigger:h})}),e.jsx(B,{open:d,onOpenChange:i,expense:u,onClose:C,onSuccess:g})]})}export{me as ExpensesPage};
