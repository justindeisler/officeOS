import{r as a,j as e}from"./vendor-react-DeR5d9Tv.js";import{g as H,a as W,b as Q,c as U}from"./client-DV_YJGvU.js";import{n as z,s as b,M as R,j as h,a as N,C as L,I as G,l as T}from"./index-B9wpeZVf.js";import{T as J}from"./textarea-CZihQ_1Z.js";import{D as V,a as X,b as Y,c as Z,d as $,e as ee}from"./dialog-FtNsGa4T.js";import{P as F}from"./plus-BG4HFTMm.js";import{C as te}from"./calendar-BXLbKi9j.js";import{f as I}from"./vendor-date-fns-D0ugVOfH.js";import"./vendor-markdown-PIr_2kdo.js";import"./vendor-recharts-DrMJw15s.js";import"./vendor-radix-sPo3_CXI.js";import"./vendor-floating-ui-CESiY8Ey.js";import"./vendor-router-9bGSKQ4q.js";const se=z("ClientDashboard"),ae={backlog:"border-t-slate-400",queue:"border-t-blue-400",in_progress:"border-t-amber-400",done:"border-t-green-400"},_={1:"bg-destructive/20 text-destructive",2:"bg-warning/20 text-warning",3:"bg-muted text-muted-foreground"},re={1:"High",2:"Medium",3:"Low"};function ne({task:s}){const r=n=>n?I(new Date(n),"MMM d"):null,c=s.due_date&&new Date(s.due_date)<new Date&&s.status!=="done";return e.jsxs("div",{className:"group rounded-lg border bg-card p-3 shadow-sm transition-all hover:shadow-md",children:[e.jsx("h4",{className:"font-medium text-sm leading-tight",children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[s.priority&&e.jsx("span",{className:h("inline-flex items-center rounded px-1.5 py-0.5 text-xs font-medium",_[s.priority]||_[3]),children:re[s.priority]||"Low"}),s.due_date&&e.jsxs("span",{className:h("inline-flex items-center gap-1 text-xs",c?"text-destructive":"text-muted-foreground"),children:[e.jsx(te,{className:"h-3 w-3"}),r(s.due_date)]}),!!s.quick_capture&&e.jsx("span",{className:"inline-flex items-center rounded px-1.5 py-0.5 text-xs font-medium bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400",children:"Request"})]})]})}function g({title:s,tasks:r,status:c}){return e.jsxs("div",{className:h("flex flex-col rounded-lg border border-t-4 bg-muted/30",ae[c]),children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsx("h3",{className:"font-semibold text-sm",children:s}),e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-muted px-2 py-0.5 text-xs font-medium text-muted-foreground",children:r.length})]}),e.jsx("div",{className:"flex-1 p-2 space-y-2 min-h-[200px]",children:r.length===0?e.jsx("div",{className:"flex items-center justify-center h-20 text-sm text-muted-foreground",children:"No tasks"}):r.map(n=>e.jsx(ne,{task:n},n.id))})]})}function be(){const[s,r]=a.useState([]),[c,n]=a.useState(!0),[y,M]=a.useState(null),[u,w]=a.useState(null),[x,E]=a.useState([]),[O,m]=a.useState(!1),[d,v]=a.useState(""),[k,D]=a.useState(""),[f,C]=a.useState(!1);a.useEffect(()=>{P(),q()},[]);const q=async()=>{try{const t=await H();E(t.requests)}catch(t){se.error({err:t},"Failed to load pending requests")}},P=async()=>{try{n(!0);const t=await W(),p=t.projects.map(l=>({...l,tasksLoading:!0}));r(p),t.projects.length>0&&w(t.projects[0].id);const A=t.projects.map(async l=>{try{const o=await Q(l.id);return{projectId:l.id,kanbanData:o,error:null}}catch(o){return{projectId:l.id,kanbanData:null,error:o}}}),K=await Promise.all(A);r(l=>l.map(o=>{const j=K.find(B=>B.projectId===o.id);return{...o,kanbanData:(j==null?void 0:j.kanbanData)||void 0,tasksLoading:!1}}))}catch(t){M(t instanceof Error?t.message:"Failed to load dashboard")}finally{n(!1)}},S=async()=>{if(!(!d.trim()||!u))try{C(!0),await U(u,d.trim(),k.trim()||void 0,!0,d.trim()),T.success("Request submitted successfully"),m(!1),v(""),D(""),await Promise.all([P(),q()])}catch(t){T.error(t instanceof Error?t.message:"Failed to submit request")}finally{C(!1)}},i=s.find(t=>t.id===u);return c?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[e.jsx(b,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading dashboard..."})]}):y?e.jsx("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:e.jsx("p",{className:"text-destructive font-medium",children:y})}):s.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Tasks"})}),e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4 rounded-lg border bg-muted/30",children:[e.jsx(R,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"No projects assigned"})]})]}):e.jsxs("div",{className:"space-y-6",children:[s.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:s.map(t=>e.jsx("button",{onClick:()=>w(t.id),className:h("px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors",u===t.id?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80 text-muted-foreground"),children:t.name},t.id))}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Tasks"}),e.jsxs(N,{onClick:()=>m(!0),className:"w-full sm:w-auto",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"New Request"]})]}),e.jsxs("div",{className:"rounded-lg bg-white dark:bg-card border shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 border-b",children:[e.jsx(L,{className:"h-5 w-5 text-amber-500"}),e.jsx("h2",{className:"font-semibold text-base",children:"Pending Review"}),x.length>0&&e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-100 dark:bg-amber-900/50 px-2.5 py-0.5 text-xs font-medium text-amber-700 dark:text-amber-300",children:x.length})]}),e.jsx("div",{className:"p-4",children:x.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center mb-3",children:e.jsx(L,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No requests pending review"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"New requests will appear here"})]}):e.jsx("div",{className:"space-y-3",children:x.map(t=>{var p;return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/30 border",children:[e.jsx("div",{className:"mt-1.5 h-2 w-2 rounded-full bg-amber-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm",children:((p=t.metadata)==null?void 0:p.original_title)||t.content}),e.jsxs("div",{className:"flex items-center gap-2 mt-1.5 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Submitted ",I(new Date(t.created_at),"MMM d")]}),e.jsx("span",{className:"inline-flex items-center rounded px-1.5 py-0.5 text-xs font-medium bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-300",children:"Awaiting review"})]})]})]},t.id)})})})]}),i&&(i.tasksLoading?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[e.jsx(b,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading tasks..."})]}):i.kanbanData?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(g,{title:"Backlog",tasks:i.kanbanData.kanban.backlog,status:"backlog"}),e.jsx(g,{title:"Queue",tasks:i.kanbanData.kanban.queue||[],status:"queue"}),e.jsx(g,{title:"In Progress",tasks:i.kanbanData.kanban.in_progress,status:"in_progress"}),e.jsx(g,{title:"Done",tasks:i.kanbanData.kanban.done,status:"done"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4 rounded-lg border bg-muted/30",children:[e.jsx(R,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Failed to load tasks"})]})),e.jsx(V,{open:O,onOpenChange:m,children:e.jsxs(X,{children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Submit a Request"}),e.jsx($,{children:"Describe what you need and it will be added to the project backlog."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"title",className:"text-sm font-medium",children:["What do you need? ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(G,{id:"title",placeholder:"e.g., Update homepage banner, Fix contact form...",value:d,onChange:t=>v(t.target.value),onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&d.trim()&&S()},autoFocus:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"description",className:"text-sm font-medium",children:"Details (optional)"}),e.jsx(J,{id:"description",placeholder:"Add any additional context, requirements, or links...",value:k,onChange:t=>D(t.target.value),rows:4})]})]}),e.jsxs(ee,{children:[e.jsx(N,{variant:"outline",onClick:()=>m(!1),disabled:f,children:"Cancel"}),e.jsx(N,{onClick:S,disabled:!d.trim()||f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-4 w-4 mr-2 animate-spin"}),"Submitting..."]}):"Submit Request"})]})]})}),e.jsx("button",{onClick:()=>m(!0),className:"fixed bottom-6 right-6 md:hidden w-14 h-14 bg-primary text-primary-foreground rounded-full shadow-lg hover:bg-primary/90 transition-colors flex items-center justify-center","aria-label":"New Request",children:e.jsx(F,{className:"h-6 w-6"})})]})}export{be as ClientDashboard};
