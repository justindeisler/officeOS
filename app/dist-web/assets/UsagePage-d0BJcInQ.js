import{r as c,j as e}from"./vendor-react-nkeu7MKf.js";import{C as S,a as O,b as F,d as A,c as E}from"./card-DcYCBqFU.js";import{c as j,W as H,T as R,Z as I,B as L,m as Q}from"./index-Bq9JOXc-.js";import{T as X,a as Y,b as M}from"./tabs-DtMJx56S.js";import{S as ee,a as te,b as ae,c as se,d as k}from"./select-DhYjehN7.js";import{u as le,D as oe,a as re,b as ne,M as ie,O as ce,f as i,S as de,R as me,c as ue,d as y,E as he}from"./SortableTable-1VXLG7Bw.js";import{C as pe}from"./calendar-BNREcHMx.js";import{f as v,x as xe}from"./vendor-date-fns-D0ugVOfH.js";import"./vendor-markdown-zaQAhtrl.js";import"./vendor-recharts-COauwCrp.js";import"./vendor-radix-Oq5tdvA1.js";import"./vendor-floating-ui-_Y3uXdsy.js";import"./vendor-router-bCYKpmtI.js";import"./info-CBSAcddX.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=j("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=j("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=j("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=j("CalendarRange",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=j("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]),ke={"opus-4-5":{label:"Opus 4.5",color:"hsl(var(--chart-1))"},"sonnet-4-5":{label:"Sonnet 4.5",color:"hsl(var(--chart-2))"},"haiku-4-5":{label:"Haiku 4.5",color:"hsl(var(--chart-3))"}},ve={input:{label:"Input Tokens",color:"hsl(var(--chart-2))"},output:{label:"Output Tokens",color:"hsl(var(--chart-3))"}},B={input:{label:"Input",color:"hsl(var(--chart-2))"},output:{label:"Output",color:"hsl(var(--chart-3))"}},we={tokens:{label:"Tokens"},"opus-4-5":{label:"Opus 4.5",color:"hsl(var(--chart-1))"},"sonnet-4-5":{label:"Sonnet 4.5",color:"hsl(var(--chart-2))"},"haiku-4-5":{label:"Haiku 4.5",color:"hsl(var(--chart-3))"}},b={"opus-4-5":"Opus 4.5","sonnet-4-5":"Sonnet 4.5","haiku-4-5":"Haiku 4.5"},d={"opus-4-5":"hsl(var(--chart-1))","sonnet-4-5":"hsl(var(--chart-2))","haiku-4-5":"hsl(var(--chart-3))"},Ne={timestamp:(t,o)=>new Date(t.timestamp).getTime()-new Date(o.timestamp).getTime(),model:(t,o)=>t.model.localeCompare(o.model),inputTokens:(t,o)=>t.inputTokens-o.inputTokens,outputTokens:(t,o)=>t.outputTokens-o.outputTokens,total:(t,o)=>t.total-o.total};function U(t){return(o,f)=>{var h;return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-muted-foreground",children:[((h=t[f])==null?void 0:h.label)||f,":"]})," ",e.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:o.toLocaleString()})]})}}function Ue(){const[t,o]=c.useState(null),[f,h]=c.useState(!0),[T,C]=c.useState(null),[m,$]=c.useState("day"),[n,z]=c.useState("all");c.useEffect(()=>{(async()=>{h(!0),C(null);try{const l=xe(new Date,30).toISOString().slice(0,10),a=new Date().toISOString().slice(0,10),r=await Q.getTokenUsage({startDate:l,endDate:a,groupBy:m,model:n==="all"?void 0:n});o(r)}catch(l){console.error("Failed to fetch usage data:",l),C("Failed to load usage data")}finally{h(!1)}})()},[m,n]);const{sortField:p,sortDirection:x,toggleSort:g,displayed:W,expanded:D,setExpanded:_,canExpand:K,totalCount:V}=le({data:(t==null?void 0:t.sessions)??[],defaultField:"timestamp",comparators:Ne}),q=c.useMemo(()=>{if(!t)return[];const s=a=>m==="day"?v(new Date(a),"MMM d"):m==="week"?`W${v(new Date(a),"w")}`:v(new Date(a),"MMM yyyy");if(n!=="all")return t.trend.map(a=>({date:s(a.date),input:a.inputTokens,output:a.outputTokens}));const l=new Map;for(const a of t.trend){const r=s(a.date);l.has(r)||l.set(r,{});const u=l.get(r);u[a.model]=(u[a.model]||0)+a.tokens}return Array.from(l.entries()).map(([a,r])=>({date:a,...r}))},[t,m,n]),P=c.useMemo(()=>{if(!t)return[];const s=Object.values(t.byModel).reduce((l,a)=>l+a.total,0);return Object.entries(t.byModel).map(([l,a])=>({model:l,name:b[l]||l,tokens:a.total,value:s>0?Math.round(a.total/s*100):0,fill:d[l]||"hsl(var(--chart-4))"})).sort((l,a)=>a.value-l.value)},[t]),Z=c.useMemo(()=>t?Object.entries(t.byModel).map(([s,l])=>({name:b[s]||s,input:l.input,output:l.output})):[],[t]),w=n!=="all"?ve:ke,G=Object.keys(w);return e.jsx(e.Fragment,{children:f?e.jsx(oe,{}):T||!t?e.jsx(re,{message:T??void 0}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(ne,{icon:H,title:"Token Usage",description:"Track AI token consumption across models",actions:e.jsxs(ee,{value:n,onValueChange:z,children:[e.jsxs(te,{className:"w-[140px]",children:[e.jsx(fe,{className:"h-3.5 w-3.5 mr-1.5 text-muted-foreground"}),e.jsx(ae,{placeholder:"All Models"})]}),e.jsxs(se,{children:[e.jsx(k,{value:"all",children:"All Models"}),e.jsx(k,{value:"opus-4-5",children:"Opus 4.5"}),e.jsx(k,{value:"sonnet-4-5",children:"Sonnet 4.5"}),e.jsx(k,{value:"haiku-4-5",children:"Haiku 4.5"})]})]})}),t._mock&&e.jsxs(ie,{children:[e.jsx("span",{className:"font-medium",children:"Sample data."})," Real token tracking will be integrated when Clawdbot gateway exposes per-session usage metrics."]}),e.jsx("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-4",children:[{title:"All Time",icon:R,key:"total",accent:"bg-chart-1/10 text-chart-1"},{title:"This Month",icon:je,key:"month",accent:"bg-chart-2/10 text-chart-2"},{title:"This Week",icon:be,key:"week",accent:"bg-chart-3/10 text-chart-3"},{title:"Today",icon:pe,key:"today",accent:"bg-chart-4/10 text-chart-4"}].map(({title:s,icon:l,key:a,accent:r})=>{const u=a==="total"?t.overview.total:t.overview[a],N=t.overview[a==="total"?"totalInput":`${a}Input`],J=t.overview[a==="total"?"totalOutput":`${a}Output`];return e.jsx(ce,{title:s,icon:l,accent:r,value:i(u),children:e.jsxs("div",{className:"flex items-center gap-3 pt-1",children:[e.jsxs("span",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ye,{className:"h-3 w-3 text-chart-2"}),i(N)," in"]}),e.jsxs("span",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ge,{className:"h-3 w-3 text-chart-3"}),i(J)," out"]})]})},a)})}),e.jsxs("div",{className:"grid gap-4 sm:gap-6 lg:grid-cols-3",children:[e.jsxs(S,{className:"lg:col-span-2",children:[e.jsxs(O,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0 space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsxs(F,{className:"text-lg flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Usage Trend"]}),e.jsx(A,{className:"mt-1",children:n!=="all"?`${b[n]} — input vs output tokens`:"Token usage stacked by model"})]}),e.jsx(X,{value:m,onValueChange:$,children:e.jsxs(Y,{className:"h-8",children:[e.jsx(M,{value:"day",className:"text-xs px-2.5 h-6",children:"Daily"}),e.jsx(M,{value:"week",className:"text-xs px-2.5 h-6",children:"Weekly"}),e.jsx(M,{value:"month",className:"text-xs px-2.5 h-6",children:"Monthly"})]})})]}),e.jsx(E,{children:e.jsx(de,{data:q,config:w,dataKeys:G,gradientPrefix:"fill",yTickFormatter:s=>i(s),tooltipFormatter:U(w)})})]}),e.jsx(me,{config:we,data:P,icon:I,title:"By Model",description:"Token distribution across models",legend:e.jsx("div",{className:"space-y-3 px-2 pb-4",children:Object.entries(t.byModel).map(([s,l])=>{const a=Object.values(t.byModel).reduce((u,N)=>u+N.total,0),r=a>0?(l.total/a*100).toFixed(1):"0";return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-3 h-3 rounded-[2px] flex-shrink-0",style:{backgroundColor:d[s]}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:b[s]}),e.jsxs("span",{className:"text-sm text-muted-foreground tabular-nums",children:[r,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[i(l.input)," in"]}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[i(l.output)," out"]})]})]})]},s)})})})]}),e.jsx(ue,{icon:H,title:"Input vs Output by Model",description:"Compare input and output token usage across each model",config:B,data:Z,dataKeys:["input","output"],yTickFormatter:s=>i(s),tooltipFormatter:U(B)}),e.jsxs(S,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs("div",{children:[e.jsxs(F,{className:"text-lg flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Recent Sessions"]}),e.jsx(A,{className:"mt-1",children:"Detailed breakdown of individual sessions"})]}),e.jsxs(L,{variant:"outline",className:"text-xs",children:[t.sessions.length," sessions"]})]}),e.jsxs(E,{children:[e.jsx("div",{className:"overflow-x-auto -mx-6 px-6",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx(y,{field:"timestamp",label:"Date",activeField:p,direction:x,onToggle:g}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-muted-foreground hidden sm:table-cell",children:"Activity"}),e.jsx(y,{field:"model",label:"Model",activeField:p,direction:x,onToggle:g}),e.jsx(y,{field:"inputTokens",label:"Input",activeField:p,direction:x,onToggle:g,align:"right",className:"hidden md:table-cell"}),e.jsx(y,{field:"outputTokens",label:"Output",activeField:p,direction:x,onToggle:g,align:"right",className:"hidden md:table-cell"}),e.jsx(y,{field:"total",label:"Total",activeField:p,direction:x,onToggle:g,align:"right"})]})}),e.jsx("tbody",{children:W.map(s=>e.jsxs("tr",{className:"border-b border-border/50 hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"py-2.5 px-2 whitespace-nowrap text-muted-foreground",children:v(new Date(s.timestamp),"MMM d, HH:mm")}),e.jsx("td",{className:"py-2.5 px-2 hidden sm:table-cell",children:e.jsx("span",{className:"truncate block max-w-[300px]",children:s.activity})}),e.jsx("td",{className:"py-2.5 px-2",children:e.jsx(L,{variant:"outline",className:"text-xs font-normal",style:{borderColor:d[s.model]?`color-mix(in srgb, ${d[s.model]} 40%, transparent)`:void 0,color:d[s.model],backgroundColor:d[s.model]?`color-mix(in srgb, ${d[s.model]} 10%, transparent)`:void 0},children:b[s.model]||s.model})}),e.jsx("td",{className:"py-2.5 px-2 text-right tabular-nums text-muted-foreground hidden md:table-cell",children:i(s.inputTokens)}),e.jsx("td",{className:"py-2.5 px-2 text-right tabular-nums text-muted-foreground hidden md:table-cell",children:i(s.outputTokens)}),e.jsx("td",{className:"py-2.5 px-2 text-right tabular-nums font-medium",children:i(s.total)})]},s.id))})]})}),K&&e.jsx(he,{expanded:D,totalCount:V,label:"Sessions",onToggle:()=>_(!D)})]})]})]})})}export{Ue as UsagePage};
