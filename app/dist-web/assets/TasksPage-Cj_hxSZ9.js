import{j as e,r as i}from"./vendor-react-nkeu7MKf.js";import{c as de,j as O,X as ue,k as te,a as B,I as ee,L,l as P,m as K,B as Qe,U as We,F as be,n as ie,u as V,f as ve,o as Xe,p as ye,q as Ye,t as Ze,r as He}from"./index-CJ4fj71d.js";import{u as Ne,a as le,s as we,K as ke,P as Se,b as et,D as Ce,c as tt,S as Te,v as De,d as Fe,C as Ie,e as st,f as at,g as rt}from"./vendor-dnd-CdmezjDq.js";import{g as nt,T as ot,h as it,C as Oe}from"./vendor-radix-Oq5tdvA1.js";import{D as Ee,a as Ae,b as Re,c as Me,d as Pe,e as Le}from"./dialog-C8XP0moa.js";import"./alert-dialog-CbG9z7pG.js";import{C as ge}from"./chevron-right-BPJdtVA8.js";import{P as se}from"./plus-DxV0H5cT.js";import{G as ze}from"./grip-vertical-CP1ghaEt.js";import{C as me,S as G,a as Q,b as W,c as X,d as F}from"./select-Dd7vmkLO.js";import{T as xe}from"./trash-2-BxcYN-z3.js";import{F as lt}from"./folder-open-6zuZOS3R.js";import{M as ct}from"./message-square-CAjb07oX.js";import{C as dt}from"./calendar-BkRn3Kwz.js";import{E as ut}from"./ellipsis-VrwO2S--.js";import{f as Je}from"./vendor-date-fns-D0ugVOfH.js";import{T as mt}from"./textarea-DDuGbwvN.js";import{S as xt}from"./switch-BtM8oOFj.js";import{C as Be}from"./confirm-delete-dialog-BZdkYIVy.js";import{e as ht,g as gt,d as pt}from"./markdown-DZSA0cWY.js";import{D as ft}from"./download-Fr7kZ0XN.js";import{u as jt}from"./confettiStore-DMd7Nw1d.js";import{S as bt}from"./search-DZPq2hiK.js";import{P as pe}from"./pencil-BOQIFP2s.js";import"./vendor-markdown-zaQAhtrl.js";import"./vendor-recharts-COauwCrp.js";import"./vendor-router-bCYKpmtI.js";import"./vendor-floating-ui-_Y3uXdsy.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=de("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=de("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=de("Tags",[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]]);function Nt(a){const t=a.replace("#",""),s=parseInt(t.substring(0,2),16),o=parseInt(t.substring(2,4),16),x=parseInt(t.substring(4,6),16);return(.299*s+.587*o+.114*x)/255>.55?"#000000":"#ffffff"}function ce({tag:a,onRemove:t,className:s,size:o="sm"}){const x=a.color||"#6b7280",g=Nt(x);return e.jsxs("span",{className:O("inline-flex items-center gap-1 rounded-full font-medium whitespace-nowrap",o==="sm"?"px-1.5 py-0.5 text-[10px] leading-tight":"px-2 py-0.5 text-xs",s),style:{backgroundColor:x,color:g},children:[a.name,t&&e.jsx("button",{type:"button",onClick:d=>{d.stopPropagation(),t()},className:"ml-0.5 rounded-full hover:opacity-80 focus:outline-none",style:{color:g},children:e.jsx(ue,{className:o==="sm"?"h-2.5 w-2.5":"h-3 w-3"})})]})}const qe=nt,Ve=ot,he=i.forwardRef(({className:a,align:t="center",sideOffset:s=4,...o},x)=>e.jsx(it,{children:e.jsx(Oe,{ref:x,align:t,sideOffset:s,className:O("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...o})}));he.displayName=Oe.displayName;function wt({selectedIds:a,onChange:t}){const{tags:s,createTag:o}=te(),[x,g]=i.useState(!1),[d,n]=i.useState(""),[m,j]=i.useState(!1),w=s.filter(r=>r.name.toLowerCase().includes(d.toLowerCase())),k=s.filter(r=>a.includes(r.id)),b=r=>{a.includes(r)?t(a.filter(l=>l!==r)):t([...a,r])},y=async()=>{if(!d.trim()||m)return;j(!0);const r=await o({name:d.trim()});r&&(t([...a,r.id]),n("")),j(!1)},T=d.trim()&&w.length===0;return e.jsxs(qe,{open:x,onOpenChange:g,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(B,{type:"button",variant:"outline",role:"combobox","aria-expanded":x,className:"w-full justify-between h-auto min-h-10",children:[k.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:k.map(r=>e.jsx(ce,{tag:r,onRemove:()=>b(r.id)},r.id))}):e.jsx("span",{className:"text-muted-foreground",children:"Select tags..."}),e.jsx(vt,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsxs(he,{className:"w-[280px] p-2",align:"start",children:[e.jsx(ee,{placeholder:"Search or create tag...",value:d,onChange:r=>n(r.target.value),className:"mb-2 h-8 text-sm",onKeyDown:r=>{r.key==="Enter"&&T&&(r.preventDefault(),y())}}),e.jsxs("div",{className:"max-h-48 overflow-y-auto",children:[w.map(r=>e.jsx(kt,{tag:r,selected:a.includes(r.id),onToggle:()=>b(r.id)},r.id)),T&&e.jsxs("button",{type:"button",onClick:y,disabled:m,className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm text-muted-foreground hover:bg-accent hover:text-accent-foreground",children:[e.jsx(se,{className:"h-3.5 w-3.5"}),'Create "',d.trim(),'"']}),!d&&s.length===0&&e.jsx("p",{className:"px-2 py-3 text-center text-sm text-muted-foreground",children:"No tags yet. Type to create one."})]})]})]})}function kt({tag:a,selected:t,onToggle:s}){return e.jsxs("button",{type:"button",onClick:s,className:O("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-accent hover:text-accent-foreground",t&&"bg-accent/50"),children:[e.jsx("span",{className:"h-3 w-3 rounded-full shrink-0 border border-white/20",style:{backgroundColor:a.color||"#6b7280"}}),e.jsx("span",{className:"flex-1 text-left truncate",children:a.name}),t&&e.jsx(me,{className:"h-3.5 w-3.5 text-primary shrink-0"})]})}function St(){const{tags:a,filterTagIds:t,setFilterTagIds:s}=te(),[o,x]=i.useState(!1);if(a.length===0)return null;const g=n=>{t.includes(n)?s(t.filter(m=>m!==n)):s([...t,n])},d=()=>s([]);return e.jsxs(qe,{open:o,onOpenChange:x,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(B,{variant:"outline",size:"sm",className:"h-10 gap-2",children:[e.jsx(yt,{className:"h-4 w-4"}),"Tags",t.length>0&&e.jsx("span",{className:"ml-1 flex h-5 w-5 items-center justify-center rounded-full bg-primary text-[10px] font-bold text-primary-foreground",children:t.length})]})}),e.jsxs(he,{className:"w-56 p-2",align:"start",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 pb-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Filter by tag"}),t.length>0&&e.jsxs("button",{onClick:d,className:"text-xs text-muted-foreground hover:text-foreground flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3"}),"Clear"]})]}),e.jsx("div",{className:"max-h-56 overflow-y-auto space-y-0.5",children:a.map(n=>{const m=t.includes(n.id);return e.jsxs("button",{onClick:()=>g(n.id),className:O("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-accent transition-colors",m&&"bg-accent"),children:[e.jsx("span",{className:O("h-3 w-3 rounded-full shrink-0 border-2 transition-colors",m?"border-primary":"border-transparent"),style:{backgroundColor:n.color||"#6b7280"}}),e.jsx("span",{className:"flex-1 text-left truncate",children:n.name}),m&&e.jsx("span",{className:"text-xs text-primary font-medium",children:"âœ“"})]},n.id)})})]})]})}const oe=["#ef4444","#f97316","#f59e0b","#eab308","#22c55e","#14b8a6","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#a855f7","#ec4899","#6b7280","#1e293b"];function Ct({open:a,onOpenChange:t}){const{tags:s,createTag:o,updateTag:x,deleteTag:g}=te(),[d,n]=i.useState(null),[m,j]=i.useState(""),[w,k]=i.useState(oe[0]),[b,y]=i.useState(null),[T,r]=i.useState(!1),l=()=>{n(null),j(""),k(oe[0])},p=u=>{n(u),j(u.name),k(u.color||oe[0])},h=async u=>{if(u.preventDefault(),!(!m.trim()||T)){r(!0);try{d?(await x(d.id,{name:m.trim(),color:w}),P.success(`Tag "${m.trim()}" updated`)):await o({name:m.trim(),color:w})&&P.success(`Tag "${m.trim()}" created`),l()}finally{r(!1)}}},v=async()=>{b&&(await g(b.id),P.success(`Tag "${b.name}" deleted`),y(null),(d==null?void 0:d.id)===b.id&&l())};return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{open:a,onOpenChange:u=>{t(u),u||l()},children:e.jsxs(Ae,{className:"w-[calc(100vw-2rem)] max-w-[480px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Re,{children:[e.jsxs(Me,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5"}),"Manage Tags"]}),e.jsx(Pe,{children:"Create, edit, and delete tags used to organize your tasks."})]}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"tag-name",children:d?"Edit Tag":"New Tag"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ee,{id:"tag-name",value:m,onChange:u=>j(u.target.value),placeholder:"Tag name...",className:"flex-1",autoComplete:"off"}),e.jsx(B,{type:"submit",size:"sm",disabled:!m.trim()||T,children:d?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-3.5 w-3.5 mr-1"}),"Save"]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-3.5 w-3.5 mr-1"}),"Add"]})}),d&&e.jsx(B,{type:"button",variant:"ghost",size:"sm",onClick:l,children:"Cancel"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{children:"Color"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[oe.map(u=>e.jsx("button",{type:"button",onClick:()=>k(u),className:"h-7 w-7 rounded-full border-2 transition-all hover:scale-110",style:{backgroundColor:u,borderColor:w===u?"var(--primary)":"transparent",boxShadow:w===u?"0 0 0 2px var(--background), 0 0 0 4px var(--primary)":void 0},title:u},u)),e.jsxs("label",{className:"relative h-7 w-7 rounded-full border-2 border-dashed border-muted-foreground/40 flex items-center justify-center cursor-pointer hover:border-muted-foreground/70 transition-colors",title:"Custom color",children:[e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground",children:"#"}),e.jsx("input",{type:"color",value:w,onChange:u=>k(u.target.value),className:"absolute inset-0 opacity-0 cursor-pointer"})]})]}),m.trim()&&e.jsxs("div",{className:"pt-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground mr-2",children:"Preview:"}),e.jsx(ce,{tag:{id:"preview",name:m.trim(),color:w},size:"md"})]})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsxs("h4",{className:"text-sm font-medium mb-3",children:["Existing Tags (",s.length,")"]}),s.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No tags yet. Create one above!"}):e.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:s.map(u=>e.jsxs("div",{className:"flex items-center justify-between rounded-md px-2 py-1.5 hover:bg-muted/50 group",children:[e.jsx(ce,{tag:u,size:"md"}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>p(u),className:"p-1 rounded hover:bg-muted",title:"Edit tag",children:e.jsx(pe,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsx("button",{onClick:()=>y(u),className:"p-1 rounded hover:bg-destructive/10",title:"Delete tag",children:e.jsx(xe,{className:"h-3.5 w-3.5 text-destructive"})})]})]},u.id))})]}),e.jsx(Le,{children:e.jsx(B,{variant:"outline",onClick:()=>t(!1),children:"Done"})})]})}),e.jsx(Be,{open:!!b,onOpenChange:u=>{u||y(null)},title:`Delete tag "${b==null?void 0:b.name}"?`,description:"This will remove the tag from all tasks. This action cannot be undone.",onConfirm:v})]})}function Tt(a){const t={};for(const[s,o]of Object.entries(a)){const x=s.replace(/_([a-z])/g,(g,d)=>d.toUpperCase());t[x]=o}return t}function fe(a){const t=Tt(a);return{id:t.id,taskId:t.taskId,title:t.title,completed:!!t.completed,sortOrder:t.sortOrder??0,createdAt:t.createdAt}}function Dt({taskId:a,enabled:t=!0}){const[s,o]=i.useState([]),[x,g]=i.useState(!1),[d,n]=i.useState(null),m=i.useRef(!1),j=i.useCallback(async()=>{if(!(!a||!t)){g(!0),n(null);try{const l=(await K.getSubtasks(a)).map(fe);o(l),m.current=!0}catch(r){console.error("Failed to fetch subtasks:",r),n("Failed to load subtasks")}finally{g(!1)}}},[a,t]);i.useEffect(()=>{t&&!m.current&&j()},[t,j]),i.useEffect(()=>{m.current=!1,o([])},[a]);const w=i.useCallback(async r=>{if(!r.trim())return;const l=crypto.randomUUID(),p={id:l,taskId:a,title:r.trim(),completed:!1,sortOrder:s.length,createdAt:new Date().toISOString()};o(h=>[...h,p]);try{const h=await K.createSubtask(a,r.trim()),v=fe(h);o(u=>u.map(I=>I.id===l?v:I))}catch(h){console.error("Failed to create subtask:",h),o(v=>v.filter(u=>u.id!==l)),P.error("Failed to add subtask")}},[a,s.length]),k=i.useCallback(async(r,l)=>{o(p=>p.map(h=>h.id===r?{...h,completed:l}:h));try{await K.updateSubtask(r,{completed:l?1:0})}catch(p){console.error("Failed to toggle subtask:",p),o(h=>h.map(v=>v.id===r?{...v,completed:!l}:v)),P.error("Failed to update subtask")}},[]),b=i.useCallback(async(r,l)=>{var h;if(!l.trim())return;const p=(h=s.find(v=>v.id===r))==null?void 0:h.title;o(v=>v.map(u=>u.id===r?{...u,title:l.trim()}:u));try{await K.updateSubtask(r,{title:l.trim()})}catch(v){console.error("Failed to update subtask:",v),p&&o(u=>u.map(I=>I.id===r?{...I,title:p}:I)),P.error("Failed to update subtask")}},[s]),y=i.useCallback(async r=>{const l=s;o(p=>p.filter(h=>h.id!==r));try{await K.deleteSubtask(r)}catch(p){console.error("Failed to delete subtask:",p),o(l),P.error("Failed to delete subtask")}},[s]),T=i.useCallback(async r=>{const l=s,p=r.map(h=>s.find(v=>v.id===h)).filter(h=>h!==void 0).map((h,v)=>({...h,sortOrder:v}));o(p);try{await K.reorderSubtasks(a,r)}catch(h){console.error("Failed to reorder subtasks:",h),o(l),P.error("Failed to reorder subtasks")}},[a,s]);return{subtasks:s,isLoading:x,error:d,addSubtask:w,toggleSubtask:k,updateSubtask:b,deleteSubtask:y,reorderSubtasks:T,refresh:j}}function Ft({subtask:a,onToggle:t,onDelete:s}){const{attributes:o,listeners:x,setNodeRef:g,transform:d,transition:n,isDragging:m}=Fe({id:a.id}),j={transform:Ie.Transform.toString(d),transition:n};return e.jsxs("div",{ref:g,style:j,className:O("group flex items-center gap-2 py-1.5 px-1 rounded-md transition-colors",m&&"opacity-50 bg-muted",!m&&"hover:bg-muted/50"),children:[e.jsx("button",{className:"cursor-grab touch-none opacity-0 group-hover:opacity-60 transition-opacity shrink-0",...o,...x,children:e.jsx(ze,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsx("button",{onClick:()=>t(a.id,!a.completed),className:O("shrink-0 w-4 h-4 rounded-full border-2 flex items-center justify-center transition-all duration-200",a.completed?"bg-green-500 border-green-500":"border-muted-foreground/50 hover:border-green-500"),children:a.completed&&e.jsx(me,{className:"h-2.5 w-2.5 text-white",strokeWidth:3})}),e.jsx("span",{className:O("flex-1 text-sm transition-all",a.completed&&"text-muted-foreground line-through"),children:a.title}),e.jsx("button",{onClick:()=>s(a.id),className:"opacity-0 group-hover:opacity-60 hover:opacity-100 transition-opacity p-0.5 hover:text-destructive",children:e.jsx(xe,{className:"h-3.5 w-3.5"})})]})}function It({onAdd:a,onCancel:t}){const[s,o]=i.useState(""),x=i.useRef(null);i.useEffect(()=>{var n;(n=x.current)==null||n.focus()},[]);const g=()=>{s.trim()&&(a(s.trim()),o(""))},d=n=>{n.key==="Enter"?(n.preventDefault(),g()):n.key==="Escape"&&t()};return e.jsxs("div",{className:"flex items-center gap-2 py-1.5 px-1",children:[e.jsx("div",{className:"w-3.5"})," ",e.jsx("div",{className:"shrink-0 w-4 h-4 rounded-full border-2 border-muted-foreground/30"}),e.jsx("input",{ref:x,type:"text",value:s,onChange:n=>o(n.target.value),onKeyDown:d,onBlur:()=>{s.trim()||t()},placeholder:"Add subtask...",className:"flex-1 text-sm bg-transparent border-none outline-none placeholder:text-muted-foreground/50"}),e.jsx("button",{onClick:g,className:"p-0.5 text-green-500 hover:text-green-600 transition-colors",disabled:!s.trim(),children:e.jsx(me,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:t,className:"p-0.5 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(ue,{className:"h-3.5 w-3.5"})})]})}function Ot({taskId:a,counts:t,onCountChange:s}){const[o,x]=i.useState(!1),[g,d]=i.useState(!1),{subtasks:n,isLoading:m,addSubtask:j,toggleSubtask:w,deleteSubtask:k,reorderSubtasks:b}=Dt({taskId:a,enabled:o});i.useEffect(()=>{if(s&&n.length>0){const p={total:n.length,completed:n.filter(h=>h.completed).length};s(p)}},[n,s]);const y=Ne(le(Se,{activationConstraint:{distance:5}}),le(ke,{coordinateGetter:we})),T=i.useCallback(p=>{const{active:h,over:v}=p;if(!v||h.id===v.id)return;const u=n.findIndex(A=>A.id===h.id),I=n.findIndex(A=>A.id===v.id);if(u!==I){const A=et(n,u,I);b(A.map(U=>U.id))}},[n,b]),r=i.useCallback(async p=>{await j(p)},[j]),l=o?{total:n.length,completed:n.filter(p=>p.completed).length}:t||{total:0,completed:0};return!o&&l.total===0?null:e.jsxs("div",{className:"mt-2",children:[!o&&l.total>0&&e.jsxs("button",{onClick:()=>x(!0),className:O("inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-colors","bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400","hover:bg-slate-200 dark:hover:bg-slate-700"),children:[e.jsx(ge,{className:"h-3 w-3"}),e.jsxs("span",{children:[l.completed,"/",l.total," Sub-Tasks"]})]}),o&&e.jsxs("div",{className:"rounded-lg border bg-card/50 p-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("button",{onClick:()=>x(!1),className:"text-xs font-medium text-muted-foreground hover:text-foreground flex items-center gap-1 transition-colors",children:[e.jsx(ge,{className:"h-3 w-3 rotate-90"}),"Subtasks"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[l.completed,"/",l.total]})]}),m&&n.length===0?e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"Loading..."}):e.jsx(Ce,{sensors:y,collisionDetection:tt,onDragEnd:T,children:e.jsx(Te,{items:n.map(p=>p.id),strategy:De,children:e.jsx("div",{className:"space-y-0.5",children:n.map(p=>e.jsx(Ft,{subtask:p,onToggle:w,onDelete:k},p.id))})})}),g?e.jsx(It,{onAdd:r,onCancel:()=>d(!1)}):e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 py-1.5 px-1 mt-1 text-xs text-muted-foreground hover:text-foreground transition-colors w-full",children:[e.jsx("div",{className:"w-3.5"}),e.jsx(se,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Add subtask"})]})]})]})}const Et={1:"bg-destructive/20 text-destructive",2:"bg-warning/20 text-warning",3:"bg-muted text-muted-foreground"},At={wellfy:"bg-blue-500/20 text-blue-600 dark:text-blue-400",freelance:"bg-green-500/20 text-green-600 dark:text-green-400",personal:"bg-purple-500/20 text-purple-600 dark:text-purple-400"},Ue=["bg-orange-500/20 text-orange-700 dark:text-orange-400","bg-emerald-500/20 text-emerald-700 dark:text-emerald-400","bg-violet-500/20 text-violet-700 dark:text-violet-400","bg-rose-500/20 text-rose-700 dark:text-rose-400","bg-cyan-500/20 text-cyan-700 dark:text-cyan-400","bg-amber-500/20 text-amber-700 dark:text-amber-400","bg-fuchsia-500/20 text-fuchsia-700 dark:text-fuchsia-400","bg-sky-600/20 text-sky-700 dark:text-sky-300"];function Rt(a){let t=2166136261;for(let s=0;s<a.length;s++)t^=a.charCodeAt(s),t=t*16777619>>>0;return t%Ue.length}const _e=i.forwardRef(function({task:t,onEdit:s,onAssignToJames:o,isDragging:x,subtaskCounts:g,projects:d,prds:n,taskTags:m,dragHandleProps:j,style:w},k){var r;const b=m[t.id]||[],y=t.projectId?d.find(l=>l.id===t.projectId):null,T=t.prdId?n.find(l=>l.id===t.prdId):null;return e.jsx("div",{ref:k,style:w,className:O("group rounded-lg border bg-card p-3 shadow-sm transition-all",x&&"opacity-50 shadow-lg ring-2 ring-primary",!x&&"hover:shadow-md"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("button",{className:"mt-0.5 cursor-grab touch-none opacity-0 transition-opacity group-hover:opacity-100",...(j==null?void 0:j.attributes)??{},...(j==null?void 0:j.listeners)??{},children:e.jsx(ze,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("button",{onClick:()=>s(t),className:"text-left w-full",children:e.jsx("h4",{className:"font-medium text-sm leading-tight hover:text-primary transition-colors",children:t.title})}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:t.description}),e.jsx(Ot,{taskId:t.id,counts:g}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.jsxs(Qe,{variant:"secondary",className:O("text-xs capitalize inline-flex items-center gap-1",At[t.area]),children:[e.jsx(We,{className:"h-3 w-3"}),t.area]}),y&&e.jsxs("span",{className:O("inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium max-w-[140px]",Ue[Rt(y.name)]),title:y.name,children:[e.jsx(lt,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:y.name})]}),T&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-teal-500/20 text-teal-700 dark:text-teal-400 max-w-[140px]",title:`PRD: ${T.featureName}`,children:[e.jsx(be,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:T.featureName})]}),t.assignee==="james"&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-indigo-500/20 text-indigo-700 dark:text-indigo-400",title:"Assigned to James",children:[e.jsx(ie,{className:"h-3 w-3 shrink-0"}),"James"]}),!!t.quickCapture&&((r=t.createdBy)==null?void 0:r.includes("@"))&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-pink-500/20 text-pink-700 dark:text-pink-400",title:`Client request from ${t.createdBy}`,children:[e.jsx(ct,{className:"h-3 w-3 shrink-0"}),"Request"]}),b.map(l=>e.jsx(ce,{tag:l},l.id)),e.jsx("span",{className:O("inline-flex items-center rounded px-1.5 py-0.5 text-xs font-medium",Et[t.priority]),children:t.priority===1?"High":t.priority===2?"Med":"Low"}),t.dueDate&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(dt,{className:"h-3 w-3"}),Je(new Date(t.dueDate),"MMM d")]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[t.assignee!=="james"&&o&&e.jsx("button",{onClick:l=>{l.stopPropagation(),o(t)},className:"p-1 rounded hover:bg-indigo-100 dark:hover:bg-indigo-900/30 transition-colors",title:"Assign to James",children:e.jsx(ie,{className:"h-4 w-4 text-indigo-600 dark:text-indigo-400"})}),e.jsx("button",{onClick:()=>s(t),className:"p-1 rounded hover:bg-muted transition-colors",children:e.jsx(ut,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"})})]})]})})});function Mt({task:a,onEdit:t,onAssignToJames:s,isDragging:o,subtaskCounts:x,projects:g,prds:d,taskTags:n}){const{attributes:m,listeners:j,setNodeRef:w,transform:k,transition:b,isDragging:y}=Fe({id:a.id}),T={transform:Ie.Transform.toString(k),transition:b},r=o||y;return e.jsx(_e,{ref:w,style:T,task:a,onEdit:t,onAssignToJames:s,isDragging:r,subtaskCounts:x,projects:g,prds:d,taskTags:n,dragHandleProps:{attributes:m,listeners:j}})}const Pt={backlog:"border-t-slate-400",queue:"border-t-blue-400",in_progress:"border-t-amber-400",done:"border-t-green-400"};function Lt({id:a,title:t,tasks:s,onAddTask:o,onEditTask:x,onAssignToJames:g,subtaskCounts:d,projects:n,prds:m,taskTags:j}){const{setNodeRef:w,isOver:k}=st({id:a});return e.jsxs("div",{className:O("flex flex-col rounded-lg border border-t-4 bg-muted/30",Pt[a]),children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:t}),e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-muted px-2 py-0.5 text-xs font-medium text-muted-foreground",children:s.length})]}),e.jsx("button",{onClick:()=>o(a),className:"rounded p-1 hover:bg-accent transition-colors",title:"Add task",children:e.jsx(se,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsxs("div",{ref:w,className:O("flex-1 p-2 space-y-2 min-h-[200px] transition-colors",k&&"bg-accent/50"),children:[e.jsx(Te,{items:s.map(b=>b.id),strategy:De,children:s.map(b=>e.jsx(Mt,{task:b,onEdit:x,onAssignToJames:g,subtaskCounts:d==null?void 0:d[b.id],projects:n,prds:m,taskTags:j},b.id))}),s.length===0&&e.jsx("div",{className:"flex items-center justify-center h-20 text-sm text-muted-foreground",children:"No tasks"})]})]})}function $e({open:a,onOpenChange:t,task:s,defaultStatus:o,onClose:x}){const{addTask:g,updateTask:d,deleteTask:n}=V(),{projects:m}=ve(),{clients:j}=Xe(),{prds:w}=ye(),{taskTags:k,syncTaskTags:b}=te(),[y,T]=i.useState(""),[r,l]=i.useState(""),[p,h]=i.useState("backlog"),[v,u]=i.useState(2),[I,A]=i.useState("freelance"),[U,Y]=i.useState(""),[ae,Z]=i.useState(void 0),[re,H]=i.useState(void 0),[ne,f]=i.useState(null),[C,D]=i.useState([]),[R,E]=i.useState(!1),z=!!s;i.useEffect(()=>{if(s){T(s.title),l(s.description||""),h(s.status),u(s.priority),A(s.area),Y(s.dueDate?Je(new Date(s.dueDate),"yyyy-MM-dd"):""),Z(s.projectId),H(s.prdId),f(s.assignee||null);const c=k[s.id]||[];D(c.map(S=>S.id))}else T(""),l(""),h(o||"backlog"),u(2),A("freelance"),Y(""),Z(void 0),H(void 0),f(null),D([])},[s,o,a]);const $=async c=>{if(c.preventDefault(),!y.trim())return;const S={title:y.trim(),description:r.trim()||void 0,status:p,priority:v,area:I,dueDate:U?new Date(U).toISOString():void 0,projectId:ae,prdId:re,assignee:ne};if(z&&s)await d(s.id,S),await b(s.id,C);else{await g(S);const q=V.getState().tasks.find(_=>_.title===S.title&&_.status===S.status);q&&C.length>0&&await b(q.id,C)}x()},N=()=>{s&&(n(s.id),E(!1),x())},M=()=>{if(!s)return;const c=s.projectId?m.find(J=>J.id===s.projectId):void 0,S=c!=null&&c.clientId?j.find(J=>J.id===c.clientId):void 0,q=ht(s,{project:c,client:S}),_=gt(s.title);pt(q,_),P.success(`Exported "${s.title}" to markdown`)};return e.jsx(Ee,{open:a,onOpenChange:t,children:e.jsxs(Ae,{className:"w-[calc(100vw-2rem)] max-w-[500px] max-h-[90vh] overflow-y-auto overflow-x-hidden",children:[e.jsxs("form",{onSubmit:$,children:[e.jsxs(Re,{children:[e.jsx(Me,{children:z?"Edit Task":"New Task"}),e.jsx(Pe,{children:z?"Update the task details below.":"Create a new task by filling out the form below."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"title",children:"Title"}),e.jsx(ee,{id:"title",value:y,onChange:c=>T(c.target.value),placeholder:"Task title...",autoFocus:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"description",children:"Description"}),e.jsx(mt,{id:"description",value:r,onChange:c=>l(c.target.value),placeholder:"Add details...",rows:3})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"project",children:"Project"}),e.jsxs(G,{value:ae||"none",onValueChange:c=>Z(c==="none"?void 0:c),children:[e.jsx(Q,{children:e.jsx(W,{placeholder:"Select a project..."})}),e.jsxs(X,{children:[e.jsx(F,{value:"none",children:"No project"}),m.map(c=>e.jsx(F,{value:c.id,children:c.name},c.id))]})]})]}),w.length>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(L,{htmlFor:"prd",className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"PRD"]}),e.jsxs(G,{value:re||"none",onValueChange:c=>H(c==="none"?void 0:c),children:[e.jsx(Q,{children:e.jsx(W,{placeholder:"Link to a PRD..."})}),e.jsxs(X,{children:[e.jsx(F,{value:"none",children:"No PRD"}),w.map(c=>e.jsxs(F,{value:c.id,children:[c.featureName," (v",c.version,")"]},c.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"status",children:"Status"}),e.jsxs(G,{value:p,onValueChange:c=>h(c),children:[e.jsx(Q,{children:e.jsx(W,{})}),e.jsxs(X,{children:[e.jsx(F,{value:"backlog",children:"Backlog"}),e.jsx(F,{value:"queue",children:"Queue"}),e.jsx(F,{value:"in_progress",children:"In Progress"}),e.jsx(F,{value:"done",children:"Done"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"priority",children:"Priority"}),e.jsxs(G,{value:String(v),onValueChange:c=>u(Number(c)),children:[e.jsx(Q,{children:e.jsx(W,{})}),e.jsxs(X,{children:[e.jsx(F,{value:"1",children:"High"}),e.jsx(F,{value:"2",children:"Medium"}),e.jsx(F,{value:"3",children:"Low"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"area",children:"Area"}),e.jsxs(G,{value:I,onValueChange:c=>A(c),children:[e.jsx(Q,{children:e.jsx(W,{})}),e.jsxs(X,{children:[e.jsx(F,{value:"wellfy",children:"Wellfy"}),e.jsx(F,{value:"freelance",children:"Freelance"}),e.jsx(F,{value:"personal",children:"Personal"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"dueDate",children:"Due Date"}),e.jsx(ee,{id:"dueDate",type:"date",value:U,onChange:c=>Y(c.target.value),className:"h-10"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{children:"Tags"}),e.jsx(wt,{selectedIds:C,onChange:D})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(L,{htmlFor:"assignJames",className:"text-sm font-medium",children:"Assign to James"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"James will pick up this task automatically"})]})]}),e.jsx(xt,{id:"assignJames",checked:ne==="james",onCheckedChange:c=>f(c?"james":null)})]})]}),e.jsxs(Le,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsx("div",{className:"flex gap-1.5",children:z&&e.jsxs(e.Fragment,{children:[e.jsx(B,{type:"button",variant:"destructive",size:"sm",onClick:()=>E(!0),children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(B,{type:"button",variant:"outline",size:"sm",onClick:M,children:e.jsx(ft,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx(B,{type:"button",variant:"outline",size:"sm",onClick:x,children:"Cancel"}),e.jsx(B,{type:"submit",size:"sm",children:z?"Save":"Create"})]})]})]}),e.jsx(Be,{open:R,onOpenChange:E,title:"Delete task?",description:"This will permanently delete this task. This action cannot be undone.",onConfirm:N})]})})}const je=[{id:"backlog",title:"Backlog"},{id:"queue",title:"Queue"},{id:"in_progress",title:"In Progress"},{id:"done",title:"Done"}];function zt(){const[a,t]=i.useState(null),[s,o]=i.useState(null),[x,g]=i.useState(!1),[d,n]=i.useState(null),m=i.useRef(null),[j,w]=i.useState({}),{moveTaskLocal:k,persistColumnOrder:b}=V(),y=Ye(),T=jt(f=>f.trigger),{loadTaskTags:r,taskTags:l}=te(),{projects:p}=ve(),{prds:h}=ye(),v=i.useRef([]),u=y.map(f=>f.id).join(",");i.useEffect(()=>{const f=y.map(D=>D.id);if(f.length===0)return;(async()=>{try{const D=await K.getSubtaskCounts(f);w(D)}catch(D){console.error("Failed to fetch subtask counts:",D)}})(),r(f)},[u]);const I=Ne(le(Se,{activationConstraint:{distance:8}}),le(ke,{coordinateGetter:we})),A=i.useMemo(()=>{const f={backlog:[],queue:[],in_progress:[],done:[]};return y.forEach(C=>{f[C.status].push(C)}),Object.keys(f).forEach(C=>{f[C].sort((D,R)=>D.sortOrder-R.sortOrder)}),f},[y]),U=f=>{const C=y.find(D=>D.id===f.active.id);C&&(t(C),m.current=C.status,v.current=V.getState().tasks)},Y=f=>{const{active:C,over:D}=f;if(!D)return;const R=C.id,E=D.id,z=y.find(N=>N.id===R);if(!z)return;if(je.some(N=>N.id===E)){const N=E;if(z.status!==N){const M=A[N];k(R,N,M.length)}}else{const N=y.find(M=>M.id===E);if(N&&z.status!==N.status){const c=A[N.status].findIndex(S=>S.id===E);k(R,N.status,c)}}},ae=f=>{const{active:C,over:D}=f,R=m.current,E=C.id,z=v.current;t(null),m.current=null,v.current=[];const $=V.getState().tasks,N=$.find(M=>M.id===E);if((N==null?void 0:N.status)==="done"&&R!=="done"&&T(),D){const M=D.id;if(E!==M){const c=$.find(S=>S.id===M);if(c&&N&&N.status===c.status){const S=$.filter(J=>J.status===N.status).sort((J,Ge)=>J.sortOrder-Ge.sortOrder),q=S.findIndex(J=>J.id===E),_=S.findIndex(J=>J.id===M);q!==_&&k(E,N.status,_)}}}if(N&&(b(E,N.status,z),R&&R!==N.status)){const c=V.getState().tasks.filter(S=>S.status===R).sort((S,q)=>S.sortOrder-q.sortOrder).map(S=>S.id);c.length>0&&Ze.reorderTasks(c,R).catch(S=>{console.error("Failed to persist source column order:",S)})}},Z=f=>{n(f),o(null),g(!0)},re=f=>{o(f),n(null),g(!0)},H=()=>{g(!1),o(null),n(null)},ne=async f=>{try{const{updateTask:C}=V.getState();C(f.id,{assignee:"james"}),await K.triggerJames(),P.success(`Assigned "${f.title}" to James`,{description:"James will start working on it shortly"})}catch(C){console.error("Failed to assign to James:",C),P.error("Failed to assign task to James")}};return e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{sensors:I,collisionDetection:at,onDragStart:U,onDragOver:Y,onDragEnd:ae,children:[e.jsx("div",{className:"flex flex-col gap-4 sm:grid sm:grid-cols-2 lg:grid-cols-4",children:je.map(f=>e.jsx("div",{className:"w-full",children:e.jsx(Lt,{id:f.id,title:f.title,tasks:A[f.id],onAddTask:Z,onEditTask:re,onAssignToJames:ne,subtaskCounts:j,projects:p,prds:h,taskTags:l})},f.id))}),e.jsx(rt,{children:a?e.jsx(_e,{task:a,onEdit:()=>{},isDragging:!0,subtaskCounts:j[a.id],projects:p,prds:h,taskTags:l}):null})]}),e.jsx($e,{open:x,onOpenChange:g,task:s,defaultStatus:d,onClose:H})]})}function Jt(){const{filter:a,setFilter:t}=V();return e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 sm:max-w-sm",children:[e.jsx(bt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ee,{placeholder:"Search tasks...",value:a.search,onChange:s=>t({search:s.target.value}),className:"pl-9"})]}),e.jsxs(G,{value:a.area,onValueChange:s=>t({area:s}),children:[e.jsx(Q,{className:"w-[150px]",children:e.jsx(W,{placeholder:"All areas"})}),e.jsxs(X,{children:[e.jsx(F,{value:"all",children:"All Areas"}),e.jsx(F,{value:"wellfy",children:"Wellfy"}),e.jsx(F,{value:"freelance",children:"Freelance"}),e.jsx(F,{value:"personal",children:"Personal"})]})]}),e.jsx(St,{})]})}function hs(){const[a,t]=i.useState(!1),[s,o]=i.useState(!1),[x,g]=i.useState(!1),d=()=>{t(!0)},n=()=>{t(!1)},m=async()=>{g(!0);try{await K.triggerJames(),P.success("James is checking for new tasks...",{description:"He'll start working on any assigned tasks.",icon:"ðŸ¤–"})}catch{P.error("Failed to ping James")}finally{g(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Tasks"})}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("button",{onClick:m,disabled:x,className:"relative inline-flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-black bg-white border border-transparent rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden group",children:[e.jsx("span",{className:"absolute inset-0 rounded-md p-[2px] bg-gradient-to-r from-pink-500 via-purple-500 via-blue-500 via-cyan-500 via-green-500 via-yellow-500 to-pink-500 bg-[length:400%_100%] animate-shimmer"}),e.jsx("span",{className:"absolute inset-[2px] rounded-[4px] bg-white"}),e.jsxs("span",{className:"relative flex items-center gap-2",children:[x?e.jsx(He,{className:"h-4 w-4 animate-spin"}):e.jsx(ie,{className:"h-4 w-4"}),"James"]})]}),e.jsx(B,{variant:"outline",size:"icon",onClick:()=>o(!0),title:"Manage Tags",children:e.jsx(Ke,{className:"h-4 w-4"})}),e.jsxs(B,{onClick:d,className:"flex-1 sm:flex-none",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Add Task"]})]})]}),e.jsx(Jt,{}),e.jsx(zt,{}),e.jsx($e,{open:a,onOpenChange:t,task:null,defaultStatus:"backlog",onClose:n}),e.jsx(Ct,{open:s,onOpenChange:o})]})}export{hs as TasksPage};
