import{r as l,j as e}from"./vendor-react-wuMqdllU.js";import{l as b,k as f,S as N,a as T,i as x,B as v,I as ue}from"./index-JZoliObr.js";import{C as y,c as w,a as U,b as $}from"./card-ByB4Hy19.js";import{T as ge}from"./textarea-CvD7_vDa.js";import{S as je,a as pe,b as fe,c as Ne,d as O}from"./select-Btjdd6HG.js";import{i as ve,aN as se,ad as V,V as be,H as ye,aC as we,ab as ee,am as Se,f as te,X as ae,a9 as Ce,a6 as ke,al as G,aW as Te,ao as Ae,aX as Fe,d as Me}from"./vendor-icons-CHGo4Fp8.js";import{A as Ee,m as re}from"./vendor-framer-motion-C26rlN9R.js";import{n as Ie}from"./vendor-date-fns-D0ugVOfH.js";import"./vendor-markdown-C3iCDuOK.js";import"./vendor-recharts-tRgwS7-V.js";import"./vendor-radix-BCh4MJnw.js";import"./vendor-floating-ui-BD6aHMKr.js";import"./vendor-router-Cm8Qzw9U.js";const Le=[.16,1,.3,1],J=[{id:"james",label:"James",emoji:"ğŸ”§"},{id:"markus",label:"Markus",emoji:"âš™ï¸"},{id:"rocky",label:"Rocky",emoji:"ğŸ’¼"},{id:"prof",label:"Prof",emoji:"ğŸ”"}],A={1:{label:"Tier 1 â€” Core",color:"text-red-500",bg:"bg-red-500/10 border-red-500/20"},2:{label:"Tier 2 â€” Active",color:"text-amber-500",bg:"bg-amber-500/10 border-amber-500/20"},3:{label:"Tier 3 â€” Archive",color:"text-blue-500",bg:"bg-blue-500/10 border-blue-500/20"}},Re={core:"ğŸ§  Core Identity",learning:"ğŸ“š Learning & Growth","daily-notes":"ğŸ“… Daily Notes",journal:"ğŸ““ Journal",research:"ğŸ”¬ Research",decisions:"âš–ï¸ Decisions",specs:"ğŸ“‹ Specs",drafts:"âœï¸ Drafts","second-brain":"ğŸ§  Second Brain",persona:"ğŸ‘¤ Persona",config:"âš™ï¸ Configuration",other:"ğŸ“„ Other"};function ze(t){return t<1024?`${t}B`:t<1024*1024?`${(t/1024).toFixed(1)}KB`:`${(t/(1024*1024)).toFixed(1)}MB`}function Be(){const[t,c]=l.useState(!1);return l.useEffect(()=>{const n=()=>c(window.innerWidth<768);return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t}function ss(){const[t,c]=l.useState([]),[n,r]=l.useState("james"),[i,d]=l.useState([]),[h,m]=l.useState(!0),[u,o]=l.useState(!1),[g,S]=l.useState(null),[F,R]=l.useState(null),[W,M]=l.useState(""),[ne,Q]=l.useState(!1),[le,X]=l.useState(!1),[Y,E]=l.useState(!1),[I,q]=l.useState(""),[z,B]=l.useState(null),[ie,K]=l.useState(!1),[Z,H]=l.useState("list"),C=Be(),[D,ce]=l.useState(!1),L=l.useCallback(async()=>{try{const s=await b.getMemoryAgents();c(s)}catch(s){f.error("Failed to load agents"),console.error(s)}},[]),j=l.useCallback(async s=>{o(!0);try{const a=await b.getMemoryFiles(s);d(a.files)}catch(a){f.error("Failed to load files"),console.error(a)}finally{o(!1)}},[]),_=l.useCallback(async()=>{try{const s=await b.getMemoryHealth();S(s)}catch(s){console.error("Failed to load health:",s)}},[]);l.useEffect(()=>{(async()=>{m(!0),await Promise.all([L(),j("james"),_()]),m(!1)})()},[L,j,_]),l.useEffect(()=>{h||j(n)},[n,j,h]),l.useEffect(()=>{if(!I.trim()){B(null);return}const s=setTimeout(async()=>{K(!0);try{const a=await b.searchMemory(I);B(a)}catch(a){console.error("Search failed:",a)}finally{K(!1)}},400);return()=>clearTimeout(s)},[I]);const P=async s=>{R(s),Q(!0),E(!1),C&&H("editor");try{const a=await b.getMemoryFileContent(n,s.path);M(a.content)}catch(a){f.error("Failed to load file content"),console.error(a),M(`# Error loading file

Could not read file content.`)}finally{Q(!1)}},oe=async()=>{if(F){X(!0);try{await b.updateMemoryFileContent(n,F.path,W),f.success("File saved"),E(!1),j(n)}catch(s){f.error("Failed to save file"),console.error(s)}finally{X(!1)}}},de=()=>{Y&&!confirm("You have unsaved changes. Discard?")||(R(null),M(""),E(!1),C&&H("list"))},me=async(s,a)=>{try{await b.updateMemoryFileMetadata(n,{path:s.path,tier:a}),f.success(`Updated to ${A[a].label}`),j(n),L()}catch(k){f.error("Failed to update tier"),console.error(k)}},p=t.find(s=>s.id===n),xe=l.useMemo(()=>{const s={1:[],2:[],3:[]};for(const a of i)s[a.tier]?s[a.tier].push(a):s[2].push(a);return s},[i]);return g==null||g.agents.find(s=>s.agent===n),h?e.jsxs("div",{className:"space-y-6",children:[e.jsx(N,{className:"h-8 w-64"}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[...Array(4)].map((s,a)=>e.jsx(N,{className:"h-12"},a))}),e.jsx("div",{className:"space-y-3",children:[...Array(6)].map((s,a)=>e.jsx(N,{className:"h-14"},a))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-semibold tracking-tight flex items-center gap-2",children:[e.jsx(ve,{className:"h-6 w-6 text-primary"}),"Agent Memory"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"View, track, and edit the knowledge system of all AI agents"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(T,{variant:D?"default":"outline",size:"sm",onClick:()=>ce(!D),children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"Health"]}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>{L(),j(n),_(),f.success("Refreshed")},children:e.jsx(V,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"flex gap-2 border-b pb-0",children:J.map(s=>{const a=t.find(k=>k.id===s.id);return e.jsxs("button",{onClick:()=>{r(s.id),R(null),C&&H("list")},className:x("flex items-center gap-2 px-4 py-2.5 text-sm font-medium rounded-t-lg border border-b-0 transition-colors -mb-px",n===s.id?"bg-background text-foreground border-border":"bg-transparent text-muted-foreground border-transparent hover:text-foreground hover:bg-muted/50"),children:[e.jsx("span",{children:s.emoji}),e.jsx("span",{children:s.label}),a&&e.jsx(v,{variant:"secondary",className:"text-xs ml-1",children:a.entryCount})]},s.id)})}),p&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(y,{className:"col-span-1",children:e.jsxs(w,{className:"p-3 flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl",children:p.emoji}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:p.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[p.entryCount," files"]})]})]})}),[1,2,3].map(s=>e.jsx(y,{children:e.jsxs(w,{className:"p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:A[s].label}),e.jsx("div",{className:x("text-xl font-semibold",A[s].color),children:p.tierBreakdown[String(s)]||0})]})},s)),e.jsx(y,{children:e.jsxs(w,{className:"p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Health"}),e.jsxs("div",{className:x("text-xl font-semibold",p.healthScore>=80?"text-green-500":p.healthScore>=50?"text-amber-500":"text-red-500"),children:[p.healthScore,"%"]})]})})]}),e.jsx(Ee,{children:D&&g&&e.jsx(re.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2,ease:Le},className:"overflow-hidden",children:e.jsx(Pe,{report:g,selectedAgent:n})})}),e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ue,{placeholder:"Search across all agent memory files...",className:"pl-10",value:I,onChange:s=>q(s.target.value)}),ie&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(V,{className:"h-4 w-4 animate-spin text-muted-foreground"})})]}),z&&e.jsx(Oe,{results:z,onOpenFile:(s,a)=>{r(s);const k=i.find(he=>he.path===a);k?P(k):j(s).then(()=>{P({path:a,name:a.split("/").pop()||a,size:0,lastModified:"",exists:!0,encrypted:!1,tier:2,label:null,description:null,tags:[],isShared:!1,category:"other"})})},onClear:()=>{q(""),B(null)}}),!z&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_1fr] gap-6",children:[(!C||Z==="list")&&e.jsxs("div",{className:"space-y-4",children:[u?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,a)=>e.jsx(N,{className:"h-14"},a))}):[1,2,3].map(s=>{const a=xe[s];return a!=null&&a.length?e.jsx(He,{tier:s,files:a,selectedFile:F,onSelectFile:P,onChangeTier:me},s):null}),!u&&i.length===0&&e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(ye,{className:"h-8 w-8 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No memory files found for this agent"})]})]}),(!C||Z==="editor")&&e.jsx("div",{className:"lg:sticky lg:top-6 lg:self-start",children:F?e.jsx(_e,{file:F,content:W,isLoading:ne,isSaving:le,hasChanges:Y,onContentChange:s=>{M(s),E(!0)},onSave:oe,onClose:de,isMobile:C}):e.jsx(y,{className:"border-dashed",children:e.jsxs(w,{className:"py-16 text-center text-muted-foreground",children:[e.jsx(we,{className:"h-8 w-8 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Select a file to view or edit"})]})})})]})]})}function He({tier:t,files:c,selectedFile:n,onSelectFile:r,onChangeTier:i}){const d=A[t],h=l.useMemo(()=>{const m=new Map;for(const u of c){const o=u.category||"other";m.has(o)||m.set(o,[]),m.get(o).push(u)}return m},[c]);return e.jsxs("div",{className:x("rounded-lg border p-3",d.bg),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ce,{className:x("h-4 w-4",d.color)}),e.jsx("h3",{className:x("text-sm font-semibold",d.color),children:d.label}),e.jsxs(v,{variant:"outline",className:"text-xs ml-auto",children:[c.length," ",c.length===1?"file":"files"]})]}),e.jsx("div",{className:"space-y-1",children:Array.from(h.entries()).map(([m,u])=>e.jsxs("div",{children:[h.size>1&&e.jsx("div",{className:"text-xs text-muted-foreground px-2 py-1 font-medium",children:Re[m]||m}),u.map(o=>e.jsx(De,{file:o,isSelected:(n==null?void 0:n.path)===o.path,onClick:()=>r(o),onChangeTier:g=>i(o,g)},o.path))]},m))})]})}function De({file:t,isSelected:c,onClick:n,onChangeTier:r}){return e.jsxs(re.button,{layout:!0,onClick:n,className:x("w-full flex items-center gap-3 rounded-md px-3 py-2 text-left text-sm transition-colors",c?"bg-primary/10 text-primary border border-primary/20":"hover:bg-background/60"),children:[e.jsx("div",{className:"flex-shrink-0",children:t.encrypted?e.jsx(G,{className:"h-4 w-4 text-amber-500"}):e.jsx(Me,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"truncate font-medium",children:t.label||t.name}),t.label&&e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[t.isShared&&e.jsx(te,{className:"h-3 w-3 text-blue-500"}),t.exists&&e.jsx("span",{className:"text-xs text-muted-foreground",children:ze(t.size)}),!t.exists&&e.jsx(v,{variant:"destructive",className:"text-xs",children:"Missing"}),e.jsx("div",{onClick:i=>i.stopPropagation(),children:e.jsxs(je,{value:String(t.tier),onValueChange:i=>r(Number(i)),children:[e.jsx(pe,{className:"h-6 w-16 text-xs border-0 bg-transparent px-1",children:e.jsx(fe,{})}),e.jsxs(Ne,{children:[e.jsx(O,{value:"1",children:"T1"}),e.jsx(O,{value:"2",children:"T2"}),e.jsx(O,{value:"3",children:"T3"})]})]})})]})]})}function _e({file:t,content:c,isLoading:n,isSaving:r,hasChanges:i,onContentChange:d,onSave:h,onClose:m,isMobile:u}){var o,g;return e.jsxs(y,{children:[e.jsxs(U,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u&&e.jsx(T,{variant:"ghost",size:"icon",onClick:m,className:"flex-shrink-0",children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs($,{className:"text-base truncate flex items-center gap-2",children:[t.encrypted?e.jsx(G,{className:"h-4 w-4 text-amber-500 flex-shrink-0"}):e.jsx(Te,{className:"h-4 w-4 text-green-500 flex-shrink-0"}),t.label||t.name]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:t.path})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[i&&e.jsx(v,{variant:"outline",className:"text-xs text-amber-500 border-amber-500/30",children:"Unsaved"}),e.jsxs(T,{size:"sm",onClick:h,disabled:!i||r,children:[r?e.jsx(V,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(Ae,{className:"h-4 w-4 mr-1"}),"Save"]}),!u&&e.jsx(T,{variant:"ghost",size:"icon",onClick:m,children:e.jsx(ae,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.jsx(v,{variant:"secondary",className:x("text-xs",(o=A[t.tier])==null?void 0:o.color),children:((g=A[t.tier])==null?void 0:g.label)||"Unknown Tier"}),t.encrypted&&e.jsxs(v,{variant:"outline",className:"text-xs",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),"Encrypted"]}),t.lastModified&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Modified ",Ie(new Date(t.lastModified),{addSuffix:!0})]}),t.tags.length>0&&t.tags.map(S=>e.jsxs(v,{variant:"outline",className:"text-xs",children:[e.jsx(Fe,{className:"h-3 w-3 mr-1"}),S]},S))]})]}),e.jsx(w,{children:n?e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{className:"h-4 w-full"}),e.jsx(N,{className:"h-4 w-3/4"}),e.jsx(N,{className:"h-4 w-1/2"}),e.jsx(N,{className:"h-[300px] w-full mt-4"})]}):e.jsx(ge,{value:c,onChange:S=>d(S.target.value),className:"font-mono text-sm min-h-[400px] lg:min-h-[500px] resize-y",placeholder:"File content..."})})]})}function Pe({report:t,selectedAgent:c}){const n=t.agents.find(r=>r.agent===c);return e.jsxs(y,{children:[e.jsx(U,{className:"pb-3",children:e.jsxs($,{className:"text-base flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"Health Report"]})}),e.jsxs(w,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4",children:t.agents.map(r=>{const i=J.find(d=>d.id===r.agent);return e.jsxs("div",{className:x("rounded-lg border p-3 text-center",r.agent===c&&"ring-2 ring-primary"),children:[e.jsx("div",{className:"text-lg",children:i==null?void 0:i.emoji}),e.jsx("div",{className:x("text-xl font-bold",r.score>=80?"text-green-500":r.score>=50?"text-amber-500":"text-red-500"),children:r.score}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[r.fileCount," files"]})]},r.agent)})}),n&&n.warnings.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Warnings"}),n.warnings.map((r,i)=>e.jsxs("div",{className:x("flex items-center gap-2 text-sm rounded-md px-3 py-2",r.severity==="high"?"bg-red-500/10 text-red-500":r.severity==="medium"?"bg-amber-500/10 text-amber-500":"bg-muted text-muted-foreground"),children:[r.severity==="high"?e.jsx(ee,{className:"h-4 w-4 flex-shrink-0"}):e.jsx(ee,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:r.message})]},i))]}),n&&n.warnings.length===0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-500",children:[e.jsx(Se,{className:"h-4 w-4"}),"All clear â€” no warnings for this agent"]}),t.duplicates.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Cross-Agent Duplicates"}),t.duplicates.map((r,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-muted rounded-md px-3 py-2 text-muted-foreground",children:[e.jsx(te,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:r.message})]},i))]})]})]})}function Oe({results:t,onOpenFile:c,onClear:n}){return e.jsxs(y,{children:[e.jsx(U,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($,{className:"text-base",children:["Search Results â€” ",t.resultCount,' matches for "',t.query,'"']}),e.jsxs(T,{variant:"ghost",size:"sm",onClick:n,children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Clear"]})]})}),e.jsx(w,{children:t.results.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-6",children:"No matches found"}):e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:t.results.map((r,i)=>{const d=J.find(h=>h.id===r.agentId);return e.jsxs("button",{onClick:()=>c(r.agentId,r.filePath),className:"w-full text-left rounded-md border p-3 hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{children:d==null?void 0:d.emoji}),e.jsx("span",{className:"text-sm font-medium",children:r.fileName}),e.jsxs(v,{variant:"secondary",className:"text-xs ml-auto",children:[r.matchCount," ",r.matchCount===1?"match":"matches"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground font-mono truncate",children:r.snippet})]},i)})})})]})}export{ss as JamesMemoryPage};
