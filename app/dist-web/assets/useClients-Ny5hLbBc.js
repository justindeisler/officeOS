import{r as n}from"./vendor-react-wuMqdllU.js";import{Q as c}from"./index-BJ9hpEov.js";function E(f={}){const{autoFetch:u=!0}=f,[p,o]=n.useState([]),[v,r]=n.useState(!1),[y,s]=n.useState(null),i=n.useCallback(async()=>{r(!0),s(null);try{const e=(await c.getAll()).map(t=>({id:t.id,name:t.name,address:t.address||t.company||void 0,vatId:t.vatId||void 0,email:t.email||void 0,createdAt:t.createdAt?new Date(t.createdAt):new Date}));o(e)}catch(a){console.error("Failed to fetch clients:",a);const e=a instanceof Error?a.message:typeof a=="string"?a:JSON.stringify(a)||"Failed to fetch clients";s(e)}finally{r(!1)}},[]),C=n.useCallback(async a=>{r(!0),s(null);try{const e=await c.create({name:a.name,company:a.address,email:a.email,notes:a.vatId?`VAT ID: ${a.vatId}`:void 0,status:"active"}),t={id:e.id,name:e.name,address:e.company||void 0,vatId:a.vatId,email:e.email||void 0,createdAt:e.createdAt?new Date(e.createdAt):new Date};return o(d=>[...d,t].sort((m,l)=>m.name.localeCompare(l.name))),t}catch(e){return s(e instanceof Error?e.message:"Failed to create client"),null}finally{r(!1)}},[]),I=n.useCallback(async(a,e)=>{r(!0),s(null);try{await c.update(a,{name:e.name,company:e.address,email:e.email,notes:e.vatId?`VAT ID: ${e.vatId}`:void 0});const t=await c.getById(a);if(t){const d={id:t.id,name:t.name,address:t.company||void 0,vatId:e.vatId,email:t.email||void 0,createdAt:t.createdAt?new Date(t.createdAt):new Date};return o(m=>m.map(l=>l.id===a?d:l).sort((l,g)=>l.name.localeCompare(g.name))),d}return null}catch(t){return s(t instanceof Error?t.message:"Failed to update client"),null}finally{r(!1)}},[]),w=n.useCallback(async a=>{r(!0),s(null);try{return await c.delete(a),o(e=>e.filter(t=>t.id!==a)),!0}catch(e){return s(e instanceof Error?e.message:"Failed to delete client"),!1}finally{r(!1)}},[]),A=n.useCallback(async()=>{await i()},[i]);return n.useEffect(()=>{u&&i()},[u,i]),{clients:p,isLoading:v,error:y,fetchClients:i,createClient:C,updateClient:I,deleteClient:w,refresh:A}}export{E as u};
