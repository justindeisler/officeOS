import{r as o,j as e}from"./vendor-react-DeR5d9Tv.js";import{C as A,a as H,b as V,c as G}from"./card-Do3Kg1xk.js";import{a as p,j,B as f,C as y,I as Q,m as x,n as U,l as a}from"./index-B9wpeZVf.js";import{T as K}from"./textarea-CZihQ_1Z.js";import{D as R,a as $,b as z,c as W,d as X,e as Y}from"./dialog-FtNsGa4T.js";import{S as N,a as T,b as k,c as w,d as i}from"./select-BY8eQiQN.js";import{L as Z}from"./list-todo-CoAB3JnI.js";import{P as ee}from"./plus-BG4HFTMm.js";import{G as se}from"./grip-vertical-DKFDITPQ.js";import{C as te}from"./circle-alert-DR10Pc3C.js";import{T as re}from"./trash-2-BAQCKdVR.js";import{f as C}from"./vendor-date-fns-D0ugVOfH.js";import"./vendor-markdown-PIr_2kdo.js";import"./vendor-recharts-DrMJw15s.js";import"./vendor-radix-sPo3_CXI.js";import"./vendor-floating-ui-CESiY8Ey.js";import"./vendor-router-9bGSKQ4q.js";import"./check-BOz78U_D.js";import"./chevron-up-Csf9Xqjr.js";const ae=U("TasksPage"),D=[{id:"backlog",title:"Backlog",color:"border-t-slate-500"},{id:"queue",title:"Queue",color:"border-t-blue-500"},{id:"in_progress",title:"In Progress",color:"border-t-amber-500"},{id:"done",title:"Done",color:"border-t-emerald-500"}],ie={1:"bg-red-500/10 text-red-700 dark:text-red-400 border-red-200",2:"bg-orange-500/10 text-orange-700 dark:text-orange-400 border-orange-200",3:"bg-yellow-500/10 text-yellow-700 dark:text-yellow-400 border-yellow-200",4:"bg-green-500/10 text-green-700 dark:text-green-400 border-green-200",5:"bg-slate-500/10 text-slate-700 dark:text-slate-400 border-slate-200"},le={1:"Critical",2:"High",3:"Medium",4:"Low",5:"Minimal"};function Ce(){const[S,M]=o.useState([]),[F,J]=o.useState(!0),[L,d]=o.useState(!1),[l,v]=o.useState(null),[r,n]=o.useState({title:"",description:"",priority:3,status:"backlog"}),[c,h]=o.useState(null),u=async()=>{try{const s=await x.getJamesTasks({limit:200});M(s)}catch(s){ae.error({err:s},"Failed to fetch tasks"),a.error("Failed to load tasks")}finally{J(!1)}};o.useEffect(()=>{u()},[]);const E=()=>{v(null),n({title:"",description:"",priority:3,status:"backlog"}),d(!0)},I=s=>{v(s),n({title:s.title,description:s.description||"",priority:s.priority,status:s.status}),d(!0)},P=async()=>{if(!r.title.trim()){a.error("Title is required");return}try{l?(await x.updateJamesTask(l.id,r),a.success("Task updated")):(await x.createJamesTask(r),a.success("Task created")),d(!1),u()}catch{a.error(l?"Failed to update task":"Failed to create task")}},_=async s=>{if(confirm("Are you sure you want to delete this task?"))try{await x.deleteJamesTask(s),a.success("Task deleted"),u()}catch{a.error("Failed to delete task")}},B=(s,t)=>{h(t),s.dataTransfer.effectAllowed="move"},O=s=>{s.preventDefault(),s.dataTransfer.dropEffect="move"},q=async(s,t)=>{var m;if(s.preventDefault(),!c||c.status===t){h(null);return}try{await x.updateJamesTask(c.id,{status:t}),a.success(`Moved to ${(m=D.find(b=>b.id===t))==null?void 0:m.title}`),u()}catch{a.error("Failed to move task")}h(null)},g=s=>S.filter(t=>t.status===s).sort((t,m)=>t.priority-m.priority);return e.jsx(e.Fragment,{children:F?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight flex items-center gap-2",children:[e.jsx(Z,{className:"h-7 w-7"}),"James Tasks"]}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Kanban board for James's task queue"})]}),e.jsxs(p,{onClick:E,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Add Task"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:D.map(s=>e.jsxs(A,{className:j("border-t-4",s.color),onDragOver:O,onDrop:t=>q(t,s.id),children:[e.jsx(H,{className:"py-3",children:e.jsxs(V,{className:"text-sm font-medium flex items-center justify-between",children:[s.title,e.jsx(f,{variant:"secondary",className:"ml-2",children:g(s.id).length})]})}),e.jsxs(G,{className:"space-y-2 min-h-[200px]",children:[g(s.id).map(t=>e.jsx("div",{draggable:!0,onDragStart:m=>B(m,t),onClick:()=>I(t),className:j("p-3 rounded-lg border bg-card cursor-pointer transition-all hover:shadow-md",(c==null?void 0:c.id)===t.id&&"opacity-50"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(se,{className:"h-4 w-4 text-muted-foreground shrink-0 mt-0.5 cursor-grab"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm line-clamp-2",children:t.title}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mt-1",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[e.jsx(f,{variant:"outline",className:j("text-xs",ie[t.priority]),children:le[t.priority]}),t.source&&e.jsx(f,{variant:"outline",className:"text-xs",children:t.source})]}),t.status==="in_progress"&&t.started_at&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-muted-foreground",children:[e.jsx(y,{className:"h-3 w-3"}),"Started ",C(new Date(t.started_at),"MMM d")]}),t.status==="done"&&t.completed_at&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-muted-foreground",children:[e.jsx(y,{className:"h-3 w-3"}),"Completed ",C(new Date(t.completed_at),"MMM d")]})]})]})},t.id)),g(s.id).length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-muted-foreground",children:[e.jsx(te,{className:"h-8 w-8 mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No tasks"})]})]})]},s.id))}),e.jsx(R,{open:L,onOpenChange:d,children:e.jsxs($,{children:[e.jsxs(z,{children:[e.jsx(W,{children:l?"Edit Task":"Create Task"}),e.jsx(X,{children:l?"Update the task details below.":"Add a new task to James's queue."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Title"}),e.jsx(Q,{value:r.title,onChange:s=>n({...r,title:s.target.value}),placeholder:"Task title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx(K,{value:r.description,onChange:s=>n({...r,description:s.target.value}),placeholder:"Optional description",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Priority"}),e.jsxs(N,{value:String(r.priority),onValueChange:s=>n({...r,priority:parseInt(s)}),children:[e.jsx(T,{children:e.jsx(k,{})}),e.jsxs(w,{children:[e.jsx(i,{value:"1",children:"1 - Critical"}),e.jsx(i,{value:"2",children:"2 - High"}),e.jsx(i,{value:"3",children:"3 - Medium"}),e.jsx(i,{value:"4",children:"4 - Low"}),e.jsx(i,{value:"5",children:"5 - Minimal"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(N,{value:r.status,onValueChange:s=>n({...r,status:s}),children:[e.jsx(T,{children:e.jsx(k,{})}),e.jsxs(w,{children:[e.jsx(i,{value:"backlog",children:"Backlog"}),e.jsx(i,{value:"queue",children:"Queue"}),e.jsx(i,{value:"in_progress",children:"In Progress"}),e.jsx(i,{value:"done",children:"Done"})]})]})]})]})]}),e.jsxs(Y,{className:"gap-2",children:[l&&e.jsxs(p,{variant:"destructive",onClick:()=>{_(l.id),d(!1)},children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Delete"]}),e.jsx(p,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(p,{onClick:P,children:l?"Update":"Create"})]})]})})]})})}export{Ce as TasksPage};
