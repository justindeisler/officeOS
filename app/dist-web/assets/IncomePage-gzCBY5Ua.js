import{r as o,j as e}from"./vendor-react-wuMqdllU.js";import{u as R,I as E}from"./IncomeDialog-DR38jBtu.js";import{i as b,E as F,a as y,I as B,B as C}from"./index-BJ9hpEov.js";import{T as G,a as M,b as T,c as n,d as O,e as a}from"./table-D-p124BO.js";import{C as P}from"./confirm-delete-dialog-D3P6PPsQ.js";import{u as V}from"./usePeriodLocks-CimS-PQ2.js";import{i as H}from"./isRecordLocked-BcN8lokf.js";import{o as Z,t as z,Y as U,am as Y,f as q,G as J}from"./vendor-icons-ssgfUAX_.js";import"./vendor-markdown-C3iCDuOK.js";import"./dialog-BPcAFwmD.js";import"./vendor-radix-DqeMb71O.js";import"./vendor-floating-ui-BD6aHMKr.js";import"./vendor-forms-B8CBK7X2.js";import"./income-BENnsCsJ.js";import"./db-BUkeUm8J.js";import"./vendor-recharts-tRgwS7-V.js";import"./vendor-router-Cm8Qzw9U.js";import"./alert-dialog-CMM_3WOV.js";function l(i){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(i)}function K(i){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(i)}function Q({onAddIncome:i,onEditIncome:r,className:d,refreshTrigger:c}){const{income:m,isLoading:g,error:h,deleteIncome:p,setSelectedIncome:v,refresh:j}=R(),{periods:x}=V(),[u,D]=o.useState(""),[N,w]=o.useState(null);o.useEffect(()=>{c&&c>0&&j()},[c,j]);const f=o.useMemo(()=>{if(!u)return m;const s=u.toLowerCase();return m.filter(t=>t.description.toLowerCase().includes(s)||t.euerCategory.toLowerCase().includes(s))},[m,u]),I=o.useMemo(()=>f.reduce((s,t)=>({net:s.net+t.netAmount,vat:s.vat+t.vatAmount,gross:s.gross+t.grossAmount}),{net:0,vat:0,gross:0}),[f]),A=s=>{v(s),r==null||r(s)},k=(s,t)=>{if(s.stopPropagation(),t.invoiceId){alert("This income record was auto-generated from an invoice. To remove it, cancel or modify the original invoice.");return}w(t.id)},S=async()=>{N&&(await p(N),w(null))};return g?e.jsxs("div",{className:b("flex items-center justify-center p-8",d),children:[e.jsx(Z,{className:"h-8 w-8 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading..."})]}):h?e.jsxs("div",{className:b("p-8 text-center",d),children:[e.jsx("p",{className:"text-destructive",children:F(h)}),e.jsx(y,{variant:"outline",className:"mt-4",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:b("space-y-4",d),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Income"}),e.jsxs(y,{onClick:i,className:"w-full sm:w-auto",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Add Income"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(B,{placeholder:"Search income...",value:u,onChange:s=>D(s.target.value),className:"pl-10"})]}),f.length===0?e.jsx("div",{className:"rounded-lg border border-dashed p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:u?"No income records match your search":"No income records yet. Add your first income to get started."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(G,{className:"min-w-[700px]",children:[e.jsx(M,{children:e.jsxs(T,{children:[e.jsx(n,{className:"w-[32px]"}),e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Description"}),e.jsx(n,{children:"VAT"}),e.jsx(n,{className:"text-right",children:"Net"}),e.jsx(n,{className:"text-right",children:"VAT"}),e.jsx(n,{className:"text-right",children:"Gross"}),e.jsx(n,{className:"w-[50px]"})]})}),e.jsx(O,{children:f.map(s=>{const t=H(s.date,x);return e.jsxs(T,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>A(s),children:[e.jsx(a,{className:"w-[32px] px-2",children:t&&e.jsx(Y,{className:"h-3.5 w-3.5 text-red-400","aria-label":"Gesperrt",title:"Zeitraum gesperrt"})}),e.jsx(a,{className:"font-medium",children:K(s.date)}),e.jsx(a,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.invoiceId&&e.jsx("span",{title:"From Invoice",children:e.jsx(q,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"})}),e.jsx("span",{children:s.description}),s.invoiceId&&e.jsx(C,{variant:"outline",className:"text-xs",children:"Invoice"}),s.ustReported&&e.jsx(C,{variant:"secondary",className:"text-xs",children:"Reported"})]})}),e.jsx(a,{children:e.jsxs(C,{variant:"outline",children:[s.vatRate,"%"]})}),e.jsx(a,{className:"text-right",children:l(s.netAmount)}),e.jsx(a,{className:"text-right",children:l(s.vatAmount)}),e.jsx(a,{className:"text-right font-medium",children:l(s.grossAmount)}),e.jsx(a,{children:t?e.jsx("span",{className:"text-xs text-muted-foreground",title:"Zeitraum gesperrt",children:"—"}):s.invoiceId?e.jsx("span",{className:"text-xs text-muted-foreground",title:"Managed by invoice",children:"—"}):e.jsx(y,{variant:"ghost",size:"icon",onClick:L=>k(L,s),"aria-label":"Delete",children:e.jsx(J,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"})})})]},s.id)})})]})}),e.jsx("div",{className:"flex justify-start sm:justify-end",children:e.jsxs("div",{className:"rounded-lg bg-muted p-3 sm:p-4 w-full sm:w-auto",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Total"}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 gap-2 sm:gap-4 text-right",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Net"}),e.jsx("div",{className:"font-medium text-sm sm:text-base",children:l(I.net)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"VAT"}),e.jsx("div",{className:"font-medium text-sm sm:text-base",children:l(I.vat)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Gross"}),e.jsx("div",{className:"font-semibold text-sm sm:text-base",children:l(I.gross)})]})]})]})})]}),e.jsx(P,{open:!!N,onOpenChange:s=>!s&&w(null),title:"Delete income?",description:"This will permanently delete this income record. This action cannot be undone.",onConfirm:S})]})}function he(){const[i,r]=o.useState(!1),[d,c]=o.useState(null),[m,g]=o.useState(0),h=()=>{c(null),r(!0)},p=x=>{c(x),r(!0)},v=()=>{r(!1),c(null)},j=()=>{g(x=>x+1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsx(Q,{onAddIncome:h,onEditIncome:p,refreshTrigger:m})}),e.jsx(E,{open:i,onOpenChange:r,income:d,onClose:v,onSuccess:j})]})}export{he as IncomePage};
