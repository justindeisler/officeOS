var H=Object.defineProperty;var B=(t,e,n)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>B(t,typeof e!="symbol"?e+"":e,n);import{r as g,j as o}from"./vendor-react-wuMqdllU.js";import{K as P}from"./index-JZoliObr.js";import"./vendor-markdown-C3iCDuOK.js";import"./vendor-recharts-tRgwS7-V.js";import"./vendor-radix-BCh4MJnw.js";import"./vendor-floating-ui-BD6aHMKr.js";import"./vendor-router-Cm8Qzw9U.js";import"./vendor-icons-CHGo4Fp8.js";const L={idle:"idle",coding:"typing",delegating:"working",thinking:"thinking",reviewing:"thinking",meeting:"meeting",break:"coffee_break",away:"away"},w=16,O=75,$=50,R=O*w,I=$*w,h={floorLight:"#c8b89a",floorDark:"#b8a88a",wallTop:"#e8e0d0",wallSide:"#d0c8b0",wallAccent:"#a09070",deskWood:"#8b6d3f",deskDark:"#6b4d2f",chairBlue:"#4a6fa5",chairGrey:"#6a7a8a",monitorFrame:"#2a2a2a",monitorScreenOn:"#2a5a8a",monitorGlow:"#4a8aba",counterTop:"#808080",counterSide:"#606060",coffeeMachine:"#4a3a2a",fridge:"#d0d8e0",tableWood:"#7a5a3a",whiteboard:"#f0f0f0",whiteboardFrame:"#808080",plantGreen:"#4a8a3a",plantDark:"#2a6a1a",potBrown:"#8a6a4a",bookshelfWood:"#6a4a2a",divider:"#b0a890",jamesPrimary:"#3a6a9a",jamesAccent:"#2a4a6a",markusPrimary:"#7a7a7a",markusAccent:"#5a5a5a",skin:"#e8c8a0"},C={james:{desk:{x:14,y:30},kitchen:{x:45,y:10},meetingRoom:{x:12,y:10}},markus:{desk:{x:54,y:30},kitchen:{x:50,y:10},meetingRoom:{x:18,y:10}}};function z(){return[{id:"meeting-table",type:"table",x:8,y:7,width:14,height:8,color:h.tableWood,zIndex:1},{id:"mchair-1",type:"chair",x:10,y:5,width:3,height:3,color:h.chairBlue},{id:"mchair-2",type:"chair",x:17,y:5,width:3,height:3,color:h.chairBlue},{id:"mchair-3",type:"chair",x:10,y:14,width:3,height:3,color:h.chairBlue},{id:"mchair-4",type:"chair",x:17,y:14,width:3,height:3,color:h.chairBlue},{id:"whiteboard",type:"whiteboard",x:2,y:2,width:12,height:3,color:h.whiteboard},{id:"coffee-machine",type:"appliance",x:40,y:2,width:4,height:4,color:h.coffeeMachine,label:"â˜•"},{id:"fridge",type:"appliance",x:46,y:2,width:4,height:5,color:h.fridge},{id:"counter",type:"counter",x:52,y:2,width:16,height:3,color:h.counterTop},{id:"vending",type:"appliance",x:60,y:7,width:5,height:6,color:"#4050a0",label:"ðŸ§Š"},{id:"plant-kitchen",type:"plant",x:36,y:14,width:3,height:4,color:h.plantGreen},{id:"james-desk",type:"desk",x:8,y:28,width:14,height:6,color:h.deskWood,zIndex:1},{id:"james-monitor",type:"monitor",x:12,y:27,width:6,height:4,color:h.monitorFrame,zIndex:2},{id:"james-chair",type:"chair",x:13,y:33,width:4,height:3,color:h.chairBlue},{id:"james-tablet",type:"prop",x:9,y:29,width:2,height:3,color:"#303030"},{id:"plant-james",type:"plant",x:3,y:35,width:3,height:4,color:h.plantGreen},{id:"markus-desk",type:"desk",x:48,y:28,width:18,height:6,color:h.deskWood,zIndex:1},{id:"markus-monitor-1",type:"monitor",x:51,y:27,width:5,height:4,color:h.monitorFrame,zIndex:2},{id:"markus-monitor-2",type:"monitor",x:57,y:27,width:5,height:4,color:h.monitorFrame,zIndex:2},{id:"markus-chair",type:"chair",x:53,y:33,width:4,height:3,color:h.chairGrey},{id:"markus-mug",type:"prop",x:63,y:29,width:2,height:2,color:"#a04020"},{id:"markus-headphones",type:"prop",x:49,y:30,width:2,height:2,color:"#2a2a2a"},{id:"bookshelf",type:"bookshelf",x:32,y:25,width:8,height:10,color:h.bookshelfWood},{id:"plant-main",type:"plant",x:42,y:38,width:3,height:4,color:h.plantGreen},{id:"wall-art-1",type:"decoration",x:28,y:22,width:4,height:3,color:"#506090"},{id:"wall-art-2",type:"decoration",x:60,y:22,width:4,height:3,color:"#905050"},{id:"future-desk-1",type:"desk",x:8,y:42,width:12,height:5,color:"#a09080",label:"Available"},{id:"future-desk-2",type:"desk",x:50,y:42,width:12,height:5,color:"#a09080",label:"Available"}]}function l(t,e,n,i,a,r,s){t.fillStyle=r,t.fillRect(Math.round(e*w*s),Math.round(n*w*s),Math.round(i*w*s),Math.round(a*w*s))}function F(t,e,n,i,a,r,s,d=1){t.strokeStyle=r,t.lineWidth=d*s,t.strokeRect(Math.round(e*w*s)+.5,Math.round(n*w*s)+.5,Math.round(i*w*s)-1,Math.round(a*w*s)-1)}function W(t,e){for(let n=0;n<50;n++)for(let i=0;i<75;i++){const a=(i+n)%2===0;let r;n<20&&i<30?r=a?"#8a9a7a":"#7a8a6a":n<20&&i>=30?r=a?"#d0d0d0":"#c0c0c0":n>=20&&n<25?r=a?h.floorLight:h.floorDark:r=a?"#c0a878":"#b09868",l(t,i,n,1,1,r,e)}}function Y(t,e){l(t,0,0,75,1.5,h.wallTop,e),l(t,0,1.5,75,.5,h.wallAccent,e),l(t,0,0,1.5,50,h.wallSide,e),l(t,73.5,0,1.5,50,h.wallSide,e),l(t,29.5,0,1,18,h.divider,e),l(t,0,19,14,1,h.divider,e),l(t,18,19,12,1,h.divider,e),l(t,35,19,20,1,h.divider,e),l(t,60,19,15,1,h.divider,e),l(t,0,48.5,75,1.5,h.wallSide,e),l(t,14,19,4,1,"#d0c8b0",e),l(t,55,19,5,1,"#d0c8b0",e)}function _(t,e,n,i){const a=[...e].sort((r,s)=>(r.zIndex||0)-(s.zIndex||0));for(const r of a)switch(r.type){case"desk":X(t,r,n);break;case"monitor":G(t,r,n,i);break;case"chair":K(t,r,n);break;case"table":J(t,r,n);break;case"plant":U(t,r,n);break;case"appliance":q(t,r,n);break;case"counter":V(t,r,n);break;case"bookshelf":Z(t,r,n);break;case"whiteboard":Q(t,r,n);break;case"decoration":ee(t,r,n);break;case"prop":te(t,r,n);break;default:l(t,r.x,r.y,r.width,r.height,r.color,n)}}function X(t,e,n){if(l(t,e.x,e.y,e.width,e.height,e.color,n),l(t,e.x,e.y,e.width,.5,"#a08050",n),l(t,e.x,e.y+e.height-.5,e.width,.5,h.deskDark,n),l(t,e.x+.5,e.y+e.height,1,1,h.deskDark,n),l(t,e.x+e.width-1.5,e.y+e.height,1,1,h.deskDark,n),e.label){const i=w*n,a=(e.x+e.width/2)*i,r=(e.y+e.height/2)*i;t.fillStyle="#807060",t.font=`${Math.round(8*n)}px monospace`,t.textAlign="center",t.textBaseline="middle",t.fillText(e.label,a,r)}}function G(t,e,n,i){l(t,e.x,e.y,e.width,e.height-1,h.monitorFrame,n);const a=.5,s=i==="night"||i==="evening"?h.monitorGlow:h.monitorScreenOn;l(t,e.x+a,e.y+a,e.width-a*2,e.height-1-a*2,s,n),l(t,e.x+1,e.y+1,1.5,.5,"rgba(255,255,255,0.3)",n),l(t,e.x+e.width/2-.75,e.y+e.height-1,1.5,1,"#3a3a3a",n),l(t,e.x+e.width/2-1.5,e.y+e.height,3,.5,"#3a3a3a",n)}function K(t,e,n){l(t,e.x,e.y,e.width,e.height,e.color,n),l(t,e.x+.5,e.y,e.width-1,1,e.color===h.chairBlue?"#3a5f8f":"#5a6a7a",n);const i="#404040";l(t,e.x,e.y+e.height-.5,.5,.5,i,n),l(t,e.x+e.width-.5,e.y+e.height-.5,.5,.5,i,n)}function J(t,e,n){l(t,e.x,e.y,e.width,e.height,e.color,n),l(t,e.x,e.y,e.width,.5,"#9a7a5a",n),l(t,e.x,e.y+e.height-.5,e.width,.5,"#5a3a1a",n),l(t,e.x+1,e.y+e.height,1,1,"#5a3a1a",n),l(t,e.x+e.width-2,e.y+e.height,1,1,"#5a3a1a",n)}function U(t,e,n){l(t,e.x+.5,e.y+e.height-2,e.width-1,2,h.potBrown,n),l(t,e.x,e.y,e.width,e.height-2,h.plantGreen,n),l(t,e.x+.5,e.y+.5,1,1,"#5aaa4a",n),l(t,e.x+e.width-1.5,e.y+1,1,1,"#5aaa4a",n),l(t,e.x+1,e.y+1,1,1,h.plantDark,n)}function q(t,e,n){const i=w*n;if(l(t,e.x,e.y,e.width,e.height,e.color,n),l(t,e.x,e.y,e.width,.5,E(e.color,30),n),F(t,e.x,e.y,e.width,e.height,E(e.color,-30),n),e.label){const a=(e.x+e.width/2)*i,r=(e.y+e.height/2)*i;t.font=`${Math.round(10*n)}px serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(e.label,a,r)}}function V(t,e,n){l(t,e.x,e.y,e.width,e.height,e.color,n),l(t,e.x,e.y+e.height,e.width,1,h.counterSide,n),l(t,e.x,e.y,e.width,.3,"#909090",n)}function Z(t,e,n){l(t,e.x,e.y,e.width,e.height,e.color,n);const i=4,a=e.height/i;for(let s=1;s<i;s++)l(t,e.x,e.y+a*s,e.width,.3,"#5a3a1a",n);const r=["#c04040","#4060c0","#40a040","#c0a040","#8040c0","#c06040"];for(let s=0;s<i;s++){let d=e.x+.5;const f=e.y+s*a+.5;for(let c=0;c<4+Math.floor(Math.random()*3);c++){const u=.8+Math.random()*.6,b=a-1;if(d+u>e.x+e.width-.5)break;l(t,d,f,u,b,r[c%r.length],n),d+=u+.2}}}function Q(t,e,n){l(t,e.x,e.y,e.width,e.height,h.whiteboardFrame,n),l(t,e.x+.3,e.y+.3,e.width-.6,e.height-.6,h.whiteboard,n),l(t,e.x+1,e.y+1,3,.2,"#3060a0",n),l(t,e.x+1,e.y+1.5,4,.2,"#3060a0",n),l(t,e.x+6,e.y+1,2,.2,"#a03030",n)}function ee(t,e,n){l(t,e.x,e.y,e.width,e.height,"#404040",n),l(t,e.x+.3,e.y+.3,e.width-.6,e.height-.6,e.color,n)}function te(t,e,n){l(t,e.x,e.y,e.width,e.height,e.color,n)}function ae(t,e,n,i){const a=w*n,r=e.x*a,s=e.y*a,d=3*a;t.fillStyle="rgba(0,0,0,0.15)",t.beginPath(),t.ellipse(r+d/2,s+d-a*.3,d*.4,d*.15,0,0,Math.PI*2),t.fill();const f=e.animation==="typing"?Math.sin(i*.15)*n*1.5:e.animation==="idle"?Math.sin(i*.05)*n*.5:0,c=s+f;t.fillStyle="#4a4a5a",l(t,e.x+.8,e.y+2.2,.6,.8,"#4a4a5a",n),l(t,e.x+1.6,e.y+2.2,.6,.8,"#4a4a5a",n),t.fillStyle=e.color;const u=c+a*.8;t.fillRect(Math.round(r+a*.5),Math.round(u),Math.round(a*2),Math.round(a*1.5)),t.fillStyle=e.accentColor,t.fillRect(Math.round(r+a*.7),Math.round(u),Math.round(a*1.6),Math.round(a*.3)),t.fillStyle=h.skin,t.fillRect(Math.round(r+a*.7),Math.round(c+a*.1),Math.round(a*1.6),Math.round(a*.8)),t.fillStyle=e.id==="james"?"#3a2a1a":"#5a4a3a",t.fillRect(Math.round(r+a*.6),Math.round(c),Math.round(a*1.8),Math.round(a*.35)),t.fillStyle="#1a1a2a";const b=c+a*.45;if(t.fillRect(Math.round(r+a*.95),Math.round(b),Math.round(a*.25),Math.round(a*.2)),t.fillRect(Math.round(r+a*1.8),Math.round(b),Math.round(a*.25),Math.round(a*.2)),(i+(e.id==="markus"?60:0))%120>116&&(t.fillStyle=h.skin,t.fillRect(Math.round(r+a*.95),Math.round(b),Math.round(a*.25),Math.round(a*.2)),t.fillRect(Math.round(r+a*1.8),Math.round(b),Math.round(a*.25),Math.round(a*.2))),e.animation==="typing"){t.fillStyle=e.color;const k=Math.sin(i*.3)*n;t.fillRect(Math.round(r+a*.2),Math.round(u+a*.8+k),Math.round(a*.5),Math.round(a*.4)),t.fillRect(Math.round(r+a*2.3),Math.round(u+a*.8-k),Math.round(a*.5),Math.round(a*.4)),t.fillStyle=h.skin,t.fillRect(Math.round(r+a*.1),Math.round(u+a*1.1+k),Math.round(a*.35),Math.round(a*.25)),t.fillRect(Math.round(r+a*2.55),Math.round(u+a*1.1-k),Math.round(a*.35),Math.round(a*.25))}else if(e.animation==="thinking"){if(t.fillStyle=e.color,t.fillRect(Math.round(r+a*2.1),Math.round(u+a*.2),Math.round(a*.5),Math.round(a*.8)),t.fillStyle=h.skin,t.fillRect(Math.round(r+a*2.1),Math.round(c+a*.6),Math.round(a*.3),Math.round(a*.25)),i%60<40){t.fillStyle="rgba(255,255,255,0.8)";const k=i%60/40;t.beginPath(),t.arc(r+a*2.8,c-a*.2,a*.15,0,Math.PI*2),t.fill(),k>.3&&(t.beginPath(),t.arc(r+a*3.1,c-a*.6,a*.12,0,Math.PI*2),t.fill()),k>.6&&(t.beginPath(),t.arc(r+a*3.3,c-a*1,a*.1,0,Math.PI*2),t.fill())}}else e.animation==="working"?(t.fillStyle=e.color,t.fillRect(Math.round(r+a*.1),Math.round(u+a*.4),Math.round(a*.4),Math.round(a*.8)),t.fillRect(Math.round(r+a*2.5),Math.round(u+a*.4),Math.round(a*.4),Math.round(a*.8))):(t.fillStyle=e.color,t.fillRect(Math.round(r+a*.2),Math.round(u+a*.5),Math.round(a*.4),Math.round(a*.7)),t.fillRect(Math.round(r+a*2.4),Math.round(u+a*.5),Math.round(a*.4),Math.round(a*.7)));e.id==="markus"&&(e.animation==="typing"||e.animation==="idle")&&(t.fillStyle="#2a2a2a",t.fillRect(Math.round(r+a*.5),Math.round(c-a*.05),Math.round(a*2),Math.round(a*.15)),t.fillRect(Math.round(r+a*.4),Math.round(c+a*.2),Math.round(a*.3),Math.round(a*.4)),t.fillRect(Math.round(r+a*2.3),Math.round(c+a*.2),Math.round(a*.3),Math.round(a*.4))),e.id==="james"&&e.animation==="working"&&(t.fillStyle="#e0e0e0",t.fillRect(Math.round(r+a*2.6),Math.round(u+a*.5),Math.round(a*.8),Math.round(a*1)),t.fillStyle="#a0a0a0",t.fillRect(Math.round(r+a*2.7),Math.round(u+a*.6),Math.round(a*.6),Math.round(a*.15)),t.fillRect(Math.round(r+a*2.7),Math.round(u+a*.85),Math.round(a*.6),Math.round(a*.15))),ne(t,e,n,i)}function ne(t,e,n,i){const a=w*n,r=e.x*a+a*1.5,s=e.y*a-a*1.2;if(e.animation==="away")return;const d=re(e.status);if(!d)return;const f=Math.sin(i*.08)*n*2;t.fillStyle="rgba(255,255,255,0.9)";const c=a*1.2;t.beginPath(),t.roundRect(Math.round(r-c/2),Math.round(s+f-c/2),Math.round(c),Math.round(c),n*3),t.fill(),t.strokeStyle="rgba(0,0,0,0.2)",t.lineWidth=n,t.stroke(),t.fillStyle="rgba(255,255,255,0.9)",t.beginPath(),t.moveTo(r-a*.15,s+f+c/2-n),t.lineTo(r,s+f+c/2+a*.3),t.lineTo(r+a*.15,s+f+c/2-n),t.fill(),t.font=`${Math.round(9*n)}px serif`,t.textAlign="center",t.textBaseline="middle",t.fillStyle="#000",t.fillText(d,r,s+f)}function re(t){switch(t){case"coding":return"ðŸ’»";case"delegating":return"ðŸ“‹";case"thinking":return"ðŸ¤”";case"reviewing":return"ðŸ”";case"meeting":return"ðŸ—£ï¸";case"break":return"â˜•";case"idle":return null;case"away":return null;default:return null}}function ie(t,e,n,i,a){let r,s;switch(e){case"morning":r="255, 220, 150",s=.08;break;case"day":r="255, 255, 255",s=0;break;case"evening":r="255, 150, 80",s=.12;break;case"night":r="30, 30, 80",s=.25;break;default:s=0,r="0,0,0"}s>0&&(t.fillStyle=`rgba(${r}, ${s})`,t.fillRect(0,0,i,a))}function oe(t,e,n,i){if(!e.isHovered)return;const a=w*n,r=.5+Math.sin(i*.1)*.3;t.strokeStyle=`rgba(100, 180, 255, ${r})`,t.lineWidth=2*n,t.beginPath(),t.roundRect(Math.round(e.x*a-a*.3),Math.round(e.y*a-a*.3),Math.round(a*3.6),Math.round(a*3.6),n*4),t.stroke();const s=e.x*a+a*1.5,d=e.y*a-a*2.2;t.fillStyle="rgba(0,0,0,0.75)";const f=t.measureText(e.name).width+a*.8;t.beginPath(),t.roundRect(Math.round(s-f/2),Math.round(d-a*.4),Math.round(f),Math.round(a*.9),n*3),t.fill(),t.fillStyle="#ffffff",t.font=`bold ${Math.round(8*n)}px monospace`,t.textAlign="center",t.textBaseline="middle",t.fillText(e.name,s,d)}function E(t,e){const n=Math.min(255,Math.max(0,parseInt(t.slice(1,3),16)+e)),i=Math.min(255,Math.max(0,parseInt(t.slice(3,5),16)+e)),a=Math.min(255,Math.max(0,parseInt(t.slice(5,7),16)+e));return`#${n.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")}`}class se{constructor(e){p(this,"canvas");p(this,"ctx");p(this,"animationId",null);p(this,"frameCount",0);p(this,"scale",1);p(this,"furniture");p(this,"characters",new Map);p(this,"sceneTime","day");p(this,"hoveredCharId",null);p(this,"onCharacterHover");p(this,"onCharacterClick");p(this,"isDestroyed",!1);p(this,"prefersReducedMotion",!1);p(this,"bgCanvas",null);p(this,"bgScale",0);p(this,"bookshelfSeed");p(this,"handleMouseMove",e=>{const n=this.getCanvasPos(e.clientX,e.clientY),i=this.findCharacterAt(n.x,n.y);for(const r of this.characters.values())r.isHovered=(i==null?void 0:i.id)===r.id;const a=(i==null?void 0:i.id)||null;if(a!==this.hoveredCharId){this.hoveredCharId=a,this.canvas.getBoundingClientRect();const r=e.clientX,s=e.clientY;this.onCharacterHover(i,r,s)}this.canvas.style.cursor=i?"pointer":"default"});p(this,"handleClick",e=>{const n=this.getCanvasPos(e.clientX,e.clientY),i=this.findCharacterAt(n.x,n.y);i&&this.onCharacterClick(i)});p(this,"handleTouch",e=>{if(e.touches.length!==1)return;const n=e.touches[0],i=this.getCanvasPos(n.clientX,n.clientY),a=this.findCharacterAt(i.x,i.y);a&&(e.preventDefault(),this.onCharacterClick(a))});this.canvas=e.canvas,this.ctx=this.canvas.getContext("2d"),this.onCharacterHover=e.onCharacterHover,this.onCharacterClick=e.onCharacterClick,this.furniture=z(),this.bookshelfSeed=Math.random(),this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.initCharacters(),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("click",this.handleClick),this.canvas.addEventListener("touchstart",this.handleTouch,{passive:!1}),this.resize(),this.startLoop()}initCharacters(){const e={id:"james",name:"James",role:"Team Manager",x:C.james.desk.x,y:C.james.desk.y,animation:"working",baseAnimation:"working",frame:0,frameTimer:0,direction:"down",currentTask:"Coordinating team tasks",status:"delegating",taskStartTime:new Date(Date.now()-36e5).toISOString(),color:h.jamesPrimary,accentColor:h.jamesAccent,isHovered:!1},n={id:"markus",name:"Markus",role:"Senior Developer",x:C.markus.desk.x,y:C.markus.desk.y,animation:"typing",baseAnimation:"typing",frame:0,frameTimer:0,direction:"down",currentTask:"Building Office feature",status:"coding",taskStartTime:new Date(Date.now()-72e5).toISOString(),color:h.markusPrimary,accentColor:h.markusAccent,isHovered:!1};this.characters.set("james",e),this.characters.set("markus",n)}updateFromAPI(e){this.sceneTime=e.scene.time;for(const n of e.agents){const i=this.characters.get(n.id);if(!i)continue;const a=L[n.status]||"idle";i.baseAnimation=a,i.animation!=="walking"&&(i.animation=a),i.status=n.status,i.currentTask=n.currentTask,i.taskStartTime=n.taskStartTime;const r=C[n.id];if(r){const s=n.location==="dev_station"?"desk":n.location,d=r[s];d&&(i.targetX=d.x,i.targetY=d.y)}}}resize(){const e=this.canvas.parentElement;if(!e)return;const n=e.clientWidth,i=e.clientHeight||600,a=n/R,r=i/I;this.scale=Math.min(a,r,2);const s=Math.round(R*this.scale),d=Math.round(I*this.scale);(this.canvas.width!==s||this.canvas.height!==d)&&(this.canvas.width=s,this.canvas.height=d,this.canvas.style.width=`${s}px`,this.canvas.style.height=`${d}px`),this.ctx.imageSmoothingEnabled=!1}startLoop(){const e=()=>{this.isDestroyed||(this.update(),this.render(),this.frameCount++,this.animationId=requestAnimationFrame(e))};this.animationId=requestAnimationFrame(e)}update(){if(this.prefersReducedMotion){for(const e of this.characters.values())e.targetX!==void 0&&e.targetY!==void 0&&(e.x=e.targetX,e.y=e.targetY,e.targetX=void 0,e.targetY=void 0,e.animation=e.baseAnimation);return}for(const e of this.characters.values()){if(e.targetX!==void 0&&e.targetY!==void 0){const i=e.targetX-e.x,a=e.targetY-e.y,r=Math.sqrt(i*i+a*a);r>.1?(e.x+=i/r*Math.min(.1,r),e.y+=a/r*Math.min(.1,r),e.animation="walking",Math.abs(i)>Math.abs(a)?e.direction=i>0?"right":"left":e.direction=a>0?"down":"up"):(e.x=e.targetX,e.y=e.targetY,e.targetX=void 0,e.targetY=void 0,e.animation=e.baseAnimation)}e.frameTimer++;const n=e.animation==="typing"?8:e.animation==="walking"?6:20;e.frameTimer>=n&&(e.frame=(e.frame+1)%4,e.frameTimer=0)}}render(){const{ctx:e,scale:n}=this,i=this.canvas.width,a=this.canvas.height;e.clearRect(0,0,i,a),e.imageSmoothingEnabled=!1,this.drawBackground();const r=Array.from(this.characters.values()).sort((s,d)=>s.y-d.y);for(const s of r)ae(e,s,n,this.frameCount),oe(e,s,n,this.frameCount);ie(e,this.sceneTime,n,i,a)}drawBackground(){if(!this.bgCanvas||this.bgScale!==this.scale){this.bgCanvas=document.createElement("canvas"),this.bgCanvas.width=this.canvas.width,this.bgCanvas.height=this.canvas.height;const e=this.bgCanvas.getContext("2d");e.imageSmoothingEnabled=!1;const n=Math.random;let i=this.bookshelfSeed;Math.random=()=>(i=i*16807%2147483647,(i-1)/2147483646),W(e,this.scale),Y(e,this.scale),_(e,this.furniture,this.scale,this.sceneTime),Math.random=n,this.bgScale=this.scale}this.ctx.drawImage(this.bgCanvas,0,0)}invalidateBackground(){this.bgScale=0}getCanvasPos(e,n){const i=this.canvas.getBoundingClientRect();return{x:(e-i.left)/this.scale/w,y:(n-i.top)/this.scale/w}}findCharacterAt(e,n){for(const a of this.characters.values())if(e>=a.x-.5&&e<=a.x+3+.5&&n>=a.y-.5&&n<=a.y+3+.5)return a;return null}getCharacters(){return Array.from(this.characters.values())}getCharacterById(e){return this.characters.get(e)||null}setHoveredCharacter(e){for(const n of this.characters.values())n.isHovered=n.id===e;this.hoveredCharId=e}destroy(){this.isDestroyed=!0,this.animationId!==null&&cancelAnimationFrame(this.animationId),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("click",this.handleClick),this.canvas.removeEventListener("touchstart",this.handleTouch)}}const le={coding:"Coding",delegating:"Delegating",thinking:"Thinking",reviewing:"Reviewing",meeting:"In Meeting",break:"On Break",idle:"Idle",away:"Away"};function de(t){const e=Date.now()-new Date(t).getTime(),n=Math.floor(e/6e4);if(n<1)return"Just now";if(n<60)return`${n}m ago`;const i=Math.floor(n/60);return i<24?`${i}h ${n%60}m ago`:`${Math.floor(i/24)}d ago`}function he({character:t,screenX:e,screenY:n}){const[i,a]=g.useState(!1),[r,s]=g.useState({x:0,y:0});return g.useEffect(()=>{if(t){const d=setTimeout(()=>{a(!0);const f=240,c=140;let u=e-f/2,b=n-c-20;u=Math.max(8,Math.min(window.innerWidth-f-8,u)),b=Math.max(8,b),b<8&&(b=n+20),s({x:u,y:b})},200);return()=>clearTimeout(d)}else a(!1)},[t,e,n]),!t||!i?null:o.jsx("div",{className:"fixed z-50 pointer-events-none",style:{left:r.x,top:r.y,transition:"opacity 150ms ease",opacity:i?1:0},children:o.jsxs("div",{className:"bg-gray-900/95 text-white rounded-lg border-2 border-white/20 shadow-xl px-4 py-3 w-60",style:{fontFamily:"'JetBrains Mono', 'Fira Code', monospace",imageRendering:"pixelated"},children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx("div",{className:"w-8 h-8 rounded border-2 border-white/30 flex items-center justify-center text-sm font-bold",style:{backgroundColor:t.color},children:t.name[0]}),o.jsxs("div",{children:[o.jsx("div",{className:"font-bold text-sm",children:t.name}),o.jsx("div",{className:"text-xs text-gray-400",children:t.role})]})]}),o.jsx("div",{className:"border-t border-white/10 my-2"}),o.jsxs("div",{className:"text-xs",children:[o.jsx("div",{className:"text-gray-400 mb-1",children:"Currently:"}),o.jsx("div",{className:"text-white/90 leading-tight line-clamp-2",children:t.currentTask||"No active task"})]}),o.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs",children:[o.jsxs("span",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:`w-2 h-2 rounded-full ${ce(t.status)}`}),o.jsx("span",{className:"text-gray-300",children:le[t.status]||t.status})]}),o.jsxs("span",{className:"text-gray-500",children:["â± ",de(t.taskStartTime)]})]})]})})}function ce(t){switch(t){case"coding":case"typing":return"bg-green-500";case"delegating":case"working":return"bg-blue-500";case"thinking":case"reviewing":return"bg-yellow-500";case"meeting":return"bg-purple-500";case"break":return"bg-orange-500";case"away":return"bg-gray-500";default:return"bg-gray-400"}}const A={"Strategic thinker":"ðŸ§ ","Excellent delegator":"ðŸ“‹","Clear communicator":"ðŸ’¬","Always has a plan":"ðŸ“","Analytical & methodical":"ðŸ”","Test-Driven Development advocate":"âœ…","TypeScript enthusiast":"ðŸ’™","Coffee-powered â˜•":"â˜•"},ue={high:"bg-red-500/20 text-red-400 border-red-500/30",medium:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",low:"bg-green-500/20 text-green-400 border-green-500/30"};function fe({character:t,onClose:e}){const[n,i]=g.useState(null),[a,r]=g.useState(!1);g.useEffect(()=>{if(!t){i(null);return}r(!0),fetch(`/api/office/agent/${t.id}`,{headers:P()}).then(d=>{if(!d.ok)throw new Error("Failed to load profile");return d.json()}).then(d=>{i(d),r(!1)}).catch(()=>{i({fullName:t.name,role:t.role,traits:[],currentTask:{title:t.currentTask,progress:50,startTime:t.taskStartTime},backlog:[],stats:{}}),r(!1)})},[t]);const s=g.useCallback(d=>{d.key==="Escape"&&e()},[e]);return g.useEffect(()=>{if(t)return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[t,s]),t?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:d=>d.target===d.currentTarget&&e(),children:o.jsxs("div",{className:"bg-gray-900 border-2 border-white/20 rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden animate-in fade-in zoom-in-95 duration-200",style:{fontFamily:"'JetBrains Mono', 'Fira Code', monospace"},children:[o.jsxs("div",{className:"px-6 py-5 relative",style:{background:`linear-gradient(135deg, ${t.color}40, ${t.accentColor}20)`},children:[o.jsx("button",{onClick:e,className:"absolute top-3 right-3 w-8 h-8 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 text-white/60 hover:text-white transition-colors",children:"âœ•"}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-14 h-14 rounded-lg border-3 border-white/30 flex items-center justify-center text-2xl font-bold text-white",style:{backgroundColor:t.color},children:t.name[0]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-xl font-bold text-white",children:(n==null?void 0:n.fullName)||t.name}),o.jsx("p",{className:"text-sm text-white/60",children:t.role})]})]})]}),a?o.jsxs("div",{className:"px-6 py-8 text-center text-gray-500",children:[o.jsx("div",{className:"w-6 h-6 border-2 border-white/20 border-t-white/60 rounded-full animate-spin mx-auto mb-2"}),"Loading profile..."]}):n?o.jsxs("div",{className:"px-6 py-4 space-y-4 max-h-[60vh] overflow-y-auto",children:[n.traits.length>0&&o.jsxs("div",{children:[o.jsx("h3",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-2",children:"Traits"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:n.traits.map((d,f)=>o.jsxs("span",{className:"text-xs bg-white/5 border border-white/10 rounded-full px-3 py-1 text-gray-300",children:[A[d]?`${A[d]} `:"",d]},f))})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-2",children:"Current Task"}),o.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[o.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[o.jsx("span",{className:"text-base",children:"ðŸ”¨"}),o.jsx("span",{className:"text-sm text-white/90",children:n.currentTask.title})]}),o.jsxs("div",{className:"mt-2",children:[o.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-1",children:[o.jsx("span",{children:"Progress"}),o.jsxs("span",{children:[n.currentTask.progress,"%"]})]}),o.jsx("div",{className:"h-2 bg-gray-800 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${n.currentTask.progress}%`,backgroundColor:t.color}})})]})]})]}),n.backlog.length>0&&o.jsxs("div",{children:[o.jsxs("h3",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-2",children:["Task Backlog (",n.backlog.length,")"]}),o.jsx("div",{className:"space-y-1.5",children:n.backlog.map(d=>o.jsxs("div",{className:"flex items-center gap-2 text-xs bg-white/5 rounded-md px-3 py-2",children:[o.jsx("span",{className:"text-gray-400",children:"ðŸ“‹"}),o.jsx("span",{className:"flex-1 text-gray-300 truncate",children:d.title}),o.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] border ${ue[d.priority]||"text-gray-400"}`,children:d.priority})]},d.id))})]}),Object.keys(n.stats).length>0&&o.jsxs("div",{children:[o.jsx("h3",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-2",children:"Statistics"}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(n.stats).map(([d,f])=>o.jsxs("div",{className:"bg-white/5 rounded-md px-3 py-2 text-center",children:[o.jsx("div",{className:"text-lg font-bold text-white",children:f}),o.jsx("div",{className:"text-[10px] text-gray-500 capitalize",children:d.replace(/([A-Z])/g," $1").trim()})]},d))})]})]}):null,o.jsx("div",{className:"px-6 py-3 border-t border-white/10 flex justify-end",children:o.jsx("button",{onClick:e,className:"px-4 py-1.5 text-sm bg-white/10 hover:bg-white/20 text-white rounded-md transition-colors",children:"Close"})})]})}):null}const ge=5e3;function ye(){const t=g.useRef(null),e=g.useRef(null),[n,i]=g.useState(null),[a,r]=g.useState({x:0,y:0}),[s,d]=g.useState(null),[f,c]=g.useState("connecting"),[u,b]=g.useState(""),[M,k]=g.useState(-1),j=g.useCallback((y,x,m)=>{i(y),r({x,y:m})},[]),N=g.useCallback(y=>{d(y)},[]),D=g.useCallback(y=>{const x=e.current;if(!x)return;const m=x.getCharacters();if(m.length!==0)if(y.key==="Tab"){y.preventDefault();const v=y.shiftKey?M<=0?m.length-1:M-1:(M+1)%m.length;k(v),x.setHoveredCharacter(m[v].id),j(m[v],0,0)}else y.key==="Enter"||y.key===" "?(y.preventDefault(),M>=0&&M<m.length&&d(m[M])):y.key==="Escape"&&(x.setHoveredCharacter(null),k(-1),j(null,0,0))},[M,j]);return g.useEffect(()=>{if(!t.current)return;const y=new se({canvas:t.current,onCharacterHover:j,onCharacterClick:N});e.current=y;const x=()=>y.resize();window.addEventListener("resize",x);const m=t.current.parentElement;let v=null;return m&&(v=new ResizeObserver(()=>y.resize()),v.observe(m)),()=>{y.destroy(),window.removeEventListener("resize",x),v==null||v.disconnect()}},[j,N]),g.useEffect(()=>{let y=!0,x="";const m=async()=>{try{const S=await fetch("/api/office/status",{headers:P()});if(!S.ok)throw new Error(`HTTP ${S.status}`);const T=await S.json();y&&e.current&&(e.current.updateFromAPI(T),T.scene.time!==x&&(e.current.invalidateBackground(),x=T.scene.time),c("connected"),b(new Date().toLocaleTimeString()))}catch(S){y&&(c("error"),console.warn("[Office] Failed to fetch status:",S))}};m();const v=setInterval(m,ge);return()=>{y=!1,clearInterval(v)}},[]),o.jsxs("div",{className:"relative w-full h-full flex flex-col",children:[o.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-900/80 border-b border-white/10 text-xs",children:[o.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[o.jsx("span",{className:`w-2 h-2 rounded-full ${f==="connected"?"bg-green-500":f==="connecting"?"bg-yellow-500 animate-pulse":"bg-red-500"}`}),o.jsx("span",{children:f==="connected"?"Live":f==="connecting"?"Connecting...":"Offline"}),u&&o.jsxs("span",{className:"text-gray-600",children:["â€¢ Updated ",u]})]}),o.jsxs("div",{className:"flex items-center gap-3 text-gray-500",children:[o.jsx("span",{children:"ðŸ¢ The Office"}),o.jsx("span",{className:"hidden sm:inline",children:"â€¢ Hover for details â€¢ Click for profile"})]})]}),o.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-950 overflow-hidden p-2 sm:p-4",children:o.jsx("canvas",{ref:t,className:"block rounded-lg shadow-2xl focus:outline-none focus:ring-2 focus:ring-blue-500/50",style:{imageRendering:"pixelated",maxWidth:"100%",maxHeight:"100%"},tabIndex:0,role:"img","aria-label":"AI team office visualization. Tab to cycle through team members, Enter to view profile.",onKeyDown:D})}),o.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-2 bg-gray-900/80 border-t border-white/10 text-xs text-gray-500 flex-wrap",children:[o.jsx("span",{className:"flex items-center gap-1",children:"ðŸ’» Coding"}),o.jsx("span",{className:"flex items-center gap-1",children:"ðŸ“‹ Delegating"}),o.jsx("span",{className:"flex items-center gap-1",children:"ðŸ¤” Thinking"}),o.jsx("span",{className:"flex items-center gap-1",children:"â˜• Break"}),o.jsx("span",{className:"flex items-center gap-1",children:"ðŸ” Reviewing"})]}),o.jsx(he,{character:n,screenX:a.x,screenY:a.y}),o.jsx(fe,{character:s,onClose:()=>d(null)})]})}function Se(){return o.jsx("div",{className:"h-[calc(100vh-4rem)] w-full",children:o.jsx(ye,{})})}export{Se as OfficePage};
