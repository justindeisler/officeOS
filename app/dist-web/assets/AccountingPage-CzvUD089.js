import{r as l,j as t}from"./vendor-react-nkeu7MKf.js";import{c as U,j as d,a as R,L as le,T as de,P as ue,Q as me,F as xe,R as pe,V as fe,W as he}from"./index-DrITRpZC.js";import{g as ge}from"./income-BcxYOHsL.js";import{g as je}from"./expenses-DTkRPi84.js";import{g as ee}from"./db-Bp86U6zF.js";import{E as be}from"./index-uXN-dP3D.js";import{u as ve,I as Ne}from"./IncomeDialog-y1pIGphY.js";import{u as ye,E as De}from"./ExpenseDialog-rWD4_89J.js";import{A as we}from"./AssetDialog-eWkyRBM9.js";import{R as B,B as Ee,C as te,X as ne,Y as se,T as q,L as V,a as K,b as Ce,d as z,P as Ie,e as Me,f as Fe}from"./vendor-recharts-COauwCrp.js";import{R as Q}from"./refresh-cw-DAeFkAP4.js";import{P as $}from"./plus-CdEWzdSX.js";import{e as ke}from"./select-DGc7E8u9.js";import"./table-CJJi2_4w.js";import"./card-BgiI-iYU.js";import"./vendor-markdown-zaQAhtrl.js";import"./vendor-radix-Oq5tdvA1.js";import"./vendor-floating-ui-_Y3uXdsy.js";import"./vendor-router-bCYKpmtI.js";import"./dialog-BB-bSIFe.js";import"./vendor-forms-BDwCPqGD.js";import"./triangle-alert-B_BYk9et.js";import"./assets-DyuHYw1T.js";import"./vendor-framer-motion-Dlt2pHhV.js";import"./upload-CLGdoZOe.js";import"./circle-alert-CpxKUFz7.js";import"./alert-dialog-BaBnwxVM.js";import"./external-link-DNdX8sal.js";import"./trash-2-lofomgWT.js";import"./info-BXggt0RD.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=U("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=U("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=U("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),T={income:"hsl(142, 76%, 36%)",expenses:"hsl(0, 84.2%, 60.2%)",profit:"hsl(199, 89%, 48%)"};function G(e,n){return{id:e.id,invoiceNumber:e.invoice_number,invoiceDate:new Date(e.invoice_date),dueDate:new Date(e.due_date),status:e.status,clientId:e.client_id??void 0,projectId:e.project_id??void 0,subtotal:e.subtotal??0,vatRate:e.vat_rate??19,vatAmount:e.vat_amount??0,total:e.total??0,paymentDate:e.payment_date?new Date(e.payment_date):void 0,paymentMethod:e.payment_method,notes:e.notes??void 0,items:n,createdAt:new Date(e.created_at)}}function Re(e){return{id:e.id,invoiceId:e.invoice_id,description:e.description,quantity:e.quantity??1,unit:e.unit??"hours",unitPrice:e.unit_price??0,amount:e.amount??0}}async function Se(e){return(await(await ee()).select("SELECT * FROM invoice_items WHERE invoice_id = $1",[e])).map(Re)}async function Le(){try{const n=await(await ee()).select("SELECT * FROM invoices ORDER BY invoice_date DESC"),s=[];for(const r of n)try{const a=await Se(r.id);s.push(G(r,a))}catch(a){console.error(`Failed to get items for invoice ${r.id}:`,a),s.push(G(r,[]))}return s}catch(e){throw console.error("getAllInvoices error:",e),e}}function Ye(){const e=new Date().getMonth();return e<3?1:e<6?2:e<9?3:4}function _e(e={}){const{year:n=new Date().getFullYear(),quarter:s=Ye(),autoFetch:r=!0}=e,[a,o]=l.useState(null),[i,c]=l.useState(!1),[x,m]=l.useState(null),[f,F]=l.useState(n),[v,I]=l.useState(s),w=l.useCallback((u,k,E)=>{const y=u.filter(p=>p.date.getFullYear()===f),C=k.filter(p=>p.date.getFullYear()===f),S=y.reduce((p,A)=>p+A.grossAmount,0),L=C.reduce((p,A)=>p+A.grossAmount,0),b=S-L,M=E.filter(p=>p.status==="sent"||p.status==="overdue"),h=M.length,g=M.reduce((p,A)=>p+A.total,0),Y=new Date(f,(v-1)*3,1),ie=new Date(f,v*3,0),ce=y.filter(p=>p.date>=Y&&p.date<=ie).reduce((p,A)=>p+A.vatAmount,0);return{totalIncome:Math.round(S*100)/100,totalExpenses:Math.round(L*100)/100,profit:Math.round(b*100)/100,pendingInvoices:h,pendingAmount:Math.round(g*100)/100,currentQuarterVat:Math.round(ce*100)/100}},[f,v]),N=l.useCallback(async()=>{c(!0),m(null);try{const[u,k,E]=await Promise.all([ge(),je(),Le()]),y=w(u,k,E);o(y)}catch(u){m(u instanceof Error?u.message:"Failed to load stats"),o(null)}finally{c(!1)}},[w]),j=l.useCallback(async()=>{await N()},[N]);return l.useEffect(()=>{r&&N()},[r,N]),{stats:a,isLoading:i,error:x,refresh:j,year:f,quarter:v,setYear:F,setQuarter:I}}function W(e,n,s){const r=Array.from({length:12},(a,o)=>({year:s,month:o+1,income:0,expenses:0,profit:0,vatCollected:0,vatPaid:0,transactionCount:0}));return e.filter(a=>a.date.getFullYear()===s).forEach(a=>{const o=a.date.getMonth();r[o].income+=a.netAmount,r[o].vatCollected+=a.vatAmount,r[o].transactionCount+=1}),n.filter(a=>a.date.getFullYear()===s).forEach(a=>{const o=a.date.getMonth();r[o].expenses+=a.netAmount,r[o].vatPaid+=a.vatAmount,r[o].transactionCount+=1}),r.forEach(a=>{a.profit=a.income-a.expenses}),r}function Oe(e){if(e.length===0)return[];const n=Ge(e),s=J(e,"netAmount");return Object.entries(n).map(([a,o])=>{const i=J(o,"netAmount"),c=o.length,x=be[a],m=(x==null?void 0:x.label)??a;return{category:a,label:m,amount:i,percentage:s>0?i/s*100:0,transactionCount:c,averageTransaction:c>0?i/c:0}}).sort((a,o)=>o.amount-a.amount)}function Qe(e,n,s){const r=[];if(r.push(_("totalIncome","Total Income",e.totalIncome,n.totalIncome,"currency")),r.push(_("totalExpenses","Total Expenses",e.totalExpenses,n.totalExpenses,"currency")),r.push(_("profit","Net Profit",e.profit,n.profit,"currency")),e.totalIncome>0||n.totalIncome>0){const a=e.totalIncome>0?e.profit/e.totalIncome*100:0,o=n.totalIncome>0?n.profit/n.totalIncome*100:0;r.push(_("profitMargin","Profit Margin",a,o,"percent"))}return r}function _(e,n,s,r,a){const o=s-r,i=Ke(s,r);return{metric:e,label:n,currentYear:s,previousYear:r,change:o,changePercent:i,trend:ze(o),format:a}}function $e(e){return e.map(n=>({month:re(n.month),monthIndex:n.month,income:n.income,expenses:n.expenses,profit:n.profit}))}function Ue(e){let n=0;return e.map(s=>(n+=s.profit,{month:re(s.month),monthIndex:s.month,profit:s.profit,cumulativeProfit:n}))}function Be(e){const n=["hsl(222.2, 47.4%, 11.2%)","hsl(142, 76%, 36%)","hsl(38, 92%, 50%)","hsl(199, 89%, 48%)","hsl(0, 84.2%, 60.2%)","hsl(280, 65%, 60%)","hsl(180, 60%, 45%)","hsl(30, 80%, 55%)"];return e.map((s,r)=>({name:s.label,value:s.amount,percentage:s.percentage,color:n[r%n.length]}))}const qe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Ve=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function re(e,n="en"){const r=Math.max(1,Math.min(12,e))-1;return n==="de"?Ve[r]:qe[r]}function Ke(e,n){return n===0&&e===0?0:n===0?100:(e-n)/n*100}function ze(e){return e>0?"up":e<0?"down":"neutral"}function J(e,n){return e.reduce((s,r)=>{const a=r[n];return s+(typeof a=="number"?a:0)},0)}function Ge(e){const n={};return e.forEach(s=>{const r=s.euerCategory;n[r]||(n[r]=[]),n[r].push(s)}),n}function We(e,n,s){return e.length===0?0:ae(e,"income")*3}function Je(e,n,s){return e.length===0?0:ae(e,"expenses")*3}function ae(e,n){if(e.length===0)return 0;const s=[...e].sort((o,i)=>o.year!==i.year?o.year-i.year:o.month-i.month);let r=0,a=0;return s.forEach((o,i)=>{const c=Math.pow(1.2,i);a+=o[n]*c,r+=c}),r>0?a/r:0}function He(e,n){return e-n}function Ze(e){return e<3?"low":e<6?"medium":"high"}function Xe(e,n){const r={low:.3,medium:.2,high:.1}[n];return{low:e*(1-r),high:e*(1+r)}}function et(e,n,s){let a=n*3-1+1+(s?1:0),o=e;return a>11&&(a=a-12,o=e+1),new Date(o,a,10)}function tt(e,n,s,r){const a=We(e),o=Je(e),i=a*.19,c=o*.19,x=He(i,c),m=e.length,f=Ze(m),F=Xe(x,f),v=et(n,s,r);return{period:rt(n,s),year:n,quarter:s,projectedIncome:a,projectedExpenses:o,projectedUmsatzsteuer:i,projectedVorsteuer:c,estimatedZahllast:x,confidence:f,dueDate:v,hasDauerfrist:r,dataPointsUsed:m,projectionRange:F}}function nt(e){return Math.ceil(e/3)}function st(){const e=new Date().getMonth()+1;return nt(e)}function rt(e,n){return`${e}-Q${n}`}function at(e){const{year:n,previousYear:s=n-1,hasDauerfrist:r=!1}=e,{income:a,isLoading:o,error:i}=ve({autoFetch:!0}),{expenses:c,isLoading:x,error:m}=ye({autoFetch:!0}),f=o||x,F=i||m,v=l.useMemo(()=>a.filter(b=>b.date.getFullYear()===n),[a,n]),I=l.useMemo(()=>c.filter(b=>b.date.getFullYear()===n),[c,n]),w=l.useMemo(()=>a.filter(b=>b.date.getFullYear()===s),[a,s]),N=l.useMemo(()=>c.filter(b=>b.date.getFullYear()===s),[c,s]),j=l.useMemo(()=>W(v,I,n),[v,I,n]),u=l.useMemo(()=>W(w,N,s),[w,N,s]),k=l.useMemo(()=>$e(j),[j]),E=l.useMemo(()=>Ue(j),[j]),y=l.useMemo(()=>Oe(I),[I]),C=l.useMemo(()=>Be(y),[y]),S=l.useMemo(()=>{const b=j.filter(Y=>Y.income>0||Y.expenses>0);if(b.length===0)return null;const M=st(),h=M===4?1:M+1,g=M===4?n+1:n;return tt(b,g,h,r)},[j,n,r]),L=l.useMemo(()=>{const b={totalIncome:j.reduce((h,g)=>h+g.income,0),totalExpenses:j.reduce((h,g)=>h+g.expenses,0),profit:j.reduce((h,g)=>h+g.profit,0)},M={totalIncome:u.reduce((h,g)=>h+g.income,0),totalExpenses:u.reduce((h,g)=>h+g.expenses,0),profit:u.reduce((h,g)=>h+g.profit,0)};return Qe(b,M)},[j,u,n]);return{plChartData:k,profitTrendData:E,expenseDonutData:C,categoryBreakdown:y,taxForecast:S,yearComparison:L,currentYear:n,previousYear:s,isLoading:f,error:F}}function ot(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function it({active:e,payload:n,label:s}){return!e||!n||n.length===0?null:t.jsxs("div",{className:"rounded-lg border bg-background p-3 shadow-md",children:[t.jsx("p",{className:"font-medium text-sm mb-2",children:s}),n.map((r,a)=>t.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": ",ot(r.value)]},a))]})}function ct({data:e,title:n,height:s=300,className:r}){return!e||e.length===0?t.jsx("div",{className:d("flex items-center justify-center",r),style:{height:s},children:t.jsx("p",{className:"text-muted-foreground text-sm",children:"No data available"})}):t.jsxs("div",{className:d("w-full",r),children:[n&&t.jsx("h3",{className:"text-lg font-semibold mb-4",children:n}),t.jsx(B,{width:"100%",height:s,children:t.jsxs(Ee,{data:e,margin:{top:10,right:30,left:0,bottom:0},role:"img","aria-label":"Income vs Expenses chart",children:[t.jsx(te,{strokeDasharray:"3 3",className:"stroke-muted"}),t.jsx(ne,{dataKey:"month",tick:{fontSize:12},className:"text-muted-foreground"}),t.jsx(se,{tick:{fontSize:12},tickFormatter:a=>Math.abs(a)>=1e3?`${(a/1e3).toFixed(1)}k`:a.toFixed(0),className:"text-muted-foreground"}),t.jsx(q,{content:t.jsx(it,{})}),t.jsx(V,{wrapperStyle:{paddingTop:"10px"},formatter:a=>t.jsx("span",{className:"text-sm text-foreground",children:a})}),t.jsx(K,{dataKey:"income",name:"Income",fill:T.income,radius:[4,4,0,0]}),t.jsx(K,{dataKey:"expenses",name:"Expenses",fill:T.expenses,radius:[4,4,0,0]})]})})]})}function lt(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function dt({active:e,payload:n,label:s}){return!e||!n||n.length===0?null:t.jsxs("div",{className:"rounded-lg border bg-background p-3 shadow-md",children:[t.jsx("p",{className:"font-medium text-sm mb-2",children:s}),n.map((r,a)=>t.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": ",lt(r.value)]},a))]})}function ut({data:e,title:n,height:s=300,showCumulative:r=!0,className:a}){return!e||e.length===0?t.jsx("div",{className:d("flex items-center justify-center",a),style:{height:s},children:t.jsx("p",{className:"text-muted-foreground text-sm",children:"No data available"})}):t.jsxs("div",{className:d("w-full",a),children:[n&&t.jsx("h3",{className:"text-lg font-semibold mb-4",children:n}),t.jsx(B,{width:"100%",height:s,children:t.jsxs(Ce,{data:e,margin:{top:10,right:30,left:0,bottom:0},role:"img","aria-label":"Profit trend chart",children:[t.jsx(te,{strokeDasharray:"3 3",className:"stroke-muted"}),t.jsx(ne,{dataKey:"month",tick:{fontSize:12},className:"text-muted-foreground"}),t.jsx(se,{tick:{fontSize:12},tickFormatter:o=>Math.abs(o)>=1e3?`${(o/1e3).toFixed(1)}k`:o.toFixed(0),className:"text-muted-foreground"}),t.jsx(q,{content:t.jsx(dt,{})}),t.jsx(V,{wrapperStyle:{paddingTop:"10px"},formatter:o=>t.jsx("span",{className:"text-sm text-foreground",children:o})}),t.jsx(z,{type:"monotone",dataKey:"profit",name:"Monthly Profit",stroke:T.profit,strokeWidth:2,dot:{fill:T.profit,r:4},activeDot:{r:6}}),r&&t.jsx(z,{type:"monotone",dataKey:"cumulativeProfit",name:"Cumulative Profit",stroke:T.income,strokeWidth:2,strokeDasharray:"5 5",dot:{fill:T.income,r:4},activeDot:{r:6}})]})})]})}function oe(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function mt({active:e,payload:n}){if(!e||!n||n.length===0)return null;const s=n[0].payload;return t.jsxs("div",{className:"rounded-lg border bg-background p-3 shadow-md",children:[t.jsx("p",{className:"font-medium text-sm mb-1",children:s.name}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:[oe(s.value)," (",s.percentage.toFixed(1),"%)"]})]})}function xt({data:e,title:n,height:s=300,showTotal:r=!1,className:a}){if(!e||e.length===0)return t.jsx("div",{className:d("flex items-center justify-center",a),style:{height:s},children:t.jsx("p",{className:"text-muted-foreground text-sm",children:"No data available"})});const o=e.reduce((i,c)=>i+c.value,0);return t.jsxs("div",{className:d("w-full",a),children:[n&&t.jsx("h3",{className:"text-lg font-semibold mb-4",children:n}),t.jsxs("div",{className:"relative",children:[t.jsx(B,{width:"100%",height:s,children:t.jsxs(Ie,{role:"img","aria-label":"Expense breakdown chart",children:[t.jsx(Me,{data:e,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:2,dataKey:"value",nameKey:"name",children:e.map((i,c)=>t.jsx(Fe,{fill:i.color},`cell-${c}`))}),t.jsx(q,{content:t.jsx(mt,{})}),t.jsx(V,{verticalAlign:"bottom",height:36,formatter:i=>t.jsx("span",{className:"text-sm text-foreground",children:i})})]})}),r&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:t.jsxs("div",{className:"text-center",style:{marginBottom:"36px"},children:[t.jsx("p",{className:"text-2xl font-bold",children:oe(o)}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"})]})})]})]})}function P(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function H(e){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(e)}function pt(e){const n="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium";switch(e){case"high":return d(n,"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200");case"medium":return d(n,"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200");case"low":return d(n,"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200")}}function ft({forecast:e,variant:n="default",className:s}){const r=e.estimatedZahllast<0,a=n==="compact";return t.jsxs("div",{className:d("rounded-lg border bg-card p-6",s),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Tax Forecast"}),t.jsx("p",{className:"text-2xl font-bold text-foreground",children:e.period})]}),t.jsxs("div",{className:"flex flex-col items-end gap-2",children:[t.jsxs("span",{className:pt(e.confidence),children:[e.confidence.charAt(0).toUpperCase()+e.confidence.slice(1)," confidence"]}),e.hasDauerfrist&&t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",children:"Dauerfrist"})]})]}),t.jsxs("div",{className:"mb-6 p-4 rounded-lg bg-muted/50",children:[t.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:["Estimated ",r?"Refund (Erstattung)":"Payment (Zahllast)"]}),t.jsxs("p",{className:d("text-3xl font-bold",r?"text-green-600 dark:text-green-400":"text-foreground"),children:[r?"-":"",P(Math.abs(e.estimatedZahllast))]}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Range: ",P(e.projectionRange.low)," – ",P(e.projectionRange.high)]})]}),!a&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Projected Income"}),t.jsx("p",{className:"text-lg font-semibold",children:P(e.projectedIncome)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Projected Expenses"}),t.jsx("p",{className:"text-lg font-semibold",children:P(e.projectedExpenses)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"USt (Collected)"}),t.jsx("p",{className:"text-lg font-semibold",children:P(e.projectedUmsatzsteuer)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Vorsteuer (Paid)"}),t.jsx("p",{className:"text-lg font-semibold",children:P(e.projectedVorsteuer)})]})]}),t.jsxs("div",{className:"flex items-center justify-between pt-4 border-t text-sm text-muted-foreground",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Due Date:"})," ",H(e.dueDate)]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Based on:"})," ",e.dataPointsUsed," months of data"]})]})]}),a&&t.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[t.jsxs("span",{children:["Due: ",H(e.dueDate)]}),t.jsxs("span",{children:[e.dataPointsUsed," months data"]})]})]})}function Z(e,n){switch(n){case"currency":return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);case"percent":return new Intl.NumberFormat("de-DE",{style:"percent",minimumFractionDigits:1,maximumFractionDigits:1}).format(e/100);case"number":default:return new Intl.NumberFormat("de-DE").format(e)}}function ht(e,n){return n===0&&e===0?0:n===0?100:(e-n)/n*100}function gt(e){return e>0?"up":e<0?"down":"neutral"}function jt(e,n){if(e==="neutral")return"text-muted-foreground";const s=e==="up";return(n?s:!s)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}function bt({trend:e,className:n}){switch(e){case"up":return t.jsx(Pe,{"data-testid":"trend-up",className:n});case"down":return t.jsx(Ae,{"data-testid":"trend-down",className:n});case"neutral":default:return t.jsx(Te,{"data-testid":"trend-neutral",className:n})}}function vt({title:e,currentValue:n,previousValue:s,format:r,positiveIsGood:a=!0,className:o}){const i=n-s,c=ht(n,s),x=gt(i),m=jt(x,a);return t.jsxs("div",{className:d("rounded-lg border bg-card p-4",o),children:[t.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:e}),t.jsx("p",{className:"text-2xl font-bold mb-2",children:Z(n,r)}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(bt,{trend:x,className:d("h-4 w-4",m)}),t.jsxs("span",{className:d("text-sm font-medium",m),children:[Math.abs(c).toFixed(1),"%"]}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:["vs ",Z(s,r)]})]})]})}function Nt(e){return!["totalExpenses","expenses","vatPaid","taxOwed"].includes(e)}function yt({comparisons:e,currentYear:n,previousYear:s,title:r,className:a}){if(!e||e.length===0)return t.jsx("div",{className:d("flex items-center justify-center p-8",a),children:t.jsx("p",{className:"text-muted-foreground text-sm",children:"No data available"})});const o=r||`${n} vs ${s}`;return t.jsxs("div",{className:d("space-y-4",a),children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsx("h2",{className:"text-xl font-semibold",children:o})}),t.jsx("div",{"data-testid":"comparison-grid",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:e.map(i=>t.jsx(vt,{title:i.label,currentValue:i.currentYear,previousValue:i.previousYear,format:i.format,positiveIsGood:Nt(i.metric)},i.metric))})]})}function D(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e)}function X(e){return`Q${e}`}function O({title:e,value:n,subtitle:s,icon:r,testId:a,colorClass:o,onClick:i,tabIndex:c=0,ariaLabel:x}){return t.jsx("div",{"data-testid":a,className:d("rounded-lg border bg-card p-6 shadow-sm",o,i&&"cursor-pointer hover:bg-accent/50 transition-colors"),onClick:i,onKeyDown:m=>{i&&(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),i())},tabIndex:i?c:void 0,role:i?"button":void 0,"aria-label":x||e,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:e}),t.jsx("p",{className:"text-2xl font-bold mt-1",children:n}),s&&t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s})]}),t.jsx("div",{className:"flex items-center justify-center",children:r})]})})}function Dt({onNavigate:e,className:n}){const{stats:s,isLoading:r,error:a,refresh:o,year:i,quarter:c,setYear:x}=_e(),[m,f]=l.useState(!1),[F,v]=l.useState(!1),[I,w]=l.useState(!1),[N,j]=l.useState(!0),u=at({year:i,hasDauerfrist:!1});if(r)return t.jsx("div",{className:d("space-y-6",n),children:t.jsxs("div",{className:"flex items-center justify-center p-12",children:[t.jsx(Q,{className:"h-8 w-8 animate-spin text-muted-foreground"}),t.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading..."})]})});if(a)return t.jsx("div",{className:d("space-y-6",n),children:t.jsxs("div",{className:"rounded-lg border border-destructive bg-destructive/10 p-6",children:[t.jsx("p",{className:"text-destructive",children:a}),t.jsxs(R,{variant:"outline",onClick:o,className:"mt-4",children:[t.jsx(Q,{className:"mr-2 h-4 w-4"}),"Retry"]})]})});const k=s?s.profit>0?"text-green-600":s.profit<0?"text-red-600":"":"",E=new Date().getFullYear(),y=[E-2,E-1,E];return t.jsxs("div",{className:d("space-y-6",n),children:[t.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Dashboard"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(le,{htmlFor:"year-select",className:"hidden sm:inline",children:"Period"}),t.jsx("select",{id:"year-select","aria-label":"Period",className:"flex h-9 rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",value:i,onChange:C=>x(Number(C.target.value)),children:y.map(C=>t.jsx("option",{value:C,children:C},C))})]}),t.jsxs(R,{variant:"outline",size:"sm",onClick:o,children:[t.jsx(Q,{className:"mr-2 h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]})]}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Current Quarter: ",X(c)," ",i]}),t.jsxs("div",{className:"grid gap-4 grid-cols-2 sm:grid-cols-3 lg:grid-cols-5",children:[t.jsx(O,{title:"Total Income",value:D(s?s.totalIncome:0),icon:t.jsx(de,{className:"h-6 w-6 text-green-600"}),testId:"income-card",ariaLabel:"Total Income",onClick:()=>e==null?void 0:e("income"),tabIndex:0}),t.jsx(O,{title:"Total Expenses",value:D(s?s.totalExpenses:0),icon:t.jsx(ue,{className:"h-6 w-6 text-red-600"}),testId:"expenses-card",ariaLabel:"Total Expenses",onClick:()=>e==null?void 0:e("expenses"),tabIndex:0}),t.jsx("div",{"data-testid":"profit-card",className:d("rounded-lg border bg-card p-6 shadow-sm",k),"aria-label":"Profit",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Profit"}),t.jsx("p",{className:"text-2xl font-bold mt-1",children:D(s?s.profit:0)}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s&&s.profit>0?"Net gain":s&&s.profit<0?"Net loss":"Break even"})]}),t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(me,{className:"h-6 w-6"})})]})}),t.jsx(O,{title:"Pending Invoices",value:s?s.pendingInvoices.toString():"0",subtitle:D(s?s.pendingAmount:0),icon:t.jsx(xe,{className:"h-6 w-6 text-orange-600"}),testId:"pending-card",ariaLabel:"Pending Invoices",onClick:()=>e==null?void 0:e("invoices"),tabIndex:0}),t.jsx(O,{title:"VAT (USt)",value:D(s?s.currentQuarterVat:0),subtitle:`${X(c)} ${i}`,icon:t.jsx(pe,{className:"h-6 w-6 text-blue-600"}),testId:"vat-card",ariaLabel:"Current Quarter VAT"})]}),t.jsxs("div",{className:"rounded-lg border bg-card p-6 shadow-sm","data-testid":"quick-actions",children:[t.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"flex flex-wrap gap-3",children:[t.jsxs(R,{onClick:()=>f(!0),"data-testid":"add-income-btn",children:[t.jsx($,{className:"mr-2 h-4 w-4"}),"Add Income"]}),t.jsxs(R,{variant:"outline",onClick:()=>v(!0),"data-testid":"add-expense-btn",children:[t.jsx($,{className:"mr-2 h-4 w-4"}),"Add Expense"]}),t.jsxs(R,{variant:"outline",onClick:()=>w(!0),"data-testid":"add-asset-btn",children:[t.jsx($,{className:"mr-2 h-4 w-4"}),"Add Asset"]})]})]}),t.jsxs("div",{className:"rounded-lg border bg-card shadow-sm","data-testid":"reports-section",children:[t.jsxs("button",{className:"flex w-full items-center justify-between p-6 text-left",onClick:()=>j(!N),"aria-expanded":N,"aria-controls":"reports-content",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(fe,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("h2",{className:"text-lg font-semibold",children:"Reports & Analytics"})]}),N?t.jsx(ke,{className:"h-5 w-5 text-muted-foreground"}):t.jsx(he,{className:"h-5 w-5 text-muted-foreground"})]}),N&&t.jsxs("div",{id:"reports-content",className:"space-y-6 px-6 pb-6",children:[t.jsx(yt,{comparisons:u.yearComparison,currentYear:u.currentYear,previousYear:u.previousYear}),u.taxForecast&&t.jsx(ft,{forecast:u.taxForecast}),t.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[t.jsx("div",{className:"rounded-lg border bg-background p-4",children:t.jsx(ct,{data:u.plChartData,title:"Income vs Expenses",height:280})}),t.jsx("div",{className:"rounded-lg border bg-background p-4",children:t.jsx(ut,{data:u.profitTrendData,title:"Profit Trend",height:280})})]}),t.jsx("div",{className:"rounded-lg border bg-background p-4",children:t.jsx(xt,{data:u.expenseDonutData,title:"Expense Breakdown",height:300,showTotal:!0})})]})]}),t.jsx(Ne,{open:m,onOpenChange:f,income:null,onClose:()=>f(!1)}),t.jsx(De,{open:F,onOpenChange:v,expense:null,onClose:()=>v(!1)}),t.jsx(we,{open:I,onOpenChange:w,asset:null,onClose:()=>w(!1)})]})}function tn(){return t.jsx(Dt,{})}export{tn as AccountingPage};
