import{r as o,j as n}from"./vendor-react-DeR5d9Tv.js";import{c as h,n as w,j as g,a as E}from"./index-B9wpeZVf.js";import{R as x}from"./refresh-cw-BMXkLT5Q.js";import"./vendor-markdown-PIr_2kdo.js";import"./vendor-recharts-DrMJw15s.js";import"./vendor-radix-sPo3_CXI.js";import"./vendor-floating-ui-CESiY8Ey.js";import"./vendor-router-9bGSKQ4q.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=h("CloudOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=h("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),d=w("useOfflineSync"),p="offline-sync-queue",T=3;function j(){const[t,a]=o.useState(navigator.onLine),[e,i]=o.useState([]),[l,u]=o.useState(!1);o.useEffect(()=>{const r=localStorage.getItem(p);if(r)try{i(JSON.parse(r))}catch(s){d.error({err:s},"Failed to parse sync queue"),localStorage.removeItem(p)}},[]),o.useEffect(()=>{localStorage.setItem(p,JSON.stringify(e))},[e]),o.useEffect(()=>{const r=()=>a(!0),s=()=>a(!1);return window.addEventListener("online",r),window.addEventListener("offline",s),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",s)}},[]),o.useEffect(()=>{t&&e.length>0&&!l&&f()},[t,e.length]);const y=o.useCallback(r=>{const s={...r,id:`${r.type}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),retries:0};return i(c=>[...c,s]),s.id},[]),m=o.useCallback(r=>{i(s=>s.filter(c=>c.id!==r))},[]),f=o.useCallback(async()=>{if(l||e.length===0||!t)return;u(!0);const r=[];for(const s of e)try{await b(s)}catch(c){d.error({err:s,error:c},"Failed to sync action"),s.retries<T?r.push({...s,retries:s.retries+1}):d.error({err:s},"Max retries exceeded for action")}i(r),u(!1)},[e,t,l]);return{isOnline:t,queue:e,isSyncing:l,queueLength:e.length,addToQueue:y,removeFromQueue:m,syncQueue:f}}async function b(t){const a="/api";switch(t.type){case"CREATE_TASK":{const e=await fetch(`${a}/api/tasks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload)});if(!e.ok)throw new Error(`Failed to create task: ${e.statusText}`);break}case"UPDATE_TASK":{const e=await fetch(`${a}/api/tasks/${t.payload.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload)});if(!e.ok)throw new Error(`Failed to update task: ${e.statusText}`);break}case"DELETE_TASK":{const e=await fetch(`${a}/api/tasks/${t.payload.id}`,{method:"DELETE"});if(!e.ok)throw new Error(`Failed to delete task: ${e.statusText}`);break}case"CREATE_PROJECT":{const e=await fetch(`${a}/api/projects`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload)});if(!e.ok)throw new Error(`Failed to create project: ${e.statusText}`);break}case"UPDATE_PROJECT":{const e=await fetch(`${a}/api/projects/${t.payload.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload)});if(!e.ok)throw new Error(`Failed to update project: ${e.statusText}`);break}default:d.warn({data:t.type},"Unknown action type")}}function R(){const{isOnline:t,queueLength:a,isSyncing:e,syncQueue:i}=j();return t&&a===0?null:n.jsx("div",{className:"fixed bottom-4 right-4 z-40",children:n.jsx("div",{className:g("flex items-center gap-2 px-3 py-2 rounded-lg shadow-lg text-sm backdrop-blur-sm",t?"bg-blue-500/90 text-white":"bg-orange-500/90 text-white"),children:e?n.jsxs(n.Fragment,{children:[n.jsx(x,{className:"w-4 h-4 animate-spin"}),n.jsxs("span",{children:["Syncing ",a," items..."]})]}):a>0?n.jsxs(n.Fragment,{children:[n.jsx(S,{className:"w-4 h-4"}),n.jsxs("span",{children:[a," pending"]}),t&&n.jsx(E,{size:"sm",variant:"ghost",className:"h-6 px-2 text-white hover:bg-white/20",onClick:i,children:"Sync now"})]}):n.jsxs(n.Fragment,{children:[n.jsx(k,{className:"w-4 h-4"}),n.jsx("span",{children:"Synced"})]})})})}export{R as SyncStatusIndicator};
