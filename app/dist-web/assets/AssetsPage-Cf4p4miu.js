import{r as m,j as e}from"./vendor-react-DeR5d9Tv.js";import{u as E,A as B}from"./AssetDialog-D2rPRuLz.js";import{j as A,s as I,V as R,a as j,I as M,B as S,F as O,n as Y}from"./index-B9wpeZVf.js";import{T as $,a as q,b as D,c as o,d as z,e as l}from"./table-pJl76dEH.js";import{C as H}from"./confirm-delete-dialog-LuDEhVpD.js";import{a as U}from"./assets-DTNv2ysQ.js";import{P as G}from"./plus-BG4HFTMm.js";import{S as J}from"./search-CsGBUCyq.js";import{T as K}from"./trash-2-BAQCKdVR.js";import"./card-Do3Kg1xk.js";import"./vendor-markdown-PIr_2kdo.js";import"./dialog-FtNsGa4T.js";import"./vendor-radix-sPo3_CXI.js";import"./vendor-floating-ui-CESiY8Ey.js";import"./vendor-forms-slL2B-gN.js";import"./index-uXN-dP3D.js";import"./select-BY8eQiQN.js";import"./check-BOz78U_D.js";import"./chevron-up-Csf9Xqjr.js";import"./vendor-framer-motion-5hIM_3P7.js";import"./upload-Ddt_p2-Y.js";import"./circle-alert-DR10Pc3C.js";import"./alert-dialog-83Lj5Hrs.js";import"./external-link-DW0qQmWJ.js";import"./info-D7pY16WJ.js";import"./vendor-recharts-DrMJw15s.js";import"./vendor-router-9bGSKQ4q.js";import"./db-DvpaIHPS.js";const T=Y("AssetList");function g(t){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)}function Q(t){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(t)}function W(t){return{computer:"Computer",phone:"Phone",furniture:"Furniture",equipment:"Equipment",software:"Software"}[t]}function X(t){return{active:"Active",disposed:"Disposed",sold:"Sold"}[t]}function Z(t){return{active:"default",disposed:"secondary",sold:"outline"}[t]}function P(t){const r=new Date().getFullYear(),i=t.depreciationSchedule.filter(n=>n.year<=r).sort((n,u)=>u.year-n.year)[0];return(i==null?void 0:i.bookValue)??t.purchasePrice}function _({onAddAsset:t,onEditAsset:r,className:i,refreshTrigger:n}){const{assets:u,isLoading:v,error:p,deleteAsset:N,setSelectedAsset:b,refresh:f}=E(),[c,L]=m.useState(""),[w,y]=m.useState(null);m.useEffect(()=>{n&&n>0&&f()},[n,f]);const h=m.useMemo(()=>{if(!c)return u;const s=c.toLowerCase();return u.filter(a=>{var d,x;return a.name.toLowerCase().includes(s)||(((d=a.vendor)==null?void 0:d.toLowerCase().includes(s))??!1)||(((x=a.description)==null?void 0:x.toLowerCase().includes(s))??!1)||a.category.toLowerCase().includes(s)})},[u,c]),C=m.useMemo(()=>{const s=h.filter(a=>a.status==="active");return{purchaseValue:h.reduce((a,d)=>a+d.purchasePrice,0),bookValue:h.reduce((a,d)=>a+P(d),0),activeCount:s.length}},[h]),k=s=>{b(s),r==null||r(s)},V=(s,a)=>{s.stopPropagation(),y(a)},F=async()=>{w&&(await N(w),y(null))};return v?e.jsxs("div",{className:A("flex items-center justify-center p-8",i),children:[e.jsx(I,{className:"h-8 w-8 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading..."})]}):p?e.jsxs("div",{className:A("p-8 text-center",i),children:[e.jsx("p",{className:"text-destructive",children:R(p)}),e.jsx(j,{variant:"outline",className:"mt-4",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:A("space-y-4",i),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Assets"}),e.jsxs(j,{onClick:t,className:"w-full sm:w-auto",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Add Asset"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(M,{placeholder:"Search assets...",value:c,onChange:s=>L(s.target.value),className:"pl-10"})]}),h.length===0?e.jsx("div",{className:"rounded-lg border border-dashed p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:c?"No assets match your search":"No assets yet. Add your first asset to get started."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs($,{className:"min-w-[900px]",children:[e.jsx(q,{children:e.jsxs(D,{children:[e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Vendor"}),e.jsx(o,{children:"Category"}),e.jsx(o,{children:"Purchase Date"}),e.jsx(o,{className:"text-right",children:"Purchase Price"}),e.jsx(o,{className:"text-right",children:"Book Value"}),e.jsx(o,{children:"AfA"}),e.jsx(o,{children:"Status"}),e.jsx(o,{className:"w-[40px]"}),e.jsx(o,{className:"w-[50px]"})]})}),e.jsx(z,{children:h.map(s=>e.jsxs(D,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>k(s),children:[e.jsx(l,{className:"font-medium",children:s.name}),e.jsx(l,{className:"text-muted-foreground",children:s.vendor||"â€”"}),e.jsx(l,{children:e.jsx(S,{variant:"outline",children:W(s.category)})}),e.jsx(l,{children:Q(s.purchaseDate)}),e.jsx(l,{className:"text-right",children:g(s.purchasePrice)}),e.jsx(l,{className:"text-right font-medium",children:g(P(s))}),e.jsx(l,{children:e.jsx("span",{className:"text-sm text-muted-foreground",children:s.afaMethod==="immediate"?"Immediate":`${s.afaYears} years`})}),e.jsx(l,{children:e.jsx(S,{variant:Z(s.status),children:X(s.status)})}),e.jsx(l,{className:"text-center",children:s.billPath&&e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:async a=>{a.stopPropagation(),T.info(`[AssetList] Opening attachment for asset ${s.id}:`,s.billPath);try{await U.openAttachment(s.billPath)}catch(d){const x=d instanceof Error?d.message:"Unknown error";T.error("[AssetList] Failed to open attachment:",x),alert(`Failed to open attachment: ${x}`)}},title:"View attached bill",children:e.jsx(O,{className:"h-4 w-4 text-muted-foreground hover:text-primary"})})}),e.jsx(l,{children:e.jsx(j,{variant:"ghost",size:"icon",onClick:a=>V(a,s.id),"aria-label":"Delete",children:e.jsx(K,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"})})})]},s.id))})]})}),e.jsx("div",{className:"flex justify-start sm:justify-end",children:e.jsxs("div",{className:"rounded-lg bg-muted p-3 sm:p-4 w-full sm:w-auto",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Summary"}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 gap-2 sm:gap-6 text-right",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Purchase"}),e.jsx("div",{className:"font-medium text-sm sm:text-base",children:g(C.purchaseValue)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Book Value"}),e.jsx("div",{className:"font-semibold text-sm sm:text-base",children:g(C.bookValue)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Active Assets"}),e.jsxs("div",{className:"font-medium text-sm sm:text-base",children:[C.activeCount," active"]})]})]})]})})]}),e.jsx(H,{open:!!w,onOpenChange:s=>!s&&y(null),title:"Delete asset?",description:"This will permanently delete this asset. This action cannot be undone.",onConfirm:F})]})}function Te(){const[t,r]=m.useState(!1),[i,n]=m.useState(null),[u,v]=m.useState(0),p=()=>{n(null),r(!0)},N=c=>{n(c),r(!0)},b=()=>{r(!1),n(null)},f=()=>{v(c=>c+1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsx(_,{onAddAsset:p,onEditAsset:N,refreshTrigger:u})}),e.jsx(B,{open:t,onOpenChange:r,asset:i,onClose:b,onSuccess:f})]})}export{Te as AssetsPage};
