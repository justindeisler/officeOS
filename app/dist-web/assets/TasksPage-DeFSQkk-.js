import{r as n,j as e}from"./vendor-react-nkeu7MKf.js";import{j as B,k as J,l as L,X as Se,f as re,m as ne,B as Ce,U as De,F as ie,n as W,u as $,o as Te,L as M,I as Z,a as H,p as Ie,q as Fe}from"./index-B8iL-mFc.js";import{u as oe,a as Q,s as le,K as de,P as ce,b as Ee,D as ue,c as Ae,S as me,v as xe,d as ge,C as he,e as Oe,f as Pe,g as Re}from"./vendor-dnd-CdmezjDq.js";import{C as te}from"./chevron-right-awEDJHKV.js";import{P as ee}from"./plus-CyEuG3A9.js";import{G as pe}from"./grip-vertical-D2GQYh0r.js";import{C as fe}from"./check-B3khgP6s.js";import{T as je}from"./trash-2-AmDOJzz6.js";import{F as Je}from"./folder-open-4JmYWw8K.js";import{M as Le}from"./message-square-BtE6GFX9.js";import{C as Me}from"./calendar-DSn87wry.js";import{E as Be}from"./ellipsis-D0FHfw8L.js";import{f as be}from"./vendor-date-fns-BDn9Xvdo.js";import{D as qe,a as ze,b as Ve,c as Ke,d as Ge,e as _e}from"./dialog-DVyvRuUP.js";import{T as Ue}from"./textarea-B7xux4Rg.js";import{S as K,a as G,b as _,c as U,d as w}from"./select-kbF847gm.js";import{S as He}from"./switch-CW35lTdA.js";import{C as $e}from"./confirm-delete-dialog-Bmg-jezg.js";import{e as We,g as Qe,d as Xe}from"./markdown-BFsDFXVz.js";import{D as Ye}from"./download-Cl-g8rBZ.js";import{u as Ze}from"./confettiStore-Ck6PUdc0.js";import{S as et}from"./search-DZzJdEKb.js";import"./vendor-markdown-zaQAhtrl.js";import"./vendor-recharts-COauwCrp.js";import"./vendor-radix-DCQ-pcr5.js";import"./vendor-floating-ui-_Y3uXdsy.js";import"./vendor-router-bCYKpmtI.js";import"./alert-dialog-uXkDba-y.js";function tt(t){const a={};for(const[s,i]of Object.entries(t)){const g=s.replace(/_([a-z])/g,(h,p)=>p.toUpperCase());a[g]=i}return a}function se(t){const a=tt(t);return{id:a.id,taskId:a.taskId,title:a.title,completed:!!a.completed,sortOrder:a.sortOrder??0,createdAt:a.createdAt}}function st({taskId:t,enabled:a=!0}){const[s,i]=n.useState([]),[g,h]=n.useState(!1),[p,o]=n.useState(null),j=n.useRef(!1),b=n.useCallback(async()=>{if(!(!t||!a)){h(!0),o(null);try{const m=(await B.getSubtasks(t)).map(se);i(m),j.current=!0}catch(u){console.error("Failed to fetch subtasks:",u),o("Failed to load subtasks")}finally{h(!1)}}},[t,a]);n.useEffect(()=>{a&&!j.current&&b()},[a,b]),n.useEffect(()=>{j.current=!1,i([])},[t]);const P=n.useCallback(async u=>{if(!u.trim())return;const m=crypto.randomUUID(),d={id:m,taskId:t,title:u.trim(),completed:!1,sortOrder:s.length,createdAt:new Date().toISOString()};i(r=>[...r,d]);try{const r=await B.createSubtask(t,u.trim()),x=se(r);i(k=>k.map(S=>S.id===m?x:S))}catch(r){console.error("Failed to create subtask:",r),i(x=>x.filter(k=>k.id!==m)),J.error("Failed to add subtask")}},[t,s.length]),D=n.useCallback(async(u,m)=>{i(d=>d.map(r=>r.id===u?{...r,completed:m}:r));try{await B.updateSubtask(u,{completed:m?1:0})}catch(d){console.error("Failed to toggle subtask:",d),i(r=>r.map(x=>x.id===u?{...x,completed:!m}:x)),J.error("Failed to update subtask")}},[]),v=n.useCallback(async(u,m)=>{var r;if(!m.trim())return;const d=(r=s.find(x=>x.id===u))==null?void 0:r.title;i(x=>x.map(k=>k.id===u?{...k,title:m.trim()}:k));try{await B.updateSubtask(u,{title:m.trim()})}catch(x){console.error("Failed to update subtask:",x),d&&i(k=>k.map(S=>S.id===u?{...S,title:d}:S)),J.error("Failed to update subtask")}},[s]),R=n.useCallback(async u=>{const m=s;i(d=>d.filter(r=>r.id!==u));try{await B.deleteSubtask(u)}catch(d){console.error("Failed to delete subtask:",d),i(m),J.error("Failed to delete subtask")}},[s]),A=n.useCallback(async u=>{const m=s,d=u.map(r=>s.find(x=>x.id===r)).filter(r=>r!==void 0).map((r,x)=>({...r,sortOrder:x}));i(d);try{await B.reorderSubtasks(t,u)}catch(r){console.error("Failed to reorder subtasks:",r),i(m),J.error("Failed to reorder subtasks")}},[t,s]);return{subtasks:s,isLoading:g,error:p,addSubtask:P,toggleSubtask:D,updateSubtask:v,deleteSubtask:R,reorderSubtasks:A,refresh:b}}function at({subtask:t,onToggle:a,onDelete:s}){const{attributes:i,listeners:g,setNodeRef:h,transform:p,transition:o,isDragging:j}=ge({id:t.id}),b={transform:he.Transform.toString(p),transition:o};return e.jsxs("div",{ref:h,style:b,className:L("group flex items-center gap-2 py-1.5 px-1 rounded-md transition-colors",j&&"opacity-50 bg-muted",!j&&"hover:bg-muted/50"),children:[e.jsx("button",{className:"cursor-grab touch-none opacity-0 group-hover:opacity-60 transition-opacity shrink-0",...i,...g,children:e.jsx(pe,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsx("button",{onClick:()=>a(t.id,!t.completed),className:L("shrink-0 w-4 h-4 rounded-full border-2 flex items-center justify-center transition-all duration-200",t.completed?"bg-green-500 border-green-500":"border-muted-foreground/50 hover:border-green-500"),children:t.completed&&e.jsx(fe,{className:"h-2.5 w-2.5 text-white",strokeWidth:3})}),e.jsx("span",{className:L("flex-1 text-sm transition-all",t.completed&&"text-muted-foreground line-through"),children:t.title}),e.jsx("button",{onClick:()=>s(t.id),className:"opacity-0 group-hover:opacity-60 hover:opacity-100 transition-opacity p-0.5 hover:text-destructive",children:e.jsx(je,{className:"h-3.5 w-3.5"})})]})}function rt({onAdd:t,onCancel:a}){const[s,i]=n.useState(""),g=n.useRef(null);n.useEffect(()=>{var o;(o=g.current)==null||o.focus()},[]);const h=()=>{s.trim()&&(t(s.trim()),i(""))},p=o=>{o.key==="Enter"?(o.preventDefault(),h()):o.key==="Escape"&&a()};return e.jsxs("div",{className:"flex items-center gap-2 py-1.5 px-1",children:[e.jsx("div",{className:"w-3.5"})," ",e.jsx("div",{className:"shrink-0 w-4 h-4 rounded-full border-2 border-muted-foreground/30"}),e.jsx("input",{ref:g,type:"text",value:s,onChange:o=>i(o.target.value),onKeyDown:p,onBlur:()=>{s.trim()||a()},placeholder:"Add subtask...",className:"flex-1 text-sm bg-transparent border-none outline-none placeholder:text-muted-foreground/50"}),e.jsx("button",{onClick:h,className:"p-0.5 text-green-500 hover:text-green-600 transition-colors",disabled:!s.trim(),children:e.jsx(fe,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:a,className:"p-0.5 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(Se,{className:"h-3.5 w-3.5"})})]})}function nt({taskId:t,counts:a,onCountChange:s}){const[i,g]=n.useState(!1),[h,p]=n.useState(!1),{subtasks:o,isLoading:j,addSubtask:b,toggleSubtask:P,deleteSubtask:D,reorderSubtasks:v}=st({taskId:t,enabled:i});n.useEffect(()=>{if(s&&o.length>0){const d={total:o.length,completed:o.filter(r=>r.completed).length};s(d)}},[o,s]);const R=oe(Q(ce,{activationConstraint:{distance:5}}),Q(de,{coordinateGetter:le})),A=n.useCallback(d=>{const{active:r,over:x}=d;if(!x||r.id===x.id)return;const k=o.findIndex(O=>O.id===r.id),S=o.findIndex(O=>O.id===x.id);if(k!==S){const O=Ee(o,k,S);v(O.map(c=>c.id))}},[o,v]),u=n.useCallback(async d=>{await b(d)},[b]),m=i?{total:o.length,completed:o.filter(d=>d.completed).length}:a||{total:0,completed:0};return!i&&m.total===0?null:e.jsxs("div",{className:"mt-2",children:[!i&&m.total>0&&e.jsxs("button",{onClick:()=>g(!0),className:L("inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-colors","bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400","hover:bg-slate-200 dark:hover:bg-slate-700"),children:[e.jsx(te,{className:"h-3 w-3"}),e.jsxs("span",{children:[m.completed,"/",m.total," Sub-Tasks"]})]}),i&&e.jsxs("div",{className:"rounded-lg border bg-card/50 p-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("button",{onClick:()=>g(!1),className:"text-xs font-medium text-muted-foreground hover:text-foreground flex items-center gap-1 transition-colors",children:[e.jsx(te,{className:"h-3 w-3 rotate-90"}),"Subtasks"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[m.completed,"/",m.total]})]}),j&&o.length===0?e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"Loading..."}):e.jsx(ue,{sensors:R,collisionDetection:Ae,onDragEnd:A,children:e.jsx(me,{items:o.map(d=>d.id),strategy:xe,children:e.jsx("div",{className:"space-y-0.5",children:o.map(d=>e.jsx(at,{subtask:d,onToggle:P,onDelete:D},d.id))})})}),h?e.jsx(rt,{onAdd:u,onCancel:()=>p(!1)}):e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 py-1.5 px-1 mt-1 text-xs text-muted-foreground hover:text-foreground transition-colors w-full",children:[e.jsx("div",{className:"w-3.5"}),e.jsx(ee,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Add subtask"})]})]})]})}const it={1:"bg-destructive/20 text-destructive",2:"bg-warning/20 text-warning",3:"bg-muted text-muted-foreground"},ot={wellfy:"bg-blue-500/20 text-blue-600 dark:text-blue-400",freelance:"bg-green-500/20 text-green-600 dark:text-green-400",personal:"bg-purple-500/20 text-purple-600 dark:text-purple-400"},ve=["bg-orange-500/20 text-orange-700 dark:text-orange-400","bg-emerald-500/20 text-emerald-700 dark:text-emerald-400","bg-violet-500/20 text-violet-700 dark:text-violet-400","bg-rose-500/20 text-rose-700 dark:text-rose-400","bg-cyan-500/20 text-cyan-700 dark:text-cyan-400","bg-amber-500/20 text-amber-700 dark:text-amber-400","bg-fuchsia-500/20 text-fuchsia-700 dark:text-fuchsia-400","bg-sky-600/20 text-sky-700 dark:text-sky-300"];function lt(t){let a=2166136261;for(let s=0;s<t.length;s++)a^=t.charCodeAt(s),a=a*16777619>>>0;return a%ve.length}function ye({task:t,onEdit:a,onAssignToJames:s,isDragging:i,subtaskCounts:g}){var d;const{projects:h}=re(),{prds:p}=ne(),o=t.projectId?h.find(r=>r.id===t.projectId):null,j=t.prdId?p.find(r=>r.id===t.prdId):null,{attributes:b,listeners:P,setNodeRef:D,transform:v,transition:R,isDragging:A}=ge({id:t.id}),u={transform:he.Transform.toString(v),transition:R},m=i||A;return e.jsx("div",{ref:D,style:u,className:L("group rounded-lg border bg-card p-3 shadow-sm transition-all",m&&"opacity-50 shadow-lg ring-2 ring-primary",!m&&"hover:shadow-md"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("button",{className:"mt-0.5 cursor-grab touch-none opacity-0 transition-opacity group-hover:opacity-100",...b,...P,children:e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("button",{onClick:()=>a(t),className:"text-left w-full",children:e.jsx("h4",{className:"font-medium text-sm leading-tight hover:text-primary transition-colors",children:t.title})}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:t.description}),e.jsx(nt,{taskId:t.id,counts:g}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.jsxs(Ce,{variant:"secondary",className:L("text-xs capitalize inline-flex items-center gap-1",ot[t.area]),children:[e.jsx(De,{className:"h-3 w-3"}),t.area]}),o&&e.jsxs("span",{className:L("inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium max-w-[140px]",ve[lt(o.name)]),title:o.name,children:[e.jsx(Je,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:o.name})]}),j&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-teal-500/20 text-teal-700 dark:text-teal-400 max-w-[140px]",title:`PRD: ${j.featureName}`,children:[e.jsx(ie,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:j.featureName})]}),t.assignee==="james"&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-indigo-500/20 text-indigo-700 dark:text-indigo-400",title:"Assigned to James",children:[e.jsx(W,{className:"h-3 w-3 shrink-0"}),"James"]}),!!t.quickCapture&&((d=t.createdBy)==null?void 0:d.includes("@"))&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-pink-500/20 text-pink-700 dark:text-pink-400",title:`Client request from ${t.createdBy}`,children:[e.jsx(Le,{className:"h-3 w-3 shrink-0"}),"Request"]}),e.jsx("span",{className:L("inline-flex items-center rounded px-1.5 py-0.5 text-xs font-medium",it[t.priority]),children:t.priority===1?"High":t.priority===2?"Med":"Low"}),t.dueDate&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Me,{className:"h-3 w-3"}),be(new Date(t.dueDate),"MMM d")]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[t.assignee!=="james"&&s&&e.jsx("button",{onClick:r=>{r.stopPropagation(),s(t)},className:"p-1 rounded hover:bg-indigo-100 dark:hover:bg-indigo-900/30 transition-colors",title:"Assign to James",children:e.jsx(W,{className:"h-4 w-4 text-indigo-600 dark:text-indigo-400"})}),e.jsx("button",{onClick:()=>a(t),className:"p-1 rounded hover:bg-muted transition-colors",children:e.jsx(Be,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"})})]})]})})}const dt={backlog:"border-t-slate-400",queue:"border-t-blue-400",in_progress:"border-t-amber-400",done:"border-t-green-400"};function ct({id:t,title:a,tasks:s,onAddTask:i,onEditTask:g,onAssignToJames:h,subtaskCounts:p}){const{setNodeRef:o,isOver:j}=Oe({id:t});return e.jsxs("div",{className:L("flex flex-col rounded-lg border border-t-4 bg-muted/30",dt[t]),children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:a}),e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-muted px-2 py-0.5 text-xs font-medium text-muted-foreground",children:s.length})]}),e.jsx("button",{onClick:()=>i(t),className:"rounded p-1 hover:bg-accent transition-colors",title:"Add task",children:e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsxs("div",{ref:o,className:L("flex-1 p-2 space-y-2 min-h-[200px] transition-colors",j&&"bg-accent/50"),children:[e.jsx(me,{items:s.map(b=>b.id),strategy:xe,children:s.map(b=>e.jsx(ye,{task:b,onEdit:g,onAssignToJames:h,subtaskCounts:p==null?void 0:p[b.id]},b.id))}),s.length===0&&e.jsx("div",{className:"flex items-center justify-center h-20 text-sm text-muted-foreground",children:"No tasks"})]})]})}function ke({open:t,onOpenChange:a,task:s,defaultStatus:i,onClose:g}){const{addTask:h,updateTask:p,deleteTask:o}=$(),{projects:j}=re(),{clients:b}=Te(),{prds:P}=ne(),[D,v]=n.useState(""),[R,A]=n.useState(""),[u,m]=n.useState("backlog"),[d,r]=n.useState(2),[x,k]=n.useState("freelance"),[S,O]=n.useState(""),[c,f]=n.useState(void 0),[N,T]=n.useState(void 0),[I,q]=n.useState(null),[F,y]=n.useState(!1),C=!!s;n.useEffect(()=>{s?(v(s.title),A(s.description||""),m(s.status),r(s.priority),k(s.area),O(s.dueDate?be(new Date(s.dueDate),"yyyy-MM-dd"):""),f(s.projectId),T(s.prdId),q(s.assignee||null)):(v(""),A(""),m(i||"backlog"),r(2),k("freelance"),O(""),f(void 0),T(void 0),q(null))},[s,i,t]);const V=l=>{if(l.preventDefault(),!D.trim())return;const z={title:D.trim(),description:R.trim()||void 0,status:u,priority:d,area:x,dueDate:S?new Date(S).toISOString():void 0,projectId:c,prdId:N,assignee:I};C&&s?p(s.id,z):h(z),g()},E=()=>{s&&(o(s.id),y(!1),g())},X=()=>{if(!s)return;const l=s.projectId?j.find(Y=>Y.id===s.projectId):void 0,z=l!=null&&l.clientId?b.find(Y=>Y.id===l.clientId):void 0,Ne=We(s,{project:l,client:z}),we=Qe(s.title);Xe(Ne,we),J.success(`Exported "${s.title}" to markdown`)};return e.jsx(qe,{open:t,onOpenChange:a,children:e.jsxs(ze,{className:"w-[calc(100vw-2rem)] max-w-[500px] max-h-[90vh] overflow-y-auto overflow-x-hidden",children:[e.jsxs("form",{onSubmit:V,children:[e.jsxs(Ve,{children:[e.jsx(Ke,{children:C?"Edit Task":"New Task"}),e.jsx(Ge,{children:C?"Update the task details below.":"Create a new task by filling out the form below."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"title",children:"Title"}),e.jsx(Z,{id:"title",value:D,onChange:l=>v(l.target.value),placeholder:"Task title...",autoFocus:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"description",children:"Description"}),e.jsx(Ue,{id:"description",value:R,onChange:l=>A(l.target.value),placeholder:"Add details...",rows:3})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"project",children:"Project"}),e.jsxs(K,{value:c||"none",onValueChange:l=>f(l==="none"?void 0:l),children:[e.jsx(G,{children:e.jsx(_,{placeholder:"Select a project..."})}),e.jsxs(U,{children:[e.jsx(w,{value:"none",children:"No project"}),j.map(l=>e.jsx(w,{value:l.id,children:l.name},l.id))]})]})]}),P.length>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(M,{htmlFor:"prd",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"PRD"]}),e.jsxs(K,{value:N||"none",onValueChange:l=>T(l==="none"?void 0:l),children:[e.jsx(G,{children:e.jsx(_,{placeholder:"Link to a PRD..."})}),e.jsxs(U,{children:[e.jsx(w,{value:"none",children:"No PRD"}),P.map(l=>e.jsxs(w,{value:l.id,children:[l.featureName," (v",l.version,")"]},l.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"status",children:"Status"}),e.jsxs(K,{value:u,onValueChange:l=>m(l),children:[e.jsx(G,{children:e.jsx(_,{})}),e.jsxs(U,{children:[e.jsx(w,{value:"backlog",children:"Backlog"}),e.jsx(w,{value:"queue",children:"Queue"}),e.jsx(w,{value:"in_progress",children:"In Progress"}),e.jsx(w,{value:"done",children:"Done"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"priority",children:"Priority"}),e.jsxs(K,{value:String(d),onValueChange:l=>r(Number(l)),children:[e.jsx(G,{children:e.jsx(_,{})}),e.jsxs(U,{children:[e.jsx(w,{value:"1",children:"High"}),e.jsx(w,{value:"2",children:"Medium"}),e.jsx(w,{value:"3",children:"Low"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"area",children:"Area"}),e.jsxs(K,{value:x,onValueChange:l=>k(l),children:[e.jsx(G,{children:e.jsx(_,{})}),e.jsxs(U,{children:[e.jsx(w,{value:"wellfy",children:"Wellfy"}),e.jsx(w,{value:"freelance",children:"Freelance"}),e.jsx(w,{value:"personal",children:"Personal"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"dueDate",children:"Due Date"}),e.jsx(Z,{id:"dueDate",type:"date",value:S,onChange:l=>O(l.target.value),className:"h-10"})]})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(M,{htmlFor:"assignJames",className:"text-sm font-medium",children:"Assign to James"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"James will pick up this task automatically"})]})]}),e.jsx(He,{id:"assignJames",checked:I==="james",onCheckedChange:l=>q(l?"james":null)})]})]}),e.jsxs(_e,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsx("div",{className:"flex gap-1.5",children:C&&e.jsxs(e.Fragment,{children:[e.jsx(H,{type:"button",variant:"destructive",size:"sm",onClick:()=>y(!0),children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx(H,{type:"button",variant:"outline",size:"sm",onClick:X,children:e.jsx(Ye,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx(H,{type:"button",variant:"outline",size:"sm",onClick:g,children:"Cancel"}),e.jsx(H,{type:"submit",size:"sm",children:C?"Save":"Create"})]})]})]}),e.jsx($e,{open:F,onOpenChange:y,title:"Delete task?",description:"This will permanently delete this task. This action cannot be undone.",onConfirm:E})]})})}const ae=[{id:"backlog",title:"Backlog"},{id:"queue",title:"Queue"},{id:"in_progress",title:"In Progress"},{id:"done",title:"Done"}];function ut(){const[t,a]=n.useState(null),[s,i]=n.useState(null),[g,h]=n.useState(!1),[p,o]=n.useState(null),j=n.useRef(null),[b,P]=n.useState({}),{moveTask:D}=$(),v=Ie(),R=Ze(c=>c.trigger);n.useEffect(()=>{const c=v.map(N=>N.id);if(c.length===0)return;(async()=>{try{const N=await B.getSubtaskCounts(c);P(N)}catch(N){console.error("Failed to fetch subtask counts:",N)}})()},[v.map(c=>c.id).join(",")]);const A=oe(Q(ce,{activationConstraint:{distance:8}}),Q(de,{coordinateGetter:le})),u=n.useMemo(()=>{const c={backlog:[],queue:[],in_progress:[],done:[]};return v.forEach(f=>{c[f.status].push(f)}),Object.keys(c).forEach(f=>{c[f].sort((N,T)=>N.sortOrder-T.sortOrder)}),c},[v]),m=c=>{const f=v.find(N=>N.id===c.active.id);f&&(a(f),j.current=f.status,console.log("ðŸš€ handleDragStart: Captured originalStatus =",f.status))},d=c=>{const{active:f,over:N}=c;if(!N)return;const T=f.id,I=N.id,q=v.find(y=>y.id===T);if(!q)return;if(ae.some(y=>y.id===I)){const y=I;if(q.status!==y){const C=u[y];D(T,y,C.length)}}else{const y=v.find(C=>C.id===I);if(y&&q.status!==y.status){const V=u[y.status].findIndex(E=>E.id===I);D(T,y.status,V)}}},r=c=>{const{active:f,over:N}=c,T=j.current,I=f.id;a(null),j.current=null;const F=$.getState().tasks.find(E=>E.id===I);if(console.log("ðŸŽ¯ Confetti check:",{originalStatus:T,currentTaskStatus:F==null?void 0:F.status,shouldTrigger:(F==null?void 0:F.status)==="done"&&T!=="done"}),(F==null?void 0:F.status)==="done"&&T!=="done"&&(console.log("ðŸŽ‰ TRIGGERING CONFETTI!"),R()),!N)return;const y=N.id;if(I===y)return;const C=v.find(E=>E.id===I);if(!C)return;const V=v.find(E=>E.id===y);if(V&&C.status===V.status){const E=u[C.status],X=E.findIndex(z=>z.id===I),l=E.findIndex(z=>z.id===y);X!==l&&D(I,C.status,l)}},x=c=>{o(c),i(null),h(!0)},k=c=>{i(c),o(null),h(!0)},S=()=>{h(!1),i(null),o(null)},O=async c=>{try{const{updateTask:f}=$.getState();f(c.id,{assignee:"james"}),await B.triggerJames(),J.success(`Assigned "${c.title}" to James`,{description:"James will start working on it shortly"})}catch(f){console.error("Failed to assign to James:",f),J.error("Failed to assign task to James")}};return e.jsxs(e.Fragment,{children:[e.jsxs(ue,{sensors:A,collisionDetection:Pe,onDragStart:m,onDragOver:d,onDragEnd:r,children:[e.jsx("div",{className:"flex flex-col gap-4 sm:grid sm:grid-cols-2 lg:grid-cols-4",children:ae.map(c=>e.jsx("div",{className:"w-full",children:e.jsx(ct,{id:c.id,title:c.title,tasks:u[c.id],onAddTask:x,onEditTask:k,onAssignToJames:O,subtaskCounts:b})},c.id))}),e.jsx(Re,{children:t?e.jsx(ye,{task:t,onEdit:()=>{},isDragging:!0,subtaskCounts:b[t.id]}):null})]}),e.jsx(ke,{open:g,onOpenChange:h,task:s,defaultStatus:p,onClose:S})]})}function mt(){const{filter:t,setFilter:a}=$();return e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 sm:max-w-sm",children:[e.jsx(et,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Z,{placeholder:"Search tasks...",value:t.search,onChange:s=>a({search:s.target.value}),className:"pl-9"})]}),e.jsxs(K,{value:t.area,onValueChange:s=>a({area:s}),children:[e.jsx(G,{className:"w-[150px]",children:e.jsx(_,{placeholder:"All areas"})}),e.jsxs(U,{children:[e.jsx(w,{value:"all",children:"All Areas"}),e.jsx(w,{value:"wellfy",children:"Wellfy"}),e.jsx(w,{value:"freelance",children:"Freelance"}),e.jsx(w,{value:"personal",children:"Personal"})]})]})]})}function zt(){const[t,a]=n.useState(!1),[s,i]=n.useState(!1),g=()=>{a(!0)},h=()=>{a(!1)},p=async()=>{i(!0);try{await B.triggerJames(),J.success("James is checking for new tasks...",{description:"He'll start working on any assigned tasks.",icon:"ðŸ¤–"})}catch{J.error("Failed to ping James")}finally{i(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Tasks"})}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("button",{onClick:p,disabled:s,className:"relative inline-flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-black bg-white border border-transparent rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden group",children:[e.jsx("span",{className:"absolute inset-0 rounded-md p-[2px] bg-gradient-to-r from-pink-500 via-purple-500 via-blue-500 via-cyan-500 via-green-500 via-yellow-500 to-pink-500 bg-[length:400%_100%] animate-shimmer"}),e.jsx("span",{className:"absolute inset-[2px] rounded-[4px] bg-white"}),e.jsxs("span",{className:"relative flex items-center gap-2",children:[s?e.jsx(Fe,{className:"h-4 w-4 animate-spin"}):e.jsx(W,{className:"h-4 w-4"}),"James"]})]}),e.jsxs(H,{onClick:g,className:"flex-1 sm:flex-none",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Add Task"]})]})]}),e.jsx(mt,{}),e.jsx(ut,{}),e.jsx(ke,{open:t,onOpenChange:a,task:null,defaultStatus:"backlog",onClose:h})]})}export{zt as TasksPage};
