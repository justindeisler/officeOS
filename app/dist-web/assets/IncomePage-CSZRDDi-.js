import{r as a,j as e}from"./vendor-react-DeR5d9Tv.js";import{u as R,I as k}from"./IncomeDialog-CEYYmVVS.js";import{j as I,r as F,Q as L,a as y,I as E,F as B,B as b}from"./index-9iTO35Tf.js";import{T as M,a as O,b as C,c as l,d as P,e as c}from"./table-1HdAiBAg.js";import{C as V}from"./confirm-delete-dialog-BMDwFNTg.js";import{P as G}from"./plus-B0AmLF8B.js";import{S as H}from"./search-UYtf0GIM.js";import{T as z}from"./trash-2-DGGE0QMh.js";import"./vendor-markdown-PIr_2kdo.js";import"./dialog-DRTG7Iov.js";import"./vendor-radix-zn9KX-y8.js";import"./vendor-floating-ui-CESiY8Ey.js";import"./vendor-forms-slL2B-gN.js";import"./income-BNbe5EU1.js";import"./db-Bt7PgIAT.js";import"./vendor-recharts-DrMJw15s.js";import"./vendor-router-9bGSKQ4q.js";import"./alert-dialog-Ba9m1D5X.js";function d(o){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(o)}function Q(o){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(o)}function U({onAddIncome:o,onEditIncome:n,className:m,refreshTrigger:i}){const{income:x,isLoading:f,error:u,deleteIncome:g,setSelectedIncome:p,refresh:h}=R(),[r,T]=a.useState(""),[v,N]=a.useState(null);a.useEffect(()=>{i&&i>0&&h()},[i,h]);const j=a.useMemo(()=>{if(!r)return x;const s=r.toLowerCase();return x.filter(t=>t.description.toLowerCase().includes(s)||t.euerCategory.toLowerCase().includes(s))},[x,r]),w=a.useMemo(()=>j.reduce((s,t)=>({net:s.net+t.netAmount,vat:s.vat+t.vatAmount,gross:s.gross+t.grossAmount}),{net:0,vat:0,gross:0}),[j]),D=s=>{p(s),n==null||n(s)},A=(s,t)=>{if(s.stopPropagation(),t.invoiceId){alert("This income record was auto-generated from an invoice. To remove it, cancel or modify the original invoice.");return}N(t.id)},S=async()=>{v&&(await g(v),N(null))};return f?e.jsxs("div",{className:I("flex items-center justify-center p-8",m),children:[e.jsx(F,{className:"h-8 w-8 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading..."})]}):u?e.jsxs("div",{className:I("p-8 text-center",m),children:[e.jsx("p",{className:"text-destructive",children:L(u)}),e.jsx(y,{variant:"outline",className:"mt-4",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:I("space-y-4",m),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Income"}),e.jsxs(y,{onClick:o,className:"w-full sm:w-auto",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Add Income"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(E,{placeholder:"Search income...",value:r,onChange:s=>T(s.target.value),className:"pl-10"})]}),j.length===0?e.jsx("div",{className:"rounded-lg border border-dashed p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:r?"No income records match your search":"No income records yet. Add your first income to get started."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(M,{className:"min-w-[700px]",children:[e.jsx(O,{children:e.jsxs(C,{children:[e.jsx(l,{children:"Date"}),e.jsx(l,{children:"Description"}),e.jsx(l,{children:"VAT"}),e.jsx(l,{className:"text-right",children:"Net"}),e.jsx(l,{className:"text-right",children:"VAT"}),e.jsx(l,{className:"text-right",children:"Gross"}),e.jsx(l,{className:"w-[50px]"})]})}),e.jsx(P,{children:j.map(s=>e.jsxs(C,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>D(s),children:[e.jsx(c,{className:"font-medium",children:Q(s.date)}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.invoiceId&&e.jsx("span",{title:"From Invoice",children:e.jsx(B,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"})}),e.jsx("span",{children:s.description}),s.invoiceId&&e.jsx(b,{variant:"outline",className:"text-xs",children:"Invoice"}),s.ustReported&&e.jsx(b,{variant:"secondary",className:"text-xs",children:"Reported"})]})}),e.jsx(c,{children:e.jsxs(b,{variant:"outline",children:[s.vatRate,"%"]})}),e.jsx(c,{className:"text-right",children:d(s.netAmount)}),e.jsx(c,{className:"text-right",children:d(s.vatAmount)}),e.jsx(c,{className:"text-right font-medium",children:d(s.grossAmount)}),e.jsx(c,{children:s.invoiceId?e.jsx("span",{className:"text-xs text-muted-foreground",title:"Managed by invoice",children:"â€”"}):e.jsx(y,{variant:"ghost",size:"icon",onClick:t=>A(t,s),"aria-label":"Delete",children:e.jsx(z,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"})})})]},s.id))})]})}),e.jsx("div",{className:"flex justify-start sm:justify-end",children:e.jsxs("div",{className:"rounded-lg bg-muted p-3 sm:p-4 w-full sm:w-auto",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Total"}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 gap-2 sm:gap-4 text-right",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Net"}),e.jsx("div",{className:"font-medium text-sm sm:text-base",children:d(w.net)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"VAT"}),e.jsx("div",{className:"font-medium text-sm sm:text-base",children:d(w.vat)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Gross"}),e.jsx("div",{className:"font-semibold text-sm sm:text-base",children:d(w.gross)})]})]})]})})]}),e.jsx(V,{open:!!v,onOpenChange:s=>!s&&N(null),title:"Delete income?",description:"This will permanently delete this income record. This action cannot be undone.",onConfirm:S})]})}function ce(){const[o,n]=a.useState(!1),[m,i]=a.useState(null),[x,f]=a.useState(0),u=()=>{i(null),n(!0)},g=r=>{i(r),n(!0)},p=()=>{n(!1),i(null)},h=()=>{f(r=>r+1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsx(U,{onAddIncome:u,onEditIncome:g,refreshTrigger:x})}),e.jsx(k,{open:o,onOpenChange:n,income:m,onClose:p,onSuccess:h})]})}export{ce as IncomePage};
