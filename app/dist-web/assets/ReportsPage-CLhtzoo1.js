const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DV0Z4ueH.js","assets/core-BDPGcIsz.js","assets/index-CDjnCujr.js","assets/path-E9zjYLSN.js"])))=>i.map(i=>d[i]);
import{r as f,j as e}from"./vendor-react-DeR5d9Tv.js";import{T as Ie,a as Te,b as M,c as P}from"./tabs-BYG1mUUs.js";import{S as de,a as me,b as xe,c as he,d as fe}from"./select-D2VRqISc.js";import{c as ge,ab as G,ac as et,j as A,Q as Z,a as B,B as Ne,ad as tt,F as st,V as ve,W as nt,_ as ie}from"./index-RJ0cNIvj.js";import{T as J,a as X,b as D,c as S,d as W,e as p}from"./table-CQvGxNfR.js";import{g as H}from"./db-Ct4VTwBw.js";import{j as at,m as rt,n as ct,g as lt}from"./assets-Z9c_-zTG.js";import{a as w,H as ot}from"./index-uXN-dP3D.js";import{D as it}from"./download-DwxoQ9rF.js";import{C as I,a as L,b as _,c as T}from"./card-DIHf8IPz.js";import{z as ut,B as dt,E as mt,F as xt,G as ht,H as ft,J as Ae}from"./vendor-radix-zn9KX-y8.js";import{g as gt}from"./income-DxbWZeB_.js";import{g as pt}from"./expenses-DYX0nKAu.js";import"./vendor-markdown-PIr_2kdo.js";import"./check-mFeD-rYu.js";import"./vendor-recharts-DrMJw15s.js";import"./vendor-router-9bGSKQ4q.js";import"./vendor-floating-ui-CESiY8Ey.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=ge("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=ge("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=ge("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),ee=(t,s)=>et.request(t,s);function te(t,s){const n=(s-1)*3,a=new Date(t,n,1),o=new Date(t,n+3,0);return{startDate:a,endDate:o}}function _e(t){return{id:t.id,date:new Date(t.date),clientId:t.client_id??void 0,invoiceId:t.invoice_id??void 0,description:t.description,netAmount:t.net_amount,vatRate:t.vat_rate,vatAmount:t.vat_amount,grossAmount:t.gross_amount,euerLine:t.euer_line??14,euerCategory:t.euer_category??"services",paymentMethod:t.payment_method,bankReference:t.bank_reference??void 0,ustPeriod:t.ust_period??void 0,ustReported:t.ust_reported===1,createdAt:new Date(t.created_at)}}function Fe(t){return{id:t.id,date:new Date(t.date),vendor:t.vendor,description:t.description,netAmount:t.net_amount,vatRate:t.vat_rate,vatAmount:t.vat_amount,grossAmount:t.gross_amount,euerLine:t.euer_line,euerCategory:t.euer_category,deductiblePercent:t.deductible_percent,paymentMethod:t.payment_method,receiptPath:t.receipt_path??void 0,isRecurring:t.is_recurring===1,recurringFrequency:t.recurring_frequency,ustPeriod:t.ust_period??void 0,vorsteuerClaimed:t.vorsteuer_claimed===1,isGwg:t.is_gwg===1,assetId:t.asset_id??void 0,createdAt:new Date(t.created_at)}}async function bt(t,s){const{startDate:n,endDate:a}=te(t,s);return(await(await H()).select(`SELECT * FROM income
     WHERE date >= $1 AND date <= $2
     ORDER BY date DESC`,[n.toISOString().split("T")[0],a.toISOString().split("T")[0]])).map(_e)}async function Nt(t,s){const{startDate:n,endDate:a}=te(t,s);return(await(await H()).select(`SELECT * FROM expenses
     WHERE date >= $1 AND date <= $2
     ORDER BY date DESC`,[n.toISOString().split("T")[0],a.toISOString().split("T")[0]])).map(Fe)}async function vt(t){const s=new Date(t,0,1),n=new Date(t,11,31);return(await(await H()).select(`SELECT * FROM income
     WHERE date >= $1 AND date <= $2
     ORDER BY date DESC`,[s.toISOString().split("T")[0],n.toISOString().split("T")[0]])).map(_e)}async function At(t){const s=new Date(t,0,1),n=new Date(t,11,31);return(await(await H()).select(`SELECT * FROM expenses
     WHERE date >= $1 AND date <= $2
     ORDER BY date DESC`,[s.toISOString().split("T")[0],n.toISOString().split("T")[0]])).map(Fe)}async function pe(t,s){if(!G()){const d=await ee(`/reports/ust/${t}/${s}`);return{...d,startDate:new Date(d.startDate),endDate:new Date(d.endDate),filedDate:d.filedDate?new Date(d.filedDate):void 0}}const{startDate:n,endDate:a}=te(t,s),o=await bt(t,s),l=await Nt(t,s),h=o.filter(d=>d.vatRate===19).reduce((d,i)=>d+i.vatAmount,0),b=o.filter(d=>d.vatRate===7).reduce((d,i)=>d+i.vatAmount,0),x=h+b,m=l.reduce((d,i)=>d+(i.vatAmount||0),0),u=x-m,j=d=>Math.round(d*100)/100;return{period:`${t}-Q${s}`,year:t,quarter:s,startDate:n,endDate:a,umsatzsteuer19:j(h),umsatzsteuer7:j(b),totalUmsatzsteuer:j(x),vorsteuer:j(m),zahllast:j(u),status:"draft"}}async function Dt(t){if(!G())return(await ee(`/reports/ust/${t}`)).map(o=>({...o,startDate:new Date(o.startDate),endDate:new Date(o.endDate),filedDate:o.filedDate?new Date(o.filedDate):void 0}));const s=[1,2,3,4];return await Promise.all(s.map(a=>pe(t,a)))}async function yt(t,s){if(!G()){const x=await ee(`/reports/ust/${t}/${s}/file`,{method:"POST"});return{...x,startDate:new Date(x.startDate),endDate:new Date(x.endDate),filedDate:x.filedDate?new Date(x.filedDate):void 0}}const{startDate:n,endDate:a}=te(t,s),o=await H(),l=n.toISOString().split("T")[0],h=a.toISOString().split("T")[0];return await o.execute("UPDATE income SET ust_reported = 1 WHERE date >= $1 AND date <= $2",[l,h]),await o.execute("UPDATE expenses SET ust_reported = 1 WHERE date >= $1 AND date <= $2",[l,h]),{...await pe(t,s),status:"filed",filedDate:new Date}}async function Et(t){if(!G())return ee(`/reports/euer/${t}`);const s=await vt(t),n=await At(t),a=await at(t),o={};for(const d of s){const i=d.euerLine;o[i]=(o[i]||0)+d.netAmount}const l={};for(const d of n){const i=d.euerLine,r=d.netAmount*((d.deductiblePercent??100)/100);l[i]=(l[i]||0)+r}l[w.AFA]=(l[w.AFA]||0)+a;const h=await rt(t);h>0&&(o[w.ENTNAHME_VERKAUF]=(o[w.ENTNAHME_VERKAUF]||0)+h);const b=await ct(t);b>0&&(l[w.ANLAGENABGANG_VERLUST]=(l[w.ANLAGENABGANG_VERLUST]||0)+b),l[w.ARBEITSZIMMER]||(l[w.ARBEITSZIMMER]=ot);const x=Object.values(o).reduce((d,i)=>d+i,0),m=Object.values(l).reduce((d,i)=>d+i,0),u=x-m,j=d=>Math.round(d*100)/100;for(const d of Object.keys(o))o[Number(d)]=j(o[Number(d)]);for(const d of Object.keys(l))l[Number(d)]=j(l[Number(d)]);return{year:t,income:o,expenses:l,totalIncome:j(x),totalExpenses:j(m),gewinn:j(u)}}function wt(){return{income:[{line:w.BETRIEBSEINNAHMEN,name:"Betriebseinnahmen",description:"Standard taxable business income (19% or 7%)"},{line:w.ENTNAHME_VERKAUF,name:"Veräußerungsgewinne",description:"Gains from asset sales (selling price - book value)"},{line:w.UST_ERSTATTUNG,name:"USt-Erstattung",description:"VAT refunds from tax office"}],expenses:[{line:w.FREMDLEISTUNGEN,name:"Fremdleistungen",description:"Subcontractors, freelancers"},{line:w.VORSTEUER,name:"Vorsteuer",description:"Input VAT on purchases"},{line:w.GEZAHLTE_UST,name:"Gezahlte USt",description:"Output VAT paid to tax office"},{line:w.AFA,name:"AfA",description:"Depreciation of movable assets"},{line:w.ARBEITSZIMMER,name:"Arbeitszimmer",description:"Home office costs (Pauschale: €1,260/year)"},{line:w.SONSTIGE,name:"Sonstige",description:"Other fully deductible business expenses"},{line:w.ANLAGENABGANG_VERLUST,name:"Anlagenabgang (Verlust)",description:"Losses from asset disposals (remaining book value)"}]}}function kt(){const t=new Date().getMonth();return Math.floor(t/3)+1}function St(t={}){const{autoFetch:s=!0,year:n=new Date().getFullYear(),quarter:a=kt()}=t,[o,l]=f.useState(null),[h,b]=f.useState([]),[x,m]=f.useState(!1),[u,j]=f.useState(null),[d,i]=f.useState(n),[r,N]=f.useState(a),E=f.useCallback(async(g,c)=>{m(!0),j(null);try{const v=await pe(g,c);l(v)}catch(v){j(v instanceof Error?v.message:"Failed to fetch USt-Voranmeldung")}finally{m(!1)}},[]),R=f.useCallback(async g=>{m(!0),j(null);try{const c=await Dt(g);b(c)}catch(c){j(c instanceof Error?c.message:"Failed to fetch quarterly data")}finally{m(!1)}},[]),O=f.useCallback(async(g,c)=>{m(!0),j(null);try{const v=await yt(g,c);l(v),b($=>$.map(F=>F.year===g&&F.quarter===c?v:F))}catch(v){j(v instanceof Error?v.message:"Failed to mark as filed")}finally{m(!1)}},[]),y=f.useCallback(async()=>{await E(d,r)},[d,r,E]);return f.useEffect(()=>{s&&E(d,r)},[s,d,r,E]),{ustVoranmeldung:o,allQuarters:h,isLoading:x,error:u,selectedYear:d,selectedQuarter:r,setSelectedYear:i,setSelectedQuarter:N,fetchUstVoranmeldung:E,fetchAllQuarters:R,markAsFiled:O,refresh:y}}function Y(t){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)}function re(t){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(t)}function Ct(){const t=new Date().getFullYear();return Array.from({length:6},(s,n)=>t-n)}function Rt({onPrint:t,className:s}){const{ustVoranmeldung:n,isLoading:a,error:o,selectedYear:l,selectedQuarter:h,setSelectedYear:b,setSelectedQuarter:x,markAsFiled:m}=St(),u=Ct(),j=()=>{t?t():window.print()},d=async()=>{n&&await m(n.year,n.quarter)};if(a)return e.jsxs("div",{className:A("space-y-6",s),children:[e.jsx("h2",{className:"text-xl font-semibold",children:"USt-Voranmeldung"}),e.jsx("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:"Laden..."})]});if(o)return e.jsxs("div",{className:A("space-y-6",s),children:[e.jsx("h2",{className:"text-xl font-semibold",children:"USt-Voranmeldung"}),e.jsxs("div",{className:"rounded-lg border border-destructive p-8 text-center text-destructive",children:["Fehler: ",Z(o)]})]});if(!n)return e.jsxs("div",{className:A("space-y-6",s),children:[e.jsx("h2",{className:"text-xl font-semibold",children:"USt-Voranmeldung"}),e.jsx("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:"Keine Daten verfügbar"})]});const i=n.zahllast<0;return e.jsxs("div",{className:A("space-y-6",s),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"USt-Voranmeldung"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(B,{variant:"outline",size:"sm",onClick:j,children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),"Drucken"]}),n.status==="draft"&&e.jsxs(B,{size:"sm",onClick:d,children:[e.jsx(jt,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Als gemeldet markieren"}),e.jsx("span",{className:"sm:hidden",children:"Melden"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"year-select",className:"text-sm font-medium",children:"Jahr:"}),e.jsxs(de,{value:String(l),onValueChange:r=>b(Number(r)),children:[e.jsx(me,{id:"year-select",className:"w-[100px]",children:e.jsx(xe,{})}),e.jsx(he,{children:u.map(r=>e.jsx(fe,{value:String(r),children:r},r))})]})]}),e.jsx(Ie,{value:`Q${h}`,onValueChange:r=>x(Number(r.replace("Q",""))),children:e.jsxs(Te,{children:[e.jsx(M,{value:"Q1",children:"Q1"}),e.jsx(M,{value:"Q2",children:"Q2"}),e.jsx(M,{value:"Q3",children:"Q3"}),e.jsx(M,{value:"Q4",children:"Q4"})]})})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between rounded-lg border p-3 sm:p-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Zeitraum"}),e.jsx("p",{className:"font-medium",children:n.period}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[re(n.startDate)," –"," ",re(n.endDate)]})]}),e.jsxs("div",{className:"sm:text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),n.status==="draft"?e.jsx(Ne,{variant:"secondary",children:"Entwurf"}):e.jsx(Ne,{variant:"default",children:"Gemeldet"}),n.filedDate&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:re(n.filedDate)})]})]}),e.jsx("div",{className:"rounded-lg border overflow-x-auto",children:e.jsxs(J,{className:"min-w-[400px]",children:[e.jsx(X,{children:e.jsxs(D,{children:[e.jsx(S,{className:"w-[300px]",children:"Position"}),e.jsx(S,{className:"text-right",children:"Betrag"})]})}),e.jsxs(W,{children:[e.jsx(D,{className:"bg-muted/30",children:e.jsx(p,{colSpan:2,className:"font-semibold",children:"Umsatzsteuer (Output VAT)"})}),e.jsxs(D,{children:[e.jsx(p,{className:"pl-8",children:"Umsatzsteuer 19%"}),e.jsx(p,{className:"text-right",children:Y(n.umsatzsteuer19)})]}),e.jsxs(D,{children:[e.jsx(p,{className:"pl-8",children:"Umsatzsteuer 7%"}),e.jsx(p,{className:"text-right",children:Y(n.umsatzsteuer7)})]}),e.jsxs(D,{className:"font-medium",children:[e.jsx(p,{className:"pl-8",children:"Summe Umsatzsteuer"}),e.jsx(p,{className:"text-right",children:Y(n.totalUmsatzsteuer)})]}),e.jsx(D,{className:"bg-muted/30",children:e.jsx(p,{colSpan:2,className:"font-semibold",children:"Vorsteuer (Input VAT)"})}),e.jsxs(D,{children:[e.jsx(p,{className:"pl-8",children:"Abziehbare Vorsteuer"}),e.jsx(p,{className:"text-right",children:Y(n.vorsteuer)})]}),e.jsxs(D,{className:"border-t-2 bg-muted font-bold",children:[e.jsxs(p,{children:["Zahllast"," ",i&&e.jsx("span",{className:"text-green-600 font-normal",children:"(Erstattung)"})]}),e.jsxs(p,{className:A("text-right",i?"text-green-600":"text-red-600"),children:[Y(Math.abs(n.zahllast)),i&&" (Erstattung)"]})]})]})]})}),e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Zahllast"}),": Umsatzsteuer − Vorsteuer"]}),e.jsxs("p",{children:["Positiver Betrag = Zahlung an das Finanzamt fällig",e.jsx("br",{}),"Negativer Betrag = Erstattung vom Finanzamt erwartet"]})]})]})}function It(t={}){const{autoFetch:s=!0,year:n=new Date().getFullYear()}=t,[a,o]=f.useState(null),[l,h]=f.useState(!1),[b,x]=f.useState(null),[m,u]=f.useState(n),j=f.useCallback(async r=>{h(!0),x(null);try{const N=await Et(r);o(N)}catch(N){x(N instanceof Error?N.message:"Failed to fetch EÜR report")}finally{h(!1)}},[]),d=f.useCallback(()=>wt(),[]),i=f.useCallback(async()=>{await j(m)},[m,j]);return f.useEffect(()=>{s&&j(m)},[s,m,j]),{euerReport:a,isLoading:l,error:b,selectedYear:m,setSelectedYear:u,fetchEuerReport:j,getLineDetails:d,refresh:i}}function Q(t){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)}function Tt(){const t=new Date().getFullYear();return Array.from({length:6},(s,n)=>t-n)}function Vt({onPrint:t,onExport:s,className:n}){const{euerReport:a,isLoading:o,error:l,selectedYear:h,setSelectedYear:b,getLineDetails:x}=It(),m=Tt(),u=x(),j=()=>{t?t():window.print()},d=()=>{s&&s()};if(o)return e.jsxs("div",{className:A("space-y-6",n),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["EÜR ",h]}),e.jsx("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:"Laden..."})]});if(l)return e.jsxs("div",{className:A("space-y-6",n),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["EÜR ",h]}),e.jsxs("div",{className:"rounded-lg border border-destructive p-8 text-center text-destructive",children:["Fehler: ",Z(l)]})]});if(!a)return e.jsxs("div",{className:A("space-y-6",n),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["EÜR ",h]}),e.jsx("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:"Keine Daten verfügbar"})]});const i=a.gewinn>=0;return e.jsxs("div",{className:A("space-y-6",n),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["EÜR ",h]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(B,{variant:"outline",size:"sm",onClick:j,children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),"Drucken"]}),e.jsxs(B,{variant:"outline",size:"sm",onClick:d,children:[e.jsx(it,{className:"mr-2 h-4 w-4"}),"Export"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"year-select",className:"text-sm font-medium",children:"Jahr:"}),e.jsxs(de,{value:String(h),onValueChange:r=>b(Number(r)),children:[e.jsx(me,{id:"year-select",className:"w-[100px]",children:e.jsx(xe,{})}),e.jsx(he,{children:m.map(r=>e.jsx(fe,{value:String(r),children:r},r))})]})]}),e.jsx("div",{className:"rounded-lg border overflow-x-auto",children:e.jsxs(J,{className:"min-w-[500px]",children:[e.jsx(X,{children:e.jsxs(D,{children:[e.jsx(S,{className:"w-[100px]",children:"Zeile"}),e.jsx(S,{children:"Position"}),e.jsx(S,{className:"text-right",children:"Betrag"})]})}),e.jsxs(W,{children:[e.jsx(D,{className:"bg-muted/30",children:e.jsx(p,{colSpan:3,className:"font-semibold",children:"Einnahmen"})}),u.income.map(r=>e.jsxs(D,{children:[e.jsxs(p,{className:"font-mono text-sm",children:["Zeile ",r.line]}),e.jsx(p,{children:e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:r.name}),e.jsxs("span",{className:"text-muted-foreground text-sm ml-2",children:["(",r.description,")"]})]})}),e.jsx(p,{className:"text-right",children:Q(a.income[r.line]||0)})]},r.line)),e.jsxs(D,{className:"font-medium bg-muted/20",children:[e.jsx(p,{}),e.jsx(p,{children:"Summe Einnahmen"}),e.jsx(p,{className:"text-right",children:Q(a.totalIncome)})]}),e.jsx(D,{className:"bg-muted/30",children:e.jsx(p,{colSpan:3,className:"font-semibold",children:"Ausgaben"})}),u.expenses.map(r=>e.jsxs(D,{children:[e.jsxs(p,{className:"font-mono text-sm",children:["Zeile ",r.line]}),e.jsx(p,{children:e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:r.name}),e.jsxs("span",{className:"text-muted-foreground text-sm ml-2",children:["(",r.description,")"]})]})}),e.jsx(p,{className:"text-right",children:Q(a.expenses[r.line]||0)})]},r.line)),e.jsxs(D,{className:"font-medium bg-muted/20",children:[e.jsx(p,{}),e.jsx(p,{children:"Summe Ausgaben"}),e.jsx(p,{className:"text-right",children:Q(a.totalExpenses)})]}),e.jsxs(D,{className:"border-t-2 bg-muted font-bold",children:[e.jsx(p,{}),e.jsx(p,{children:i?"Gewinn":"Verlust"}),e.jsx(p,{className:A("text-right",i?"text-green-600":"text-red-600"),children:Q(Math.abs(a.gewinn))})]})]})]})}),e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Gewinn/Verlust"}),": Einnahmen − Ausgaben"]}),e.jsxs("p",{children:["Positiver Betrag = Gewinn (steuerpflichtiges Einkommen)",e.jsx("br",{}),"Negativer Betrag = Verlust (kann vorgetragen werden)"]})]})]})}function z(t){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)}function De(t){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(t)}function Lt(t){return{computer:"EDV/Computer",furniture:"Büromöbel",equipment:"Geräte",software:"Software",phone:"Telefon"}[t]||t}function _t(t){return{active:"Aktiv",disposed:"Abgang",sold:"Verkauft"}[t]||t}function ye(t,s){if(!t.depreciationSchedule||t.depreciationSchedule.length===0)return t.purchasePrice;const n=t.depreciationSchedule.find(l=>l.year===s);if(n)return n.bookValue;const o=[...t.depreciationSchedule].sort((l,h)=>h.year-l.year).find(l=>l.year<=s);return o?o.bookValue:t.purchasePrice}function Ft({year:t,assets:s,isLoading:n=!1,error:a=null,showOnlyYearAcquisitions:o=!1,onExportCSV:l,onExportPDF:h,className:b}){const x=f.useMemo(()=>o?s.filter(u=>new Date(u.purchaseDate).getFullYear()===t):s,[s,t,o]),m=f.useMemo(()=>{const u=x.reduce((i,r)=>i+r.purchasePrice,0),j=x.reduce((i,r)=>i+r.afaAnnualAmount,0),d=x.reduce((i,r)=>i+ye(r,t),0);return{count:x.length,totalPurchaseValue:u,totalAnnualAfa:j,totalBookValue:d}},[x,t]);return n?e.jsxs("div",{className:A("space-y-6",b),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Anlageverzeichnis ",t]}),e.jsx("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:"Laden..."})]}):a?e.jsxs("div",{className:A("space-y-6",b),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Anlageverzeichnis ",t]}),e.jsx("div",{className:"rounded-lg border border-destructive p-8 text-center text-destructive",children:Z(a)})]}):x.length===0?e.jsxs("div",{className:A("space-y-6",b),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Anlageverzeichnis ",t]}),e.jsxs("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:[e.jsx(tt,{className:"mx-auto h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{children:"Keine Anlagen vorhanden"}),e.jsx("p",{className:"text-sm mt-1",children:"No assets registered"})]})]}):e.jsxs("div",{className:A("space-y-6",b),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Anlageverzeichnis ",t]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(B,{variant:"outline",size:"sm",onClick:()=>l==null?void 0:l(x,t),className:"flex-1 sm:flex-none",children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"CSV Export"]}),e.jsxs(B,{variant:"outline",size:"sm",onClick:()=>h==null?void 0:h(x,t),className:"flex-1 sm:flex-none",children:[e.jsx(st,{className:"mr-2 h-4 w-4"}),"PDF Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4","data-testid":"summary-section",children:[e.jsxs(I,{children:[e.jsx(L,{className:"pb-2",children:e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Anlagen"})}),e.jsx(T,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[m.count," Anlagen"]})})]}),e.jsxs(I,{children:[e.jsx(L,{className:"pb-2",children:e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Anschaffungswert"})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl font-bold",children:z(m.totalPurchaseValue)})})]}),e.jsxs(I,{children:[e.jsx(L,{className:"pb-2",children:e.jsxs(_,{className:"text-sm font-medium text-muted-foreground",children:["AfA ",t]})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl font-bold",children:z(m.totalAnnualAfa)})})]}),e.jsxs(I,{children:[e.jsx(L,{className:"pb-2",children:e.jsxs(_,{className:"text-sm font-medium text-muted-foreground",children:["Buchwert ",t]})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl font-bold",children:z(m.totalBookValue)})})]})]}),e.jsx(I,{children:e.jsx(T,{className:"p-0 overflow-x-auto",children:e.jsxs(J,{className:"min-w-[900px]",children:[e.jsx(X,{children:e.jsxs(D,{children:[e.jsx(S,{scope:"col",children:"Bezeichnung"}),e.jsx(S,{scope:"col",children:"Kategorie"}),e.jsx(S,{scope:"col",children:"Anschaffung"}),e.jsx(S,{scope:"col",className:"text-right",children:"Anschaffungswert"}),e.jsx(S,{scope:"col",className:"text-center",children:"AfA Jahre"}),e.jsx(S,{scope:"col",className:"text-right",children:"AfA/Jahr"}),e.jsxs(S,{scope:"col",className:"text-right",children:["Buchwert ",t]}),e.jsx(S,{scope:"col",children:"Status"})]})}),e.jsx(W,{children:x.map(u=>{const j=ye(u,t),d=u.status!=="active";return e.jsxs(D,{className:A(d&&"text-muted-foreground"),children:[e.jsxs(p,{className:"font-medium",children:[u.name,u.inventoryNumber&&e.jsxs("span",{className:"block text-xs text-muted-foreground",children:["Inv.-Nr.: ",u.inventoryNumber]})]}),e.jsx(p,{children:Lt(u.category)}),e.jsx(p,{children:De(new Date(u.purchaseDate))}),e.jsx(p,{className:"text-right",children:z(u.purchasePrice)}),e.jsxs(p,{className:"text-center",children:[u.afaYears," Jahre"]}),e.jsx(p,{className:"text-right",children:z(u.afaAnnualAmount)}),e.jsx(p,{className:"text-right",children:z(j)}),e.jsxs(p,{children:[e.jsx("span",{className:A("inline-flex items-center rounded-full px-2 py-1 text-xs font-medium",u.status==="active"&&"bg-green-100 text-green-700",u.status==="disposed"&&"bg-gray-100 text-gray-700",u.status==="sold"&&"bg-blue-100 text-blue-700"),children:_t(u.status)}),d&&u.disposalDate&&e.jsx("span",{className:"block text-xs text-muted-foreground mt-1",children:De(new Date(u.disposalDate))})]})]},u.id)})})]})})}),e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 text-sm text-muted-foreground",children:[e.jsx("p",{children:e.jsx("strong",{children:"Hinweise zum Anlageverzeichnis:"})}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Erforderlich für EÜR Anlage AVEÜR (Anlageverzeichnis)"}),e.jsx("li",{children:"Alle Beträge sind Netto-Werte (ohne USt)"}),e.jsx("li",{children:"Lineare AfA-Methode gemäß AfA-Tabelle"})]})]})]})}function U(t){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)}function Ee(t){return new Intl.NumberFormat("de-DE",{style:"percent",minimumFractionDigits:0,maximumFractionDigits:1}).format(t)}function we(t){return{computer:"EDV/Computer",furniture:"Büromöbel",equipment:"Geräte",software:"Software",phone:"Telefon"}[t]||t}function Mt(t,s){const o=new Date(t.afaStartDate).getFullYear()+t.afaYears-s-1;return Math.max(0,o)}function Ot(t,s){var a;const n=(a=t.depreciationSchedule)==null?void 0:a.find(o=>o.year===s);return(n==null?void 0:n.amount)??t.afaAnnualAmount}function Bt({year:t,assets:s,isLoading:n=!1,error:a=null,showCategoryBreakdown:o=!1,showYearlyComparison:l=!1,onExportCSV:h,className:b}){const x=f.useMemo(()=>s.filter(i=>i.status==="active"||i.afaAnnualAmount>0),[s]),m=f.useMemo(()=>[...x].sort((i,r)=>r.afaAnnualAmount-i.afaAnnualAmount),[x]),u=f.useMemo(()=>{const i=m.reduce((N,E)=>N+E.afaAnnualAmount,0),r=m.length>0?i/m.length:0;return{count:m.length,totalAfa:i,averageAfa:r}},[m]),j=f.useMemo(()=>{const i={computer:{count:0,total:0},furniture:{count:0,total:0},equipment:{count:0,total:0},software:{count:0,total:0},phone:{count:0,total:0}};for(const r of m)i[r.category]&&(i[r.category].count++,i[r.category].total+=r.afaAnnualAmount);return Object.entries(i).filter(([r,N])=>N.count>0).map(([r,N])=>({category:r,...N})).sort((r,N)=>N.total-r.total)},[m]),d=f.useMemo(()=>{if(!l)return[];const i=new Set;for(const r of m)if(r.depreciationSchedule)for(const N of r.depreciationSchedule)i.add(N.year);return Array.from(i).sort()},[m,l]);return n?e.jsxs("div",{className:A("space-y-6",b),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["AfA-Übersicht ",t]}),e.jsx("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:"Laden..."})]}):a?e.jsxs("div",{className:A("space-y-6",b),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["AfA-Übersicht ",t]}),e.jsx("div",{className:"rounded-lg border border-destructive p-8 text-center text-destructive",children:Z(a)})]}):m.length===0?e.jsxs("div",{className:A("space-y-6",b),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["AfA-Übersicht ",t]}),e.jsxs("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:[e.jsx(ve,{className:"mx-auto h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{children:"Keine Abschreibungen vorhanden"}),e.jsx("p",{className:"text-sm mt-1",children:"No depreciation for this year"})]})]}):e.jsxs("div",{className:A("space-y-6",b),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["AfA-Übersicht ",t]}),e.jsxs(B,{variant:"outline",size:"sm",onClick:()=>h==null?void 0:h(m,t),className:"w-full sm:w-auto",children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4","data-testid":"afa-summary-totals",children:[e.jsxs(I,{children:[e.jsx(L,{className:"pb-2",children:e.jsxs(_,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Gesamt-AfA ",t]})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl font-bold",children:U(u.totalAfa)})})]}),e.jsxs(I,{children:[e.jsx(L,{className:"pb-2",children:e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Anlagen mit AfA"})}),e.jsx(T,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[u.count," Anlagen"]})})]}),e.jsxs(I,{children:[e.jsx(L,{className:"pb-2",children:e.jsxs(_,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(nt,{className:"h-4 w-4"}),"Durchschnitt/Anlage"]})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl font-bold",children:U(u.averageAfa)})})]})]}),o&&j.length>0&&e.jsxs(I,{children:[e.jsx(L,{children:e.jsx(_,{className:"text-sm font-medium",children:"AfA nach Kategorie"})}),e.jsx(T,{children:e.jsx("div",{className:"space-y-3",children:j.map(({category:i,count:r,total:N})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:we(i)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",r," Anlagen)"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-medium",children:U(N)}),e.jsx("span",{className:"text-sm text-muted-foreground ml-2",children:Ee(N/u.totalAfa)})]})]},i))})})]}),l&&d.length>0&&e.jsxs(I,{children:[e.jsx(L,{children:e.jsx(_,{className:"text-sm font-medium",children:"Jahresvergleich"})}),e.jsx(T,{children:e.jsx("div",{className:"flex gap-4",children:d.map(i=>{const r=m.reduce((E,R)=>E+Ot(R,i),0),N=i===t;return e.jsxs("div",{className:A("flex-1 text-center p-3 rounded-lg border",N&&"bg-muted border-primary"),children:[e.jsx("div",{className:"text-sm font-medium",children:i}),e.jsx("div",{className:A("text-lg font-bold",N&&"text-primary"),children:U(r)})]},i)})})})]}),e.jsxs(I,{children:[e.jsx(L,{children:e.jsxs(_,{className:"text-sm font-medium",children:["AfA-Aufstellung ",t]})}),e.jsx(T,{className:"p-0 overflow-x-auto",children:e.jsxs(J,{className:"min-w-[600px]",children:[e.jsx(X,{children:e.jsxs(D,{children:[e.jsx(S,{scope:"col",children:"Anlage"}),e.jsx(S,{scope:"col",children:"Kategorie"}),e.jsxs(S,{scope:"col",className:"text-right",children:["AfA ",t]}),e.jsx(S,{scope:"col",className:"text-right",children:"Anteil"}),e.jsx(S,{scope:"col",className:"text-center",children:"Restlaufzeit"})]})}),e.jsxs(W,{children:[m.map(i=>{const r=u.totalAfa>0?i.afaAnnualAmount/u.totalAfa:0,N=Mt(i,t);return e.jsxs(D,{children:[e.jsxs(p,{className:"font-medium",children:[i.name,i.inventoryNumber&&e.jsxs("span",{className:"block text-xs text-muted-foreground",children:["Inv.-Nr.: ",i.inventoryNumber]})]}),e.jsx(p,{children:we(i.category)}),e.jsx(p,{className:"text-right font-medium",children:U(i.afaAnnualAmount)}),e.jsx(p,{className:"text-right",children:Ee(r)}),e.jsx(p,{className:"text-center",children:N>0?e.jsxs("span",{children:[N," Jahre"]}):e.jsx("span",{className:"text-muted-foreground",children:"Abgeschlossen"})})]},i.id)}),e.jsxs(D,{className:"bg-muted/50 font-bold",children:[e.jsx(p,{colSpan:2,children:"Gesamt"}),e.jsx(p,{className:"text-right",children:U(u.totalAfa)}),e.jsx(p,{className:"text-right",children:"100%"}),e.jsx(p,{})]})]})]})})]}),e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 text-sm text-muted-foreground",children:[e.jsx("p",{children:e.jsx("strong",{children:"Hinweise zur AfA-Berechnung:"})}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Lineare Abschreibung gemäß AfA-Tabelle"}),e.jsx("li",{children:"Pro-rata-temporis im Anschaffungs- und Abgangsjahr"}),e.jsx("li",{children:"Beträge netto (ohne Umsatzsteuer)"})]})]})]})}const $t=[{euerCategory:"services",euerLine:14,skr03Account:8400,skr04Account:4400,defaultVatRate:19,isIncome:!0},{euerCategory:"services_7",euerLine:14,skr03Account:8300,skr04Account:4300,defaultVatRate:7,isIncome:!0},{euerCategory:"services_exempt",euerLine:14,skr03Account:8120,skr04Account:4120,defaultVatRate:0,isIncome:!0},{euerCategory:"asset_sale",euerLine:16,skr03Account:8600,skr04Account:4600,defaultVatRate:19,isIncome:!0},{euerCategory:"ust_refund",euerLine:18,skr03Account:8955,skr04Account:4955,defaultVatRate:0,isIncome:!0},{euerCategory:"subcontractor",euerLine:25,skr03Account:3100,skr04Account:5900,defaultVatRate:19,isIncome:!1},{euerCategory:"software",euerLine:34,skr03Account:4964,skr04Account:6815,defaultVatRate:19,isIncome:!1},{euerCategory:"telecom",euerLine:34,skr03Account:4920,skr04Account:6805,defaultVatRate:19,isIncome:!1},{euerCategory:"hosting",euerLine:34,skr03Account:4964,skr04Account:6815,defaultVatRate:19,isIncome:!1},{euerCategory:"travel",euerLine:34,skr03Account:4670,skr04Account:6650,defaultVatRate:19,isIncome:!1},{euerCategory:"insurance",euerLine:34,skr03Account:4360,skr04Account:6400,defaultVatRate:0,isIncome:!1},{euerCategory:"bank_fees",euerLine:34,skr03Account:4970,skr04Account:6855,defaultVatRate:0,isIncome:!1},{euerCategory:"training",euerLine:34,skr03Account:4945,skr04Account:6820,defaultVatRate:19,isIncome:!1},{euerCategory:"books",euerLine:34,skr03Account:4940,skr04Account:6821,defaultVatRate:7,isIncome:!1},{euerCategory:"office_supplies",euerLine:34,skr03Account:4930,skr04Account:6815,defaultVatRate:19,isIncome:!1},{euerCategory:"home_office",euerLine:33,skr03Account:4288,skr04Account:6310,defaultVatRate:0,isIncome:!1},{euerCategory:"depreciation",euerLine:30,skr03Account:4830,skr04Account:6220,defaultVatRate:0,isIncome:!1},{euerCategory:"afa",euerLine:30,skr03Account:4830,skr04Account:6220,defaultVatRate:0,isIncome:!1},{euerCategory:"other",euerLine:34,skr03Account:4980,skr04Account:6890,defaultVatRate:19,isIncome:!1}];function zt(t,s){if(t==="services")return s===7?8300:s===0?8120:8400;const n=$t.find(a=>a.euerCategory===t);return(n==null?void 0:n.skr03Account)??4980}const Ut={BANK:1200},Pt=[{euerCategory:"services",euerLine:14,skr03Account:8400,skr04Account:4400,defaultVatRate:19,isIncome:!0},{euerCategory:"services_7",euerLine:14,skr03Account:8300,skr04Account:4300,defaultVatRate:7,isIncome:!0},{euerCategory:"services_exempt",euerLine:14,skr03Account:8120,skr04Account:4120,defaultVatRate:0,isIncome:!0},{euerCategory:"asset_sale",euerLine:16,skr03Account:8600,skr04Account:4600,defaultVatRate:19,isIncome:!0},{euerCategory:"ust_refund",euerLine:18,skr03Account:8955,skr04Account:4955,defaultVatRate:0,isIncome:!0},{euerCategory:"subcontractor",euerLine:25,skr03Account:3100,skr04Account:5900,defaultVatRate:19,isIncome:!1},{euerCategory:"software",euerLine:34,skr03Account:4964,skr04Account:6815,defaultVatRate:19,isIncome:!1},{euerCategory:"telecom",euerLine:34,skr03Account:4920,skr04Account:6805,defaultVatRate:19,isIncome:!1},{euerCategory:"hosting",euerLine:34,skr03Account:4964,skr04Account:6815,defaultVatRate:19,isIncome:!1},{euerCategory:"travel",euerLine:34,skr03Account:4670,skr04Account:6650,defaultVatRate:19,isIncome:!1},{euerCategory:"insurance",euerLine:34,skr03Account:4360,skr04Account:6400,defaultVatRate:0,isIncome:!1},{euerCategory:"bank_fees",euerLine:34,skr03Account:4970,skr04Account:6855,defaultVatRate:0,isIncome:!1},{euerCategory:"training",euerLine:34,skr03Account:4945,skr04Account:6820,defaultVatRate:19,isIncome:!1},{euerCategory:"books",euerLine:34,skr03Account:4940,skr04Account:6821,defaultVatRate:7,isIncome:!1},{euerCategory:"office_supplies",euerLine:34,skr03Account:4930,skr04Account:6815,defaultVatRate:19,isIncome:!1},{euerCategory:"home_office",euerLine:33,skr03Account:4288,skr04Account:6310,defaultVatRate:0,isIncome:!1},{euerCategory:"depreciation",euerLine:30,skr03Account:4830,skr04Account:6220,defaultVatRate:0,isIncome:!1},{euerCategory:"afa",euerLine:30,skr03Account:4830,skr04Account:6220,defaultVatRate:0,isIncome:!1},{euerCategory:"other",euerLine:34,skr03Account:4980,skr04Account:6890,defaultVatRate:19,isIncome:!1}];function Yt(t,s){if(t==="services")return s===7?4300:s===0?4120:4400;const n=Pt.find(a=>a.euerCategory===t);return(n==null?void 0:n.skr04Account)??6890}const Qt={BANK:1800};function Me(t){switch(t){case 19:return 3;case 7:return 2;case 0:default:return 0}}function Oe(t,s,n){return s==="SKR03"?zt(t,n):Yt(t,n)}function Be(t){return t==="SKR03"?Ut.BANK:Qt.BANK}function $e(t){const s=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0");return`${s}${n}`}function ce(t){return t.toFixed(2).replace(".",",")}function ze(){return{amount:0,debitCredit:"S",currency:"EUR",exchangeRate:"",baseAmount:0,account:0,counterAccount:1200,vatCode:0,documentDate:"",documentRef1:"",documentRef2:"",discount:0,description:"",blocked:0,addressNumber:"",partnerBank:"",businessCase:"",interestBlocked:0,documentLink:"",documentInfoType:"",documentInfoContent:""}}function Ue(t,s){const n=Oe(t.euerCategory,s,t.vatRate),a=Be(s);return{...ze(),amount:t.grossAmount,debitCredit:"H",baseAmount:t.grossAmount,account:n,counterAccount:a,vatCode:Me(t.vatRate),documentDate:$e(t.date),documentRef1:t.invoiceId??"",description:Ye(t.description)}}function Pe(t,s){const n=Oe(t.euerCategory,s,t.vatRate),a=Be(s);return{...ze(),amount:t.grossAmount,debitCredit:"S",baseAmount:t.grossAmount,account:n,counterAccount:a,vatCode:Me(t.vatRate),documentDate:$e(t.date),documentRef1:t.receiptPath?Gt(t.receiptPath):"",description:Ye(`${t.vendor}: ${t.description}`)}}function Ye(t){return t.length<=60?t:t.slice(0,57)+"..."}function Gt(t){return(t.split("/").pop()??"").replace(/\.[^/.]+$/,"")}function Qe(t){const s=[];return t.amount<=0&&s.push("Amount must be greater than 0"),(!t.account||t.account===0)&&s.push("Account number is required"),(!t.counterAccount||t.counterAccount===0)&&s.push("Counter account is required"),(!t.documentDate||t.documentDate.length!==4)&&s.push("Document date must be in DDMM format"),["S","H"].includes(t.debitCredit)||s.push("Debit/Credit indicator must be S or H"),[0,2,3].includes(t.vatCode)||s.push("VAT code must be 0, 2, or 3"),s}const Ge=["Umsatz","Soll/Haben-Kennzeichen","WKZ Umsatz","Kurs","Basis-Umsatz","Konto","Gegenkonto","BU-Schlüssel","Belegdatum","Belegfeld 1","Belegfeld 2","Skonto","Buchungstext","Postensperre","Diverse Adressnummer","Geschäftspartnerbank","Sachverhalt","Zinssperre","Beleglink","Beleginfo - Art 1","Beleginfo - Inhalt 1"],se=";";function He(t){return[ce(t.amount),t.debitCredit,t.currency,t.exchangeRate,ce(t.baseAmount),String(t.account),String(t.counterAccount),String(t.vatCode),t.documentDate,K(t.documentRef1),K(t.documentRef2),ce(t.discount),K(t.description),String(t.blocked),t.addressNumber,t.partnerBank,t.businessCase,String(t.interestBlocked),t.documentLink,t.documentInfoType,t.documentInfoContent].join(se)}function K(t){return t?t.includes(se)||t.includes('"')||t.includes(`
`)?`"${t.replace(/"/g,'""')}"`:t:""}function Ht(t){const s=Ge.join(se),n=t.map(He);return[s,...n].join(`
`)}function Ke(t,s){return t.map(n=>Ue(n,s))}function qe(t,s){return t.map(n=>Pe(n,s))}function Ze(t){const s=[];for(let n=0;n<t.length;n++){const a=t.charCodeAt(n);a<=255?s.push(a):s.push(63)}return new Uint8Array(s)}function Je(t,s,n){const a=[],o=[],l=[],h=t.filter(x=>{const m=x.date;return m>=n.startDate&&m<=n.endDate}),b=s.filter(x=>{const m=x.date;return m>=n.startDate&&m<=n.endDate});if(n.includeIncome!==!1){const x=Ke(h,n.chartOfAccounts);l.push(...x)}if(n.includeExpenses!==!1){const x=qe(b,n.chartOfAccounts);l.push(...x)}return l.forEach((x,m)=>{const u=Qe(x);u.length>0&&a.push(`Record ${m+1}: ${u.join(", ")}`)}),l.length===0&&o.push("No records found in the selected date range"),{records:l,recordCount:l.length,startDate:n.startDate,endDate:n.endDate,chartOfAccounts:n.chartOfAccounts,format:"csv",errors:a,warnings:o}}function Xe(t,s="csv"){const n=ke(t.startDate),a=ke(t.endDate);return`DATEV_${t.chartOfAccounts}_${n}_${a}.${s}`}function ke(t){const s=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${s}${n}${a}`}function q(t,s){switch(s){case"Q1":return{startDate:new Date(t,0,1),endDate:new Date(t,2,31)};case"Q2":return{startDate:new Date(t,3,1),endDate:new Date(t,5,30)};case"Q3":return{startDate:new Date(t,6,1),endDate:new Date(t,8,30)};case"Q4":return{startDate:new Date(t,9,1),endDate:new Date(t,11,31)};case"year":return{startDate:new Date(t,0,1),endDate:new Date(t,11,31)}}}function We(t,s){const n=new Date(t,s-1,1),a=new Date(t,s,0);return{startDate:n,endDate:a}}const Kt=Object.freeze(Object.defineProperty({__proto__:null,DATEV_CSV_HEADER:Ge,DATEV_DELIMITER:se,datevRecordToCsvRow:He,encodeToLatin1:Ze,escapeCsvField:K,expensesToDatevRecords:qe,generateCsvContent:Ht,generateDatevCsv:Je,generateDatevFilename:Xe,getMonthDates:We,getPeriodDates:q,incomesToDatevRecords:Ke},Symbol.toStringTag,{value:"Module"})),qt=new Date().getFullYear(),Se=Math.ceil((new Date().getMonth()+1)/3),Ce={periodType:"quarter",year:qt,quarter:Se>1?Se-1:4,month:new Date().getMonth()||12,customStartDate:null,customEndDate:null,chartOfAccounts:"SKR03",format:"csv",consultantNumber:"",clientNumber:"",includeIncome:!0,includeExpenses:!0,includeDepreciation:!0};function Zt(t={}){const[s,n]=f.useState({...Ce,...t}),a=f.useMemo(()=>{switch(s.periodType){case"month":return We(s.year,s.month);case"quarter":return q(s.year,`Q${s.quarter}`);case"year":return q(s.year,"year");case"custom":return{startDate:s.customStartDate||new Date(s.year,0,1),endDate:s.customEndDate||new Date(s.year,11,31)};default:return q(s.year,"year")}},[s.periodType,s.year,s.month,s.quarter,s.customStartDate,s.customEndDate]),o=f.useMemo(()=>({startDate:a.startDate,endDate:a.endDate,chartOfAccounts:s.chartOfAccounts,format:s.format,consultantNumber:s.consultantNumber||void 0,clientNumber:s.clientNumber||void 0,includeIncome:s.includeIncome,includeExpenses:s.includeExpenses,includeDepreciation:s.includeDepreciation}),[a,s]),l=f.useMemo(()=>{const g=[];return s.periodType==="custom"&&(s.customStartDate||g.push("Start date is required for custom period"),s.customEndDate||g.push("End date is required for custom period"),s.customStartDate&&s.customEndDate&&s.customStartDate>s.customEndDate&&g.push("Start date must be before end date")),!s.includeIncome&&!s.includeExpenses&&!s.includeDepreciation&&g.push("At least one transaction type must be selected"),g},[s]),h=l.length===0,b=f.useCallback(g=>{n(c=>({...c,periodType:g}))},[]),x=f.useCallback(g=>{n(c=>({...c,year:g}))},[]),m=f.useCallback(g=>{n(c=>({...c,quarter:g}))},[]),u=f.useCallback(g=>{n(c=>({...c,month:g}))},[]),j=f.useCallback((g,c)=>{n(v=>({...v,customStartDate:g,customEndDate:c}))},[]),d=f.useCallback(g=>{n(c=>({...c,chartOfAccounts:g}))},[]),i=f.useCallback(g=>{n(c=>({...c,format:g}))},[]),r=f.useCallback(g=>{n(c=>({...c,consultantNumber:g}))},[]),N=f.useCallback(g=>{n(c=>({...c,clientNumber:g}))},[]),E=f.useCallback(()=>{n(g=>({...g,includeIncome:!g.includeIncome}))},[]),R=f.useCallback(()=>{n(g=>({...g,includeExpenses:!g.includeExpenses}))},[]),O=f.useCallback(()=>{n(g=>({...g,includeDepreciation:!g.includeDepreciation}))},[]),y=f.useCallback(()=>{n(Ce)},[]);return{state:s,exportOptions:o,setPeriodType:b,setYear:x,setQuarter:m,setMonth:u,setCustomDateRange:j,setChartOfAccounts:d,setFormat:i,setConsultantNumber:r,setClientNumber:N,toggleIncludeIncome:E,toggleIncludeExpenses:R,toggleIncludeDepreciation:O,reset:y,validationErrors:l,isValid:h}}function Jt(){return f.useMemo(()=>{const t=[],s=new Date().getFullYear();for(let n=0;n<6;n++)t.push(s-n);return t},[])}function Xt(){return f.useMemo(()=>["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"].map((s,n)=>({value:n+1,label:s})),[])}function Wt(){return f.useMemo(()=>[{value:1,label:"Q1 (Jan - Mär)"},{value:2,label:"Q2 (Apr - Jun)"},{value:3,label:"Q3 (Jul - Sep)"},{value:4,label:"Q4 (Okt - Dez)"}],[])}function es(){return f.useMemo(()=>[{value:"month",label:"Monat"},{value:"quarter",label:"Quartal"},{value:"year",label:"Jahr"},{value:"custom",label:"Benutzerdefiniert"}],[])}const ts=({exportState:t,disabled:s=!1,className:n=""})=>{const{state:a,setPeriodType:o,setYear:l,setQuarter:h,setMonth:b,setCustomDateRange:x,setChartOfAccounts:m,setFormat:u,setConsultantNumber:j,setClientNumber:d,toggleIncludeIncome:i,toggleIncludeExpenses:r,toggleIncludeDepreciation:N,validationErrors:E}=t,R=Jt(),O=Xt(),y=Wt(),g=es();return e.jsxs("div",{className:`space-y-6 ${n}`,role:"form","aria-label":"DATEV Export Einstellungen",children:[e.jsxs("fieldset",{className:"space-y-4",disabled:s,children:[e.jsx("legend",{className:"text-sm font-medium text-gray-700",children:"Zeitraum"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"periodType",className:"block text-sm text-gray-600 mb-1",children:"Zeitraumtyp"}),e.jsx("select",{id:"periodType",value:a.periodType,onChange:c=>o(c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500","aria-describedby":"periodType-description",children:g.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"year",className:"block text-sm text-gray-600 mb-1",children:"Jahr"}),e.jsx("select",{id:"year",value:a.year,onChange:c=>l(parseInt(c.target.value,10)),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:R.map(c=>e.jsx("option",{value:c,children:c},c))})]})]}),a.periodType==="quarter"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"quarter",className:"block text-sm text-gray-600 mb-1",children:"Quartal"}),e.jsx("select",{id:"quarter",value:a.quarter,onChange:c=>h(parseInt(c.target.value,10)),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:y.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),a.periodType==="month"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"month",className:"block text-sm text-gray-600 mb-1",children:"Monat"}),e.jsx("select",{id:"month",value:a.month,onChange:c=>b(parseInt(c.target.value,10)),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:O.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),a.periodType==="custom"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm text-gray-600 mb-1",children:"Von"}),e.jsx("input",{type:"date",id:"startDate",value:a.customStartDate?a.customStartDate.toISOString().split("T")[0]:"",onChange:c=>x(c.target.value?new Date(c.target.value):null,a.customEndDate),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm text-gray-600 mb-1",children:"Bis"}),e.jsx("input",{type:"date",id:"endDate",value:a.customEndDate?a.customEndDate.toISOString().split("T")[0]:"",onChange:c=>x(a.customStartDate,c.target.value?new Date(c.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]})]})]}),e.jsxs("fieldset",{className:"space-y-4",disabled:s,children:[e.jsx("legend",{className:"text-sm font-medium text-gray-700",children:"Format"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"chartOfAccounts",className:"block text-sm text-gray-600 mb-1",children:"Kontenrahmen"}),e.jsxs("select",{id:"chartOfAccounts",value:a.chartOfAccounts,onChange:c=>m(c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"SKR03",children:"SKR03 (Standard)"}),e.jsx("option",{value:"SKR04",children:"SKR04"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"format",className:"block text-sm text-gray-600 mb-1",children:"Exportformat"}),e.jsxs("select",{id:"format",value:a.format,onChange:c=>u(c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"csv",children:"CSV (Buchungsstapel)"}),e.jsx("option",{value:"xml",children:"XML (LedgerImport)"})]})]})]})]}),e.jsxs("fieldset",{className:"space-y-4",disabled:s,children:[e.jsx("legend",{className:"text-sm font-medium text-gray-700",children:"DATEV Metadaten (optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"consultantNumber",className:"block text-sm text-gray-600 mb-1",children:"Beraternummer"}),e.jsx("input",{type:"text",id:"consultantNumber",value:a.consultantNumber,onChange:c=>j(c.target.value),placeholder:"z.B. 12345",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"clientNumber",className:"block text-sm text-gray-600 mb-1",children:"Mandantennummer"}),e.jsx("input",{type:"text",id:"clientNumber",value:a.clientNumber,onChange:c=>d(c.target.value),placeholder:"z.B. 99999",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]})]})]}),e.jsxs("fieldset",{className:"space-y-3",disabled:s,children:[e.jsx("legend",{className:"text-sm font-medium text-gray-700",children:"Zu exportieren"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.includeIncome,onChange:i,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Einnahmen"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.includeExpenses,onChange:r,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Ausgaben"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.includeDepreciation,onChange:N,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Abschreibungen (AfA)"})]})]})]}),E.length>0&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",role:"alert","aria-live":"polite",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Bitte korrigieren Sie folgende Fehler:"}),e.jsx("ul",{className:"mt-1 text-sm text-red-600 list-disc list-inside",children:E.map((c,v)=>e.jsx("li",{children:c},v))})]})]})},ss="http://xml.datev.de/bedi/tps/ledger/v060",ns='<?xml version="1.0" encoding="UTF-8"?>';function as(t){return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):""}function k(t,s,n){if(s==null||s==="")return`<${t}/>`;const o=typeof s=="number"?s.toString():as(s);return`<${t}>${o}</${t}>`}function je(t,s){const n=s.filter(a=>a).join(`
`);return`<${t}>
${n}
</${t}>`}function ue(t,s=2){const n=t.split(`
`),a=" ".repeat(s);return n.map(o=>a+o).join(`
`)}function Re(t){const s=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${s}-${n}-${a}`}function rs(t,s){const n=t.slice(0,2),a=t.slice(2,4);return`${s}-${a}-${n}`}function cs(t,s){const n=[],a=rs(t.documentDate,s);if(n.push(k("Date",a)),n.push(k("Amount",t.amount.toFixed(2))),t.debitCredit==="S"?(n.push(k("DebitAccount",t.account)),n.push(k("CreditAccount",t.counterAccount))):(n.push(k("DebitAccount",t.counterAccount)),n.push(k("CreditAccount",t.account))),t.description&&n.push(k("Description",t.description)),t.vatCode>0){const o=t.vatCode===3?19:t.vatCode===2?7:0;n.push(k("TaxCode",o))}return t.documentRef1&&n.push(k("DocumentNumber",t.documentRef1)),n.push(k("Currency",t.currency)),je("Transaction",n)}function ls(t,s){const n=t.map(a=>ue(cs(a,s),4));return je("Consolidate",n)}function os(t){const s=[];return s.push(k("Version","6.0")),s.push(k("Generator","Personal Assistant")),s.push(k("GeneratedAt",new Date().toISOString())),t.consultantNumber&&s.push(k("ConsultantNumber",t.consultantNumber)),t.clientNumber&&s.push(k("ClientNumber",t.clientNumber)),s.push(k("ChartOfAccounts",t.chartOfAccounts)),s.push(k("PeriodStart",Re(t.startDate))),s.push(k("PeriodEnd",Re(t.endDate))),je("Header",s)}function is(t,s){const n=s.startDate.getFullYear(),a=ue(os(s),2),o=ue(ls(t,n),2),l=[a,o].join(`
`),h=`<LedgerImport xmlns="${ss}">
${l}
</LedgerImport>`;return`${ns}
${h}`}function us(t,s){return t.map(n=>Ue(n,s))}function ds(t,s){return t.map(n=>Pe(n,s))}function ms(t,s,n){const a=[],o=[],l=[],h=t.filter(x=>{const m=x.date;return m>=n.startDate&&m<=n.endDate}),b=s.filter(x=>{const m=x.date;return m>=n.startDate&&m<=n.endDate});if(n.includeIncome!==!1){const x=us(h,n.chartOfAccounts);l.push(...x)}if(n.includeExpenses!==!1){const x=ds(b,n.chartOfAccounts);l.push(...x)}return l.forEach((x,m)=>{const u=Qe(x);u.length>0&&a.push(`Record ${m+1}: ${u.join(", ")}`)}),l.length===0&&o.push("No records found in the selected date range"),{records:l,recordCount:l.length,startDate:n.startDate,endDate:n.endDate,chartOfAccounts:n.chartOfAccounts,format:"xml",errors:a,warnings:o}}function xs(t,s){return is(t.records,s)}let le=null,oe=null;async function hs(){if(!le||!oe){const[t,s]=await Promise.all([ie(()=>import("./index-DV0Z4ueH.js"),__vite__mapDeps([0,1])),ie(()=>import("./index-CDjnCujr.js"),__vite__mapDeps([2,3,1]))]);le=t,oe=s}return{save:le.save,writeFile:oe.writeFile}}function fs(t,s,n){const a=new Blob([t],{type:n}),o=URL.createObjectURL(a),l=document.createElement("a");l.href=o,l.download=s,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o)}const gs=({open:t,onOpenChange:s,incomes:n,expenses:a,className:o=""})=>{const l=Zt(),{exportOptions:h,isValid:b}=l,[x,m]=f.useState(!1),[u,j]=f.useState(null),[d,i]=f.useState(null),[r,N]=f.useState(null);f.useEffect(()=>{if(!t)return;const y=n.filter(V=>{const C=V.date;return C>=h.startDate&&C<=h.endDate}),g=a.filter(V=>{const C=V.date;return C>=h.startDate&&C<=h.endDate}),c=h.includeIncome?y.length:0,v=h.includeExpenses?g.length:0,$=y.reduce((V,C)=>V+C.grossAmount,0),F=g.reduce((V,C)=>V+C.grossAmount,0);j({incomeCount:c,expenseCount:v,depreciationCount:0,totalCount:c+v,totalIncome:Math.round($*100)/100,totalExpenses:Math.round(F*100)/100,startDate:h.startDate,endDate:h.endDate})},[t,n,a,h]);const E=f.useCallback(async()=>{if(b){m(!0),N(null);try{const y=n,g=a;let c,v,$,F;if(h.format==="csv"){c=Je(y,g,h);const{generateCsvContent:ne}=await ie(async()=>{const{generateCsvContent:ae}=await Promise.resolve().then(()=>Kt);return{generateCsvContent:ae}},void 0);v=ne(c.records),$="text/csv",F="iso-8859-1"}else c=ms(y,g,h),v=xs(c,h),$="application/xml",F="utf-8";if(c.errors.length>0)throw new Error(c.errors.join(`
`));const V=Xe(h,h.format);let C;if(F==="iso-8859-1"?C=Ze(v):C=new TextEncoder().encode(v),G()){const{save:ne,writeFile:ae}=await hs(),be=await ne({defaultPath:V,filters:[{name:h.format==="csv"?"CSV Files":"XML Files",extensions:[h.format]}]});if(!be)return;await ae(be,C)}else fs(C,V,$);i(c)}catch(y){N(y instanceof Error?y.message:"Export failed")}finally{m(!1)}}},[b,n,a,h]),R=y=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(y),O=y=>new Intl.DateTimeFormat("de-DE").format(y);return e.jsx(ut,{open:t,onOpenChange:s,children:e.jsxs(dt,{children:[e.jsx(mt,{className:"fixed inset-0 bg-black/50 data-[state=open]:animate-fadeIn"}),e.jsxs(xt,{className:`fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto focus:outline-none data-[state=open]:animate-contentShow ${o}`,"aria-describedby":"datev-export-description",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 z-10",children:[e.jsx(ht,{className:"text-lg font-semibold text-gray-900",children:"DATEV Export"}),e.jsx(ft,{id:"datev-export-description",className:"text-sm text-gray-500 mt-1",children:"Exportieren Sie Ihre Buchhaltungsdaten im DATEV-Format für Ihren Steuerberater."})]}),e.jsxs("div",{className:"px-6 py-4 space-y-6",children:[e.jsx(ts,{exportState:l,disabled:x}),u&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Vorschau"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Zeitraum:"}),e.jsxs("p",{className:"font-medium",children:[O(u.startDate)," -"," ",O(u.endDate)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Datensätze:"}),e.jsx("p",{className:"font-medium",children:u.totalCount})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm pt-2 border-t",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Einnahmen"}),e.jsxs("p",{className:"font-medium text-green-600",children:[u.incomeCount," (",R(u.totalIncome),")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Ausgaben"}),e.jsxs("p",{className:"font-medium text-red-600",children:[u.expenseCount," (",R(u.totalExpenses),")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Ergebnis"}),e.jsx("p",{className:`font-medium ${u.totalIncome-u.totalExpenses>=0?"text-green-600":"text-red-600"}`,children:R(u.totalIncome-u.totalExpenses)})]})]})]}),d&&!r&&e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-md",role:"status","aria-live":"polite",children:[e.jsxs("p",{className:"text-sm text-green-800",children:["Export erfolgreich! ",d.recordCount," Datensätze wurden exportiert."]}),d.warnings.length>0&&e.jsx("ul",{className:"mt-2 text-sm text-yellow-700 list-disc list-inside",children:d.warnings.map((y,g)=>e.jsx("li",{children:y},g))})]}),r&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",role:"alert","aria-live":"assertive",children:e.jsx("p",{className:"text-sm text-red-800",children:r})})]}),e.jsxs("div",{className:"sticky bottom-0 bg-white border-t px-6 py-4 flex justify-end gap-3",children:[e.jsx(Ae,{asChild:!0,children:e.jsx("button",{type:"button",className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:x,children:"Abbrechen"})}),e.jsx("button",{type:"button",onClick:E,disabled:!b||x||(u==null?void 0:u.totalCount)===0,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed","aria-busy":x,children:x?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Exportiere..."]}):"Exportieren"})]}),e.jsx(Ae,{asChild:!0,children:e.jsx("button",{type:"button",className:"absolute top-4 right-4 p-1 rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Schließen",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]})]})})};function _s(){const t=new Date().getFullYear(),[s,n]=f.useState(t),[a,o]=f.useState([]),[l,h]=f.useState([]),[b,x]=f.useState([]),[m,u]=f.useState(!0),[j,d]=f.useState(!1);f.useEffect(()=>{async function r(){u(!0);try{const[N,E,R]=await Promise.all([lt(),gt(),pt()]);o(N),h(E),x(R)}catch(N){console.error("Failed to load data:",N)}finally{u(!1)}}r()},[]);const i=Array.from({length:6},(r,N)=>t-N);return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Reports"})}),e.jsxs(de,{value:String(s),onValueChange:r=>n(Number(r)),children:[e.jsx(me,{className:"w-full sm:w-[120px]",children:e.jsx(xe,{placeholder:"Year"})}),e.jsx(he,{children:i.map(r=>e.jsx(fe,{value:String(r),children:r},r))})]})]}),e.jsxs(Ie,{defaultValue:"vat",className:"w-full",children:[e.jsxs(Te,{className:"flex w-full overflow-x-auto gap-1 sm:grid sm:grid-cols-5",children:[e.jsx(M,{value:"vat",className:"flex-shrink-0",children:"VAT (USt)"}),e.jsx(M,{value:"euer",className:"flex-shrink-0",children:"Profit (EÜR)"}),e.jsx(M,{value:"assets",className:"flex-shrink-0 whitespace-nowrap",children:"Asset Register"}),e.jsx(M,{value:"afa",className:"flex-shrink-0",children:"Depreciation"}),e.jsx(M,{value:"datev",className:"flex-shrink-0 whitespace-nowrap",children:"DATEV Export"})]}),e.jsx(P,{value:"vat",className:"mt-6",children:e.jsx(Rt,{})}),e.jsx(P,{value:"euer",className:"mt-6",children:e.jsx(Vt,{})}),e.jsx(P,{value:"assets",className:"mt-6",children:e.jsx(Ft,{year:s,assets:a,isLoading:m})}),e.jsx(P,{value:"afa",className:"mt-6",children:e.jsx(Bt,{year:s,assets:a,isLoading:m})}),e.jsx(P,{value:"datev",className:"mt-6",children:e.jsx("div",{className:"rounded-lg border bg-card p-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 py-8",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"DATEV Export"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:"Export your accounting data in DATEV format for your tax advisor. Supports CSV (Buchungsstapel) and XML (LedgerImport) formats."})]}),e.jsx(B,{onClick:()=>d(!0),size:"lg",children:"Open DATEV Export"})]})})})]}),e.jsx(gs,{open:j,onOpenChange:d,incomes:l,expenses:b})]})}export{_s as ReportsPage};
