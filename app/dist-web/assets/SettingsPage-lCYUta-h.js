const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DV0Z4ueH.js","assets/core-BDPGcIsz.js","assets/index-CDjnCujr.js","assets/path-E9zjYLSN.js","assets/index-JZoliObr.js","assets/vendor-react-wuMqdllU.js","assets/vendor-router-Cm8Qzw9U.js","assets/vendor-icons-CHGo4Fp8.js","assets/index-DJ26gkiS.css"])))=>i.map(i=>d[i]);
var Be=Object.defineProperty;var Se=(s,t,a)=>t in s?Be(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var X=(s,t,a)=>Se(s,typeof t!="symbol"?t+"":t,a);import{r as x,j as e}from"./vendor-react-wuMqdllU.js";import{_ as F,A as M,C as Ie,D as le,k as p,L as h,I as f,a as j,B as De}from"./index-JZoliObr.js";import{getDb as W,getSchemaVersion as Re}from"./db.web-lSIIGn2q.js";import{C as S,a as I,b as D,d as A,c as R}from"./card-ByB4Hy19.js";import{a7 as oe,B as Te,a5 as Ae,d as Fe,a8 as Oe,J as Pe,a9 as Q,H as Le,b as _e,aa as Z,ab as ee,m as se,ac as Y,ad as Me,Q as de,ae as Ue,af as Je,z as $e}from"./vendor-icons-CHGo4Fp8.js";import{S as ae,a as te,b as re,c as ne,d as T}from"./select-Btjdd6HG.js";import{A as Ve,a as ze,b as We,c as He,d as Ye,e as Ke,f as qe,g as Ge,h as Xe}from"./alert-dialog-WF8eNeVO.js";import"./vendor-markdown-C3iCDuOK.js";import"./vendor-recharts-tRgwS7-V.js";import"./vendor-radix-BCh4MJnw.js";import"./vendor-floating-ui-BD6aHMKr.js";import"./vendor-router-Cm8Qzw9U.js";function V(){return typeof window<"u"&&"__TAURI__"in window&&!!window.__TAURI__}let J=null,$=null;async function ce(){if(!V())throw new Error("Tauri modules not available in web environment");if(!J||!$){const[s,t]=await Promise.all([F(()=>import("./index-DV0Z4ueH.js"),__vite__mapDeps([0,1])),F(()=>import("./index-CDjnCujr.js"),__vite__mapDeps([2,3,1]))]);J=s,$=t}return{save:J.save,open:J.open,writeTextFile:$.writeTextFile,readTextFile:$.readTextFile}}function Qe(s,t){const a=new Blob([s],{type:"application/json"}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}function Ze(){return new Promise(s=>{const t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=async a=>{var o;const n=(o=a.target.files)==null?void 0:o[0];if(!n){s(null);return}const i=await n.text();s(i)},t.oncancel=()=>s(null),t.click()})}function ie(s){let t=0;for(let a=0;a<s.length;a++){const n=s.charCodeAt(a);t=(t<<5)-t+n,t=t&t}return`hash:${Math.abs(t).toString(16)}`}class es{constructor(){X(this,"APP_VERSION","1.0.0")}async exportBackup(){try{const t=await W(),a=await Re(),[n,i,o,r,d,u,v]=await Promise.all([t.select("SELECT * FROM clients"),t.select("SELECT * FROM projects"),t.select("SELECT * FROM tasks"),t.select("SELECT * FROM time_entries"),t.select("SELECT * FROM invoices"),t.select("SELECT * FROM captures"),t.select("SELECT * FROM settings")]),g={version:this.APP_VERSION,exportedAt:new Date().toISOString(),schemaVersion:a,data:{clients:n,projects:i,tasks:o,time_entries:r,invoices:d,captures:u,settings:v}},k=JSON.stringify(g.data),y=ie(k),m={...g,checksum:y},w=`personal-assistant-backup-${new Date().toISOString().split("T")[0]}.json`,E=JSON.stringify(m,null,2);if(V()){const{save:O,writeTextFile:P}=await ce(),B=await O({defaultPath:w,filters:[{name:"JSON",extensions:["json"]}]});return B?(await P(B,E),{success:!0,filePath:B}):{success:!1,error:"Export cancelled"}}else return Qe(E,w),{success:!0,filePath:w}}catch(t){return console.error("Backup export failed:",t),{success:!1,error:t instanceof Error?t.message:"Export failed"}}}async importBackup(){try{let t;if(V()){const{open:u,readTextFile:v}=await ce(),g=await u({filters:[{name:"JSON",extensions:["json"]}],multiple:!1});if(!g||Array.isArray(g))return{success:!1,error:"Import cancelled"};t=await v(g)}else t=await Ze();if(!t)return{success:!1,error:"Import cancelled"};const a=JSON.parse(t),n=this.validateBackup(a);if(n)return{success:!1,error:n};const i=JSON.stringify(a.data);if(ie(i)!==a.checksum)return{success:!1,error:"Backup file is corrupted (checksum mismatch)"};const r=await W();await r.execute("DELETE FROM captures"),await r.execute("DELETE FROM time_entries"),await r.execute("DELETE FROM invoices"),await r.execute("DELETE FROM tasks"),await r.execute("DELETE FROM projects"),await r.execute("DELETE FROM clients"),await r.execute("DELETE FROM settings");let d=0;for(const u of a.data.clients)await this.insertRecord(r,"clients",u),d++;for(const u of a.data.projects)await this.insertRecord(r,"projects",u),d++;for(const u of a.data.tasks)await this.insertRecord(r,"tasks",u),d++;for(const u of a.data.time_entries)await this.insertRecord(r,"time_entries",u),d++;for(const u of a.data.invoices)await this.insertRecord(r,"invoices",u),d++;for(const u of a.data.captures)await this.insertRecord(r,"captures",u),d++;for(const u of a.data.settings)await this.insertRecord(r,"settings",u),d++;return{success:!0,stats:{tables:7,records:d}}}catch(t){return console.error("Backup import failed:",t),{success:!1,error:t instanceof Error?t.message:"Import failed"}}}validateBackup(t){if(!t||typeof t!="object")return"Invalid backup file format";const a=t;if(!a.version||typeof a.version!="string")return"Missing or invalid version";if(!a.exportedAt||typeof a.exportedAt!="string")return"Missing or invalid export date";if(typeof a.schemaVersion!="number")return"Missing or invalid schema version";if(!a.data||typeof a.data!="object")return"Missing or invalid data";if(!a.checksum||typeof a.checksum!="string")return"Missing or invalid checksum";const n=a.data,i=["clients","projects","tasks","time_entries","invoices","captures","settings"];for(const o of i)if(!Array.isArray(n[o]))return`Missing or invalid table: ${o}`;return null}async insertRecord(t,a,n){const i=Object.keys(n),o=i.map(()=>"?").join(", "),r=Object.values(n);await t.execute(`INSERT INTO ${a} (${i.join(", ")}) VALUES (${o})`,r)}async getBackupStats(){var t,a,n,i,o,r;if(V()){const d=await W(),[u,v,g,k,y,m]=await Promise.all([d.select("SELECT COUNT(*) as count FROM clients"),d.select("SELECT COUNT(*) as count FROM projects"),d.select("SELECT COUNT(*) as count FROM tasks"),d.select("SELECT COUNT(*) as count FROM time_entries"),d.select("SELECT COUNT(*) as count FROM invoices"),d.select("SELECT COUNT(*) as count FROM captures")]);return{clients:((t=u[0])==null?void 0:t.count)||0,projects:((a=v[0])==null?void 0:a.count)||0,tasks:((n=g[0])==null?void 0:n.count)||0,timeEntries:((i=k[0])==null?void 0:i.count)||0,invoices:((o=y[0])==null?void 0:o.count)||0,captures:((r=m[0])==null?void 0:r.count)||0}}else{const{api:d}=await F(async()=>{const{api:w}=await import("./index-JZoliObr.js").then(E=>E.V);return{api:w}},__vite__mapDeps([4,5,6,7,8])),[u,v,g,k,y,m]=await Promise.all([d.getClients(),d.getProjects(),d.getTasks(),d.getTimeEntries(),d.getInvoices(),d.getCaptures()]);return{clients:u.length,projects:v.length,tasks:g.length,timeEntries:k.length,invoices:y.length,captures:m.length}}}}const H=new es;async function ue(){return M.get("/backups/status")}async function ss(){return M.post("/backups/trigger")}async function as(){var n;const s=await M.requestBlob("/backups/download"),t=URL.createObjectURL(s),a=document.createElement("a");try{const i=await ue();a.download=((n=i.lastBackup)==null?void 0:n.filename)||"pa-backup.enc"}catch{a.download="pa-backup.enc"}a.href=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}async function ts(){const s=await M.requestBlob("/backups/export?format=json"),t=URL.createObjectURL(s),a=document.createElement("a"),n=new Date().toISOString().split("T")[0];a.download=`pa-export-${n}.json`,a.href=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}async function rs(s){return M.post(`/backups/restore/${encodeURIComponent(s)}`)}async function ns(s){const t=new FormData;t.append("file",s);const a=(await F(async()=>{const{getAdminToken:o}=await import("./index-JZoliObr.js").then(r=>r.U);return{getAdminToken:o}},__vite__mapDeps([4,5,6,7,8]))).getAdminToken(),n=(await F(async()=>{const{API_BASE:o}=await import("./index-JZoliObr.js").then(r=>r.U);return{API_BASE:o}},__vite__mapDeps([4,5,6,7,8]))).API_BASE,i=await fetch(`${n}/backups/import`,{method:"POST",headers:a?{Authorization:`Bearer ${a}`}:{},body:t});if(!i.ok){const o=await i.json().catch(()=>({error:"Import failed"}));throw new Error(o.error||"Import failed")}return i.json()}const cs={fullName:"",jobTitle:"",email:"",phone:"",street:"",postalCode:"",city:"",country:"Deutschland",vatId:"",taxId:"",bankAccountHolder:"",bankName:"",bankIban:"",bankBic:""};function is(){const s=Ie(),[t,a]=x.useState(s.workspacePath||""),[n,i]=x.useState(s.userName||""),[o,r]=x.useState(!1),[d,u]=x.useState(!1),[v,g]=x.useState(s.businessProfile||cs),[k,y]=x.useState(!1),[m,w]=x.useState(null),[E,O]=x.useState(null),[P,B]=x.useState(!1),[z,N]=x.useState(!1),[b,L]=x.useState(!1),[U,K]=x.useState(!1),[pe,q]=x.useState(!1);x.useEffect(()=>{s.businessProfile&&g(s.businessProfile)},[s.businessProfile]),x.useEffect(()=>{async function l(){try{const c=await H.getBackupStats();w(c)}catch(c){console.error("Failed to load data stats:",c)}}l()},[]);const _=x.useCallback(async()=>{if(le())try{const l=await ue();O(l)}catch(l){console.error("Failed to load backup status:",l)}},[]);x.useEffect(()=>{_()},[_]);const me=async()=>{var l;B(!0);try{const c=await ss();c.success?(p.success(`Backup created: ${(l=c.backup)==null?void 0:l.filename}`),await _()):p.error(c.error||"Backup failed")}catch(c){console.error("Backup trigger failed:",c),p.error("Failed to create backup")}finally{B(!1)}},xe=async()=>{N(!0);try{await as(),p.success("Backup download started")}catch(l){console.error("Backup download failed:",l),p.error("Failed to download backup")}finally{N(!1)}},he=async()=>{L(!0);try{await ts(),p.success("JSON export download started")}catch(l){console.error("JSON export failed:",l),p.error("Failed to export data")}finally{L(!1)}},fe=async l=>{K(!0);try{const c=await rs(l);c.success?(p.success(`Restored from ${c.restoredFrom}: ${c.totalRecords} records across ${c.tablesRestored} tables`),await _()):p.error(c.error||"Restore failed")}catch(c){console.error("Restore failed:",c),p.error(c instanceof Error?c.message:"Failed to restore backup")}finally{K(!1)}},je=async l=>{q(!0);try{const c=await ns(l);c.success?(p.success(`Imported from ${c.restoredFrom}: ${c.totalRecords} records across ${c.tablesRestored} tables`),await _()):p.error(c.error||"Import failed")}catch(c){console.error("Import failed:",c),p.error(c instanceof Error?c.message:"Failed to import backup")}finally{q(!1)}},ge=async()=>{t.trim()?(await s.setWorkspacePath(t.trim()),p.success("Workspace path saved")):(await s.setWorkspacePath(void 0),p.success("Workspace path cleared"))},be=async()=>{n.trim()&&(await s.setUserName(n.trim()),p.success("Name saved"))},ve=async()=>{y(!0);try{await s.setBusinessProfile(v),p.success("Business profile saved")}catch(l){console.error("Failed to save business profile:",l),p.error("Failed to save business profile")}finally{y(!1)}},G=(l,c)=>{g(C=>({...C,[l]:c}))},ke=l=>l.replace(/\s/g,"").toUpperCase().replace(/(.{4})/g,"$1 ").trim(),ye=l=>{const c=l.replace(/\s/g,"").toUpperCase();G("bankIban",c)},Ne=async()=>{r(!0);try{const l=await H.exportBackup();l.success?p.success("Backup exported successfully"):l.error!=="Export cancelled"&&p.error(l.error||"Export failed")}catch(l){console.error("Export failed:",l),p.error("Failed to export backup")}finally{r(!1)}},we=async()=>{var l,c;u(!0);try{const C=await H.importBackup();C.success?(p.success(`Backup restored: ${(l=C.stats)==null?void 0:l.records} records across ${(c=C.stats)==null?void 0:c.tables} tables`),window.location.reload()):C.error!=="Import cancelled"&&p.error(C.error||"Import failed")}catch(C){console.error("Import failed:",C),p.error("Failed to import backup")}finally{u(!1)}},Ee=async()=>{try{const{getDb:l}=await F(async()=>{const{getDb:C}=await import("./db.web-lSIIGn2q.js");return{getDb:C}},[]),c=await l();await c.execute("DELETE FROM captures"),await c.execute("DELETE FROM time_entries"),await c.execute("DELETE FROM invoices"),await c.execute("DELETE FROM tasks"),await c.execute("DELETE FROM projects"),await c.execute("DELETE FROM clients"),await c.execute("DELETE FROM settings"),p.success("All data cleared"),window.location.reload()}catch(l){console.error("Clear data failed:",l),p.error("Failed to clear data")}},Ce=m?m.clients+m.projects+m.tasks+m.timeEntries+m.invoices+m.captures:0;return{...s,pathInput:t,setPathInput:a,nameInput:n,setNameInput:i,profileForm:v,isSavingProfile:k,dataStats:m,totalRecords:Ce,isExporting:o,isImporting:d,backupStatus:E,isBackingUp:P,isDownloadingBackup:z,isExportingJson:b,isRestoring:U,isImportingBackup:pe,handleSaveWorkspacePath:ge,handleSaveUserName:be,handleSaveBusinessProfile:ve,updateProfileField:G,formatIban:ke,handleIbanChange:ye,handleTriggerBackup:me,handleDownloadBackup:xe,handleExportJson:he,handleRestoreBackup:fe,handleImportBackupFile:je,handleExportData:Ne,handleImportData:we,handleClearAllData:Ee}}function ls({nameInput:s,setNameInput:t,onSave:a}){return e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5"}),"Profile"]}),e.jsx(A,{children:"Your personal information displayed in the sidebar."})]}),e.jsx(R,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"user-name",children:"Display Name"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{id:"user-name",value:s,onChange:n=>t(n.target.value),placeholder:"Your name",className:"flex-1"}),e.jsx(j,{onClick:a,children:"Save"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This name appears next to your profile icon in the sidebar."})]})})]})}function os({profileForm:s,isSavingProfile:t,onUpdateField:a,onIbanChange:n,formatIban:i,onSave:o}){return e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5"}),"Business Profile"]}),e.jsx(A,{children:"Your business information for invoices and official documents."})]}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Personal Information"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"bp-fullName",children:"Full Name"}),e.jsx(f,{id:"bp-fullName",value:s.fullName,onChange:r=>a("fullName",r.target.value),placeholder:"Max Mustermann"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"bp-jobTitle",children:"Job Title"}),e.jsx(f,{id:"bp-jobTitle",value:s.jobTitle,onChange:r=>a("jobTitle",r.target.value),placeholder:"Full-Stack Developer"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"bp-email",children:"Business Email"}),e.jsx(f,{id:"bp-email",type:"email",value:s.email,onChange:r=>a("email",r.target.value),placeholder:"kontakt@example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"bp-phone",children:"Phone (optional)"}),e.jsx(f,{id:"bp-phone",type:"tel",value:s.phone||"",onChange:r=>a("phone",r.target.value),placeholder:"+49 123 456789"})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),"Address"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"bp-street",children:"Street Address"}),e.jsx(f,{id:"bp-street",value:s.street,onChange:r=>a("street",r.target.value),placeholder:"MusterstraÃŸe 123"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"bp-postalCode",children:"Postal Code"}),e.jsx(f,{id:"bp-postalCode",value:s.postalCode,onChange:r=>a("postalCode",r.target.value),placeholder:"12345"})]}),e.jsxs("div",{className:"space-y-2 col-span-1 sm:col-span-2",children:[e.jsx(h,{htmlFor:"bp-city",children:"City"}),e.jsx(f,{id:"bp-city",value:s.city,onChange:r=>a("city",r.target.value),placeholder:"Berlin"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"bp-country",children:"Country"}),e.jsx(f,{id:"bp-country",value:s.country,onChange:r=>a("country",r.target.value),placeholder:"Deutschland"})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Tax Information"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"bp-vatId",children:"USt-IdNr (VAT ID)"}),e.jsx(f,{id:"bp-vatId",value:s.vatId||"",onChange:r=>a("vatId",r.target.value.toUpperCase()),placeholder:"DE123456789"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Required for EU B2B invoices"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"bp-taxId",children:"Steuernummer (Tax Number)"}),e.jsx(f,{id:"bp-taxId",value:s.taxId||"",onChange:r=>a("taxId",r.target.value),placeholder:"123/456/78901"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Your local tax office number"})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Bank Details"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"bp-bankAccountHolder",children:"Account Holder"}),e.jsx(f,{id:"bp-bankAccountHolder",value:s.bankAccountHolder,onChange:r=>a("bankAccountHolder",r.target.value),placeholder:"Max Mustermann"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"bp-bankName",children:"Bank Name"}),e.jsx(f,{id:"bp-bankName",value:s.bankName,onChange:r=>a("bankName",r.target.value),placeholder:"Sparkasse Berlin"})]}),e.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[e.jsx(h,{htmlFor:"bp-bankIban",children:"IBAN"}),e.jsx(f,{id:"bp-bankIban",value:i(s.bankIban),onChange:r=>n(r.target.value),placeholder:"DE89 3704 0044 0532 0130 00",className:"font-mono"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"bp-bankBic",children:"BIC/SWIFT"}),e.jsx(f,{id:"bp-bankBic",value:s.bankBic,onChange:r=>a("bankBic",r.target.value.toUpperCase()),placeholder:"COBADEFFXXX",className:"font-mono"})]})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx(j,{onClick:o,disabled:t,children:t?"Saving...":"Save Business Profile"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"This information will be used in your invoice PDFs."})]})]})]})}function ds({theme:s,onSetTheme:t}){return e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsx(D,{children:"Appearance"}),e.jsx(A,{children:"Customize the look and feel."})]}),e.jsx(R,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Theme"}),e.jsx("div",{className:"flex gap-2",children:["light","dark","system"].map(a=>e.jsx(j,{variant:s===a?"default":"outline",size:"sm",onClick:()=>t(a),className:"capitalize",children:a},a))})]})})]})}function us({pathInput:s,setPathInput:t,workspacePath:a,onSave:n}){return e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5"}),"Workspace"]}),e.jsx(A,{children:"Configure your Obsidian workspace location for markdown integration."})]}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"workspace-path",children:"Workspace Path"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{id:"workspace-path",value:s,onChange:i=>t(i.target.value),placeholder:"/Users/you/Documents/Obsidian/Vault",className:"flex-1"}),e.jsx(j,{onClick:n,children:"Save"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Path to your Obsidian vault or markdown workspace. Used for exporting and linking files."})]}),a&&e.jsxs("div",{className:"rounded-lg bg-muted p-3 text-sm",children:[e.jsx("p",{className:"font-medium",children:"Current workspace:"}),e.jsx("code",{className:"text-xs text-muted-foreground",children:a})]})]})]})}function ps({defaultArea:s,defaultCurrency:t,onSetDefaultArea:a,onSetDefaultCurrency:n}){return e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsx(D,{children:"Defaults"}),e.jsx(A,{children:"Set default values for new items."})]}),e.jsx(R,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Default Area"}),e.jsxs(ae,{value:s,onValueChange:i=>a(i),children:[e.jsx(te,{children:e.jsx(re,{})}),e.jsxs(ne,{children:[e.jsx(T,{value:"wellfy",children:"Wellfy"}),e.jsx(T,{value:"freelance",children:"Freelance"}),e.jsx(T,{value:"personal",children:"Personal"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Default Currency"}),e.jsxs(ae,{value:t,onValueChange:n,children:[e.jsx(te,{children:e.jsx(re,{})}),e.jsxs(ne,{children:[e.jsx(T,{value:"EUR",children:"EUR"}),e.jsx(T,{value:"USD",children:"USD"}),e.jsx(T,{value:"GBP",children:"GBP"}),e.jsx(T,{value:"CHF",children:"CHF"})]})]})]})]})})]})}function ms({backupStatus:s,isBackingUp:t,isDownloadingBackup:a,isExportingJson:n,isRestoring:i,isImportingBackup:o,onTriggerBackup:r,onDownloadBackup:d,onExportJson:u,onRestoreBackup:v,onImportBackupFile:g}){const[k,y]=x.useState(null),[m,w]=x.useState(null),E=x.useRef(null),O=b=>{y(b)},P=()=>{k&&(v(k),y(null))},B=b=>{var U;const L=(U=b.target.files)==null?void 0:U[0];L&&w(L),E.current&&(E.current.value="")},z=()=>{m&&(g(m),w(null))},N=i||o;return e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Backup & Export"]}),e.jsx(A,{children:"Automated encrypted backups and data export. Backups are encrypted with AES-256-GCM."})]}),e.jsxs(R,{className:"space-y-4",children:[s&&e.jsxs("div",{className:"rounded-lg bg-muted p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"Backup Status"]}),e.jsx(De,{variant:s.encryptionKeyAvailable?"default":"destructive",children:s.encryptionKeyAvailable?"ðŸ”’ Encryption Active":"âš ï¸ No Key"})]}),s.lastBackup?e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(_e,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:["Last backup:"," ",e.jsx("span",{className:"text-foreground font-medium",children:new Date(s.lastBackup.date).toLocaleString("de-DE",{dateStyle:"medium",timeStyle:"short"})})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground pl-5",children:[s.lastBackup.filename," (",(s.lastBackup.sizeBytes/1024).toFixed(1)," KB)"]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No backups yet. Create your first backup below."}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ðŸ“¦ ",s.totalBackups," backup(s) stored in ",e.jsx("code",{className:"text-xs",children:s.backupDir})]})]}),s&&s.recentBackups.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Recent Backups"}),e.jsx("div",{className:"rounded-lg border divide-y",children:s.recentBackups.map(b=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(Q,{className:"h-3.5 w-3.5 text-green-500 shrink-0"}),e.jsx("span",{className:"truncate font-mono text-xs",children:b.filename})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground shrink-0",children:[e.jsxs("span",{children:[(b.sizeBytes/1024).toFixed(1)," KB"]}),e.jsx("span",{children:new Date(b.date).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}),e.jsxs(j,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",disabled:N,onClick:()=>O(b.filename),children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),"Restore"]})]})]},b.filename))})]}),k&&e.jsxs("div",{className:"rounded-lg border border-amber-500/50 bg-amber-50 dark:bg-amber-950/20 p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-amber-600 dark:text-amber-400 shrink-0 mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-sm font-medium text-amber-800 dark:text-amber-200",children:"Confirm Restore"}),e.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:["This will replace your current database with the backup"," ",e.jsx("code",{className:"font-mono bg-amber-100 dark:bg-amber-900/40 px-1 rounded",children:k}),". A safety backup of your current data will be created first."]})]})]}),e.jsxs("div",{className:"flex gap-2 pl-7",children:[e.jsx(j,{variant:"destructive",size:"sm",onClick:P,disabled:N,children:i?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-3.5 w-3.5 mr-1.5 animate-spin"}),"Restoring..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-3.5 w-3.5 mr-1.5"}),"Yes, Restore"]})}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>y(null),disabled:N,children:"Cancel"})]})]}),m&&e.jsxs("div",{className:"rounded-lg border border-amber-500/50 bg-amber-50 dark:bg-amber-950/20 p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-amber-600 dark:text-amber-400 shrink-0 mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-sm font-medium text-amber-800 dark:text-amber-200",children:"Confirm Import"}),e.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:["This will replace your current database with the uploaded file"," ",e.jsx("code",{className:"font-mono bg-amber-100 dark:bg-amber-900/40 px-1 rounded",children:m.name})," ","(",(m.size/1024).toFixed(1)," KB). A safety backup of your current data will be created first."]})]})]}),e.jsxs("div",{className:"flex gap-2 pl-7",children:[e.jsx(j,{variant:"destructive",size:"sm",onClick:z,disabled:N,children:o?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-3.5 w-3.5 mr-1.5 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-3.5 w-3.5 mr-1.5"}),"Yes, Import"]})}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>w(null),disabled:N,children:"Cancel"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[e.jsxs(j,{variant:"default",onClick:r,disabled:t||N,children:[e.jsx(Me,{className:`h-4 w-4 mr-2 ${t?"animate-spin":""}`}),t?"Backing up...":"Create Backup"]}),e.jsxs(j,{variant:"outline",onClick:d,disabled:a||!(s!=null&&s.lastBackup)||N,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),a?"Downloading...":"Download Backup"]}),e.jsxs(j,{variant:"outline",onClick:u,disabled:n||N,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),n?"Exporting...":"Export JSON"]}),e.jsxs(j,{variant:"outline",onClick:()=>{var b;return(b=E.current)==null?void 0:b.click()},disabled:N,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),o?"Importing...":"Import Backup"]}),e.jsx("input",{ref:E,type:"file",accept:".enc,.json,.backup,.db",className:"hidden",onChange:B})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Create Backup:"})," Encrypted backup saved on server (auto-rotated, 30 days).",e.jsx("br",{}),e.jsx("strong",{children:"Download Backup:"})," Download the latest encrypted backup file.",e.jsx("br",{}),e.jsx("strong",{children:"Export JSON:"})," Download all data as unencrypted JSON (for portability).",e.jsx("br",{}),e.jsx("strong",{children:"Import Backup:"})," Upload an encrypted (.enc) or JSON backup file to restore.",e.jsx("br",{}),e.jsx("strong",{children:"Restore:"})," Revert to a previous server-side backup. A safety backup is always created first."]})]})]})}function xs({dataStats:s,totalRecords:t,isExporting:a,isImporting:n,onExport:i,onImport:o,onClearAll:r}){return e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-5 w-5"}),"Data Management"]}),e.jsx(A,{children:"Your data is stored locally in SQLite. Export backups to keep your data safe."})]}),e.jsxs(R,{className:"space-y-4",children:[s&&e.jsxs("div",{className:"rounded-lg bg-muted p-3 text-sm",children:[e.jsxs("p",{className:"font-medium mb-2",children:["Current Data (",t," total)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[s.clients," clients"]}),e.jsxs("span",{children:[s.projects," projects"]}),e.jsxs("span",{children:[s.tasks," tasks"]}),e.jsxs("span",{children:[s.timeEntries," time entries"]}),e.jsxs("span",{children:[s.invoices," invoices"]}),e.jsxs("span",{children:[s.captures," captures"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(j,{variant:"outline",onClick:i,disabled:a,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),a?"Exporting...":"Export Backup"]}),e.jsxs(j,{variant:"outline",onClick:o,disabled:n,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),n?"Importing...":"Import Backup"]}),e.jsxs(Ve,{children:[e.jsx(ze,{asChild:!0,children:e.jsxs(j,{variant:"destructive",children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"Clear All Data"]})}),e.jsxs(We,{children:[e.jsxs(He,{children:[e.jsx(Ye,{children:"Are you absolutely sure?"}),e.jsx(Ke,{children:"This action cannot be undone. This will permanently delete all your tasks, time entries, clients, projects, invoices, and captures from the database."})]}),e.jsxs(qe,{children:[e.jsx(Ge,{children:"Cancel"}),e.jsx(Xe,{onClick:r,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Yes, delete everything"})]})]})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Export creates a JSON backup of all your data. Import restores from a previous backup.",e.jsx("strong",{className:"block mt-1",children:"Tip: Export backups regularly to protect your data."})]})]})]})}function hs(){return e.jsxs(S,{children:[e.jsx(I,{children:e.jsx(D,{children:"About"})}),e.jsxs(R,{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Personal Assistant Dashboard v0.1.0"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Built with Tauri, React, and TypeScript"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Data stored in: ~/Library/Application Support/com.personal-assistant.app/"})]})]})}function Is(){const s=is();return e.jsxs("div",{className:"space-y-6 max-w-2xl",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Settings"})}),e.jsx(ls,{nameInput:s.nameInput,setNameInput:s.setNameInput,onSave:s.handleSaveUserName}),e.jsx(os,{profileForm:s.profileForm,isSavingProfile:s.isSavingProfile,onUpdateField:s.updateProfileField,onIbanChange:s.handleIbanChange,formatIban:s.formatIban,onSave:s.handleSaveBusinessProfile}),e.jsx(ds,{theme:s.theme,onSetTheme:s.setTheme}),e.jsx(us,{pathInput:s.pathInput,setPathInput:s.setPathInput,workspacePath:s.workspacePath,onSave:s.handleSaveWorkspacePath}),e.jsx(ps,{defaultArea:s.defaultArea,defaultCurrency:s.defaultCurrency,onSetDefaultArea:s.setDefaultArea,onSetDefaultCurrency:s.setDefaultCurrency}),le()&&e.jsx(ms,{backupStatus:s.backupStatus,isBackingUp:s.isBackingUp,isDownloadingBackup:s.isDownloadingBackup,isExportingJson:s.isExportingJson,isRestoring:s.isRestoring,isImportingBackup:s.isImportingBackup,onTriggerBackup:s.handleTriggerBackup,onDownloadBackup:s.handleDownloadBackup,onExportJson:s.handleExportJson,onRestoreBackup:s.handleRestoreBackup,onImportBackupFile:s.handleImportBackupFile}),e.jsx(xs,{dataStats:s.dataStats,totalRecords:s.totalRecords,isExporting:s.isExporting,isImporting:s.isImporting,onExport:s.handleExportData,onImport:s.handleImportData,onClearAll:s.handleClearAllData}),e.jsx(hs,{})]})}export{Is as SettingsPage};
