import{r,j as n}from"./vendor-react-wuMqdllU.js";import{i as m,a as y}from"./index-BJ9hpEov.js";import{ae as w,bb as g,bc as E}from"./vendor-icons-ssgfUAX_.js";import"./vendor-markdown-C3iCDuOK.js";import"./vendor-recharts-tRgwS7-V.js";import"./vendor-radix-DqeMb71O.js";import"./vendor-floating-ui-BD6aHMKr.js";import"./vendor-router-Cm8Qzw9U.js";const d="offline-sync-queue",x=3;function S(){const[t,o]=r.useState(navigator.onLine),[e,i]=r.useState([]),[l,p]=r.useState(!1);r.useEffect(()=>{const a=localStorage.getItem(d);if(a)try{i(JSON.parse(a))}catch(s){console.error("Failed to parse sync queue:",s),localStorage.removeItem(d)}},[]),r.useEffect(()=>{localStorage.setItem(d,JSON.stringify(e))},[e]),r.useEffect(()=>{const a=()=>o(!0),s=()=>o(!1);return window.addEventListener("online",a),window.addEventListener("offline",s),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",s)}},[]),r.useEffect(()=>{t&&e.length>0&&!l&&u()},[t,e.length]);const f=r.useCallback(a=>{const s={...a,id:`${a.type}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),retries:0};return i(c=>[...c,s]),s.id},[]),h=r.useCallback(a=>{i(s=>s.filter(c=>c.id!==a))},[]),u=r.useCallback(async()=>{if(l||e.length===0||!t)return;p(!0);const a=[];for(const s of e)try{await T(s)}catch(c){console.error("Failed to sync action:",s,c),s.retries<x?a.push({...s,retries:s.retries+1}):console.error("Max retries exceeded for action:",s)}i(a),p(!1)},[e,t,l]);return{isOnline:t,queue:e,isSyncing:l,queueLength:e.length,addToQueue:f,removeFromQueue:h,syncQueue:u}}async function T(t){const o="/api";switch(t.type){case"CREATE_TASK":{const e=await fetch(`${o}/api/tasks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload)});if(!e.ok)throw new Error(`Failed to create task: ${e.statusText}`);break}case"UPDATE_TASK":{const e=await fetch(`${o}/api/tasks/${t.payload.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload)});if(!e.ok)throw new Error(`Failed to update task: ${e.statusText}`);break}case"DELETE_TASK":{const e=await fetch(`${o}/api/tasks/${t.payload.id}`,{method:"DELETE"});if(!e.ok)throw new Error(`Failed to delete task: ${e.statusText}`);break}case"CREATE_PROJECT":{const e=await fetch(`${o}/api/projects`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload)});if(!e.ok)throw new Error(`Failed to create project: ${e.statusText}`);break}case"UPDATE_PROJECT":{const e=await fetch(`${o}/api/projects/${t.payload.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload)});if(!e.ok)throw new Error(`Failed to update project: ${e.statusText}`);break}default:console.warn("Unknown action type:",t.type)}}function A(){const{isOnline:t,queueLength:o,isSyncing:e,syncQueue:i}=S();return t&&o===0?null:n.jsx("div",{className:"fixed bottom-4 right-4 z-40",children:n.jsx("div",{className:m("flex items-center gap-2 px-3 py-2 rounded-lg shadow-lg text-sm backdrop-blur-sm",t?"bg-blue-500/90 text-white":"bg-orange-500/90 text-white"),children:e?n.jsxs(n.Fragment,{children:[n.jsx(w,{className:"w-4 h-4 animate-spin"}),n.jsxs("span",{children:["Syncing ",o," items..."]})]}):o>0?n.jsxs(n.Fragment,{children:[n.jsx(g,{className:"w-4 h-4"}),n.jsxs("span",{children:[o," pending"]}),t&&n.jsx(y,{size:"sm",variant:"ghost",className:"h-6 px-2 text-white hover:bg-white/20",onClick:i,children:"Sync now"})]}):n.jsxs(n.Fragment,{children:[n.jsx(E,{className:"w-4 h-4"}),n.jsx("span",{children:"Synced"})]})})})}export{A as SyncStatusIndicator};
