import{j as e,r as i}from"./vendor-react-nkeu7MKf.js";import{c as de,j as M,X as ue,k as Y,a as J,I as te,L,l as P,m as q,f as be,n as ve,B as Ge,U as Qe,F as ye,o as oe,u as V,p as We,q as Xe,t as Ye,r as Ze}from"./index-DrITRpZC.js";import{u as Ne,a as ie,s as we,K as ke,P as Se,b as He,D as Ce,c as et,S as Te,v as De,d as Fe,C as Ie,e as tt,f as st,g as at}from"./vendor-dnd-CdmezjDq.js";import{g as rt,T as nt,h as ot,C as Oe}from"./vendor-radix-Oq5tdvA1.js";import{D as Ee,a as Ae,b as Re,c as Me,d as Pe,e as Le}from"./dialog-BB-bSIFe.js";import"./alert-dialog-BaBnwxVM.js";import{C as ge}from"./chevron-right-ft5l9QGJ.js";import{P as se}from"./plus-CdEWzdSX.js";import{G as ze}from"./grip-vertical-eFXWIw9i.js";import{C as me,S as G,a as Q,b as W,c as X,d as D}from"./select-DGc7E8u9.js";import{T as xe}from"./trash-2-lofomgWT.js";import{F as it}from"./folder-open-CR2vBeSH.js";import{M as lt}from"./message-square-CXhsR9FO.js";import{C as ct}from"./calendar-CFQSmmVU.js";import{E as dt}from"./ellipsis-BFw811sM.js";import{f as Je}from"./vendor-date-fns-D0ugVOfH.js";import{T as ut}from"./textarea-CXvtp2xE.js";import{S as mt}from"./switch-CEI1dIoC.js";import{C as Be}from"./confirm-delete-dialog-CQpG7Cp6.js";import{e as xt,g as ht,d as gt}from"./markdown-DZSA0cWY.js";import{D as pt}from"./download-CCOQkPeK.js";import{u as ft}from"./confettiStore-BxkEw7hl.js";import{S as jt}from"./search-B35Aldtr.js";import{P as pe}from"./pencil-DLHpG_O_.js";import"./vendor-markdown-zaQAhtrl.js";import"./vendor-recharts-COauwCrp.js";import"./vendor-router-bCYKpmtI.js";import"./vendor-floating-ui-_Y3uXdsy.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=de("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=de("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=de("Tags",[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]]);function yt(a){const t=a.replace("#",""),s=parseInt(t.substring(0,2),16),o=parseInt(t.substring(2,4),16),u=parseInt(t.substring(4,6),16);return(.299*s+.587*o+.114*u)/255>.55?"#000000":"#ffffff"}function le({tag:a,onRemove:t,className:s,size:o="sm"}){const u=a.color||"#6b7280",g=yt(u);return e.jsxs("span",{className:M("inline-flex items-center gap-1 rounded-full font-medium whitespace-nowrap",o==="sm"?"px-1.5 py-0.5 text-[10px] leading-tight":"px-2 py-0.5 text-xs",s),style:{backgroundColor:u,color:g},children:[a.name,t&&e.jsx("button",{type:"button",onClick:l=>{l.stopPropagation(),t()},className:"ml-0.5 rounded-full hover:opacity-80 focus:outline-none",style:{color:g},children:e.jsx(ue,{className:o==="sm"?"h-2.5 w-2.5":"h-3 w-3"})})]})}const qe=rt,Ve=nt,he=i.forwardRef(({className:a,align:t="center",sideOffset:s=4,...o},u)=>e.jsx(ot,{children:e.jsx(Oe,{ref:u,align:t,sideOffset:s,className:M("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...o})}));he.displayName=Oe.displayName;function Nt({selectedIds:a,onChange:t}){const{tags:s,createTag:o}=Y(),[u,g]=i.useState(!1),[l,n]=i.useState(""),[d,j]=i.useState(!1),w=s.filter(r=>r.name.toLowerCase().includes(l.toLowerCase())),k=s.filter(r=>a.includes(r.id)),v=r=>{a.includes(r)?t(a.filter(x=>x!==r)):t([...a,r])},N=async()=>{if(!l.trim()||d)return;j(!0);const r=await o({name:l.trim()});r&&(t([...a,r.id]),n("")),j(!1)},C=l.trim()&&w.length===0;return e.jsxs(qe,{open:u,onOpenChange:g,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(J,{type:"button",variant:"outline",role:"combobox","aria-expanded":u,className:"w-full justify-between h-auto min-h-10",children:[k.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:k.map(r=>e.jsx(le,{tag:r,onRemove:()=>v(r.id)},r.id))}):e.jsx("span",{className:"text-muted-foreground",children:"Select tags..."}),e.jsx(bt,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsxs(he,{className:"w-[280px] p-2",align:"start",children:[e.jsx(te,{placeholder:"Search or create tag...",value:l,onChange:r=>n(r.target.value),className:"mb-2 h-8 text-sm",onKeyDown:r=>{r.key==="Enter"&&C&&(r.preventDefault(),N())}}),e.jsxs("div",{className:"max-h-48 overflow-y-auto",children:[w.map(r=>e.jsx(wt,{tag:r,selected:a.includes(r.id),onToggle:()=>v(r.id)},r.id)),C&&e.jsxs("button",{type:"button",onClick:N,disabled:d,className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm text-muted-foreground hover:bg-accent hover:text-accent-foreground",children:[e.jsx(se,{className:"h-3.5 w-3.5"}),'Create "',l.trim(),'"']}),!l&&s.length===0&&e.jsx("p",{className:"px-2 py-3 text-center text-sm text-muted-foreground",children:"No tags yet. Type to create one."})]})]})]})}function wt({tag:a,selected:t,onToggle:s}){return e.jsxs("button",{type:"button",onClick:s,className:M("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-accent hover:text-accent-foreground",t&&"bg-accent/50"),children:[e.jsx("span",{className:"h-3 w-3 rounded-full shrink-0 border border-white/20",style:{backgroundColor:a.color||"#6b7280"}}),e.jsx("span",{className:"flex-1 text-left truncate",children:a.name}),t&&e.jsx(me,{className:"h-3.5 w-3.5 text-primary shrink-0"})]})}function kt(){const{tags:a,filterTagIds:t,setFilterTagIds:s}=Y(),[o,u]=i.useState(!1);if(a.length===0)return null;const g=n=>{t.includes(n)?s(t.filter(d=>d!==n)):s([...t,n])},l=()=>s([]);return e.jsxs(qe,{open:o,onOpenChange:u,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(J,{variant:"outline",size:"sm",className:"h-10 gap-2",children:[e.jsx(vt,{className:"h-4 w-4"}),"Tags",t.length>0&&e.jsx("span",{className:"ml-1 flex h-5 w-5 items-center justify-center rounded-full bg-primary text-[10px] font-bold text-primary-foreground",children:t.length})]})}),e.jsxs(he,{className:"w-56 p-2",align:"start",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 pb-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Filter by tag"}),t.length>0&&e.jsxs("button",{onClick:l,className:"text-xs text-muted-foreground hover:text-foreground flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3"}),"Clear"]})]}),e.jsx("div",{className:"max-h-56 overflow-y-auto space-y-0.5",children:a.map(n=>{const d=t.includes(n.id);return e.jsxs("button",{onClick:()=>g(n.id),className:M("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-accent transition-colors",d&&"bg-accent"),children:[e.jsx("span",{className:M("h-3 w-3 rounded-full shrink-0 border-2 transition-colors",d?"border-primary":"border-transparent"),style:{backgroundColor:n.color||"#6b7280"}}),e.jsx("span",{className:"flex-1 text-left truncate",children:n.name}),d&&e.jsx("span",{className:"text-xs text-primary font-medium",children:"âœ“"})]},n.id)})})]})]})}const ne=["#ef4444","#f97316","#f59e0b","#eab308","#22c55e","#14b8a6","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#a855f7","#ec4899","#6b7280","#1e293b"];function St({open:a,onOpenChange:t}){const{tags:s,createTag:o,updateTag:u,deleteTag:g}=Y(),[l,n]=i.useState(null),[d,j]=i.useState(""),[w,k]=i.useState(ne[0]),[v,N]=i.useState(null),[C,r]=i.useState(!1),x=()=>{n(null),j(""),k(ne[0])},p=c=>{n(c),j(c.name),k(c.color||ne[0])},h=async c=>{if(c.preventDefault(),!(!d.trim()||C)){r(!0);try{l?(await u(l.id,{name:d.trim(),color:w}),P.success(`Tag "${d.trim()}" updated`)):await o({name:d.trim(),color:w})&&P.success(`Tag "${d.trim()}" created`),x()}finally{r(!1)}}},b=async()=>{v&&(await g(v.id),P.success(`Tag "${v.name}" deleted`),N(null),(l==null?void 0:l.id)===v.id&&x())};return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{open:a,onOpenChange:c=>{t(c),c||x()},children:e.jsxs(Ae,{className:"w-[calc(100vw-2rem)] max-w-[480px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Re,{children:[e.jsxs(Me,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5"}),"Manage Tags"]}),e.jsx(Pe,{children:"Create, edit, and delete tags used to organize your tasks."})]}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"tag-name",children:l?"Edit Tag":"New Tag"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{id:"tag-name",value:d,onChange:c=>j(c.target.value),placeholder:"Tag name...",className:"flex-1",autoComplete:"off"}),e.jsx(J,{type:"submit",size:"sm",disabled:!d.trim()||C,children:l?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-3.5 w-3.5 mr-1"}),"Save"]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-3.5 w-3.5 mr-1"}),"Add"]})}),l&&e.jsx(J,{type:"button",variant:"ghost",size:"sm",onClick:x,children:"Cancel"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{children:"Color"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[ne.map(c=>e.jsx("button",{type:"button",onClick:()=>k(c),className:"h-7 w-7 rounded-full border-2 transition-all hover:scale-110",style:{backgroundColor:c,borderColor:w===c?"var(--primary)":"transparent",boxShadow:w===c?"0 0 0 2px var(--background), 0 0 0 4px var(--primary)":void 0},title:c},c)),e.jsxs("label",{className:"relative h-7 w-7 rounded-full border-2 border-dashed border-muted-foreground/40 flex items-center justify-center cursor-pointer hover:border-muted-foreground/70 transition-colors",title:"Custom color",children:[e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground",children:"#"}),e.jsx("input",{type:"color",value:w,onChange:c=>k(c.target.value),className:"absolute inset-0 opacity-0 cursor-pointer"})]})]}),d.trim()&&e.jsxs("div",{className:"pt-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground mr-2",children:"Preview:"}),e.jsx(le,{tag:{id:"preview",name:d.trim(),color:w},size:"md"})]})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsxs("h4",{className:"text-sm font-medium mb-3",children:["Existing Tags (",s.length,")"]}),s.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No tags yet. Create one above!"}):e.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:s.map(c=>e.jsxs("div",{className:"flex items-center justify-between rounded-md px-2 py-1.5 hover:bg-muted/50 group",children:[e.jsx(le,{tag:c,size:"md"}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>p(c),className:"p-1 rounded hover:bg-muted",title:"Edit tag",children:e.jsx(pe,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsx("button",{onClick:()=>N(c),className:"p-1 rounded hover:bg-destructive/10",title:"Delete tag",children:e.jsx(xe,{className:"h-3.5 w-3.5 text-destructive"})})]})]},c.id))})]}),e.jsx(Le,{children:e.jsx(J,{variant:"outline",onClick:()=>t(!1),children:"Done"})})]})}),e.jsx(Be,{open:!!v,onOpenChange:c=>{c||N(null)},title:`Delete tag "${v==null?void 0:v.name}"?`,description:"This will remove the tag from all tasks. This action cannot be undone.",onConfirm:b})]})}function Ct(a){const t={};for(const[s,o]of Object.entries(a)){const u=s.replace(/_([a-z])/g,(g,l)=>l.toUpperCase());t[u]=o}return t}function fe(a){const t=Ct(a);return{id:t.id,taskId:t.taskId,title:t.title,completed:!!t.completed,sortOrder:t.sortOrder??0,createdAt:t.createdAt}}function Tt({taskId:a,enabled:t=!0}){const[s,o]=i.useState([]),[u,g]=i.useState(!1),[l,n]=i.useState(null),d=i.useRef(!1),j=i.useCallback(async()=>{if(!(!a||!t)){g(!0),n(null);try{const x=(await q.getSubtasks(a)).map(fe);o(x),d.current=!0}catch(r){console.error("Failed to fetch subtasks:",r),n("Failed to load subtasks")}finally{g(!1)}}},[a,t]);i.useEffect(()=>{t&&!d.current&&j()},[t,j]),i.useEffect(()=>{d.current=!1,o([])},[a]);const w=i.useCallback(async r=>{if(!r.trim())return;const x=crypto.randomUUID(),p={id:x,taskId:a,title:r.trim(),completed:!1,sortOrder:s.length,createdAt:new Date().toISOString()};o(h=>[...h,p]);try{const h=await q.createSubtask(a,r.trim()),b=fe(h);o(c=>c.map(E=>E.id===x?b:E))}catch(h){console.error("Failed to create subtask:",h),o(b=>b.filter(c=>c.id!==x)),P.error("Failed to add subtask")}},[a,s.length]),k=i.useCallback(async(r,x)=>{o(p=>p.map(h=>h.id===r?{...h,completed:x}:h));try{await q.updateSubtask(r,{completed:x?1:0})}catch(p){console.error("Failed to toggle subtask:",p),o(h=>h.map(b=>b.id===r?{...b,completed:!x}:b)),P.error("Failed to update subtask")}},[]),v=i.useCallback(async(r,x)=>{var h;if(!x.trim())return;const p=(h=s.find(b=>b.id===r))==null?void 0:h.title;o(b=>b.map(c=>c.id===r?{...c,title:x.trim()}:c));try{await q.updateSubtask(r,{title:x.trim()})}catch(b){console.error("Failed to update subtask:",b),p&&o(c=>c.map(E=>E.id===r?{...E,title:p}:E)),P.error("Failed to update subtask")}},[s]),N=i.useCallback(async r=>{const x=s;o(p=>p.filter(h=>h.id!==r));try{await q.deleteSubtask(r)}catch(p){console.error("Failed to delete subtask:",p),o(x),P.error("Failed to delete subtask")}},[s]),C=i.useCallback(async r=>{const x=s,p=r.map(h=>s.find(b=>b.id===h)).filter(h=>h!==void 0).map((h,b)=>({...h,sortOrder:b}));o(p);try{await q.reorderSubtasks(a,r)}catch(h){console.error("Failed to reorder subtasks:",h),o(x),P.error("Failed to reorder subtasks")}},[a,s]);return{subtasks:s,isLoading:u,error:l,addSubtask:w,toggleSubtask:k,updateSubtask:v,deleteSubtask:N,reorderSubtasks:C,refresh:j}}function Dt({subtask:a,onToggle:t,onDelete:s}){const{attributes:o,listeners:u,setNodeRef:g,transform:l,transition:n,isDragging:d}=Fe({id:a.id}),j={transform:Ie.Transform.toString(l),transition:n};return e.jsxs("div",{ref:g,style:j,className:M("group flex items-center gap-2 py-1.5 px-1 rounded-md transition-colors",d&&"opacity-50 bg-muted",!d&&"hover:bg-muted/50"),children:[e.jsx("button",{className:"cursor-grab touch-none opacity-0 group-hover:opacity-60 transition-opacity shrink-0",...o,...u,children:e.jsx(ze,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsx("button",{onClick:()=>t(a.id,!a.completed),className:M("shrink-0 w-4 h-4 rounded-full border-2 flex items-center justify-center transition-all duration-200",a.completed?"bg-green-500 border-green-500":"border-muted-foreground/50 hover:border-green-500"),children:a.completed&&e.jsx(me,{className:"h-2.5 w-2.5 text-white",strokeWidth:3})}),e.jsx("span",{className:M("flex-1 text-sm transition-all",a.completed&&"text-muted-foreground line-through"),children:a.title}),e.jsx("button",{onClick:()=>s(a.id),className:"opacity-0 group-hover:opacity-60 hover:opacity-100 transition-opacity p-0.5 hover:text-destructive",children:e.jsx(xe,{className:"h-3.5 w-3.5"})})]})}function Ft({onAdd:a,onCancel:t}){const[s,o]=i.useState(""),u=i.useRef(null);i.useEffect(()=>{var n;(n=u.current)==null||n.focus()},[]);const g=()=>{s.trim()&&(a(s.trim()),o(""))},l=n=>{n.key==="Enter"?(n.preventDefault(),g()):n.key==="Escape"&&t()};return e.jsxs("div",{className:"flex items-center gap-2 py-1.5 px-1",children:[e.jsx("div",{className:"w-3.5"})," ",e.jsx("div",{className:"shrink-0 w-4 h-4 rounded-full border-2 border-muted-foreground/30"}),e.jsx("input",{ref:u,type:"text",value:s,onChange:n=>o(n.target.value),onKeyDown:l,onBlur:()=>{s.trim()||t()},placeholder:"Add subtask...",className:"flex-1 text-sm bg-transparent border-none outline-none placeholder:text-muted-foreground/50"}),e.jsx("button",{onClick:g,className:"p-0.5 text-green-500 hover:text-green-600 transition-colors",disabled:!s.trim(),children:e.jsx(me,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:t,className:"p-0.5 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(ue,{className:"h-3.5 w-3.5"})})]})}function It({taskId:a,counts:t,onCountChange:s}){const[o,u]=i.useState(!1),[g,l]=i.useState(!1),{subtasks:n,isLoading:d,addSubtask:j,toggleSubtask:w,deleteSubtask:k,reorderSubtasks:v}=Tt({taskId:a,enabled:o});i.useEffect(()=>{if(s&&n.length>0){const p={total:n.length,completed:n.filter(h=>h.completed).length};s(p)}},[n,s]);const N=Ne(ie(Se,{activationConstraint:{distance:5}}),ie(ke,{coordinateGetter:we})),C=i.useCallback(p=>{const{active:h,over:b}=p;if(!b||h.id===b.id)return;const c=n.findIndex(z=>z.id===h.id),E=n.findIndex(z=>z.id===b.id);if(c!==E){const z=He(n,c,E);v(z.map(U=>U.id))}},[n,v]),r=i.useCallback(async p=>{await j(p)},[j]),x=o?{total:n.length,completed:n.filter(p=>p.completed).length}:t||{total:0,completed:0};return!o&&x.total===0?null:e.jsxs("div",{className:"mt-2",children:[!o&&x.total>0&&e.jsxs("button",{onClick:()=>u(!0),className:M("inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-colors","bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400","hover:bg-slate-200 dark:hover:bg-slate-700"),children:[e.jsx(ge,{className:"h-3 w-3"}),e.jsxs("span",{children:[x.completed,"/",x.total," Sub-Tasks"]})]}),o&&e.jsxs("div",{className:"rounded-lg border bg-card/50 p-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("button",{onClick:()=>u(!1),className:"text-xs font-medium text-muted-foreground hover:text-foreground flex items-center gap-1 transition-colors",children:[e.jsx(ge,{className:"h-3 w-3 rotate-90"}),"Subtasks"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[x.completed,"/",x.total]})]}),d&&n.length===0?e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"Loading..."}):e.jsx(Ce,{sensors:N,collisionDetection:et,onDragEnd:C,children:e.jsx(Te,{items:n.map(p=>p.id),strategy:De,children:e.jsx("div",{className:"space-y-0.5",children:n.map(p=>e.jsx(Dt,{subtask:p,onToggle:w,onDelete:k},p.id))})})}),g?e.jsx(Ft,{onAdd:r,onCancel:()=>l(!1)}):e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 py-1.5 px-1 mt-1 text-xs text-muted-foreground hover:text-foreground transition-colors w-full",children:[e.jsx("div",{className:"w-3.5"}),e.jsx(se,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Add subtask"})]})]})]})}const Ot={1:"bg-destructive/20 text-destructive",2:"bg-warning/20 text-warning",3:"bg-muted text-muted-foreground"},Et={wellfy:"bg-blue-500/20 text-blue-600 dark:text-blue-400",freelance:"bg-green-500/20 text-green-600 dark:text-green-400",personal:"bg-purple-500/20 text-purple-600 dark:text-purple-400"},Ue=["bg-orange-500/20 text-orange-700 dark:text-orange-400","bg-emerald-500/20 text-emerald-700 dark:text-emerald-400","bg-violet-500/20 text-violet-700 dark:text-violet-400","bg-rose-500/20 text-rose-700 dark:text-rose-400","bg-cyan-500/20 text-cyan-700 dark:text-cyan-400","bg-amber-500/20 text-amber-700 dark:text-amber-400","bg-fuchsia-500/20 text-fuchsia-700 dark:text-fuchsia-400","bg-sky-600/20 text-sky-700 dark:text-sky-300"];function At(a){let t=2166136261;for(let s=0;s<a.length;s++)t^=a.charCodeAt(s),t=t*16777619>>>0;return t%Ue.length}const _e=i.forwardRef(function({task:t,onEdit:s,onAssignToJames:o,isDragging:u,subtaskCounts:g,dragHandleProps:l,style:n},d){var C;const{projects:j}=be(),{prds:w}=ve(),k=Y(r=>r.taskTags[t.id]||[]),v=t.projectId?j.find(r=>r.id===t.projectId):null,N=t.prdId?w.find(r=>r.id===t.prdId):null;return e.jsx("div",{ref:d,style:n,className:M("group rounded-lg border bg-card p-3 shadow-sm transition-all",u&&"opacity-50 shadow-lg ring-2 ring-primary",!u&&"hover:shadow-md"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("button",{className:"mt-0.5 cursor-grab touch-none opacity-0 transition-opacity group-hover:opacity-100",...(l==null?void 0:l.attributes)??{},...(l==null?void 0:l.listeners)??{},children:e.jsx(ze,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("button",{onClick:()=>s(t),className:"text-left w-full",children:e.jsx("h4",{className:"font-medium text-sm leading-tight hover:text-primary transition-colors",children:t.title})}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:t.description}),e.jsx(It,{taskId:t.id,counts:g}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.jsxs(Ge,{variant:"secondary",className:M("text-xs capitalize inline-flex items-center gap-1",Et[t.area]),children:[e.jsx(Qe,{className:"h-3 w-3"}),t.area]}),v&&e.jsxs("span",{className:M("inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium max-w-[140px]",Ue[At(v.name)]),title:v.name,children:[e.jsx(it,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:v.name})]}),N&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-teal-500/20 text-teal-700 dark:text-teal-400 max-w-[140px]",title:`PRD: ${N.featureName}`,children:[e.jsx(ye,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:N.featureName})]}),t.assignee==="james"&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-indigo-500/20 text-indigo-700 dark:text-indigo-400",title:"Assigned to James",children:[e.jsx(oe,{className:"h-3 w-3 shrink-0"}),"James"]}),!!t.quickCapture&&((C=t.createdBy)==null?void 0:C.includes("@"))&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-pink-500/20 text-pink-700 dark:text-pink-400",title:`Client request from ${t.createdBy}`,children:[e.jsx(lt,{className:"h-3 w-3 shrink-0"}),"Request"]}),k.map(r=>e.jsx(le,{tag:r},r.id)),e.jsx("span",{className:M("inline-flex items-center rounded px-1.5 py-0.5 text-xs font-medium",Ot[t.priority]),children:t.priority===1?"High":t.priority===2?"Med":"Low"}),t.dueDate&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ct,{className:"h-3 w-3"}),Je(new Date(t.dueDate),"MMM d")]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[t.assignee!=="james"&&o&&e.jsx("button",{onClick:r=>{r.stopPropagation(),o(t)},className:"p-1 rounded hover:bg-indigo-100 dark:hover:bg-indigo-900/30 transition-colors",title:"Assign to James",children:e.jsx(oe,{className:"h-4 w-4 text-indigo-600 dark:text-indigo-400"})}),e.jsx("button",{onClick:()=>s(t),className:"p-1 rounded hover:bg-muted transition-colors",children:e.jsx(dt,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"})})]})]})})});function Rt({task:a,onEdit:t,onAssignToJames:s,isDragging:o,subtaskCounts:u}){const{attributes:g,listeners:l,setNodeRef:n,transform:d,transition:j,isDragging:w}=Fe({id:a.id}),k={transform:Ie.Transform.toString(d),transition:j},v=o||w;return e.jsx(_e,{ref:n,style:k,task:a,onEdit:t,onAssignToJames:s,isDragging:v,subtaskCounts:u,dragHandleProps:{attributes:g,listeners:l}})}const Mt={backlog:"border-t-slate-400",queue:"border-t-blue-400",in_progress:"border-t-amber-400",done:"border-t-green-400"};function Pt({id:a,title:t,tasks:s,onAddTask:o,onEditTask:u,onAssignToJames:g,subtaskCounts:l}){const{setNodeRef:n,isOver:d}=tt({id:a});return e.jsxs("div",{className:M("flex flex-col rounded-lg border border-t-4 bg-muted/30",Mt[a]),children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:t}),e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-muted px-2 py-0.5 text-xs font-medium text-muted-foreground",children:s.length})]}),e.jsx("button",{onClick:()=>o(a),className:"rounded p-1 hover:bg-accent transition-colors",title:"Add task",children:e.jsx(se,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsxs("div",{ref:n,className:M("flex-1 p-2 space-y-2 min-h-[200px] transition-colors",d&&"bg-accent/50"),children:[e.jsx(Te,{items:s.map(j=>j.id),strategy:De,children:s.map(j=>e.jsx(Rt,{task:j,onEdit:u,onAssignToJames:g,subtaskCounts:l==null?void 0:l[j.id]},j.id))}),s.length===0&&e.jsx("div",{className:"flex items-center justify-center h-20 text-sm text-muted-foreground",children:"No tasks"})]})]})}function $e({open:a,onOpenChange:t,task:s,defaultStatus:o,onClose:u}){const{addTask:g,updateTask:l,deleteTask:n}=V(),{projects:d}=be(),{clients:j}=We(),{prds:w}=ve(),{taskTags:k,syncTaskTags:v}=Y(),[N,C]=i.useState(""),[r,x]=i.useState(""),[p,h]=i.useState("backlog"),[b,c]=i.useState(2),[E,z]=i.useState("freelance"),[U,Z]=i.useState(""),[ae,H]=i.useState(void 0),[f,S]=i.useState(void 0),[T,A]=i.useState(null),[R,B]=i.useState([]),[_,y]=i.useState(!1),F=!!s;i.useEffect(()=>{if(s){C(s.title),x(s.description||""),h(s.status),c(s.priority),z(s.area),Z(s.dueDate?Je(new Date(s.dueDate),"yyyy-MM-dd"):""),H(s.projectId),S(s.prdId),A(s.assignee||null);const m=k[s.id]||[];B(m.map(O=>O.id))}else C(""),x(""),h(o||"backlog"),c(2),z("freelance"),Z(""),H(void 0),S(void 0),A(null),B([])},[s,o,a]);const K=async m=>{if(m.preventDefault(),!N.trim())return;const O={title:N.trim(),description:r.trim()||void 0,status:p,priority:b,area:E,dueDate:U?new Date(U).toISOString():void 0,projectId:ae,prdId:f,assignee:T};if(F&&s)await l(s.id,O),await v(s.id,R);else{await g(O);const $=V.getState().tasks.find(re=>re.title===O.title&&re.status===O.status);$&&R.length>0&&await v($.id,R)}u()},I=()=>{s&&(n(s.id),y(!1),u())},ee=()=>{if(!s)return;const m=s.projectId?d.find(ce=>ce.id===s.projectId):void 0,O=m!=null&&m.clientId?j.find(ce=>ce.id===m.clientId):void 0,$=xt(s,{project:m,client:O}),re=ht(s.title);gt($,re),P.success(`Exported "${s.title}" to markdown`)};return e.jsx(Ee,{open:a,onOpenChange:t,children:e.jsxs(Ae,{className:"w-[calc(100vw-2rem)] max-w-[500px] max-h-[90vh] overflow-y-auto overflow-x-hidden",children:[e.jsxs("form",{onSubmit:K,children:[e.jsxs(Re,{children:[e.jsx(Me,{children:F?"Edit Task":"New Task"}),e.jsx(Pe,{children:F?"Update the task details below.":"Create a new task by filling out the form below."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"title",children:"Title"}),e.jsx(te,{id:"title",value:N,onChange:m=>C(m.target.value),placeholder:"Task title...",autoFocus:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"description",children:"Description"}),e.jsx(ut,{id:"description",value:r,onChange:m=>x(m.target.value),placeholder:"Add details...",rows:3})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"project",children:"Project"}),e.jsxs(G,{value:ae||"none",onValueChange:m=>H(m==="none"?void 0:m),children:[e.jsx(Q,{children:e.jsx(W,{placeholder:"Select a project..."})}),e.jsxs(X,{children:[e.jsx(D,{value:"none",children:"No project"}),d.map(m=>e.jsx(D,{value:m.id,children:m.name},m.id))]})]})]}),w.length>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(L,{htmlFor:"prd",className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"PRD"]}),e.jsxs(G,{value:f||"none",onValueChange:m=>S(m==="none"?void 0:m),children:[e.jsx(Q,{children:e.jsx(W,{placeholder:"Link to a PRD..."})}),e.jsxs(X,{children:[e.jsx(D,{value:"none",children:"No PRD"}),w.map(m=>e.jsxs(D,{value:m.id,children:[m.featureName," (v",m.version,")"]},m.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"status",children:"Status"}),e.jsxs(G,{value:p,onValueChange:m=>h(m),children:[e.jsx(Q,{children:e.jsx(W,{})}),e.jsxs(X,{children:[e.jsx(D,{value:"backlog",children:"Backlog"}),e.jsx(D,{value:"queue",children:"Queue"}),e.jsx(D,{value:"in_progress",children:"In Progress"}),e.jsx(D,{value:"done",children:"Done"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"priority",children:"Priority"}),e.jsxs(G,{value:String(b),onValueChange:m=>c(Number(m)),children:[e.jsx(Q,{children:e.jsx(W,{})}),e.jsxs(X,{children:[e.jsx(D,{value:"1",children:"High"}),e.jsx(D,{value:"2",children:"Medium"}),e.jsx(D,{value:"3",children:"Low"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"area",children:"Area"}),e.jsxs(G,{value:E,onValueChange:m=>z(m),children:[e.jsx(Q,{children:e.jsx(W,{})}),e.jsxs(X,{children:[e.jsx(D,{value:"wellfy",children:"Wellfy"}),e.jsx(D,{value:"freelance",children:"Freelance"}),e.jsx(D,{value:"personal",children:"Personal"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"dueDate",children:"Due Date"}),e.jsx(te,{id:"dueDate",type:"date",value:U,onChange:m=>Z(m.target.value),className:"h-10"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{children:"Tags"}),e.jsx(Nt,{selectedIds:R,onChange:B})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(L,{htmlFor:"assignJames",className:"text-sm font-medium",children:"Assign to James"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"James will pick up this task automatically"})]})]}),e.jsx(mt,{id:"assignJames",checked:T==="james",onCheckedChange:m=>A(m?"james":null)})]})]}),e.jsxs(Le,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsx("div",{className:"flex gap-1.5",children:F&&e.jsxs(e.Fragment,{children:[e.jsx(J,{type:"button",variant:"destructive",size:"sm",onClick:()=>y(!0),children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(J,{type:"button",variant:"outline",size:"sm",onClick:ee,children:e.jsx(pt,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx(J,{type:"button",variant:"outline",size:"sm",onClick:u,children:"Cancel"}),e.jsx(J,{type:"submit",size:"sm",children:F?"Save":"Create"})]})]})]}),e.jsx(Be,{open:_,onOpenChange:y,title:"Delete task?",description:"This will permanently delete this task. This action cannot be undone.",onConfirm:I})]})})}const je=[{id:"backlog",title:"Backlog"},{id:"queue",title:"Queue"},{id:"in_progress",title:"In Progress"},{id:"done",title:"Done"}];function Lt(){const[a,t]=i.useState(null),[s,o]=i.useState(null),[u,g]=i.useState(!1),[l,n]=i.useState(null),d=i.useRef(null),[j,w]=i.useState({}),{moveTaskLocal:k,persistColumnOrder:v}=V(),N=Xe(),C=ft(f=>f.trigger),{loadTaskTags:r}=Y(),x=i.useRef([]),p=N.map(f=>f.id).join(",");i.useEffect(()=>{const f=N.map(T=>T.id);if(f.length===0)return;(async()=>{try{const T=await q.getSubtaskCounts(f);w(T)}catch(T){console.error("Failed to fetch subtask counts:",T)}})(),r(f)},[p]);const h=Ne(ie(Se,{activationConstraint:{distance:8}}),ie(ke,{coordinateGetter:we})),b=i.useMemo(()=>{const f={backlog:[],queue:[],in_progress:[],done:[]};return N.forEach(S=>{f[S.status].push(S)}),Object.keys(f).forEach(S=>{f[S].sort((T,A)=>T.sortOrder-A.sortOrder)}),f},[N]),c=f=>{const S=N.find(T=>T.id===f.active.id);S&&(t(S),d.current=S.status,x.current=V.getState().tasks)},E=f=>{const{active:S,over:T}=f;if(!T)return;const A=S.id,R=T.id,B=N.find(y=>y.id===A);if(!B)return;if(je.some(y=>y.id===R)){const y=R;if(B.status!==y){const F=b[y];k(A,y,F.length)}}else{const y=N.find(F=>F.id===R);if(y&&B.status!==y.status){const K=b[y.status].findIndex(I=>I.id===R);k(A,y.status,K)}}},z=f=>{const{active:S,over:T}=f,A=d.current,R=S.id,B=x.current;t(null),d.current=null,x.current=[];const _=V.getState().tasks,y=_.find(F=>F.id===R);if((y==null?void 0:y.status)==="done"&&A!=="done"&&C(),T){const F=T.id;if(R!==F){const K=_.find(I=>I.id===F);if(K&&y&&y.status===K.status){const I=_.filter(O=>O.status===y.status).sort((O,$)=>O.sortOrder-$.sortOrder),ee=I.findIndex(O=>O.id===R),m=I.findIndex(O=>O.id===F);ee!==m&&k(R,y.status,m)}}}if(y&&(v(R,y.status,B),A&&A!==y.status)){const K=V.getState().tasks.filter(I=>I.status===A).sort((I,ee)=>I.sortOrder-ee.sortOrder).map(I=>I.id);K.length>0&&Ye.reorderTasks(K,A).catch(I=>{console.error("Failed to persist source column order:",I)})}},U=f=>{n(f),o(null),g(!0)},Z=f=>{o(f),n(null),g(!0)},ae=()=>{g(!1),o(null),n(null)},H=async f=>{try{const{updateTask:S}=V.getState();S(f.id,{assignee:"james"}),await q.triggerJames(),P.success(`Assigned "${f.title}" to James`,{description:"James will start working on it shortly"})}catch(S){console.error("Failed to assign to James:",S),P.error("Failed to assign task to James")}};return e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{sensors:h,collisionDetection:st,onDragStart:c,onDragOver:E,onDragEnd:z,children:[e.jsx("div",{className:"flex flex-col gap-4 sm:grid sm:grid-cols-2 lg:grid-cols-4",children:je.map(f=>e.jsx("div",{className:"w-full",children:e.jsx(Pt,{id:f.id,title:f.title,tasks:b[f.id],onAddTask:U,onEditTask:Z,onAssignToJames:H,subtaskCounts:j})},f.id))}),e.jsx(at,{children:a?e.jsx(_e,{task:a,onEdit:()=>{},isDragging:!0,subtaskCounts:j[a.id]}):null})]}),e.jsx($e,{open:u,onOpenChange:g,task:s,defaultStatus:l,onClose:ae})]})}function zt(){const{filter:a,setFilter:t}=V();return e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 sm:max-w-sm",children:[e.jsx(jt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(te,{placeholder:"Search tasks...",value:a.search,onChange:s=>t({search:s.target.value}),className:"pl-9"})]}),e.jsxs(G,{value:a.area,onValueChange:s=>t({area:s}),children:[e.jsx(Q,{className:"w-[150px]",children:e.jsx(W,{placeholder:"All areas"})}),e.jsxs(X,{children:[e.jsx(D,{value:"all",children:"All Areas"}),e.jsx(D,{value:"wellfy",children:"Wellfy"}),e.jsx(D,{value:"freelance",children:"Freelance"}),e.jsx(D,{value:"personal",children:"Personal"})]})]}),e.jsx(kt,{})]})}function xs(){const[a,t]=i.useState(!1),[s,o]=i.useState(!1),[u,g]=i.useState(!1),l=()=>{t(!0)},n=()=>{t(!1)},d=async()=>{g(!0);try{await q.triggerJames(),P.success("James is checking for new tasks...",{description:"He'll start working on any assigned tasks.",icon:"ðŸ¤–"})}catch{P.error("Failed to ping James")}finally{g(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Tasks"})}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("button",{onClick:d,disabled:u,className:"relative inline-flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-black bg-white border border-transparent rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden group",children:[e.jsx("span",{className:"absolute inset-0 rounded-md p-[2px] bg-gradient-to-r from-pink-500 via-purple-500 via-blue-500 via-cyan-500 via-green-500 via-yellow-500 to-pink-500 bg-[length:400%_100%] animate-shimmer"}),e.jsx("span",{className:"absolute inset-[2px] rounded-[4px] bg-white"}),e.jsxs("span",{className:"relative flex items-center gap-2",children:[u?e.jsx(Ze,{className:"h-4 w-4 animate-spin"}):e.jsx(oe,{className:"h-4 w-4"}),"James"]})]}),e.jsx(J,{variant:"outline",size:"icon",onClick:()=>o(!0),title:"Manage Tags",children:e.jsx(Ke,{className:"h-4 w-4"})}),e.jsxs(J,{onClick:l,className:"flex-1 sm:flex-none",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Add Task"]})]})]}),e.jsx(zt,{}),e.jsx(Lt,{}),e.jsx($e,{open:a,onOpenChange:t,task:null,defaultStatus:"backlog",onClose:n}),e.jsx(St,{open:s,onOpenChange:o})]})}export{xs as TasksPage};
