import{r as n,j as e}from"./vendor-react-nkeu7MKf.js";import{j as z,k as R,l as J,X as Se,f as oe,m as ie,B as Ce,U as De,F as le,n as Z,u as K,o as Te,L as q,I as se,a as X,p as Fe,t as Ie,q as Oe}from"./index-DP60SsVT.js";import{u as de,a as ee,s as ce,K as ue,P as me,b as Ae,D as xe,c as Ee,S as ge,v as he,d as pe,C as fe,e as Pe,f as Re,g as Je}from"./vendor-dnd-CdmezjDq.js";import{C as ae}from"./chevron-right-q3rxsuDY.js";import{P as te}from"./plus-B92-fEQ-.js";import{G as je}from"./grip-vertical-B0CuJmZy.js";import{C as be,S as U,a as G,b as H,c as $,d as N}from"./select-DjBkBEgB.js";import{T as ve}from"./trash-2-B_FQoo9w.js";import{F as Le}from"./folder-open-DO3kHT6j.js";import{M as Me}from"./message-square-BPRFtboh.js";import{C as Be}from"./calendar-BG7ur_LW.js";import{E as qe}from"./ellipsis-Ck2HItdQ.js";import{f as ke}from"./vendor-date-fns-D0ugVOfH.js";import{D as ze,a as Ve,b as Ke,c as _e,d as Ue,e as Ge}from"./dialog-BCyKONoJ.js";import{T as He}from"./textarea-CnQgFZvv.js";import{S as $e}from"./switch-DcX7Imeh.js";import{C as We}from"./confirm-delete-dialog-CxF213AN.js";import{e as Qe,g as Xe,d as Ye}from"./markdown-DZSA0cWY.js";import{D as Ze}from"./download-wI4pjCxa.js";import{u as es}from"./confettiStore-Nn9TJzm8.js";import{S as ss}from"./search-B3YryGyJ.js";import"./vendor-markdown-zaQAhtrl.js";import"./vendor-recharts-COauwCrp.js";import"./vendor-radix-DCQ-pcr5.js";import"./vendor-floating-ui-_Y3uXdsy.js";import"./vendor-router-bCYKpmtI.js";import"./alert-dialog-BgdQTfgd.js";function ts(s){const r={};for(const[t,i]of Object.entries(s)){const h=t.replace(/_([a-z])/g,(p,f)=>f.toUpperCase());r[h]=i}return r}function re(s){const r=ts(s);return{id:r.id,taskId:r.taskId,title:r.title,completed:!!r.completed,sortOrder:r.sortOrder??0,createdAt:r.createdAt}}function as({taskId:s,enabled:r=!0}){const[t,i]=n.useState([]),[h,p]=n.useState(!1),[f,l]=n.useState(null),j=n.useRef(!1),b=n.useCallback(async()=>{if(!(!s||!r)){p(!0),l(null);try{const c=(await z.getSubtasks(s)).map(re);i(c),j.current=!0}catch(u){console.error("Failed to fetch subtasks:",u),l("Failed to load subtasks")}finally{p(!1)}}},[s,r]);n.useEffect(()=>{r&&!j.current&&b()},[r,b]),n.useEffect(()=>{j.current=!1,i([])},[s]);const E=n.useCallback(async u=>{if(!u.trim())return;const c=crypto.randomUUID(),d={id:c,taskId:s,title:u.trim(),completed:!1,sortOrder:t.length,createdAt:new Date().toISOString()};i(o=>[...o,d]);try{const o=await z.createSubtask(s,u.trim()),x=re(o);i(k=>k.map(S=>S.id===c?x:S))}catch(o){console.error("Failed to create subtask:",o),i(x=>x.filter(k=>k.id!==c)),R.error("Failed to add subtask")}},[s,t.length]),D=n.useCallback(async(u,c)=>{i(d=>d.map(o=>o.id===u?{...o,completed:c}:o));try{await z.updateSubtask(u,{completed:c?1:0})}catch(d){console.error("Failed to toggle subtask:",d),i(o=>o.map(x=>x.id===u?{...x,completed:!c}:x)),R.error("Failed to update subtask")}},[]),F=n.useCallback(async(u,c)=>{var o;if(!c.trim())return;const d=(o=t.find(x=>x.id===u))==null?void 0:o.title;i(x=>x.map(k=>k.id===u?{...k,title:c.trim()}:k));try{await z.updateSubtask(u,{title:c.trim()})}catch(x){console.error("Failed to update subtask:",x),d&&i(k=>k.map(S=>S.id===u?{...S,title:d}:S)),R.error("Failed to update subtask")}},[t]),w=n.useCallback(async u=>{const c=t;i(d=>d.filter(o=>o.id!==u));try{await z.deleteSubtask(u)}catch(d){console.error("Failed to delete subtask:",d),i(c),R.error("Failed to delete subtask")}},[t]),O=n.useCallback(async u=>{const c=t,d=u.map(o=>t.find(x=>x.id===o)).filter(o=>o!==void 0).map((o,x)=>({...o,sortOrder:x}));i(d);try{await z.reorderSubtasks(s,u)}catch(o){console.error("Failed to reorder subtasks:",o),i(c),R.error("Failed to reorder subtasks")}},[s,t]);return{subtasks:t,isLoading:h,error:f,addSubtask:E,toggleSubtask:D,updateSubtask:F,deleteSubtask:w,reorderSubtasks:O,refresh:b}}function rs({subtask:s,onToggle:r,onDelete:t}){const{attributes:i,listeners:h,setNodeRef:p,transform:f,transition:l,isDragging:j}=pe({id:s.id}),b={transform:fe.Transform.toString(f),transition:l};return e.jsxs("div",{ref:p,style:b,className:J("group flex items-center gap-2 py-1.5 px-1 rounded-md transition-colors",j&&"opacity-50 bg-muted",!j&&"hover:bg-muted/50"),children:[e.jsx("button",{className:"cursor-grab touch-none opacity-0 group-hover:opacity-60 transition-opacity shrink-0",...i,...h,children:e.jsx(je,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsx("button",{onClick:()=>r(s.id,!s.completed),className:J("shrink-0 w-4 h-4 rounded-full border-2 flex items-center justify-center transition-all duration-200",s.completed?"bg-green-500 border-green-500":"border-muted-foreground/50 hover:border-green-500"),children:s.completed&&e.jsx(be,{className:"h-2.5 w-2.5 text-white",strokeWidth:3})}),e.jsx("span",{className:J("flex-1 text-sm transition-all",s.completed&&"text-muted-foreground line-through"),children:s.title}),e.jsx("button",{onClick:()=>t(s.id),className:"opacity-0 group-hover:opacity-60 hover:opacity-100 transition-opacity p-0.5 hover:text-destructive",children:e.jsx(ve,{className:"h-3.5 w-3.5"})})]})}function ns({onAdd:s,onCancel:r}){const[t,i]=n.useState(""),h=n.useRef(null);n.useEffect(()=>{var l;(l=h.current)==null||l.focus()},[]);const p=()=>{t.trim()&&(s(t.trim()),i(""))},f=l=>{l.key==="Enter"?(l.preventDefault(),p()):l.key==="Escape"&&r()};return e.jsxs("div",{className:"flex items-center gap-2 py-1.5 px-1",children:[e.jsx("div",{className:"w-3.5"})," ",e.jsx("div",{className:"shrink-0 w-4 h-4 rounded-full border-2 border-muted-foreground/30"}),e.jsx("input",{ref:h,type:"text",value:t,onChange:l=>i(l.target.value),onKeyDown:f,onBlur:()=>{t.trim()||r()},placeholder:"Add subtask...",className:"flex-1 text-sm bg-transparent border-none outline-none placeholder:text-muted-foreground/50"}),e.jsx("button",{onClick:p,className:"p-0.5 text-green-500 hover:text-green-600 transition-colors",disabled:!t.trim(),children:e.jsx(be,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:r,className:"p-0.5 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(Se,{className:"h-3.5 w-3.5"})})]})}function os({taskId:s,counts:r,onCountChange:t}){const[i,h]=n.useState(!1),[p,f]=n.useState(!1),{subtasks:l,isLoading:j,addSubtask:b,toggleSubtask:E,deleteSubtask:D,reorderSubtasks:F}=as({taskId:s,enabled:i});n.useEffect(()=>{if(t&&l.length>0){const d={total:l.length,completed:l.filter(o=>o.completed).length};t(d)}},[l,t]);const w=de(ee(me,{activationConstraint:{distance:5}}),ee(ue,{coordinateGetter:ce})),O=n.useCallback(d=>{const{active:o,over:x}=d;if(!x||o.id===x.id)return;const k=l.findIndex(A=>A.id===o.id),S=l.findIndex(A=>A.id===x.id);if(k!==S){const A=Ae(l,k,S);F(A.map(_=>_.id))}},[l,F]),u=n.useCallback(async d=>{await b(d)},[b]),c=i?{total:l.length,completed:l.filter(d=>d.completed).length}:r||{total:0,completed:0};return!i&&c.total===0?null:e.jsxs("div",{className:"mt-2",children:[!i&&c.total>0&&e.jsxs("button",{onClick:()=>h(!0),className:J("inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-colors","bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400","hover:bg-slate-200 dark:hover:bg-slate-700"),children:[e.jsx(ae,{className:"h-3 w-3"}),e.jsxs("span",{children:[c.completed,"/",c.total," Sub-Tasks"]})]}),i&&e.jsxs("div",{className:"rounded-lg border bg-card/50 p-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("button",{onClick:()=>h(!1),className:"text-xs font-medium text-muted-foreground hover:text-foreground flex items-center gap-1 transition-colors",children:[e.jsx(ae,{className:"h-3 w-3 rotate-90"}),"Subtasks"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[c.completed,"/",c.total]})]}),j&&l.length===0?e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"Loading..."}):e.jsx(xe,{sensors:w,collisionDetection:Ee,onDragEnd:O,children:e.jsx(ge,{items:l.map(d=>d.id),strategy:he,children:e.jsx("div",{className:"space-y-0.5",children:l.map(d=>e.jsx(rs,{subtask:d,onToggle:E,onDelete:D},d.id))})})}),p?e.jsx(ns,{onAdd:u,onCancel:()=>f(!1)}):e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 py-1.5 px-1 mt-1 text-xs text-muted-foreground hover:text-foreground transition-colors w-full",children:[e.jsx("div",{className:"w-3.5"}),e.jsx(te,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Add subtask"})]})]})]})}const is={1:"bg-destructive/20 text-destructive",2:"bg-warning/20 text-warning",3:"bg-muted text-muted-foreground"},ls={wellfy:"bg-blue-500/20 text-blue-600 dark:text-blue-400",freelance:"bg-green-500/20 text-green-600 dark:text-green-400",personal:"bg-purple-500/20 text-purple-600 dark:text-purple-400"},ye=["bg-orange-500/20 text-orange-700 dark:text-orange-400","bg-emerald-500/20 text-emerald-700 dark:text-emerald-400","bg-violet-500/20 text-violet-700 dark:text-violet-400","bg-rose-500/20 text-rose-700 dark:text-rose-400","bg-cyan-500/20 text-cyan-700 dark:text-cyan-400","bg-amber-500/20 text-amber-700 dark:text-amber-400","bg-fuchsia-500/20 text-fuchsia-700 dark:text-fuchsia-400","bg-sky-600/20 text-sky-700 dark:text-sky-300"];function ds(s){let r=2166136261;for(let t=0;t<s.length;t++)r^=s.charCodeAt(t),r=r*16777619>>>0;return r%ye.length}function Ne({task:s,onEdit:r,onAssignToJames:t,isDragging:i,subtaskCounts:h}){var d;const{projects:p}=oe(),{prds:f}=ie(),l=s.projectId?p.find(o=>o.id===s.projectId):null,j=s.prdId?f.find(o=>o.id===s.prdId):null,{attributes:b,listeners:E,setNodeRef:D,transform:F,transition:w,isDragging:O}=pe({id:s.id}),u={transform:fe.Transform.toString(F),transition:w},c=i||O;return e.jsx("div",{ref:D,style:u,className:J("group rounded-lg border bg-card p-3 shadow-sm transition-all",c&&"opacity-50 shadow-lg ring-2 ring-primary",!c&&"hover:shadow-md"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("button",{className:"mt-0.5 cursor-grab touch-none opacity-0 transition-opacity group-hover:opacity-100",...b,...E,children:e.jsx(je,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("button",{onClick:()=>r(s),className:"text-left w-full",children:e.jsx("h4",{className:"font-medium text-sm leading-tight hover:text-primary transition-colors",children:s.title})}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:s.description}),e.jsx(os,{taskId:s.id,counts:h}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.jsxs(Ce,{variant:"secondary",className:J("text-xs capitalize inline-flex items-center gap-1",ls[s.area]),children:[e.jsx(De,{className:"h-3 w-3"}),s.area]}),l&&e.jsxs("span",{className:J("inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium max-w-[140px]",ye[ds(l.name)]),title:l.name,children:[e.jsx(Le,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:l.name})]}),j&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-teal-500/20 text-teal-700 dark:text-teal-400 max-w-[140px]",title:`PRD: ${j.featureName}`,children:[e.jsx(le,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:j.featureName})]}),s.assignee==="james"&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-indigo-500/20 text-indigo-700 dark:text-indigo-400",title:"Assigned to James",children:[e.jsx(Z,{className:"h-3 w-3 shrink-0"}),"James"]}),!!s.quickCapture&&((d=s.createdBy)==null?void 0:d.includes("@"))&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-pink-500/20 text-pink-700 dark:text-pink-400",title:`Client request from ${s.createdBy}`,children:[e.jsx(Me,{className:"h-3 w-3 shrink-0"}),"Request"]}),e.jsx("span",{className:J("inline-flex items-center rounded px-1.5 py-0.5 text-xs font-medium",is[s.priority]),children:s.priority===1?"High":s.priority===2?"Med":"Low"}),s.dueDate&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Be,{className:"h-3 w-3"}),ke(new Date(s.dueDate),"MMM d")]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[s.assignee!=="james"&&t&&e.jsx("button",{onClick:o=>{o.stopPropagation(),t(s)},className:"p-1 rounded hover:bg-indigo-100 dark:hover:bg-indigo-900/30 transition-colors",title:"Assign to James",children:e.jsx(Z,{className:"h-4 w-4 text-indigo-600 dark:text-indigo-400"})}),e.jsx("button",{onClick:()=>r(s),className:"p-1 rounded hover:bg-muted transition-colors",children:e.jsx(qe,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"})})]})]})})}const cs={backlog:"border-t-slate-400",queue:"border-t-blue-400",in_progress:"border-t-amber-400",done:"border-t-green-400"};function us({id:s,title:r,tasks:t,onAddTask:i,onEditTask:h,onAssignToJames:p,subtaskCounts:f}){const{setNodeRef:l,isOver:j}=Pe({id:s});return e.jsxs("div",{className:J("flex flex-col rounded-lg border border-t-4 bg-muted/30",cs[s]),children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:r}),e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-muted px-2 py-0.5 text-xs font-medium text-muted-foreground",children:t.length})]}),e.jsx("button",{onClick:()=>i(s),className:"rounded p-1 hover:bg-accent transition-colors",title:"Add task",children:e.jsx(te,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsxs("div",{ref:l,className:J("flex-1 p-2 space-y-2 min-h-[200px] transition-colors",j&&"bg-accent/50"),children:[e.jsx(ge,{items:t.map(b=>b.id),strategy:he,children:t.map(b=>e.jsx(Ne,{task:b,onEdit:h,onAssignToJames:p,subtaskCounts:f==null?void 0:f[b.id]},b.id))}),t.length===0&&e.jsx("div",{className:"flex items-center justify-center h-20 text-sm text-muted-foreground",children:"No tasks"})]})]})}function we({open:s,onOpenChange:r,task:t,defaultStatus:i,onClose:h}){const{addTask:p,updateTask:f,deleteTask:l}=K(),{projects:j}=oe(),{clients:b}=Te(),{prds:E}=ie(),[D,F]=n.useState(""),[w,O]=n.useState(""),[u,c]=n.useState("backlog"),[d,o]=n.useState(2),[x,k]=n.useState("freelance"),[S,A]=n.useState(""),[_,W]=n.useState(void 0),[m,v]=n.useState(void 0),[y,C]=n.useState(null),[I,L]=n.useState(!1),P=!!t;n.useEffect(()=>{t?(F(t.title),O(t.description||""),c(t.status),o(t.priority),k(t.area),A(t.dueDate?ke(new Date(t.dueDate),"yyyy-MM-dd"):""),W(t.projectId),v(t.prdId),C(t.assignee||null)):(F(""),O(""),c(i||"backlog"),o(2),k("freelance"),A(""),W(void 0),v(void 0),C(null))},[t,i,s]);const g=a=>{if(a.preventDefault(),!D.trim())return;const V={title:D.trim(),description:w.trim()||void 0,status:u,priority:d,area:x,dueDate:S?new Date(S).toISOString():void 0,projectId:_,prdId:m,assignee:y};P&&t?f(t.id,V):p(V),h()},T=()=>{t&&(l(t.id),L(!1),h())},M=()=>{if(!t)return;const a=t.projectId?j.find(Q=>Q.id===t.projectId):void 0,V=a!=null&&a.clientId?b.find(Q=>Q.id===a.clientId):void 0,Y=Qe(t,{project:a,client:V}),B=Xe(t.title);Ye(Y,B),R.success(`Exported "${t.title}" to markdown`)};return e.jsx(ze,{open:s,onOpenChange:r,children:e.jsxs(Ve,{className:"w-[calc(100vw-2rem)] max-w-[500px] max-h-[90vh] overflow-y-auto overflow-x-hidden",children:[e.jsxs("form",{onSubmit:g,children:[e.jsxs(Ke,{children:[e.jsx(_e,{children:P?"Edit Task":"New Task"}),e.jsx(Ue,{children:P?"Update the task details below.":"Create a new task by filling out the form below."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{htmlFor:"title",children:"Title"}),e.jsx(se,{id:"title",value:D,onChange:a=>F(a.target.value),placeholder:"Task title...",autoFocus:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{htmlFor:"description",children:"Description"}),e.jsx(He,{id:"description",value:w,onChange:a=>O(a.target.value),placeholder:"Add details...",rows:3})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{htmlFor:"project",children:"Project"}),e.jsxs(U,{value:_||"none",onValueChange:a=>W(a==="none"?void 0:a),children:[e.jsx(G,{children:e.jsx(H,{placeholder:"Select a project..."})}),e.jsxs($,{children:[e.jsx(N,{value:"none",children:"No project"}),j.map(a=>e.jsx(N,{value:a.id,children:a.name},a.id))]})]})]}),E.length>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(q,{htmlFor:"prd",className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"PRD"]}),e.jsxs(U,{value:m||"none",onValueChange:a=>v(a==="none"?void 0:a),children:[e.jsx(G,{children:e.jsx(H,{placeholder:"Link to a PRD..."})}),e.jsxs($,{children:[e.jsx(N,{value:"none",children:"No PRD"}),E.map(a=>e.jsxs(N,{value:a.id,children:[a.featureName," (v",a.version,")"]},a.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{htmlFor:"status",children:"Status"}),e.jsxs(U,{value:u,onValueChange:a=>c(a),children:[e.jsx(G,{children:e.jsx(H,{})}),e.jsxs($,{children:[e.jsx(N,{value:"backlog",children:"Backlog"}),e.jsx(N,{value:"queue",children:"Queue"}),e.jsx(N,{value:"in_progress",children:"In Progress"}),e.jsx(N,{value:"done",children:"Done"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{htmlFor:"priority",children:"Priority"}),e.jsxs(U,{value:String(d),onValueChange:a=>o(Number(a)),children:[e.jsx(G,{children:e.jsx(H,{})}),e.jsxs($,{children:[e.jsx(N,{value:"1",children:"High"}),e.jsx(N,{value:"2",children:"Medium"}),e.jsx(N,{value:"3",children:"Low"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{htmlFor:"area",children:"Area"}),e.jsxs(U,{value:x,onValueChange:a=>k(a),children:[e.jsx(G,{children:e.jsx(H,{})}),e.jsxs($,{children:[e.jsx(N,{value:"wellfy",children:"Wellfy"}),e.jsx(N,{value:"freelance",children:"Freelance"}),e.jsx(N,{value:"personal",children:"Personal"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{htmlFor:"dueDate",children:"Due Date"}),e.jsx(se,{id:"dueDate",type:"date",value:S,onChange:a=>A(a.target.value),className:"h-10"})]})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(q,{htmlFor:"assignJames",className:"text-sm font-medium",children:"Assign to James"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"James will pick up this task automatically"})]})]}),e.jsx($e,{id:"assignJames",checked:y==="james",onCheckedChange:a=>C(a?"james":null)})]})]}),e.jsxs(Ge,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsx("div",{className:"flex gap-1.5",children:P&&e.jsxs(e.Fragment,{children:[e.jsx(X,{type:"button",variant:"destructive",size:"sm",onClick:()=>L(!0),children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx(X,{type:"button",variant:"outline",size:"sm",onClick:M,children:e.jsx(Ze,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx(X,{type:"button",variant:"outline",size:"sm",onClick:h,children:"Cancel"}),e.jsx(X,{type:"submit",size:"sm",children:P?"Save":"Create"})]})]})]}),e.jsx(We,{open:I,onOpenChange:L,title:"Delete task?",description:"This will permanently delete this task. This action cannot be undone.",onConfirm:T})]})})}const ne=[{id:"backlog",title:"Backlog"},{id:"queue",title:"Queue"},{id:"in_progress",title:"In Progress"},{id:"done",title:"Done"}];function ms(){const[s,r]=n.useState(null),[t,i]=n.useState(null),[h,p]=n.useState(!1),[f,l]=n.useState(null),j=n.useRef(null),[b,E]=n.useState({}),{moveTaskLocal:D,persistColumnOrder:F}=K(),w=Fe(),O=es(m=>m.trigger),u=n.useRef([]);n.useEffect(()=>{const m=w.map(y=>y.id);if(m.length===0)return;(async()=>{try{const y=await z.getSubtaskCounts(m);E(y)}catch(y){console.error("Failed to fetch subtask counts:",y)}})()},[w.map(m=>m.id).join(",")]);const c=de(ee(me,{activationConstraint:{distance:8}}),ee(ue,{coordinateGetter:ce})),d=n.useMemo(()=>{const m={backlog:[],queue:[],in_progress:[],done:[]};return w.forEach(v=>{m[v.status].push(v)}),Object.keys(m).forEach(v=>{m[v].sort((y,C)=>y.sortOrder-C.sortOrder)}),m},[w]),o=m=>{const v=w.find(y=>y.id===m.active.id);v&&(r(v),j.current=v.status,u.current=K.getState().tasks)},x=m=>{const{active:v,over:y}=m;if(!y)return;const C=v.id,I=y.id,L=w.find(g=>g.id===C);if(!L)return;if(ne.some(g=>g.id===I)){const g=I;if(L.status!==g){const T=d[g];D(C,g,T.length)}}else{const g=w.find(T=>T.id===I);if(g&&L.status!==g.status){const M=d[g.status].findIndex(a=>a.id===I);D(C,g.status,M)}}},k=m=>{const{active:v,over:y}=m,C=j.current,I=v.id,L=u.current;r(null),j.current=null,u.current=[];const P=K.getState().tasks,g=P.find(T=>T.id===I);if((g==null?void 0:g.status)==="done"&&C!=="done"&&O(),y){const T=y.id;if(I!==T){const M=P.find(a=>a.id===T);if(M&&g&&g.status===M.status){const a=P.filter(B=>B.status===g.status).sort((B,Q)=>B.sortOrder-Q.sortOrder),V=a.findIndex(B=>B.id===I),Y=a.findIndex(B=>B.id===T);V!==Y&&D(I,g.status,Y)}}}if(g&&(F(I,g.status,L),C&&C!==g.status)){const M=K.getState().tasks.filter(a=>a.status===C).sort((a,V)=>a.sortOrder-V.sortOrder).map(a=>a.id);M.length>0&&Ie.reorderTasks(M,C).catch(a=>{console.error("Failed to persist source column order:",a)})}},S=m=>{l(m),i(null),p(!0)},A=m=>{i(m),l(null),p(!0)},_=()=>{p(!1),i(null),l(null)},W=async m=>{try{const{updateTask:v}=K.getState();v(m.id,{assignee:"james"}),await z.triggerJames(),R.success(`Assigned "${m.title}" to James`,{description:"James will start working on it shortly"})}catch(v){console.error("Failed to assign to James:",v),R.error("Failed to assign task to James")}};return e.jsxs(e.Fragment,{children:[e.jsxs(xe,{sensors:c,collisionDetection:Re,onDragStart:o,onDragOver:x,onDragEnd:k,children:[e.jsx("div",{className:"flex flex-col gap-4 sm:grid sm:grid-cols-2 lg:grid-cols-4",children:ne.map(m=>e.jsx("div",{className:"w-full",children:e.jsx(us,{id:m.id,title:m.title,tasks:d[m.id],onAddTask:S,onEditTask:A,onAssignToJames:W,subtaskCounts:b})},m.id))}),e.jsx(Je,{children:s?e.jsx(Ne,{task:s,onEdit:()=>{},isDragging:!0,subtaskCounts:b[s.id]}):null})]}),e.jsx(we,{open:h,onOpenChange:p,task:t,defaultStatus:f,onClose:_})]})}function xs(){const{filter:s,setFilter:r}=K();return e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 sm:max-w-sm",children:[e.jsx(ss,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(se,{placeholder:"Search tasks...",value:s.search,onChange:t=>r({search:t.target.value}),className:"pl-9"})]}),e.jsxs(U,{value:s.area,onValueChange:t=>r({area:t}),children:[e.jsx(G,{className:"w-[150px]",children:e.jsx(H,{placeholder:"All areas"})}),e.jsxs($,{children:[e.jsx(N,{value:"all",children:"All Areas"}),e.jsx(N,{value:"wellfy",children:"Wellfy"}),e.jsx(N,{value:"freelance",children:"Freelance"}),e.jsx(N,{value:"personal",children:"Personal"})]})]})]})}function zs(){const[s,r]=n.useState(!1),[t,i]=n.useState(!1),h=()=>{r(!0)},p=()=>{r(!1)},f=async()=>{i(!0);try{await z.triggerJames(),R.success("James is checking for new tasks...",{description:"He'll start working on any assigned tasks.",icon:"ðŸ¤–"})}catch{R.error("Failed to ping James")}finally{i(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Tasks"})}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("button",{onClick:f,disabled:t,className:"relative inline-flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-black bg-white border border-transparent rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden group",children:[e.jsx("span",{className:"absolute inset-0 rounded-md p-[2px] bg-gradient-to-r from-pink-500 via-purple-500 via-blue-500 via-cyan-500 via-green-500 via-yellow-500 to-pink-500 bg-[length:400%_100%] animate-shimmer"}),e.jsx("span",{className:"absolute inset-[2px] rounded-[4px] bg-white"}),e.jsxs("span",{className:"relative flex items-center gap-2",children:[t?e.jsx(Oe,{className:"h-4 w-4 animate-spin"}):e.jsx(Z,{className:"h-4 w-4"}),"James"]})]}),e.jsxs(X,{onClick:h,className:"flex-1 sm:flex-none",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Add Task"]})]})]}),e.jsx(xs,{}),e.jsx(ms,{}),e.jsx(we,{open:s,onOpenChange:r,task:null,defaultStatus:"backlog",onClose:p})]})}export{zs as TasksPage};
