const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DV0Z4ueH.js","assets/core-BDPGcIsz.js","assets/index-CDjnCujr.js","assets/path-E9zjYLSN.js"])))=>i.map(i=>d[i]);
import{r as f,j as e}from"./vendor-react-nkeu7MKf.js";import{T as Ce,a as Re,b as O,c as P}from"./tabs-C_yawzbB.js";import{S as ie,a as ue,b as de,c as me,d as xe}from"./select-Xdan6Flm.js";import{c as he,a8 as q,a9 as tt,j as v,a as $,B as je,aa as st,F as nt,P as be,Q as at,_ as le}from"./index-VWTpo9YE.js";import{T as Z,a as J,b as A,c as k,d as X,e as p}from"./table-Cuei_Pb9.js";import{g as G}from"./db-D1pgn3FH.js";import{j as rt,m as ct,n as lt,g as ot}from"./assets-CoyEmPBv.js";import{a as w,H as it}from"./index-uXN-dP3D.js";import{D as ut}from"./download-DY_rwJ5C.js";import{C as T,a as F,b as M,c as V}from"./card-FMWgtjin.js";import{z as dt,B as mt,E as xt,F as ht,G as ft,H as gt,J as Ne}from"./vendor-radix-Oq5tdvA1.js";import{g as pt}from"./income-CsK-LGVk.js";import{g as jt}from"./expenses-BvicC8HB.js";import"./vendor-markdown-zaQAhtrl.js";import"./vendor-recharts-COauwCrp.js";import"./vendor-router-bCYKpmtI.js";import"./vendor-floating-ui-_Y3uXdsy.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=he("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=he("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=he("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),W=(t,s)=>tt.request(t,s);function ee(t,s){const n=(s-1)*3,a=new Date(t,n,1),o=new Date(t,n+3,0);return{startDate:a,endDate:o}}function Ve(t){return{id:t.id,date:new Date(t.date),clientId:t.client_id??void 0,invoiceId:t.invoice_id??void 0,description:t.description,netAmount:t.net_amount,vatRate:t.vat_rate,vatAmount:t.vat_amount,grossAmount:t.gross_amount,euerLine:t.euer_line??14,euerCategory:t.euer_category??"services",paymentMethod:t.payment_method,bankReference:t.bank_reference??void 0,ustPeriod:t.ust_period??void 0,ustReported:t.ust_reported===1,createdAt:new Date(t.created_at)}}function Le(t){return{id:t.id,date:new Date(t.date),vendor:t.vendor,description:t.description,netAmount:t.net_amount,vatRate:t.vat_rate,vatAmount:t.vat_amount,grossAmount:t.gross_amount,euerLine:t.euer_line,euerCategory:t.euer_category,deductiblePercent:t.deductible_percent,paymentMethod:t.payment_method,receiptPath:t.receipt_path??void 0,isRecurring:t.is_recurring===1,recurringFrequency:t.recurring_frequency,ustPeriod:t.ust_period??void 0,vorsteuerClaimed:t.vorsteuer_claimed===1,isGwg:t.is_gwg===1,assetId:t.asset_id??void 0,createdAt:new Date(t.created_at)}}async function Nt(t,s){const{startDate:n,endDate:a}=ee(t,s);return(await(await G()).select(`SELECT * FROM income
     WHERE date >= $1 AND date <= $2
     ORDER BY date DESC`,[n.toISOString().split("T")[0],a.toISOString().split("T")[0]])).map(Ve)}async function vt(t,s){const{startDate:n,endDate:a}=ee(t,s);return(await(await G()).select(`SELECT * FROM expenses
     WHERE date >= $1 AND date <= $2
     ORDER BY date DESC`,[n.toISOString().split("T")[0],a.toISOString().split("T")[0]])).map(Le)}async function At(t){const s=new Date(t,0,1),n=new Date(t,11,31);return(await(await G()).select(`SELECT * FROM income
     WHERE date >= $1 AND date <= $2
     ORDER BY date DESC`,[s.toISOString().split("T")[0],n.toISOString().split("T")[0]])).map(Ve)}async function Dt(t){const s=new Date(t,0,1),n=new Date(t,11,31);return(await(await G()).select(`SELECT * FROM expenses
     WHERE date >= $1 AND date <= $2
     ORDER BY date DESC`,[s.toISOString().split("T")[0],n.toISOString().split("T")[0]])).map(Le)}async function fe(t,s){if(!q()){const d=await W(`/api/reports/ust/${t}/${s}`);return{...d,startDate:new Date(d.startDate),endDate:new Date(d.endDate),filedDate:d.filedDate?new Date(d.filedDate):void 0}}const{startDate:n,endDate:a}=ee(t,s),o=await Nt(t,s),u=await vt(t,s),h=o.filter(d=>d.vatRate===19).reduce((d,c)=>d+c.vatAmount,0),b=o.filter(d=>d.vatRate===7).reduce((d,c)=>d+c.vatAmount,0),x=h+b,m=u.filter(d=>d.vorsteuerClaimed).reduce((d,c)=>d+c.vatAmount,0),i=x-m,j=d=>Math.round(d*100)/100;return{period:`${t}-Q${s}`,year:t,quarter:s,startDate:n,endDate:a,umsatzsteuer19:j(h),umsatzsteuer7:j(b),totalUmsatzsteuer:j(x),vorsteuer:j(m),zahllast:j(i),status:"draft"}}async function yt(t){if(!q())return(await W(`/api/reports/ust/${t}`)).map(o=>({...o,startDate:new Date(o.startDate),endDate:new Date(o.endDate),filedDate:o.filedDate?new Date(o.filedDate):void 0}));const s=[1,2,3,4];return await Promise.all(s.map(a=>fe(t,a)))}async function Et(t,s){if(!q()){const x=await W(`/api/reports/ust/${t}/${s}/file`,{method:"POST"});return{...x,startDate:new Date(x.startDate),endDate:new Date(x.endDate),filedDate:x.filedDate?new Date(x.filedDate):void 0}}const{startDate:n,endDate:a}=ee(t,s),o=await G(),u=n.toISOString().split("T")[0],h=a.toISOString().split("T")[0];return await o.execute("UPDATE income SET ust_reported = 1 WHERE date >= $1 AND date <= $2",[u,h]),await o.execute("UPDATE expenses SET vorsteuer_claimed = 1 WHERE date >= $1 AND date <= $2",[u,h]),{...await fe(t,s),status:"filed",filedDate:new Date}}async function wt(t){if(!q())return W(`/api/reports/euer/${t}`);const s=await At(t),n=await Dt(t),a=await rt(t),o={};for(const d of s){const c=d.euerLine;o[c]=(o[c]||0)+d.netAmount}const u={};for(const d of n){const c=d.euerLine,r=d.netAmount*(d.deductiblePercent/100);u[c]=(u[c]||0)+r}u[w.AFA]=(u[w.AFA]||0)+a;const h=await ct(t);h>0&&(o[w.ENTNAHME_VERKAUF]=(o[w.ENTNAHME_VERKAUF]||0)+h);const b=await lt(t);b>0&&(u[w.ANLAGENABGANG_VERLUST]=(u[w.ANLAGENABGANG_VERLUST]||0)+b),u[w.ARBEITSZIMMER]||(u[w.ARBEITSZIMMER]=it);const x=Object.values(o).reduce((d,c)=>d+c,0),m=Object.values(u).reduce((d,c)=>d+c,0),i=x-m,j=d=>Math.round(d*100)/100;for(const d of Object.keys(o))o[Number(d)]=j(o[Number(d)]);for(const d of Object.keys(u))u[Number(d)]=j(u[Number(d)]);return{year:t,income:o,expenses:u,totalIncome:j(x),totalExpenses:j(m),gewinn:j(i)}}function St(){return{income:[{line:w.BETRIEBSEINNAHMEN,name:"Betriebseinnahmen",description:"Standard taxable business income (19% or 7%)"},{line:w.ENTNAHME_VERKAUF,name:"Veräußerungsgewinne",description:"Gains from asset sales (selling price - book value)"},{line:w.UST_ERSTATTUNG,name:"USt-Erstattung",description:"VAT refunds from tax office"}],expenses:[{line:w.FREMDLEISTUNGEN,name:"Fremdleistungen",description:"Subcontractors, freelancers"},{line:w.VORSTEUER,name:"Vorsteuer",description:"Input VAT on purchases"},{line:w.GEZAHLTE_UST,name:"Gezahlte USt",description:"Output VAT paid to tax office"},{line:w.AFA,name:"AfA",description:"Depreciation of movable assets"},{line:w.ARBEITSZIMMER,name:"Arbeitszimmer",description:"Home office costs (Pauschale: €1,260/year)"},{line:w.SONSTIGE,name:"Sonstige",description:"Other fully deductible business expenses"},{line:w.ANLAGENABGANG_VERLUST,name:"Anlagenabgang (Verlust)",description:"Losses from asset disposals (remaining book value)"}]}}function kt(){const t=new Date().getMonth();return Math.floor(t/3)+1}function Ct(t={}){const{autoFetch:s=!0,year:n=new Date().getFullYear(),quarter:a=kt()}=t,[o,u]=f.useState(null),[h,b]=f.useState([]),[x,m]=f.useState(!1),[i,j]=f.useState(null),[d,c]=f.useState(n),[r,N]=f.useState(a),E=f.useCallback(async(g,l)=>{m(!0),j(null);try{const D=await fe(g,l);u(D)}catch(D){j(D instanceof Error?D.message:"Failed to fetch USt-Voranmeldung")}finally{m(!1)}},[]),C=f.useCallback(async g=>{m(!0),j(null);try{const l=await yt(g);b(l)}catch(l){j(l instanceof Error?l.message:"Failed to fetch quarterly data")}finally{m(!1)}},[]),B=f.useCallback(async(g,l)=>{m(!0),j(null);try{const D=await Et(g,l);u(D),b(I=>I.map(L=>L.year===g&&L.quarter===l?D:L))}catch(D){j(D instanceof Error?D.message:"Failed to mark as filed")}finally{m(!1)}},[]),y=f.useCallback(async()=>{await E(d,r)},[d,r,E]);return f.useEffect(()=>{s&&E(d,r)},[s,d,r,E]),{ustVoranmeldung:o,allQuarters:h,isLoading:x,error:i,selectedYear:d,selectedQuarter:r,setSelectedYear:c,setSelectedQuarter:N,fetchUstVoranmeldung:E,fetchAllQuarters:C,markAsFiled:B,refresh:y}}function Y(t){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)}function ne(t){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(t)}function Rt(){const t=new Date().getFullYear();return Array.from({length:6},(s,n)=>t-n)}function It({onPrint:t,className:s}){const{ustVoranmeldung:n,isLoading:a,error:o,selectedYear:u,selectedQuarter:h,setSelectedYear:b,setSelectedQuarter:x,markAsFiled:m}=Ct(),i=Rt(),j=()=>{t?t():window.print()},d=async()=>{n&&await m(n.year,n.quarter)};if(a)return e.jsxs("div",{className:v("space-y-6",s),children:[e.jsx("h2",{className:"text-xl font-semibold",children:"USt-Voranmeldung"}),e.jsx("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:"Laden..."})]});if(o)return e.jsxs("div",{className:v("space-y-6",s),children:[e.jsx("h2",{className:"text-xl font-semibold",children:"USt-Voranmeldung"}),e.jsxs("div",{className:"rounded-lg border border-destructive p-8 text-center text-destructive",children:["Fehler: ",o]})]});if(!n)return e.jsxs("div",{className:v("space-y-6",s),children:[e.jsx("h2",{className:"text-xl font-semibold",children:"USt-Voranmeldung"}),e.jsx("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:"Keine Daten verfügbar"})]});const c=n.zahllast<0;return e.jsxs("div",{className:v("space-y-6",s),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"USt-Voranmeldung"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs($,{variant:"outline",size:"sm",onClick:j,children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Drucken"]}),n.status==="draft"&&e.jsxs($,{size:"sm",onClick:d,children:[e.jsx(bt,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Als gemeldet markieren"}),e.jsx("span",{className:"sm:hidden",children:"Melden"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"year-select",className:"text-sm font-medium",children:"Jahr:"}),e.jsxs(ie,{value:String(u),onValueChange:r=>b(Number(r)),children:[e.jsx(ue,{id:"year-select",className:"w-[100px]",children:e.jsx(de,{})}),e.jsx(me,{children:i.map(r=>e.jsx(xe,{value:String(r),children:r},r))})]})]}),e.jsx(Ce,{value:`Q${h}`,onValueChange:r=>x(Number(r.replace("Q",""))),children:e.jsxs(Re,{children:[e.jsx(O,{value:"Q1",children:"Q1"}),e.jsx(O,{value:"Q2",children:"Q2"}),e.jsx(O,{value:"Q3",children:"Q3"}),e.jsx(O,{value:"Q4",children:"Q4"})]})})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between rounded-lg border p-3 sm:p-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Zeitraum"}),e.jsx("p",{className:"font-medium",children:n.period}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[ne(n.startDate)," –"," ",ne(n.endDate)]})]}),e.jsxs("div",{className:"sm:text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),n.status==="draft"?e.jsx(je,{variant:"secondary",children:"Entwurf"}):e.jsx(je,{variant:"default",children:"Gemeldet"}),n.filedDate&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:ne(n.filedDate)})]})]}),e.jsx("div",{className:"rounded-lg border overflow-x-auto",children:e.jsxs(Z,{className:"min-w-[400px]",children:[e.jsx(J,{children:e.jsxs(A,{children:[e.jsx(k,{className:"w-[300px]",children:"Position"}),e.jsx(k,{className:"text-right",children:"Betrag"})]})}),e.jsxs(X,{children:[e.jsx(A,{className:"bg-muted/30",children:e.jsx(p,{colSpan:2,className:"font-semibold",children:"Umsatzsteuer (Output VAT)"})}),e.jsxs(A,{children:[e.jsx(p,{className:"pl-8",children:"Umsatzsteuer 19%"}),e.jsx(p,{className:"text-right",children:Y(n.umsatzsteuer19)})]}),e.jsxs(A,{children:[e.jsx(p,{className:"pl-8",children:"Umsatzsteuer 7%"}),e.jsx(p,{className:"text-right",children:Y(n.umsatzsteuer7)})]}),e.jsxs(A,{className:"font-medium",children:[e.jsx(p,{className:"pl-8",children:"Summe Umsatzsteuer"}),e.jsx(p,{className:"text-right",children:Y(n.totalUmsatzsteuer)})]}),e.jsx(A,{className:"bg-muted/30",children:e.jsx(p,{colSpan:2,className:"font-semibold",children:"Vorsteuer (Input VAT)"})}),e.jsxs(A,{children:[e.jsx(p,{className:"pl-8",children:"Abziehbare Vorsteuer"}),e.jsx(p,{className:"text-right",children:Y(n.vorsteuer)})]}),e.jsxs(A,{className:"border-t-2 bg-muted font-bold",children:[e.jsxs(p,{children:["Zahllast"," ",c&&e.jsx("span",{className:"text-green-600 font-normal",children:"(Erstattung)"})]}),e.jsxs(p,{className:v("text-right",c?"text-green-600":"text-red-600"),children:[Y(Math.abs(n.zahllast)),c&&" (Erstattung)"]})]})]})]})}),e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Zahllast"}),": Umsatzsteuer − Vorsteuer"]}),e.jsxs("p",{children:["Positiver Betrag = Zahlung an das Finanzamt fällig",e.jsx("br",{}),"Negativer Betrag = Erstattung vom Finanzamt erwartet"]})]})]})}function Tt(t={}){const{autoFetch:s=!0,year:n=new Date().getFullYear()}=t,[a,o]=f.useState(null),[u,h]=f.useState(!1),[b,x]=f.useState(null),[m,i]=f.useState(n),j=f.useCallback(async r=>{h(!0),x(null);try{const N=await wt(r);o(N)}catch(N){x(N instanceof Error?N.message:"Failed to fetch EÜR report")}finally{h(!1)}},[]),d=f.useCallback(()=>St(),[]),c=f.useCallback(async()=>{await j(m)},[m,j]);return f.useEffect(()=>{s&&j(m)},[s,m,j]),{euerReport:a,isLoading:u,error:b,selectedYear:m,setSelectedYear:i,fetchEuerReport:j,getLineDetails:d,refresh:c}}function Q(t){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)}function Vt(){const t=new Date().getFullYear();return Array.from({length:6},(s,n)=>t-n)}function Lt({onPrint:t,onExport:s,className:n}){const{euerReport:a,isLoading:o,error:u,selectedYear:h,setSelectedYear:b,getLineDetails:x}=Tt(),m=Vt(),i=x(),j=()=>{t?t():window.print()},d=()=>{s&&s()};if(o)return e.jsxs("div",{className:v("space-y-6",n),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["EÜR ",h]}),e.jsx("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:"Laden..."})]});if(u)return e.jsxs("div",{className:v("space-y-6",n),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["EÜR ",h]}),e.jsxs("div",{className:"rounded-lg border border-destructive p-8 text-center text-destructive",children:["Fehler: ",u]})]});if(!a)return e.jsxs("div",{className:v("space-y-6",n),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["EÜR ",h]}),e.jsx("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:"Keine Daten verfügbar"})]});const c=a.gewinn>=0;return e.jsxs("div",{className:v("space-y-6",n),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["EÜR ",h]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs($,{variant:"outline",size:"sm",onClick:j,children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Drucken"]}),e.jsxs($,{variant:"outline",size:"sm",onClick:d,children:[e.jsx(ut,{className:"mr-2 h-4 w-4"}),"Export"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"year-select",className:"text-sm font-medium",children:"Jahr:"}),e.jsxs(ie,{value:String(h),onValueChange:r=>b(Number(r)),children:[e.jsx(ue,{id:"year-select",className:"w-[100px]",children:e.jsx(de,{})}),e.jsx(me,{children:m.map(r=>e.jsx(xe,{value:String(r),children:r},r))})]})]}),e.jsx("div",{className:"rounded-lg border overflow-x-auto",children:e.jsxs(Z,{className:"min-w-[500px]",children:[e.jsx(J,{children:e.jsxs(A,{children:[e.jsx(k,{className:"w-[100px]",children:"Zeile"}),e.jsx(k,{children:"Position"}),e.jsx(k,{className:"text-right",children:"Betrag"})]})}),e.jsxs(X,{children:[e.jsx(A,{className:"bg-muted/30",children:e.jsx(p,{colSpan:3,className:"font-semibold",children:"Einnahmen"})}),i.income.map(r=>e.jsxs(A,{children:[e.jsxs(p,{className:"font-mono text-sm",children:["Zeile ",r.line]}),e.jsx(p,{children:e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:r.name}),e.jsxs("span",{className:"text-muted-foreground text-sm ml-2",children:["(",r.description,")"]})]})}),e.jsx(p,{className:"text-right",children:Q(a.income[r.line]||0)})]},r.line)),e.jsxs(A,{className:"font-medium bg-muted/20",children:[e.jsx(p,{}),e.jsx(p,{children:"Summe Einnahmen"}),e.jsx(p,{className:"text-right",children:Q(a.totalIncome)})]}),e.jsx(A,{className:"bg-muted/30",children:e.jsx(p,{colSpan:3,className:"font-semibold",children:"Ausgaben"})}),i.expenses.map(r=>e.jsxs(A,{children:[e.jsxs(p,{className:"font-mono text-sm",children:["Zeile ",r.line]}),e.jsx(p,{children:e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:r.name}),e.jsxs("span",{className:"text-muted-foreground text-sm ml-2",children:["(",r.description,")"]})]})}),e.jsx(p,{className:"text-right",children:Q(a.expenses[r.line]||0)})]},r.line)),e.jsxs(A,{className:"font-medium bg-muted/20",children:[e.jsx(p,{}),e.jsx(p,{children:"Summe Ausgaben"}),e.jsx(p,{className:"text-right",children:Q(a.totalExpenses)})]}),e.jsxs(A,{className:"border-t-2 bg-muted font-bold",children:[e.jsx(p,{}),e.jsx(p,{children:c?"Gewinn":"Verlust"}),e.jsx(p,{className:v("text-right",c?"text-green-600":"text-red-600"),children:Q(Math.abs(a.gewinn))})]})]})]})}),e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Gewinn/Verlust"}),": Einnahmen − Ausgaben"]}),e.jsxs("p",{children:["Positiver Betrag = Gewinn (steuerpflichtiges Einkommen)",e.jsx("br",{}),"Negativer Betrag = Verlust (kann vorgetragen werden)"]})]})]})}function z(t){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)}function ve(t){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(t)}function _t(t){return{computer:"EDV/Computer",furniture:"Büromöbel",equipment:"Geräte",software:"Software",phone:"Telefon"}[t]||t}function Ft(t){return{active:"Aktiv",disposed:"Abgang",sold:"Verkauft"}[t]||t}function Ae(t,s){if(!t.depreciationSchedule||t.depreciationSchedule.length===0)return t.purchasePrice;const n=t.depreciationSchedule.find(u=>u.year===s);if(n)return n.bookValue;const o=[...t.depreciationSchedule].sort((u,h)=>h.year-u.year).find(u=>u.year<=s);return o?o.bookValue:t.purchasePrice}function Mt({year:t,assets:s,isLoading:n=!1,error:a=null,showOnlyYearAcquisitions:o=!1,onExportCSV:u,onExportPDF:h,className:b}){const x=f.useMemo(()=>o?s.filter(i=>new Date(i.purchaseDate).getFullYear()===t):s,[s,t,o]),m=f.useMemo(()=>{const i=x.reduce((c,r)=>c+r.purchasePrice,0),j=x.reduce((c,r)=>c+r.afaAnnualAmount,0),d=x.reduce((c,r)=>c+Ae(r,t),0);return{count:x.length,totalPurchaseValue:i,totalAnnualAfa:j,totalBookValue:d}},[x,t]);return n?e.jsxs("div",{className:v("space-y-6",b),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Anlageverzeichnis ",t]}),e.jsx("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:"Laden..."})]}):a?e.jsxs("div",{className:v("space-y-6",b),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Anlageverzeichnis ",t]}),e.jsx("div",{className:"rounded-lg border border-destructive p-8 text-center text-destructive",children:a})]}):x.length===0?e.jsxs("div",{className:v("space-y-6",b),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Anlageverzeichnis ",t]}),e.jsxs("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:[e.jsx(st,{className:"mx-auto h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{children:"Keine Anlagen vorhanden"}),e.jsx("p",{className:"text-sm mt-1",children:"No assets registered"})]})]}):e.jsxs("div",{className:v("space-y-6",b),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Anlageverzeichnis ",t]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs($,{variant:"outline",size:"sm",onClick:()=>u==null?void 0:u(x,t),className:"flex-1 sm:flex-none",children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),"CSV Export"]}),e.jsxs($,{variant:"outline",size:"sm",onClick:()=>h==null?void 0:h(x,t),className:"flex-1 sm:flex-none",children:[e.jsx(nt,{className:"mr-2 h-4 w-4"}),"PDF Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4","data-testid":"summary-section",children:[e.jsxs(T,{children:[e.jsx(F,{className:"pb-2",children:e.jsx(M,{className:"text-sm font-medium text-muted-foreground",children:"Anlagen"})}),e.jsx(V,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[m.count," Anlagen"]})})]}),e.jsxs(T,{children:[e.jsx(F,{className:"pb-2",children:e.jsx(M,{className:"text-sm font-medium text-muted-foreground",children:"Anschaffungswert"})}),e.jsx(V,{children:e.jsx("div",{className:"text-2xl font-bold",children:z(m.totalPurchaseValue)})})]}),e.jsxs(T,{children:[e.jsx(F,{className:"pb-2",children:e.jsxs(M,{className:"text-sm font-medium text-muted-foreground",children:["AfA ",t]})}),e.jsx(V,{children:e.jsx("div",{className:"text-2xl font-bold",children:z(m.totalAnnualAfa)})})]}),e.jsxs(T,{children:[e.jsx(F,{className:"pb-2",children:e.jsxs(M,{className:"text-sm font-medium text-muted-foreground",children:["Buchwert ",t]})}),e.jsx(V,{children:e.jsx("div",{className:"text-2xl font-bold",children:z(m.totalBookValue)})})]})]}),e.jsx(T,{children:e.jsx(V,{className:"p-0 overflow-x-auto",children:e.jsxs(Z,{className:"min-w-[900px]",children:[e.jsx(J,{children:e.jsxs(A,{children:[e.jsx(k,{scope:"col",children:"Bezeichnung"}),e.jsx(k,{scope:"col",children:"Kategorie"}),e.jsx(k,{scope:"col",children:"Anschaffung"}),e.jsx(k,{scope:"col",className:"text-right",children:"Anschaffungswert"}),e.jsx(k,{scope:"col",className:"text-center",children:"AfA Jahre"}),e.jsx(k,{scope:"col",className:"text-right",children:"AfA/Jahr"}),e.jsxs(k,{scope:"col",className:"text-right",children:["Buchwert ",t]}),e.jsx(k,{scope:"col",children:"Status"})]})}),e.jsx(X,{children:x.map(i=>{const j=Ae(i,t),d=i.status!=="active";return e.jsxs(A,{className:v(d&&"text-muted-foreground"),children:[e.jsxs(p,{className:"font-medium",children:[i.name,i.inventoryNumber&&e.jsxs("span",{className:"block text-xs text-muted-foreground",children:["Inv.-Nr.: ",i.inventoryNumber]})]}),e.jsx(p,{children:_t(i.category)}),e.jsx(p,{children:ve(new Date(i.purchaseDate))}),e.jsx(p,{className:"text-right",children:z(i.purchasePrice)}),e.jsxs(p,{className:"text-center",children:[i.afaYears," Jahre"]}),e.jsx(p,{className:"text-right",children:z(i.afaAnnualAmount)}),e.jsx(p,{className:"text-right",children:z(j)}),e.jsxs(p,{children:[e.jsx("span",{className:v("inline-flex items-center rounded-full px-2 py-1 text-xs font-medium",i.status==="active"&&"bg-green-100 text-green-700",i.status==="disposed"&&"bg-gray-100 text-gray-700",i.status==="sold"&&"bg-blue-100 text-blue-700"),children:Ft(i.status)}),d&&i.disposalDate&&e.jsx("span",{className:"block text-xs text-muted-foreground mt-1",children:ve(new Date(i.disposalDate))})]})]},i.id)})})]})})}),e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 text-sm text-muted-foreground",children:[e.jsx("p",{children:e.jsx("strong",{children:"Hinweise zum Anlageverzeichnis:"})}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Erforderlich für EÜR Anlage AVEÜR (Anlageverzeichnis)"}),e.jsx("li",{children:"Alle Beträge sind Netto-Werte (ohne USt)"}),e.jsx("li",{children:"Lineare AfA-Methode gemäß AfA-Tabelle"})]})]})]})}function U(t){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)}function De(t){return new Intl.NumberFormat("de-DE",{style:"percent",minimumFractionDigits:0,maximumFractionDigits:1}).format(t)}function ye(t){return{computer:"EDV/Computer",furniture:"Büromöbel",equipment:"Geräte",software:"Software",phone:"Telefon"}[t]||t}function Ot(t,s){const o=new Date(t.afaStartDate).getFullYear()+t.afaYears-s-1;return Math.max(0,o)}function Bt(t,s){var a;const n=(a=t.depreciationSchedule)==null?void 0:a.find(o=>o.year===s);return(n==null?void 0:n.amount)??t.afaAnnualAmount}function $t({year:t,assets:s,isLoading:n=!1,error:a=null,showCategoryBreakdown:o=!1,showYearlyComparison:u=!1,onExportCSV:h,className:b}){const x=f.useMemo(()=>s.filter(c=>c.status==="active"||c.afaAnnualAmount>0),[s]),m=f.useMemo(()=>[...x].sort((c,r)=>r.afaAnnualAmount-c.afaAnnualAmount),[x]),i=f.useMemo(()=>{const c=m.reduce((N,E)=>N+E.afaAnnualAmount,0),r=m.length>0?c/m.length:0;return{count:m.length,totalAfa:c,averageAfa:r}},[m]),j=f.useMemo(()=>{const c={computer:{count:0,total:0},furniture:{count:0,total:0},equipment:{count:0,total:0},software:{count:0,total:0},phone:{count:0,total:0}};for(const r of m)c[r.category]&&(c[r.category].count++,c[r.category].total+=r.afaAnnualAmount);return Object.entries(c).filter(([r,N])=>N.count>0).map(([r,N])=>({category:r,...N})).sort((r,N)=>N.total-r.total)},[m]),d=f.useMemo(()=>{if(!u)return[];const c=new Set;for(const r of m)if(r.depreciationSchedule)for(const N of r.depreciationSchedule)c.add(N.year);return Array.from(c).sort()},[m,u]);return n?e.jsxs("div",{className:v("space-y-6",b),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["AfA-Übersicht ",t]}),e.jsx("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:"Laden..."})]}):a?e.jsxs("div",{className:v("space-y-6",b),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["AfA-Übersicht ",t]}),e.jsx("div",{className:"rounded-lg border border-destructive p-8 text-center text-destructive",children:a})]}):m.length===0?e.jsxs("div",{className:v("space-y-6",b),children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["AfA-Übersicht ",t]}),e.jsxs("div",{className:"rounded-lg border p-8 text-center text-muted-foreground",children:[e.jsx(be,{className:"mx-auto h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{children:"Keine Abschreibungen vorhanden"}),e.jsx("p",{className:"text-sm mt-1",children:"No depreciation for this year"})]})]}):e.jsxs("div",{className:v("space-y-6",b),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["AfA-Übersicht ",t]}),e.jsxs($,{variant:"outline",size:"sm",onClick:()=>h==null?void 0:h(m,t),className:"w-full sm:w-auto",children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4","data-testid":"afa-summary-totals",children:[e.jsxs(T,{children:[e.jsx(F,{className:"pb-2",children:e.jsxs(M,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Gesamt-AfA ",t]})}),e.jsx(V,{children:e.jsx("div",{className:"text-2xl font-bold",children:U(i.totalAfa)})})]}),e.jsxs(T,{children:[e.jsx(F,{className:"pb-2",children:e.jsx(M,{className:"text-sm font-medium text-muted-foreground",children:"Anlagen mit AfA"})}),e.jsx(V,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[i.count," Anlagen"]})})]}),e.jsxs(T,{children:[e.jsx(F,{className:"pb-2",children:e.jsxs(M,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(at,{className:"h-4 w-4"}),"Durchschnitt/Anlage"]})}),e.jsx(V,{children:e.jsx("div",{className:"text-2xl font-bold",children:U(i.averageAfa)})})]})]}),o&&j.length>0&&e.jsxs(T,{children:[e.jsx(F,{children:e.jsx(M,{className:"text-sm font-medium",children:"AfA nach Kategorie"})}),e.jsx(V,{children:e.jsx("div",{className:"space-y-3",children:j.map(({category:c,count:r,total:N})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:ye(c)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",r," Anlagen)"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-medium",children:U(N)}),e.jsx("span",{className:"text-sm text-muted-foreground ml-2",children:De(N/i.totalAfa)})]})]},c))})})]}),u&&d.length>0&&e.jsxs(T,{children:[e.jsx(F,{children:e.jsx(M,{className:"text-sm font-medium",children:"Jahresvergleich"})}),e.jsx(V,{children:e.jsx("div",{className:"flex gap-4",children:d.map(c=>{const r=m.reduce((E,C)=>E+Bt(C,c),0),N=c===t;return e.jsxs("div",{className:v("flex-1 text-center p-3 rounded-lg border",N&&"bg-muted border-primary"),children:[e.jsx("div",{className:"text-sm font-medium",children:c}),e.jsx("div",{className:v("text-lg font-bold",N&&"text-primary"),children:U(r)})]},c)})})})]}),e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(M,{className:"text-sm font-medium",children:["AfA-Aufstellung ",t]})}),e.jsx(V,{className:"p-0 overflow-x-auto",children:e.jsxs(Z,{className:"min-w-[600px]",children:[e.jsx(J,{children:e.jsxs(A,{children:[e.jsx(k,{scope:"col",children:"Anlage"}),e.jsx(k,{scope:"col",children:"Kategorie"}),e.jsxs(k,{scope:"col",className:"text-right",children:["AfA ",t]}),e.jsx(k,{scope:"col",className:"text-right",children:"Anteil"}),e.jsx(k,{scope:"col",className:"text-center",children:"Restlaufzeit"})]})}),e.jsxs(X,{children:[m.map(c=>{const r=i.totalAfa>0?c.afaAnnualAmount/i.totalAfa:0,N=Ot(c,t);return e.jsxs(A,{children:[e.jsxs(p,{className:"font-medium",children:[c.name,c.inventoryNumber&&e.jsxs("span",{className:"block text-xs text-muted-foreground",children:["Inv.-Nr.: ",c.inventoryNumber]})]}),e.jsx(p,{children:ye(c.category)}),e.jsx(p,{className:"text-right font-medium",children:U(c.afaAnnualAmount)}),e.jsx(p,{className:"text-right",children:De(r)}),e.jsx(p,{className:"text-center",children:N>0?e.jsxs("span",{children:[N," Jahre"]}):e.jsx("span",{className:"text-muted-foreground",children:"Abgeschlossen"})})]},c.id)}),e.jsxs(A,{className:"bg-muted/50 font-bold",children:[e.jsx(p,{colSpan:2,children:"Gesamt"}),e.jsx(p,{className:"text-right",children:U(i.totalAfa)}),e.jsx(p,{className:"text-right",children:"100%"}),e.jsx(p,{})]})]})]})})]}),e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 text-sm text-muted-foreground",children:[e.jsx("p",{children:e.jsx("strong",{children:"Hinweise zur AfA-Berechnung:"})}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Lineare Abschreibung gemäß AfA-Tabelle"}),e.jsx("li",{children:"Pro-rata-temporis im Anschaffungs- und Abgangsjahr"}),e.jsx("li",{children:"Beträge netto (ohne Umsatzsteuer)"})]})]})]})}const zt=[{euerCategory:"services",euerLine:14,skr03Account:8400,skr04Account:4400,defaultVatRate:19,isIncome:!0},{euerCategory:"services_7",euerLine:14,skr03Account:8300,skr04Account:4300,defaultVatRate:7,isIncome:!0},{euerCategory:"services_exempt",euerLine:14,skr03Account:8120,skr04Account:4120,defaultVatRate:0,isIncome:!0},{euerCategory:"asset_sale",euerLine:16,skr03Account:8600,skr04Account:4600,defaultVatRate:19,isIncome:!0},{euerCategory:"ust_refund",euerLine:18,skr03Account:8955,skr04Account:4955,defaultVatRate:0,isIncome:!0},{euerCategory:"subcontractor",euerLine:25,skr03Account:3100,skr04Account:5900,defaultVatRate:19,isIncome:!1},{euerCategory:"software",euerLine:34,skr03Account:4964,skr04Account:6815,defaultVatRate:19,isIncome:!1},{euerCategory:"telecom",euerLine:34,skr03Account:4920,skr04Account:6805,defaultVatRate:19,isIncome:!1},{euerCategory:"hosting",euerLine:34,skr03Account:4964,skr04Account:6815,defaultVatRate:19,isIncome:!1},{euerCategory:"travel",euerLine:34,skr03Account:4670,skr04Account:6650,defaultVatRate:19,isIncome:!1},{euerCategory:"insurance",euerLine:34,skr03Account:4360,skr04Account:6400,defaultVatRate:0,isIncome:!1},{euerCategory:"bank_fees",euerLine:34,skr03Account:4970,skr04Account:6855,defaultVatRate:0,isIncome:!1},{euerCategory:"training",euerLine:34,skr03Account:4945,skr04Account:6820,defaultVatRate:19,isIncome:!1},{euerCategory:"books",euerLine:34,skr03Account:4940,skr04Account:6821,defaultVatRate:7,isIncome:!1},{euerCategory:"office_supplies",euerLine:34,skr03Account:4930,skr04Account:6815,defaultVatRate:19,isIncome:!1},{euerCategory:"home_office",euerLine:33,skr03Account:4288,skr04Account:6310,defaultVatRate:0,isIncome:!1},{euerCategory:"depreciation",euerLine:30,skr03Account:4830,skr04Account:6220,defaultVatRate:0,isIncome:!1},{euerCategory:"afa",euerLine:30,skr03Account:4830,skr04Account:6220,defaultVatRate:0,isIncome:!1},{euerCategory:"other",euerLine:34,skr03Account:4980,skr04Account:6890,defaultVatRate:19,isIncome:!1}];function Ut(t,s){if(t==="services")return s===7?8300:s===0?8120:8400;const n=zt.find(a=>a.euerCategory===t);return(n==null?void 0:n.skr03Account)??4980}const Pt={BANK:1200},Yt=[{euerCategory:"services",euerLine:14,skr03Account:8400,skr04Account:4400,defaultVatRate:19,isIncome:!0},{euerCategory:"services_7",euerLine:14,skr03Account:8300,skr04Account:4300,defaultVatRate:7,isIncome:!0},{euerCategory:"services_exempt",euerLine:14,skr03Account:8120,skr04Account:4120,defaultVatRate:0,isIncome:!0},{euerCategory:"asset_sale",euerLine:16,skr03Account:8600,skr04Account:4600,defaultVatRate:19,isIncome:!0},{euerCategory:"ust_refund",euerLine:18,skr03Account:8955,skr04Account:4955,defaultVatRate:0,isIncome:!0},{euerCategory:"subcontractor",euerLine:25,skr03Account:3100,skr04Account:5900,defaultVatRate:19,isIncome:!1},{euerCategory:"software",euerLine:34,skr03Account:4964,skr04Account:6815,defaultVatRate:19,isIncome:!1},{euerCategory:"telecom",euerLine:34,skr03Account:4920,skr04Account:6805,defaultVatRate:19,isIncome:!1},{euerCategory:"hosting",euerLine:34,skr03Account:4964,skr04Account:6815,defaultVatRate:19,isIncome:!1},{euerCategory:"travel",euerLine:34,skr03Account:4670,skr04Account:6650,defaultVatRate:19,isIncome:!1},{euerCategory:"insurance",euerLine:34,skr03Account:4360,skr04Account:6400,defaultVatRate:0,isIncome:!1},{euerCategory:"bank_fees",euerLine:34,skr03Account:4970,skr04Account:6855,defaultVatRate:0,isIncome:!1},{euerCategory:"training",euerLine:34,skr03Account:4945,skr04Account:6820,defaultVatRate:19,isIncome:!1},{euerCategory:"books",euerLine:34,skr03Account:4940,skr04Account:6821,defaultVatRate:7,isIncome:!1},{euerCategory:"office_supplies",euerLine:34,skr03Account:4930,skr04Account:6815,defaultVatRate:19,isIncome:!1},{euerCategory:"home_office",euerLine:33,skr03Account:4288,skr04Account:6310,defaultVatRate:0,isIncome:!1},{euerCategory:"depreciation",euerLine:30,skr03Account:4830,skr04Account:6220,defaultVatRate:0,isIncome:!1},{euerCategory:"afa",euerLine:30,skr03Account:4830,skr04Account:6220,defaultVatRate:0,isIncome:!1},{euerCategory:"other",euerLine:34,skr03Account:4980,skr04Account:6890,defaultVatRate:19,isIncome:!1}];function Qt(t,s){if(t==="services")return s===7?4300:s===0?4120:4400;const n=Yt.find(a=>a.euerCategory===t);return(n==null?void 0:n.skr04Account)??6890}const Gt={BANK:1800};function _e(t){switch(t){case 19:return 3;case 7:return 2;case 0:default:return 0}}function Fe(t,s,n){return s==="SKR03"?Ut(t,n):Qt(t,n)}function Me(t){return t==="SKR03"?Pt.BANK:Gt.BANK}function Oe(t){const s=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0");return`${s}${n}`}function ae(t){return t.toFixed(2).replace(".",",")}function Be(){return{amount:0,debitCredit:"S",currency:"EUR",exchangeRate:"",baseAmount:0,account:0,counterAccount:1200,vatCode:0,documentDate:"",documentRef1:"",documentRef2:"",discount:0,description:"",blocked:0,addressNumber:"",partnerBank:"",businessCase:"",interestBlocked:0,documentLink:"",documentInfoType:"",documentInfoContent:""}}function $e(t,s){const n=Fe(t.euerCategory,s,t.vatRate),a=Me(s);return{...Be(),amount:t.grossAmount,debitCredit:"H",baseAmount:t.grossAmount,account:n,counterAccount:a,vatCode:_e(t.vatRate),documentDate:Oe(t.date),documentRef1:t.invoiceId??"",description:Ue(t.description)}}function ze(t,s){const n=Fe(t.euerCategory,s,t.vatRate),a=Me(s);return{...Be(),amount:t.grossAmount,debitCredit:"S",baseAmount:t.grossAmount,account:n,counterAccount:a,vatCode:_e(t.vatRate),documentDate:Oe(t.date),documentRef1:t.receiptPath?Ht(t.receiptPath):"",description:Ue(`${t.vendor}: ${t.description}`)}}function Ue(t){return t.length<=60?t:t.slice(0,57)+"..."}function Ht(t){return(t.split("/").pop()??"").replace(/\.[^/.]+$/,"")}function Pe(t){const s=[];return t.amount<=0&&s.push("Amount must be greater than 0"),(!t.account||t.account===0)&&s.push("Account number is required"),(!t.counterAccount||t.counterAccount===0)&&s.push("Counter account is required"),(!t.documentDate||t.documentDate.length!==4)&&s.push("Document date must be in DDMM format"),["S","H"].includes(t.debitCredit)||s.push("Debit/Credit indicator must be S or H"),[0,2,3].includes(t.vatCode)||s.push("VAT code must be 0, 2, or 3"),s}const Ye=["Umsatz","Soll/Haben-Kennzeichen","WKZ Umsatz","Kurs","Basis-Umsatz","Konto","Gegenkonto","BU-Schlüssel","Belegdatum","Belegfeld 1","Belegfeld 2","Skonto","Buchungstext","Postensperre","Diverse Adressnummer","Geschäftspartnerbank","Sachverhalt","Zinssperre","Beleglink","Beleginfo - Art 1","Beleginfo - Inhalt 1"],te=";";function Qe(t){return[ae(t.amount),t.debitCredit,t.currency,t.exchangeRate,ae(t.baseAmount),String(t.account),String(t.counterAccount),String(t.vatCode),t.documentDate,H(t.documentRef1),H(t.documentRef2),ae(t.discount),H(t.description),String(t.blocked),t.addressNumber,t.partnerBank,t.businessCase,String(t.interestBlocked),t.documentLink,t.documentInfoType,t.documentInfoContent].join(te)}function H(t){return t?t.includes(te)||t.includes('"')||t.includes(`
`)?`"${t.replace(/"/g,'""')}"`:t:""}function Kt(t){const s=Ye.join(te),n=t.map(Qe);return[s,...n].join(`
`)}function Ge(t,s){return t.map(n=>$e(n,s))}function He(t,s){return t.map(n=>ze(n,s))}function Ke(t){const s=[];for(let n=0;n<t.length;n++){const a=t.charCodeAt(n);a<=255?s.push(a):s.push(63)}return new Uint8Array(s)}function qe(t,s,n){const a=[],o=[],u=[],h=t.filter(x=>{const m=x.date;return m>=n.startDate&&m<=n.endDate}),b=s.filter(x=>{const m=x.date;return m>=n.startDate&&m<=n.endDate});if(n.includeIncome!==!1){const x=Ge(h,n.chartOfAccounts);u.push(...x)}if(n.includeExpenses!==!1){const x=He(b,n.chartOfAccounts);u.push(...x)}return u.forEach((x,m)=>{const i=Pe(x);i.length>0&&a.push(`Record ${m+1}: ${i.join(", ")}`)}),u.length===0&&o.push("No records found in the selected date range"),{records:u,recordCount:u.length,startDate:n.startDate,endDate:n.endDate,chartOfAccounts:n.chartOfAccounts,format:"csv",errors:a,warnings:o}}function Ze(t,s="csv"){const n=Ee(t.startDate),a=Ee(t.endDate);return`DATEV_${t.chartOfAccounts}_${n}_${a}.${s}`}function Ee(t){const s=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${s}${n}${a}`}function K(t,s){switch(s){case"Q1":return{startDate:new Date(t,0,1),endDate:new Date(t,2,31)};case"Q2":return{startDate:new Date(t,3,1),endDate:new Date(t,5,30)};case"Q3":return{startDate:new Date(t,6,1),endDate:new Date(t,8,30)};case"Q4":return{startDate:new Date(t,9,1),endDate:new Date(t,11,31)};case"year":return{startDate:new Date(t,0,1),endDate:new Date(t,11,31)}}}function Je(t,s){const n=new Date(t,s-1,1),a=new Date(t,s,0);return{startDate:n,endDate:a}}const qt=Object.freeze(Object.defineProperty({__proto__:null,DATEV_CSV_HEADER:Ye,DATEV_DELIMITER:te,datevRecordToCsvRow:Qe,encodeToLatin1:Ke,escapeCsvField:H,expensesToDatevRecords:He,generateCsvContent:Kt,generateDatevCsv:qe,generateDatevFilename:Ze,getMonthDates:Je,getPeriodDates:K,incomesToDatevRecords:Ge},Symbol.toStringTag,{value:"Module"})),Zt=new Date().getFullYear(),we=Math.ceil((new Date().getMonth()+1)/3),Se={periodType:"quarter",year:Zt,quarter:we>1?we-1:4,month:new Date().getMonth()||12,customStartDate:null,customEndDate:null,chartOfAccounts:"SKR03",format:"csv",consultantNumber:"",clientNumber:"",includeIncome:!0,includeExpenses:!0,includeDepreciation:!0};function Jt(t={}){const[s,n]=f.useState({...Se,...t}),a=f.useMemo(()=>{switch(s.periodType){case"month":return Je(s.year,s.month);case"quarter":return K(s.year,`Q${s.quarter}`);case"year":return K(s.year,"year");case"custom":return{startDate:s.customStartDate||new Date(s.year,0,1),endDate:s.customEndDate||new Date(s.year,11,31)};default:return K(s.year,"year")}},[s.periodType,s.year,s.month,s.quarter,s.customStartDate,s.customEndDate]),o=f.useMemo(()=>({startDate:a.startDate,endDate:a.endDate,chartOfAccounts:s.chartOfAccounts,format:s.format,consultantNumber:s.consultantNumber||void 0,clientNumber:s.clientNumber||void 0,includeIncome:s.includeIncome,includeExpenses:s.includeExpenses,includeDepreciation:s.includeDepreciation}),[a,s]),u=f.useMemo(()=>{const g=[];return s.periodType==="custom"&&(s.customStartDate||g.push("Start date is required for custom period"),s.customEndDate||g.push("End date is required for custom period"),s.customStartDate&&s.customEndDate&&s.customStartDate>s.customEndDate&&g.push("Start date must be before end date")),!s.includeIncome&&!s.includeExpenses&&!s.includeDepreciation&&g.push("At least one transaction type must be selected"),g},[s]),h=u.length===0,b=f.useCallback(g=>{n(l=>({...l,periodType:g}))},[]),x=f.useCallback(g=>{n(l=>({...l,year:g}))},[]),m=f.useCallback(g=>{n(l=>({...l,quarter:g}))},[]),i=f.useCallback(g=>{n(l=>({...l,month:g}))},[]),j=f.useCallback((g,l)=>{n(D=>({...D,customStartDate:g,customEndDate:l}))},[]),d=f.useCallback(g=>{n(l=>({...l,chartOfAccounts:g}))},[]),c=f.useCallback(g=>{n(l=>({...l,format:g}))},[]),r=f.useCallback(g=>{n(l=>({...l,consultantNumber:g}))},[]),N=f.useCallback(g=>{n(l=>({...l,clientNumber:g}))},[]),E=f.useCallback(()=>{n(g=>({...g,includeIncome:!g.includeIncome}))},[]),C=f.useCallback(()=>{n(g=>({...g,includeExpenses:!g.includeExpenses}))},[]),B=f.useCallback(()=>{n(g=>({...g,includeDepreciation:!g.includeDepreciation}))},[]),y=f.useCallback(()=>{n(Se)},[]);return{state:s,exportOptions:o,setPeriodType:b,setYear:x,setQuarter:m,setMonth:i,setCustomDateRange:j,setChartOfAccounts:d,setFormat:c,setConsultantNumber:r,setClientNumber:N,toggleIncludeIncome:E,toggleIncludeExpenses:C,toggleIncludeDepreciation:B,reset:y,validationErrors:u,isValid:h}}function Xt(){return f.useMemo(()=>{const t=[],s=new Date().getFullYear();for(let n=0;n<6;n++)t.push(s-n);return t},[])}function Wt(){return f.useMemo(()=>["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"].map((s,n)=>({value:n+1,label:s})),[])}function es(){return f.useMemo(()=>[{value:1,label:"Q1 (Jan - Mär)"},{value:2,label:"Q2 (Apr - Jun)"},{value:3,label:"Q3 (Jul - Sep)"},{value:4,label:"Q4 (Okt - Dez)"}],[])}function ts(){return f.useMemo(()=>[{value:"month",label:"Monat"},{value:"quarter",label:"Quartal"},{value:"year",label:"Jahr"},{value:"custom",label:"Benutzerdefiniert"}],[])}const ss=({exportState:t,disabled:s=!1,className:n=""})=>{const{state:a,setPeriodType:o,setYear:u,setQuarter:h,setMonth:b,setCustomDateRange:x,setChartOfAccounts:m,setFormat:i,setConsultantNumber:j,setClientNumber:d,toggleIncludeIncome:c,toggleIncludeExpenses:r,toggleIncludeDepreciation:N,validationErrors:E}=t,C=Xt(),B=Wt(),y=es(),g=ts();return e.jsxs("div",{className:`space-y-6 ${n}`,role:"form","aria-label":"DATEV Export Einstellungen",children:[e.jsxs("fieldset",{className:"space-y-4",disabled:s,children:[e.jsx("legend",{className:"text-sm font-medium text-gray-700",children:"Zeitraum"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"periodType",className:"block text-sm text-gray-600 mb-1",children:"Zeitraumtyp"}),e.jsx("select",{id:"periodType",value:a.periodType,onChange:l=>o(l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500","aria-describedby":"periodType-description",children:g.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"year",className:"block text-sm text-gray-600 mb-1",children:"Jahr"}),e.jsx("select",{id:"year",value:a.year,onChange:l=>u(parseInt(l.target.value,10)),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:C.map(l=>e.jsx("option",{value:l,children:l},l))})]})]}),a.periodType==="quarter"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"quarter",className:"block text-sm text-gray-600 mb-1",children:"Quartal"}),e.jsx("select",{id:"quarter",value:a.quarter,onChange:l=>h(parseInt(l.target.value,10)),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:y.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),a.periodType==="month"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"month",className:"block text-sm text-gray-600 mb-1",children:"Monat"}),e.jsx("select",{id:"month",value:a.month,onChange:l=>b(parseInt(l.target.value,10)),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:B.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),a.periodType==="custom"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm text-gray-600 mb-1",children:"Von"}),e.jsx("input",{type:"date",id:"startDate",value:a.customStartDate?a.customStartDate.toISOString().split("T")[0]:"",onChange:l=>x(l.target.value?new Date(l.target.value):null,a.customEndDate),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm text-gray-600 mb-1",children:"Bis"}),e.jsx("input",{type:"date",id:"endDate",value:a.customEndDate?a.customEndDate.toISOString().split("T")[0]:"",onChange:l=>x(a.customStartDate,l.target.value?new Date(l.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]})]})]}),e.jsxs("fieldset",{className:"space-y-4",disabled:s,children:[e.jsx("legend",{className:"text-sm font-medium text-gray-700",children:"Format"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"chartOfAccounts",className:"block text-sm text-gray-600 mb-1",children:"Kontenrahmen"}),e.jsxs("select",{id:"chartOfAccounts",value:a.chartOfAccounts,onChange:l=>m(l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"SKR03",children:"SKR03 (Standard)"}),e.jsx("option",{value:"SKR04",children:"SKR04"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"format",className:"block text-sm text-gray-600 mb-1",children:"Exportformat"}),e.jsxs("select",{id:"format",value:a.format,onChange:l=>i(l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"csv",children:"CSV (Buchungsstapel)"}),e.jsx("option",{value:"xml",children:"XML (LedgerImport)"})]})]})]})]}),e.jsxs("fieldset",{className:"space-y-4",disabled:s,children:[e.jsx("legend",{className:"text-sm font-medium text-gray-700",children:"DATEV Metadaten (optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"consultantNumber",className:"block text-sm text-gray-600 mb-1",children:"Beraternummer"}),e.jsx("input",{type:"text",id:"consultantNumber",value:a.consultantNumber,onChange:l=>j(l.target.value),placeholder:"z.B. 12345",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"clientNumber",className:"block text-sm text-gray-600 mb-1",children:"Mandantennummer"}),e.jsx("input",{type:"text",id:"clientNumber",value:a.clientNumber,onChange:l=>d(l.target.value),placeholder:"z.B. 99999",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]})]})]}),e.jsxs("fieldset",{className:"space-y-3",disabled:s,children:[e.jsx("legend",{className:"text-sm font-medium text-gray-700",children:"Zu exportieren"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.includeIncome,onChange:c,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Einnahmen"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.includeExpenses,onChange:r,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Ausgaben"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.includeDepreciation,onChange:N,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Abschreibungen (AfA)"})]})]})]}),E.length>0&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",role:"alert","aria-live":"polite",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Bitte korrigieren Sie folgende Fehler:"}),e.jsx("ul",{className:"mt-1 text-sm text-red-600 list-disc list-inside",children:E.map((l,D)=>e.jsx("li",{children:l},D))})]})]})},ns="http://xml.datev.de/bedi/tps/ledger/v060",as='<?xml version="1.0" encoding="UTF-8"?>';function rs(t){return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):""}function S(t,s,n){if(s==null||s==="")return`<${t}/>`;const o=typeof s=="number"?s.toString():rs(s);return`<${t}>${o}</${t}>`}function ge(t,s){const n=s.filter(a=>a).join(`
`);return`<${t}>
${n}
</${t}>`}function oe(t,s=2){const n=t.split(`
`),a=" ".repeat(s);return n.map(o=>a+o).join(`
`)}function ke(t){const s=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${s}-${n}-${a}`}function cs(t,s){const n=t.slice(0,2),a=t.slice(2,4);return`${s}-${a}-${n}`}function ls(t,s){const n=[],a=cs(t.documentDate,s);if(n.push(S("Date",a)),n.push(S("Amount",t.amount.toFixed(2))),t.debitCredit==="S"?(n.push(S("DebitAccount",t.account)),n.push(S("CreditAccount",t.counterAccount))):(n.push(S("DebitAccount",t.counterAccount)),n.push(S("CreditAccount",t.account))),t.description&&n.push(S("Description",t.description)),t.vatCode>0){const o=t.vatCode===3?19:t.vatCode===2?7:0;n.push(S("TaxCode",o))}return t.documentRef1&&n.push(S("DocumentNumber",t.documentRef1)),n.push(S("Currency",t.currency)),ge("Transaction",n)}function os(t,s){const n=t.map(a=>oe(ls(a,s),4));return ge("Consolidate",n)}function is(t){const s=[];return s.push(S("Version","6.0")),s.push(S("Generator","Personal Assistant")),s.push(S("GeneratedAt",new Date().toISOString())),t.consultantNumber&&s.push(S("ConsultantNumber",t.consultantNumber)),t.clientNumber&&s.push(S("ClientNumber",t.clientNumber)),s.push(S("ChartOfAccounts",t.chartOfAccounts)),s.push(S("PeriodStart",ke(t.startDate))),s.push(S("PeriodEnd",ke(t.endDate))),ge("Header",s)}function us(t,s){const n=s.startDate.getFullYear(),a=oe(is(s),2),o=oe(os(t,n),2),u=[a,o].join(`
`),h=`<LedgerImport xmlns="${ns}">
${u}
</LedgerImport>`;return`${as}
${h}`}function ds(t,s){return t.map(n=>$e(n,s))}function ms(t,s){return t.map(n=>ze(n,s))}function xs(t,s,n){const a=[],o=[],u=[],h=t.filter(x=>{const m=x.date;return m>=n.startDate&&m<=n.endDate}),b=s.filter(x=>{const m=x.date;return m>=n.startDate&&m<=n.endDate});if(n.includeIncome!==!1){const x=ds(h,n.chartOfAccounts);u.push(...x)}if(n.includeExpenses!==!1){const x=ms(b,n.chartOfAccounts);u.push(...x)}return u.forEach((x,m)=>{const i=Pe(x);i.length>0&&a.push(`Record ${m+1}: ${i.join(", ")}`)}),u.length===0&&o.push("No records found in the selected date range"),{records:u,recordCount:u.length,startDate:n.startDate,endDate:n.endDate,chartOfAccounts:n.chartOfAccounts,format:"xml",errors:a,warnings:o}}function hs(t,s){return us(t.records,s)}let re=null,ce=null;async function fs(){if(!re||!ce){const[t,s]=await Promise.all([le(()=>import("./index-DV0Z4ueH.js"),__vite__mapDeps([0,1])),le(()=>import("./index-CDjnCujr.js"),__vite__mapDeps([2,3,1]))]);re=t,ce=s}return{save:re.save,writeFile:ce.writeFile}}const gs=({open:t,onOpenChange:s,incomes:n,expenses:a,className:o=""})=>{const u=Jt(),{exportOptions:h,isValid:b}=u,[x,m]=f.useState(!1),[i,j]=f.useState(null),[d,c]=f.useState(null),[r,N]=f.useState(null);f.useEffect(()=>{if(!t)return;const y=n.filter(_=>{const R=_.date;return R>=h.startDate&&R<=h.endDate}),g=a.filter(_=>{const R=_.date;return R>=h.startDate&&R<=h.endDate}),l=h.includeIncome?y.length:0,D=h.includeExpenses?g.length:0,I=y.reduce((_,R)=>_+R.grossAmount,0),L=g.reduce((_,R)=>_+R.grossAmount,0);j({incomeCount:l,expenseCount:D,depreciationCount:0,totalCount:l+D,totalIncome:Math.round(I*100)/100,totalExpenses:Math.round(L*100)/100,startDate:h.startDate,endDate:h.endDate})},[t,n,a,h]);const E=f.useCallback(async()=>{if(b){m(!0),N(null);try{const{save:y,writeFile:g}=await fs(),l=n,D=a;let I,L,_,R;if(h.format==="csv"){I=qe(l,D,h);const{generateCsvContent:We}=await le(async()=>{const{generateCsvContent:et}=await Promise.resolve().then(()=>qt);return{generateCsvContent:et}},void 0);L=We(I.records),_="text/csv",R="iso-8859-1"}else I=xs(l,D,h),L=hs(I,h),_="application/xml",R="utf-8";if(I.errors.length>0)throw new Error(I.errors.join(`
`));const Xe=Ze(h,h.format),pe=await y({defaultPath:Xe,filters:[{name:h.format==="csv"?"CSV Files":"XML Files",extensions:[h.format]}]});if(!pe)return;let se;R==="iso-8859-1"?se=Ke(L):se=new TextEncoder().encode(L),await g(pe,se),c(I)}catch(y){N(y instanceof Error?y.message:"Export failed")}finally{m(!1)}}},[b,n,a,h]),C=y=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(y),B=y=>new Intl.DateTimeFormat("de-DE").format(y);return e.jsx(dt,{open:t,onOpenChange:s,children:e.jsxs(mt,{children:[e.jsx(xt,{className:"fixed inset-0 bg-black/50 data-[state=open]:animate-fadeIn"}),e.jsxs(ht,{className:`fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto focus:outline-none data-[state=open]:animate-contentShow ${o}`,"aria-describedby":"datev-export-description",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 z-10",children:[e.jsx(ft,{className:"text-lg font-semibold text-gray-900",children:"DATEV Export"}),e.jsx(gt,{id:"datev-export-description",className:"text-sm text-gray-500 mt-1",children:"Exportieren Sie Ihre Buchhaltungsdaten im DATEV-Format für Ihren Steuerberater."})]}),e.jsxs("div",{className:"px-6 py-4 space-y-6",children:[e.jsx(ss,{exportState:u,disabled:x}),i&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Vorschau"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Zeitraum:"}),e.jsxs("p",{className:"font-medium",children:[B(i.startDate)," -"," ",B(i.endDate)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Datensätze:"}),e.jsx("p",{className:"font-medium",children:i.totalCount})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm pt-2 border-t",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Einnahmen"}),e.jsxs("p",{className:"font-medium text-green-600",children:[i.incomeCount," (",C(i.totalIncome),")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Ausgaben"}),e.jsxs("p",{className:"font-medium text-red-600",children:[i.expenseCount," (",C(i.totalExpenses),")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Ergebnis"}),e.jsx("p",{className:`font-medium ${i.totalIncome-i.totalExpenses>=0?"text-green-600":"text-red-600"}`,children:C(i.totalIncome-i.totalExpenses)})]})]})]}),d&&!r&&e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-md",role:"status","aria-live":"polite",children:[e.jsxs("p",{className:"text-sm text-green-800",children:["Export erfolgreich! ",d.recordCount," Datensätze wurden exportiert."]}),d.warnings.length>0&&e.jsx("ul",{className:"mt-2 text-sm text-yellow-700 list-disc list-inside",children:d.warnings.map((y,g)=>e.jsx("li",{children:y},g))})]}),r&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",role:"alert","aria-live":"assertive",children:e.jsx("p",{className:"text-sm text-red-800",children:r})})]}),e.jsxs("div",{className:"sticky bottom-0 bg-white border-t px-6 py-4 flex justify-end gap-3",children:[e.jsx(Ne,{asChild:!0,children:e.jsx("button",{type:"button",className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:x,children:"Abbrechen"})}),e.jsx("button",{type:"button",onClick:E,disabled:!b||x||(i==null?void 0:i.totalCount)===0,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed","aria-busy":x,children:x?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Exportiere..."]}):"Exportieren"})]}),e.jsx(Ne,{asChild:!0,children:e.jsx("button",{type:"button",className:"absolute top-4 right-4 p-1 rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Schließen",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]})]})})};function Ls(){const t=new Date().getFullYear(),[s,n]=f.useState(t),[a,o]=f.useState([]),[u,h]=f.useState([]),[b,x]=f.useState([]),[m,i]=f.useState(!0),[j,d]=f.useState(!1);f.useEffect(()=>{async function r(){i(!0);try{const[N,E,C]=await Promise.all([ot(),pt(),jt()]);o(N),h(E),x(C)}catch(N){console.error("Failed to load data:",N)}finally{i(!1)}}r()},[]);const c=Array.from({length:6},(r,N)=>t-N);return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Reports"})}),e.jsxs(ie,{value:String(s),onValueChange:r=>n(Number(r)),children:[e.jsx(ue,{className:"w-full sm:w-[120px]",children:e.jsx(de,{placeholder:"Year"})}),e.jsx(me,{children:c.map(r=>e.jsx(xe,{value:String(r),children:r},r))})]})]}),e.jsxs(Ce,{defaultValue:"vat",className:"w-full",children:[e.jsxs(Re,{className:"flex w-full overflow-x-auto gap-1 sm:grid sm:grid-cols-5",children:[e.jsx(O,{value:"vat",className:"flex-shrink-0",children:"VAT (USt)"}),e.jsx(O,{value:"euer",className:"flex-shrink-0",children:"Profit (EÜR)"}),e.jsx(O,{value:"assets",className:"flex-shrink-0 whitespace-nowrap",children:"Asset Register"}),e.jsx(O,{value:"afa",className:"flex-shrink-0",children:"Depreciation"}),e.jsx(O,{value:"datev",className:"flex-shrink-0 whitespace-nowrap",children:"DATEV Export"})]}),e.jsx(P,{value:"vat",className:"mt-6",children:e.jsx(It,{})}),e.jsx(P,{value:"euer",className:"mt-6",children:e.jsx(Lt,{})}),e.jsx(P,{value:"assets",className:"mt-6",children:e.jsx(Mt,{year:s,assets:a,isLoading:m})}),e.jsx(P,{value:"afa",className:"mt-6",children:e.jsx($t,{year:s,assets:a,isLoading:m})}),e.jsx(P,{value:"datev",className:"mt-6",children:e.jsx("div",{className:"rounded-lg border bg-card p-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 py-8",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"DATEV Export"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:"Export your accounting data in DATEV format for your tax advisor. Supports CSV (Buchungsstapel) and XML (LedgerImport) formats."})]}),e.jsx($,{onClick:()=>d(!0),size:"lg",children:"Open DATEV Export"})]})})})]}),e.jsx(gs,{open:j,onOpenChange:d,incomes:u,expenses:b})]})}export{Ls as ReportsPage};
