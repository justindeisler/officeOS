import{r as c,j as e}from"./vendor-react-nkeu7MKf.js";import{u as B,E as I}from"./ExpenseDialog-CMtBjyyD.js";import{l as T,q as O,a as j,I as V,B as N,F as G,K as R}from"./index-D99RQVTX.js";import{T as U,a as q,b as L,c as l,d as z,e as o}from"./table-BNCVlMkt.js";import{C as W}from"./confirm-delete-dialog-BciY4d1W.js";import{P as _}from"./plus-BqXQVqVr.js";import{S as $}from"./search-DJZNdZ_-.js";import{D as H}from"./download-BCkxsjvm.js";import{T as M}from"./trash-2-BGCwac8g.js";import"./vendor-markdown-zaQAhtrl.js";import"./dialog-CkNEYr4M.js";import"./vendor-radix-DCQ-pcr5.js";import"./vendor-floating-ui-_Y3uXdsy.js";import"./vendor-forms-BDwCPqGD.js";import"./index-uXN-dP3D.js";import"./triangle-alert-CeNmlnby.js";import"./vendor-recharts-COauwCrp.js";import"./vendor-router-bCYKpmtI.js";import"./alert-dialog-oAl4AtET.js";function m(d){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(d)}function K(d){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(d)}function J({onAddExpense:d,onEditExpense:i,className:u,refreshTrigger:x}){const{expenses:h,isLoading:w,error:f,deleteExpense:b,setSelectedExpense:C,refresh:g}=B(),[n,S]=c.useState(""),[y,D]=c.useState(null);c.useEffect(()=>{x&&x>0&&g()},[x,g]);const v=c.useMemo(()=>{if(!n)return h;const s=n.toLowerCase();return h.filter(t=>t.description.toLowerCase().includes(s)||t.vendor.toLowerCase().includes(s)||t.euerCategory.toLowerCase().includes(s))},[h,n]),E=c.useMemo(()=>v.reduce((s,t)=>({net:s.net+t.netAmount,vat:s.vat+t.vatAmount,gross:s.gross+t.grossAmount}),{net:0,vat:0,gross:0}),[v]),A=s=>{C(s),i==null||i(s)},F=(s,t)=>{s.stopPropagation(),D(t)},P=async()=>{y&&(await b(y),D(null))};return w?e.jsxs("div",{className:T("flex items-center justify-center p-8",u),children:[e.jsx(O,{className:"h-8 w-8 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading..."})]}):f?e.jsxs("div",{className:T("p-8 text-center",u),children:[e.jsx("p",{className:"text-destructive",children:f}),e.jsx(j,{variant:"outline",className:"mt-4",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:T("space-y-4",u),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Expenses"}),e.jsxs(j,{onClick:d,className:"w-full sm:w-auto",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(V,{placeholder:"Search expenses...",value:n,onChange:s=>S(s.target.value),className:"pl-10"})]}),v.length===0?e.jsx("div",{className:"rounded-lg border border-dashed p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:n?"No expense records match your search":"No expense records yet. Add your first expense to get started."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(U,{className:"min-w-[800px]",children:[e.jsx(q,{children:e.jsxs(L,{children:[e.jsx(l,{children:"Date"}),e.jsx(l,{children:"Vendor"}),e.jsx(l,{children:"Description"}),e.jsx(l,{children:"VAT"}),e.jsx(l,{className:"text-right",children:"Net"}),e.jsx(l,{className:"text-right",children:"Vorsteuer"}),e.jsx(l,{className:"text-right",children:"Gross"}),e.jsx(l,{className:"text-center",children:"Receipt"}),e.jsx(l,{className:"w-[50px]"})]})}),e.jsx(z,{children:v.map(s=>e.jsxs(L,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>A(s),children:[e.jsx(o,{className:"font-medium",children:K(s.date)}),e.jsx(o,{children:s.vendor}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.description}),s.vorsteuerClaimed&&e.jsx(N,{variant:"secondary",className:"text-xs",children:"Claimed"}),s.isRecurring&&e.jsx(N,{variant:"outline",className:"text-xs",children:"Recurring"}),s.isGwg&&e.jsx(N,{variant:"default",className:"text-xs",children:"GWG"})]})}),e.jsx(o,{children:e.jsxs(N,{variant:"outline",children:[s.vatRate,"%"]})}),e.jsx(o,{className:"text-right",children:m(s.netAmount)}),e.jsx(o,{className:"text-right",children:m(s.vatAmount)}),e.jsx(o,{className:"text-right font-medium",children:m(s.grossAmount)}),e.jsx(o,{className:"text-center",children:s.receiptPath?e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),t.preventDefault();const r=window.open("about:blank","_blank");R.requestBlob(`/expenses/${s.id}/receipt`).then(k=>{const p=URL.createObjectURL(k);if(r)r.location.href=p;else{const a=document.createElement("a");a.href=p,a.target="_blank",a.click()}}).catch(()=>{r&&r.close(),alert("Failed to view receipt")})},"aria-label":"View receipt",title:"View PDF",children:e.jsx(G,{className:"h-4 w-4 text-muted-foreground hover:text-primary"})}),e.jsx(j,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),t.preventDefault();const r=window.open("about:blank","_blank");R.requestBlob(`/expenses/${s.id}/receipt?download=true`).then(k=>{const p=URL.createObjectURL(k);if(r)r.location.href=p;else{const a=document.createElement("a");a.href=p,a.download=`receipt-${s.id}.pdf`,document.body.appendChild(a),a.click(),document.body.removeChild(a)}}).catch(()=>{r&&r.close(),alert("Failed to download receipt")})},"aria-label":"Download receipt",title:"Download PDF",children:e.jsx(H,{className:"h-4 w-4 text-muted-foreground hover:text-primary"})})]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"â€”"})}),e.jsx(o,{children:e.jsx(j,{variant:"ghost",size:"icon",onClick:t=>F(t,s.id),"aria-label":"Delete",children:e.jsx(M,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"})})})]},s.id))})]})}),e.jsx("div",{className:"flex justify-start sm:justify-end",children:e.jsxs("div",{className:"rounded-lg bg-muted p-3 sm:p-4 w-full sm:w-auto",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Total"}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 gap-2 sm:gap-4 text-right",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Net"}),e.jsx("div",{className:"font-medium text-sm sm:text-base",children:m(E.net)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Vorsteuer"}),e.jsx("div",{className:"font-medium text-sm sm:text-base",children:m(E.vat)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Gross"}),e.jsx("div",{className:"font-semibold text-sm sm:text-base",children:m(E.gross)})]})]})]})})]}),e.jsx(W,{open:!!y,onOpenChange:s=>!s&&D(null),title:"Delete expense?",description:"This will permanently delete this expense record. This action cannot be undone.",onConfirm:P})]})}function pe(){const[d,i]=c.useState(!1),[u,x]=c.useState(null),[h,w]=c.useState(0),f=()=>{x(null),i(!0)},b=n=>{x(n),i(!0)},C=()=>{i(!1),x(null)},g=()=>{w(n=>n+1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsx(J,{onAddExpense:f,onEditExpense:b,refreshTrigger:h})}),e.jsx(I,{open:d,onOpenChange:i,expense:u,onClose:C,onSuccess:g})]})}export{pe as ExpensesPage};
