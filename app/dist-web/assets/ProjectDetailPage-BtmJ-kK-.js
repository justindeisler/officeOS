import{r as n,j as e}from"./vendor-react-DeR5d9Tv.js";import{c as V,m as _,B as x,a as S,s as $,C as b,l as E,z as K,g as Q,u as J,v as U,h as W,y as X,D as Y,S as H,R as P}from"./index-B9wpeZVf.js";import{C as u,a as h,b as j,c as p}from"./card-Do3Kg1xk.js";import{T as F,a as q,b as g,c as T}from"./tabs-DfLUlg96.js";import{G as w}from"./github--rKduYt4.js";import{R as Z}from"./refresh-cw-BMXkLT5Q.js";import{G as A,a as G,C as L}from"./git-pull-request-DJ2Nv1Uk.js";import{P as ee}from"./plus-BG4HFTMm.js";import{M as se}from"./minus-DhQxVLAe.js";import{E as te}from"./external-link-DW0qQmWJ.js";import{n as ae,f as y}from"./vendor-date-fns-D0ugVOfH.js";import{d as re,a as le,L as ne}from"./vendor-router-9bGSKQ4q.js";import{A as R}from"./arrow-left-BW1gWke2.js";import{C as B}from"./calendar-BXLbKi9j.js";import"./vendor-markdown-PIr_2kdo.js";import"./vendor-recharts-DrMJw15s.js";import"./vendor-radix-sPo3_CXI.js";import"./vendor-floating-ui-CESiY8Ey.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=V("GitMerge",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]);function ie({type:s,merged:r}){switch(s){case"commit":return e.jsx(A,{className:"h-4 w-4 text-blue-500"});case"pr":return r?e.jsx(ce,{className:"h-4 w-4 text-purple-500"}):e.jsx(G,{className:"h-4 w-4 text-green-500"});case"issue":return e.jsx(L,{className:"h-4 w-4 text-orange-500"});default:return e.jsx(w,{className:"h-4 w-4"})}}function z(s){if(s<60)return`${s}m`;const r=Math.floor(s/60),t=s%60;return t>0?`${r}h ${t}m`:`${r}h`}function de({item:s}){const r=s.type==="pr"&&s.merged_at,t=s.closed_at&&!r,N=(s.additions||0)>0||(s.deletions||0)>0;return e.jsxs("div",{className:"flex items-start gap-3 py-3 px-4 hover:bg-muted/50 rounded-lg transition-colors",children:[e.jsx("div",{className:"mt-0.5",children:e.jsx(ie,{type:s.type,merged:!!r})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium leading-tight truncate",children:[s.type==="commit"&&s.sha&&e.jsx("span",{className:"font-mono text-xs text-muted-foreground mr-1.5",children:s.sha.substring(0,7)}),s.type!=="commit"&&s.number&&e.jsxs("span",{className:"text-muted-foreground mr-1",children:["#",s.number]}),s.title||"No title"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-muted-foreground",children:[e.jsx("span",{children:s.author}),e.jsx("span",{children:"Â·"}),e.jsx("span",{title:y(new Date(s.created_at),"PPpp"),children:ae(new Date(s.created_at),{addSuffix:!0})}),r&&e.jsx(x,{variant:"outline",className:"text-purple-500 border-purple-500/20 text-[10px] h-4 px-1",children:"merged"}),t&&e.jsx(x,{variant:"outline",className:"text-red-500 border-red-500/20 text-[10px] h-4 px-1",children:"closed"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[N&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsxs("span",{className:"text-green-500 flex items-center",children:[e.jsx(ee,{className:"h-3 w-3"}),s.additions]}),e.jsxs("span",{className:"text-red-500 flex items-center",children:[e.jsx(se,{className:"h-3 w-3"}),s.deletions]})]}),s.estimated_minutes&&e.jsxs("div",{className:"flex items-center gap-0.5 text-xs text-muted-foreground",children:[e.jsx(b,{className:"h-3 w-3"}),z(s.estimated_minutes)]}),s.url&&e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(te,{className:"h-3.5 w-3.5"})})]})]})})]})}function oe({projectId:s,repoName:r}){const[t,N]=n.useState([]),[c,C]=n.useState(null),[k,o]=n.useState(!1),[m,i]=n.useState(!1),[v,I]=n.useState("all"),f=n.useCallback(async()=>{o(!0);try{const l=await _.getGitHubProjectActivity(s,v==="all"?void 0:v);N(l.activities||[]),C(l.stats||null)}catch{}finally{o(!1)}},[s,v]);n.useEffect(()=>{f()},[f]);const M=async()=>{if(r){i(!0);try{const l=await _.syncGitHubRepo(r,30),a=l.result.commitsImported+l.result.prsImported+l.result.issuesImported;E.success(`Imported ${a} items from GitHub`),f()}catch{E.error("Failed to sync GitHub activity")}finally{i(!1)}}};return!r&&t.length===0?null:e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(j,{className:"text-lg flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),"GitHub Activity",c&&e.jsxs(x,{variant:"secondary",className:"font-normal",children:[c.total," total"]})]}),e.jsx("div",{className:"flex gap-2",children:r&&e.jsxs(S,{variant:"outline",size:"sm",onClick:M,disabled:m,children:[m?e.jsx($,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(Z,{className:"h-4 w-4 mr-1"}),"Sync"]})})]}),c&&c.total>0&&e.jsxs("div",{className:"flex gap-4 text-sm text-muted-foreground mt-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-3.5 w-3.5 text-blue-500"}),c.commits," commits"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-3.5 w-3.5 text-green-500"}),c.prs," PRs"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-3.5 w-3.5 text-orange-500"}),c.issues," issues"]}),c.estimated_minutes>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-3.5 w-3.5"}),"~",z(c.estimated_minutes)," estimated"]})]}),t.length>0&&e.jsx(F,{value:v,onValueChange:l=>I(l),className:"mt-2",children:e.jsxs(q,{className:"h-8",children:[e.jsx(g,{value:"all",className:"text-xs h-7 px-2",children:"All"}),e.jsxs(g,{value:"commit",className:"text-xs h-7 px-2",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),"Commits"]}),e.jsxs(g,{value:"pr",className:"text-xs h-7 px-2",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),"PRs"]}),e.jsxs(g,{value:"issue",className:"text-xs h-7 px-2",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),"Issues"]})]})})]}),e.jsx(p,{children:k?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx($,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):t.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(w,{className:"h-10 w-10 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No GitHub activity found."}),r&&e.jsxs("p",{className:"text-sm mt-1",children:['Click "Sync" to import activity from'," ",e.jsx("span",{className:"font-mono",children:r}),"."]})]}):e.jsx("div",{className:"divide-y max-h-[500px] overflow-y-auto -mx-4",children:t.map(l=>e.jsx(de,{item:l},l.id))})})]})}const me={pipeline:"bg-blue-500/10 text-blue-500 border-blue-500/20",active:"bg-green-500/10 text-green-500 border-green-500/20",on_hold:"bg-yellow-500/10 text-yellow-500 border-yellow-500/20",completed:"bg-gray-500/10 text-gray-500 border-gray-500/20",cancelled:"bg-red-500/10 text-red-500 border-red-500/20"},xe={pipeline:"Pipeline",active:"Active",on_hold:"On Hold",completed:"Completed",cancelled:"Cancelled"},ue={wellfy:"bg-purple-500/10 text-purple-500 border-purple-500/20",freelance:"bg-orange-500/10 text-orange-500 border-orange-500/20",personal:"bg-cyan-500/10 text-cyan-500 border-cyan-500/20"};function D(s,r){return new Intl.NumberFormat("de-DE",{style:"currency",currency:r}).format(s)}function O(s){const r=Math.floor(s/60),t=s%60;return r===0?`${t}m`:t===0?`${r}h`:`${r}h ${t}m`}function he({task:s}){const r={1:"bg-red-500",2:"bg-yellow-500",3:"bg-blue-500"},t={backlog:"Backlog",queue:"Queue",in_progress:"In Progress",done:"Done"};return e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 hover:bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${r[s.priority]}`}),e.jsx("span",{className:s.status==="done"?"line-through text-muted-foreground":"",children:s.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.dueDate&&e.jsx("span",{className:"text-xs text-muted-foreground",children:y(new Date(s.dueDate),"MMM d")}),e.jsx(x,{variant:"outline",className:"text-xs",children:t[s.status]})]})]})}function je({entry:s}){const r=s.durationMinutes||0;return e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 hover:bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:s.description||"No description"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:y(new Date(s.startTime),"MMM d, yyyy 'at' h:mm a")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"secondary",children:s.category}),e.jsx("span",{className:"text-sm font-medium",children:O(r)})]})]})}function pe({invoice:s}){const r={draft:"bg-gray-500/10 text-gray-500",sent:"bg-blue-500/10 text-blue-500",paid:"bg-green-500/10 text-green-500",overdue:"bg-red-500/10 text-red-500",cancelled:"bg-red-500/10 text-red-500"};return e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 hover:bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.invoiceNumber}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Issued ",y(new Date(s.issueDate),"MMM d, yyyy")]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{variant:"outline",className:r[s.status],children:s.status}),e.jsx("span",{className:"text-sm font-medium",children:D(s.totalAmount,s.currency)})]})]})}function _e(){const{id:s}=re(),r=le(),t=K(s||""),N=Q((t==null?void 0:t.clientId)||""),{tasks:c}=J(),{entries:C}=U(),{invoices:k}=W(),o=n.useMemo(()=>c.filter(a=>a.projectId===s).sort((a,d)=>a.sortOrder-d.sortOrder),[c,s]),m=n.useMemo(()=>C.filter(a=>a.projectId===s).sort((a,d)=>new Date(d.startTime).getTime()-new Date(a.startTime).getTime()),[C,s]),i=n.useMemo(()=>k.filter(a=>a.projectId===s).sort((a,d)=>new Date(d.issueDate).getTime()-new Date(a.issueDate).getTime()),[k,s]),v=n.useMemo(()=>m.reduce((a,d)=>a+(d.durationMinutes||0),0),[m]),I=n.useMemo(()=>o.filter(a=>a.status==="done").length,[o]),f=n.useMemo(()=>i.reduce((a,d)=>a+d.totalAmount,0),[i]),M=n.useMemo(()=>i.filter(a=>a.status==="paid").reduce((a,d)=>a+d.totalAmount,0),[i]);if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-4",children:[e.jsx(X,{className:"h-12 w-12 text-muted-foreground/50"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Project not found"}),e.jsx("p",{className:"text-muted-foreground",children:"The project you're looking for doesn't exist or has been deleted."}),e.jsxs(S,{onClick:()=>r("/projects"),children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Back to Projects"]})]});const l=t.githubRepo||t.github_repo;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs(S,{variant:"ghost",onClick:()=>r("/projects"),className:"w-fit",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Back to Projects"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:t.name}),N&&e.jsx("p",{className:"text-muted-foreground mt-1",children:e.jsx(ne,{to:"/clients",className:"hover:underline",children:N.name})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"outline",className:me[t.status],children:xe[t.status]}),e.jsx(x,{variant:"outline",className:ue[t.area],children:t.area}),l?e.jsx("a",{href:`https://github.com/${l}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex",children:e.jsxs(x,{variant:"outline",className:"gap-1 hover:bg-muted",children:[e.jsx(w,{className:"h-3 w-3"}),l.split("/").pop()]})}):null]})]}),t.description&&e.jsx("p",{className:"text-muted-foreground",children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-muted-foreground",children:[t.budgetAmount&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"h-4 w-4"}),"Budget: ",D(t.budgetAmount,t.budgetCurrency)]}),t.startDate&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-4 w-4"}),"Started: ",y(new Date(t.startDate),"MMM d, yyyy")]}),t.targetEndDate&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-4 w-4"}),"Due: ",y(new Date(t.targetEndDate),"MMM d, yyyy")]})]})]}),e.jsxs("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-4",children:[e.jsxs(u,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium text-muted-foreground",children:"Tasks"})}),e.jsxs(p,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[I,"/",o.length]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"completed"})]})]}),e.jsxs(u,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium text-muted-foreground",children:"Time Tracked"})}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:O(v)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[m.length," entries"]})]})]}),e.jsxs(u,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium text-muted-foreground",children:"Invoiced"})}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:D(f,t.budgetCurrency)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.length," invoices"]})]})]}),e.jsxs(u,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium text-muted-foreground",children:"Paid"})}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-500",children:D(M,t.budgetCurrency)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[f>0?`${Math.round(M/f*100)}%`:"0%"," ","of invoiced"]})]})]})]}),e.jsxs(F,{defaultValue:"tasks",className:"space-y-4",children:[e.jsxs(q,{children:[e.jsxs(g,{value:"tasks",className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Tasks (",o.length,")"]}),e.jsxs(g,{value:"time",className:"gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),"Time (",m.length,")"]}),e.jsxs(g,{value:"invoices",className:"gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Invoices (",i.length,")"]}),l?e.jsxs(g,{value:"github",className:"gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"GitHub"]}):null]}),e.jsx(T,{value:"tasks",children:e.jsxs(u,{children:[e.jsx(h,{children:e.jsx(j,{className:"text-lg",children:"Project Tasks"})}),e.jsx(p,{children:o.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(H,{className:"h-10 w-10 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No tasks linked to this project yet."}),e.jsx("p",{className:"text-sm",children:"Create tasks and assign them to this project."})]}):e.jsx("div",{className:"divide-y",children:o.map(a=>e.jsx(he,{task:a},a.id))})})]})}),e.jsx(T,{value:"time",children:e.jsxs(u,{children:[e.jsx(h,{children:e.jsx(j,{className:"text-lg",children:"Time Entries"})}),e.jsx(p,{children:m.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(b,{className:"h-10 w-10 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No time tracked for this project yet."}),e.jsx("p",{className:"text-sm",children:"Start a timer and link it to this project."})]}):e.jsx("div",{className:"divide-y",children:m.map(a=>e.jsx(je,{entry:a},a.id))})})]})}),e.jsx(T,{value:"invoices",children:e.jsxs(u,{children:[e.jsx(h,{children:e.jsx(j,{className:"text-lg",children:"Invoices"})}),e.jsx(p,{children:i.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(P,{className:"h-10 w-10 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No invoices linked to this project yet."}),e.jsx("p",{className:"text-sm",children:"Create invoices and assign them to this project."})]}):e.jsx("div",{className:"divide-y",children:i.map(a=>e.jsx(pe,{invoice:a},a.id))})})]})}),l?e.jsx(T,{value:"github",children:e.jsx(oe,{projectId:t.id,repoName:l})}):null]})]})}export{_e as ProjectDetailPage};
