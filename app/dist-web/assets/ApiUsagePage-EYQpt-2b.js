import{r as i,j as e}from"./vendor-react-DeR5d9Tv.js";import{C as w,a as I,b as y,d as A,c as D}from"./card-CJKskPxD.js";import{c as te,D as T,a as ae,Z as le,T as $,B as f,Y as re,V as oe,m as ne}from"./index-9iTO35Tf.js";import{S as E,a as O,b as R,c as q,d}from"./select-nIcj8TB_.js";import{u as ie,D as ce,a as de,b as xe,M as he,O as b,e as h,f as g,S as ge,R as pe,c as me,d as j,g as k,E as ue}from"./SortableTable-tUpSdEkA.js";import{D as je}from"./download-CVn5Mw3H.js";import{A as B}from"./activity-BM5rrAQU.js";import{I as ve}from"./info-Dy8QoNZy.js";import{f as V,x as fe}from"./vendor-date-fns-D0ugVOfH.js";import"./vendor-markdown-PIr_2kdo.js";import"./vendor-recharts-DrMJw15s.js";import"./vendor-radix-zn9KX-y8.js";import"./vendor-floating-ui-CESiY8Ey.js";import"./vendor-router-9bGSKQ4q.js";import"./check-Dj5_6VYs.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=te("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]),S={anthropic:{label:"Anthropic",color:"hsl(var(--chart-1))"},groq:{label:"Groq",color:"hsl(var(--chart-2))"},"google-drive":{label:"Google Drive",color:"hsl(var(--chart-3))"},"google-sheets":{label:"Google Sheets",color:"hsl(var(--chart-4))"},"google-calendar":{label:"Google Calendar",color:"hsl(var(--chart-5))"}},Ne={cost:{label:"Cost"},anthropic:{label:"Anthropic",color:"hsl(var(--chart-1))"},groq:{label:"Groq",color:"hsl(var(--chart-2))"},"google-drive":{label:"Google Drive",color:"hsl(var(--chart-3))"},"google-sheets":{label:"Google Sheets",color:"hsl(var(--chart-4))"},"google-calendar":{label:"Google Calendar",color:"hsl(var(--chart-5))"}},H={anthropic:{label:"Anthropic",color:"hsl(var(--chart-1))"},groq:{label:"Groq",color:"hsl(var(--chart-2))"},"google-drive":{label:"Google Drive",color:"hsl(var(--chart-3))"},"google-sheets":{label:"Google Sheets",color:"hsl(var(--chart-4))"},"google-calendar":{label:"Google Calendar",color:"hsl(var(--chart-5))"}},F={anthropic:"hsl(var(--chart-1))",groq:"hsl(var(--chart-2))","google-drive":"hsl(var(--chart-3))","google-sheets":"hsl(var(--chart-4))","google-calendar":"hsl(var(--chart-5))"},N={anthropic:"ðŸ¤–",groq:"ðŸŽ™ï¸","google-drive":"ðŸ“","google-sheets":"ðŸ“Š","google-calendar":"ðŸ“…"},Ce={ai:"bg-purple-500/10 text-purple-700 dark:text-purple-400",transcription:"bg-blue-500/10 text-blue-700 dark:text-blue-400",cloud:"bg-green-500/10 text-green-700 dark:text-green-400",tts:"bg-orange-500/10 text-orange-700 dark:text-orange-400",other:"bg-slate-500/10 text-slate-700 dark:text-slate-400"},we={name:(t,o)=>t.name.localeCompare(o.name),calls:(t,o)=>t.calls-o.calls,units:(t,o)=>t.units-o.units,cost:(t,o)=>t.cost-o.cost,trend:(t,o)=>t.trend-o.trend};function Oe(){const[t,o]=i.useState(null),[_,P]=i.useState(!0),[M,G]=i.useState(null),[C,z]=i.useState("30d"),[v,K]=i.useState("all");i.useEffect(()=>{(async()=>{P(!0),G(null);try{const a=parseInt(C),l=fe(new Date,a).toISOString().slice(0,10),c=new Date().toISOString().slice(0,10),n=await ne.getApiUsage({startDate:l,endDate:c});o(n)}catch(a){console.error("Failed to fetch API usage data:",a),G("Failed to load API usage data")}finally{P(!1)}})()},[C]);const W=i.useMemo(()=>t?v==="all"?t.summaries:t.summaries.filter(s=>s.category===v):[],[t,v]),{sortField:p,sortDirection:m,toggleSort:u,displayed:Y,expanded:U,setExpanded:Z,canExpand:Q,totalCount:L}=ie({data:W,defaultField:"cost",comparators:we}),J=i.useMemo(()=>t?t.costTrend.map(s=>({date:V(new Date(s.date),"MMM d"),anthropic:s.anthropic,groq:s.groq,"google-drive":s["google-drive"],"google-sheets":s["google-sheets"],"google-calendar":s["google-calendar"],total:s.total})):[],[t]),X=i.useMemo(()=>{if(!t)return[];const s=t.summaries.reduce((a,l)=>a+l.cost,0);return t.summaries.filter(a=>a.cost>0).map(a=>({apiId:a.apiId,name:a.name,cost:a.cost,value:s>0?Math.round(a.cost/s*100):0,fill:F[a.apiId]||"hsl(var(--chart-4))"})).sort((a,l)=>l.value-a.value)},[t]),ee=i.useMemo(()=>t?t.costTrend.slice(-7).map(a=>{const l=t.dailyUsage.filter(n=>n.date===a.date),c={date:V(new Date(a.date),"MMM d")};for(const n of t.providers){const x=l.find(r=>r.apiId===n.id);c[n.id]=(x==null?void 0:x.calls)||0}return c}):[],[t]),se=i.useCallback(()=>{if(!t)return;const s=["API","Category","Calls","Units","Unit Type","Cost ($)","Trend (%)","Avg Daily Cost ($)"],a=t.summaries.map(r=>[r.name,r.category,r.calls,r.units,r.unitType,r.cost.toFixed(4),r.trend.toFixed(1),r.avgDailyCost.toFixed(4)]),l=[s,...a].map(r=>r.join(",")).join(`
`),c=new Blob([l],{type:"text/csv"}),n=URL.createObjectURL(c),x=document.createElement("a");x.href=n,x.download=`api-usage-${new Date().toISOString().slice(0,10)}.csv`,x.click(),URL.revokeObjectURL(n)},[t]);return e.jsx(e.Fragment,{children:_?e.jsx(ce,{}):M||!t?e.jsx(de,{message:M??void 0}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(xe,{icon:T,title:"API Usage & Costs",description:"Track usage and costs across all integrated APIs",actions:e.jsxs(e.Fragment,{children:[e.jsxs(E,{value:C,onValueChange:s=>z(s),children:[e.jsx(O,{className:"w-[120px]",children:e.jsx(R,{})}),e.jsxs(q,{children:[e.jsx(d,{value:"7d",children:"7 days"}),e.jsx(d,{value:"14d",children:"14 days"}),e.jsx(d,{value:"30d",children:"30 days"}),e.jsx(d,{value:"90d",children:"90 days"})]})]}),e.jsxs(ae,{variant:"outline",size:"sm",onClick:se,className:"gap-1.5",children:[e.jsx(je,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"CSV"})]})]})}),t._mock&&e.jsxs(he,{children:[e.jsx("span",{className:"font-medium",children:"Sample data."})," Real cost tracking will be integrated via Clawdbot gateway logs, Groq usage logs, and Google API metrics."]}),e.jsxs("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-4",children:[e.jsx(b,{title:"Cost This Month",icon:T,accent:"bg-chart-1/10 text-chart-1",value:h(t.overview.monthCost),subtitle:`Projected: ${h(t.overview.projectedMonthlyCost)}/mo`}),e.jsx(b,{title:"API Calls This Month",icon:B,accent:"bg-chart-2/10 text-chart-2",value:g(t.overview.monthCalls),subtitle:`${g(t.overview.todayCalls)} today`}),e.jsx(b,{title:"Top API by Cost",icon:be,accent:"bg-chart-3/10 text-chart-3",value:`${N[t.overview.topApiId]||"ðŸ“¦"} ${t.overview.topApiName.split(" ")[0]}`,subtitle:h(t.overview.topApiCost)}),e.jsx(b,{title:"Today's Cost",icon:le,accent:"bg-chart-4/10 text-chart-4",value:h(t.overview.todayCost),subtitle:`${t.overview.todayCalls} calls`})]}),e.jsxs("div",{className:"grid gap-4 sm:gap-6 lg:grid-cols-3",children:[e.jsxs(w,{className:"lg:col-span-2",children:[e.jsxs(I,{className:"pb-2",children:[e.jsxs(y,{className:"text-lg flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Cost Trend"]}),e.jsx(A,{children:"Daily costs stacked by API provider"})]}),e.jsx(D,{children:e.jsx(ge,{data:J,config:S,dataKeys:Object.keys(S),gradientPrefix:"fill-cost",yTickFormatter:s=>`$${s.toFixed(2)}`,tooltipFormatter:(s,a)=>{var l;return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-muted-foreground",children:[((l=S[a])==null?void 0:l.label)||a,":"]})," ",e.jsxs("span",{className:"font-mono font-medium tabular-nums text-foreground",children:["$",s.toFixed(4)]})]})}})})]}),e.jsx(pe,{config:Ne,data:X,icon:T,title:"Cost Breakdown",description:"Monthly cost distribution (paid APIs only)",emptyMessage:"No paid API costs",legend:e.jsxs("div",{className:"space-y-3 px-2 pb-4",children:[t.summaries.filter(s=>s.cost>0).sort((s,a)=>a.cost-s.cost).map(s=>{const a=t.summaries.reduce((c,n)=>c+n.cost,0),l=a>0?(s.cost/a*100).toFixed(1):"0";return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-3 h-3 rounded-[2px] flex-shrink-0",style:{backgroundColor:F[s.apiId]}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",children:[N[s.apiId]," ",s.name.split("(")[0].trim()]}),e.jsxs("span",{className:"text-sm text-muted-foreground tabular-nums",children:[l,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:h(s.cost)}),e.jsx("span",{children:"Â·"}),e.jsxs("span",{children:[g(s.calls)," calls"]})]})]})]},s.apiId)}),t.summaries.filter(s=>s.cost===0).length>0&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Free Tier APIs"}),t.summaries.filter(s=>s.cost===0).map(s=>e.jsxs("div",{className:"flex items-center gap-3 py-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-[2px] flex-shrink-0",style:{backgroundColor:F[s.apiId]}}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs",children:[N[s.apiId]," ",s.name.split("(")[0].trim()]}),e.jsx(f,{variant:"outline",className:"text-[10px] px-1.5 py-0 bg-green-500/5 text-green-600 dark:text-green-400 border-green-500/20",children:"Free"})]})})]},s.apiId))]})]})})]}),e.jsx(me,{icon:re,title:"API Calls (Last 7 Days)",description:"Daily API call count by provider",config:H,data:ee,dataKeys:t.providers.map(s=>s.id),yTickFormatter:s=>g(s),tooltipFormatter:(s,a)=>{var l;return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-muted-foreground",children:[((l=H[a])==null?void 0:l.label)||a,":"]})," ",e.jsxs("span",{className:"font-mono font-medium tabular-nums text-foreground",children:[s.toLocaleString()," calls"]})]})},stacked:!0,barRadius:[2,2,0,0]}),e.jsxs(w,{children:[e.jsxs(I,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0 pb-2",children:[e.jsxs("div",{children:[e.jsxs(y,{className:"text-lg flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5"}),"API Breakdown"]}),e.jsx(A,{className:"mt-1",children:"Detailed usage and cost per API this month"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(E,{value:v,onValueChange:K,children:[e.jsx(O,{className:"w-[140px]",children:e.jsx(R,{placeholder:"All APIs"})}),e.jsxs(q,{children:[e.jsx(d,{value:"all",children:"All APIs"}),e.jsx(d,{value:"ai",children:"AI"}),e.jsx(d,{value:"transcription",children:"Transcription"}),e.jsx(d,{value:"cloud",children:"Cloud"})]})]}),e.jsxs(f,{variant:"outline",className:"text-xs",children:[L," APIs"]})]})]}),e.jsxs(D,{children:[e.jsx("div",{className:"overflow-x-auto -mx-6 px-6",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx(j,{field:"name",label:"API",activeField:p,direction:m,onToggle:u}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-muted-foreground hidden sm:table-cell",children:"Category"}),e.jsx(j,{field:"calls",label:"Calls",activeField:p,direction:m,onToggle:u,align:"right"}),e.jsx(j,{field:"units",label:"Usage",activeField:p,direction:m,onToggle:u,align:"right",className:"hidden md:table-cell"}),e.jsx(j,{field:"cost",label:"Cost",activeField:p,direction:m,onToggle:u,align:"right"}),e.jsx(j,{field:"trend",label:"Trend",activeField:p,direction:m,onToggle:u,align:"right",className:"hidden lg:table-cell"})]})}),e.jsx("tbody",{children:Y.map(s=>e.jsxs("tr",{className:"border-b border-border/50 hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-base",children:N[s.apiId]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm block",children:s.name}),s.inputUnits!==void 0&&s.outputUnits!==void 0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[k(s.inputUnits,s.unitType)," in Â·"," ",k(s.outputUnits,s.unitType)," out"]})]})]})}),e.jsx("td",{className:"py-3 px-2 hidden sm:table-cell",children:e.jsx(f,{variant:"outline",className:`text-xs ${Ce[s.category]||""}`,children:s.category})}),e.jsx("td",{className:"py-3 px-2 text-right tabular-nums",children:g(s.calls)}),e.jsxs("td",{className:"py-3 px-2 text-right tabular-nums text-muted-foreground hidden md:table-cell",children:[k(s.units,s.unitType),e.jsx("span",{className:"text-xs ml-1",children:s.unitType})]}),e.jsx("td",{className:"py-3 px-2 text-right tabular-nums font-medium",children:s.cost>0?h(s.cost):e.jsx(f,{variant:"outline",className:"text-[10px] px-1.5 py-0 bg-green-500/5 text-green-600 dark:text-green-400 border-green-500/20",children:"Free"})}),e.jsx("td",{className:"py-3 px-2 text-right hidden lg:table-cell",children:s.cost>0?e.jsxs("span",{className:`inline-flex items-center gap-1 text-xs font-medium ${s.trend>0?"text-red-600 dark:text-red-400":s.trend<0?"text-green-600 dark:text-green-400":"text-muted-foreground"}`,children:[s.trend>0?e.jsx($,{className:"h-3 w-3"}):s.trend<0?e.jsx(oe,{className:"h-3 w-3"}):null,s.trend>0?"+":"",s.trend.toFixed(1),"%"]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"â€”"})})]},s.apiId))})]})}),Q&&e.jsx(ue,{expanded:U,totalCount:L,label:"APIs",onToggle:()=>Z(!U)})]})]}),e.jsxs(w,{children:[e.jsxs(I,{className:"pb-2",children:[e.jsxs(y,{className:"text-lg flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5"}),"Pricing Reference"]}),e.jsx(A,{children:"Current pricing for tracked APIs"})]}),e.jsx(D,{children:e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg border p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ¤–"}),e.jsx("span",{className:"font-medium text-sm",children:"Anthropic (Claude)"})]}),e.jsx("div",{className:"space-y-1 text-xs text-muted-foreground",children:Object.entries(t.pricing.anthropic).map(([s,a])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:s.replace("claude-","").replace("-"," ")}),e.jsxs("span",{className:"tabular-nums",children:["$",(a.input*1e6).toFixed(2),"/",(a.output*1e6).toFixed(2)," /MTok"]})]},s))})]}),e.jsxs("div",{className:"rounded-lg border p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸŽ™ï¸"}),e.jsx("span",{className:"font-medium text-sm",children:"Groq (Whisper STT)"})]}),e.jsx("div",{className:"space-y-1 text-xs text-muted-foreground",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Whisper Large v3"}),e.jsxs("span",{className:"tabular-nums",children:["$",t.pricing.groq.whisper,"/second"]})]})})]}),e.jsxs("div",{className:"rounded-lg border p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"â˜ï¸"}),e.jsx("span",{className:"font-medium text-sm",children:"Google APIs"})]}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[Object.entries(t.pricing.googleQuota).map(([s,a])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"capitalize",children:s}),e.jsxs("span",{className:"tabular-nums",children:[g(a.daily),"/day"]})]},s)),e.jsx("div",{className:"pt-1 text-green-600 dark:text-green-400 font-medium",children:"âœ“ Free tier â€” no costs"})]})]})]})})]})]})})}export{Oe as ApiUsagePage};
