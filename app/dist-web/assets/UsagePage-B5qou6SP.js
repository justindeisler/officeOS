import{r as c,j as e}from"./vendor-react-wuMqdllU.js";import{C as D,a as M,b as O,d as F,c as E}from"./card-BzI8yNdX.js";import{B as A,l as q}from"./index-BVfXMJeG.js";import{T as J,a as X,b as T}from"./tabs-CGLAZhUC.js";import{S as Y,a as ee,b as te,c as ae,d as v}from"./select-BeRsbXBo.js";import{u as se,D as le,a as oe,b as re,M as ne,O as ie,f as i,S as ce,R as de,c as ue,d as j,E as me}from"./SortableTable-By6dK-UN.js";import{h as H,aP as pe,T as I,aQ as xe,aR as he,K as ge,aS as je,aT as be,Z as L}from"./vendor-icons-lkZWRnZW.js";import{f as k,x as fe}from"./vendor-date-fns-D0ugVOfH.js";import"./vendor-markdown-C3iCDuOK.js";import"./vendor-recharts-tRgwS7-V.js";import"./vendor-radix-BCh4MJnw.js";import"./vendor-floating-ui-BD6aHMKr.js";import"./vendor-router-Cm8Qzw9U.js";const ve={"opus-4-5":{label:"Opus 4.5",color:"hsl(var(--chart-1))"},"sonnet-4-5":{label:"Sonnet 4.5",color:"hsl(var(--chart-2))"},"haiku-4-5":{label:"Haiku 4.5",color:"hsl(var(--chart-3))"}},ke={input:{label:"Input Tokens",color:"hsl(var(--chart-2))"},output:{label:"Output Tokens",color:"hsl(var(--chart-3))"}},R={input:{label:"Input",color:"hsl(var(--chart-2))"},output:{label:"Output",color:"hsl(var(--chart-3))"}},ye={tokens:{label:"Tokens"},"opus-4-5":{label:"Opus 4.5",color:"hsl(var(--chart-1))"},"sonnet-4-5":{label:"Sonnet 4.5",color:"hsl(var(--chart-2))"},"haiku-4-5":{label:"Haiku 4.5",color:"hsl(var(--chart-3))"}},b={"opus-4-5":"Opus 4.5","sonnet-4-5":"Sonnet 4.5","haiku-4-5":"Haiku 4.5"},d={"opus-4-5":"hsl(var(--chart-1))","sonnet-4-5":"hsl(var(--chart-2))","haiku-4-5":"hsl(var(--chart-3))"},Ne={timestamp:(t,o)=>new Date(t.timestamp).getTime()-new Date(o.timestamp).getTime(),model:(t,o)=>t.model.localeCompare(o.model),inputTokens:(t,o)=>t.inputTokens-o.inputTokens,outputTokens:(t,o)=>t.outputTokens-o.outputTokens,total:(t,o)=>t.total-o.total};function B(t){return(o,f)=>{var p;return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-muted-foreground",children:[((p=t[f])==null?void 0:p.label)||f,":"]})," ",e.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:o.toLocaleString()})]})}}function Re(){const[t,o]=c.useState(null),[f,p]=c.useState(!0),[w,C]=c.useState(null),[u,U]=c.useState("day"),[n,$]=c.useState("all");c.useEffect(()=>{(async()=>{p(!0),C(null);try{const l=fe(new Date,30).toISOString().slice(0,10),a=new Date().toISOString().slice(0,10),r=await q.getTokenUsage({startDate:l,endDate:a,groupBy:u,model:n==="all"?void 0:n});o(r)}catch(l){console.error("Failed to fetch usage data:",l),C("Failed to load usage data")}finally{p(!1)}})()},[u,n]);const{sortField:x,sortDirection:h,toggleSort:g,displayed:K,expanded:S,setExpanded:_,canExpand:P,totalCount:V}=se({data:(t==null?void 0:t.sessions)??[],defaultField:"timestamp",comparators:Ne}),W=c.useMemo(()=>{if(!t)return[];const s=a=>u==="day"?k(new Date(a),"MMM d"):u==="week"?`W${k(new Date(a),"w")}`:k(new Date(a),"MMM yyyy");if(n!=="all")return t.trend.map(a=>({date:s(a.date),input:a.inputTokens,output:a.outputTokens}));const l=new Map;for(const a of t.trend){const r=s(a.date);l.has(r)||l.set(r,{});const m=l.get(r);m[a.model]=(m[a.model]||0)+a.tokens}return Array.from(l.entries()).map(([a,r])=>({date:a,...r}))},[t,u,n]),Z=c.useMemo(()=>{if(!t)return[];const s=Object.values(t.byModel).reduce((l,a)=>l+a.total,0);return Object.entries(t.byModel).map(([l,a])=>({model:l,name:b[l]||l,tokens:a.total,value:s>0?Math.round(a.total/s*100):0,fill:d[l]||"hsl(var(--chart-4))"})).sort((l,a)=>a.value-l.value)},[t]),z=c.useMemo(()=>t?Object.entries(t.byModel).map(([s,l])=>({name:b[s]||s,input:l.input,output:l.output})):[],[t]),y=n!=="all"?ke:ve,G=Object.keys(y);return e.jsx(e.Fragment,{children:f?e.jsx(le,{}):w||!t?e.jsx(oe,{message:w??void 0}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(re,{icon:H,title:"Token Usage",description:"Track AI token consumption across models",actions:e.jsxs(Y,{value:n,onValueChange:$,children:[e.jsxs(ee,{className:"w-[140px]",children:[e.jsx(pe,{className:"h-3.5 w-3.5 mr-1.5 text-muted-foreground"}),e.jsx(te,{placeholder:"All Models"})]}),e.jsxs(ae,{children:[e.jsx(v,{value:"all",children:"All Models"}),e.jsx(v,{value:"opus-4-5",children:"Opus 4.5"}),e.jsx(v,{value:"sonnet-4-5",children:"Sonnet 4.5"}),e.jsx(v,{value:"haiku-4-5",children:"Haiku 4.5"})]})]})}),t._mock&&e.jsxs(ne,{children:[e.jsx("span",{className:"font-medium",children:"Sample data."})," Real token tracking will be integrated when Clawdbot gateway exposes per-session usage metrics."]}),e.jsx("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-4",children:[{title:"All Time",icon:I,key:"total",accent:"bg-chart-1/10 text-chart-1"},{title:"This Month",icon:xe,key:"month",accent:"bg-chart-2/10 text-chart-2"},{title:"This Week",icon:he,key:"week",accent:"bg-chart-3/10 text-chart-3"},{title:"Today",icon:ge,key:"today",accent:"bg-chart-4/10 text-chart-4"}].map(({title:s,icon:l,key:a,accent:r})=>{const m=a==="total"?t.overview.total:t.overview[a],N=t.overview[a==="total"?"totalInput":`${a}Input`],Q=t.overview[a==="total"?"totalOutput":`${a}Output`];return e.jsx(ie,{title:s,icon:l,accent:r,value:i(m),children:e.jsxs("div",{className:"flex items-center gap-3 pt-1",children:[e.jsxs("span",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(je,{className:"h-3 w-3 text-chart-2"}),i(N)," in"]}),e.jsxs("span",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(be,{className:"h-3 w-3 text-chart-3"}),i(Q)," out"]})]})},a)})}),e.jsxs("div",{className:"grid gap-4 sm:gap-6 lg:grid-cols-3",children:[e.jsxs(D,{className:"lg:col-span-2",children:[e.jsxs(M,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0 space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsxs(O,{className:"text-lg flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Usage Trend"]}),e.jsx(F,{className:"mt-1",children:n!=="all"?`${b[n]} — input vs output tokens`:"Token usage stacked by model"})]}),e.jsx(J,{value:u,onValueChange:U,children:e.jsxs(X,{className:"h-8",children:[e.jsx(T,{value:"day",className:"text-xs px-2.5 h-6",children:"Daily"}),e.jsx(T,{value:"week",className:"text-xs px-2.5 h-6",children:"Weekly"}),e.jsx(T,{value:"month",className:"text-xs px-2.5 h-6",children:"Monthly"})]})})]}),e.jsx(E,{children:e.jsx(ce,{data:W,config:y,dataKeys:G,gradientPrefix:"fill",yTickFormatter:s=>i(s),tooltipFormatter:B(y)})})]}),e.jsx(de,{config:ye,data:Z,icon:L,title:"By Model",description:"Token distribution across models",legend:e.jsx("div",{className:"space-y-3 px-2 pb-4",children:Object.entries(t.byModel).map(([s,l])=>{const a=Object.values(t.byModel).reduce((m,N)=>m+N.total,0),r=a>0?(l.total/a*100).toFixed(1):"0";return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-3 h-3 rounded-[2px] flex-shrink-0",style:{backgroundColor:d[s]}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:b[s]}),e.jsxs("span",{className:"text-sm text-muted-foreground tabular-nums",children:[r,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[i(l.input)," in"]}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[i(l.output)," out"]})]})]})]},s)})})})]}),e.jsx(ue,{icon:H,title:"Input vs Output by Model",description:"Compare input and output token usage across each model",config:R,data:z,dataKeys:["input","output"],yTickFormatter:s=>i(s),tooltipFormatter:B(R)}),e.jsxs(D,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs("div",{children:[e.jsxs(O,{className:"text-lg flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Recent Sessions"]}),e.jsx(F,{className:"mt-1",children:"Detailed breakdown of individual sessions"})]}),e.jsxs(A,{variant:"outline",className:"text-xs",children:[t.sessions.length," sessions"]})]}),e.jsxs(E,{children:[e.jsx("div",{className:"overflow-x-auto -mx-6 px-6",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx(j,{field:"timestamp",label:"Date",activeField:x,direction:h,onToggle:g}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-muted-foreground hidden sm:table-cell",children:"Activity"}),e.jsx(j,{field:"model",label:"Model",activeField:x,direction:h,onToggle:g}),e.jsx(j,{field:"inputTokens",label:"Input",activeField:x,direction:h,onToggle:g,align:"right",className:"hidden md:table-cell"}),e.jsx(j,{field:"outputTokens",label:"Output",activeField:x,direction:h,onToggle:g,align:"right",className:"hidden md:table-cell"}),e.jsx(j,{field:"total",label:"Total",activeField:x,direction:h,onToggle:g,align:"right"})]})}),e.jsx("tbody",{children:K.map(s=>e.jsxs("tr",{className:"border-b border-border/50 hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"py-2.5 px-2 whitespace-nowrap text-muted-foreground",children:k(new Date(s.timestamp),"MMM d, HH:mm")}),e.jsx("td",{className:"py-2.5 px-2 hidden sm:table-cell",children:e.jsx("span",{className:"truncate block max-w-[300px]",children:s.activity})}),e.jsx("td",{className:"py-2.5 px-2",children:e.jsx(A,{variant:"outline",className:"text-xs font-normal",style:{borderColor:d[s.model]?`color-mix(in srgb, ${d[s.model]} 40%, transparent)`:void 0,color:d[s.model],backgroundColor:d[s.model]?`color-mix(in srgb, ${d[s.model]} 10%, transparent)`:void 0},children:b[s.model]||s.model})}),e.jsx("td",{className:"py-2.5 px-2 text-right tabular-nums text-muted-foreground hidden md:table-cell",children:i(s.inputTokens)}),e.jsx("td",{className:"py-2.5 px-2 text-right tabular-nums text-muted-foreground hidden md:table-cell",children:i(s.outputTokens)}),e.jsx("td",{className:"py-2.5 px-2 text-right tabular-nums font-medium",children:i(s.total)})]},s.id))})]})}),P&&e.jsx(me,{expanded:S,totalCount:V,label:"Sessions",onToggle:()=>_(!S)})]})]})]})})}export{Re as UsagePage};
