import{r as l,j as t}from"./vendor-react-wuMqdllU.js";import{i as d,E as ce,a as S,L as le}from"./index-BVfXMJeG.js";import{g as de}from"./income-CPECZ-5R.js";import{g as ue}from"./expenses-CRnvtng3.js";import{g as X}from"./db-B8uq--hH.js";import{E as me}from"./index-uXN-dP3D.js";import{u as xe,I as fe}from"./IncomeDialog-Bs_ArY_K.js";import{u as pe,E as he}from"./ExpenseDialog-CMmBUnT-.js";import{A as ge}from"./AssetDialog-kQ6z_ijH.js";import{R as U,B as je,C as ee,X as te,Y as ne,T as B,L as q,a as K,b as be,d as z,P as ve,e as Ne,f as ye}from"./vendor-recharts-tRgwS7-V.js";import{ag as De,ah as Ee,ai as we,ad as Q,T as Ce,c as Ie,e as Me,d as Fe,R as ke,r as $,h as Ae,aj as Te,C as Pe}from"./vendor-icons-lkZWRnZW.js";import"./table-Q9An8_Qc.js";import"./card-BzI8yNdX.js";import"./vendor-markdown-C3iCDuOK.js";import"./vendor-radix-BCh4MJnw.js";import"./vendor-floating-ui-BD6aHMKr.js";import"./vendor-router-Cm8Qzw9U.js";import"./dialog-B7DVSW16.js";import"./vendor-forms-B8CBK7X2.js";import"./select-BeRsbXBo.js";import"./assets-B0pxIYIb.js";import"./vendor-framer-motion-C26rlN9R.js";import"./alert-dialog-BkE8aMwJ.js";const P={income:"hsl(142, 76%, 36%)",expenses:"hsl(0, 84.2%, 60.2%)",profit:"hsl(199, 89%, 48%)"};function G(e,n){return{id:e.id,invoiceNumber:e.invoice_number,invoiceDate:new Date(e.invoice_date),dueDate:new Date(e.due_date),status:e.status,clientId:e.client_id??void 0,projectId:e.project_id??void 0,subtotal:e.subtotal??0,vatRate:e.vat_rate??19,vatAmount:e.vat_amount??0,total:e.total??0,paymentDate:e.payment_date?new Date(e.payment_date):void 0,paymentMethod:e.payment_method,notes:e.notes??void 0,items:n,createdAt:new Date(e.created_at)}}function Se(e){return{id:e.id,invoiceId:e.invoice_id,description:e.description,quantity:e.quantity??1,unit:e.unit??"hours",unitPrice:e.unit_price??0,amount:e.amount??0}}async function Re(e){return(await(await X()).select("SELECT * FROM invoice_items WHERE invoice_id = $1",[e])).map(Se)}async function Le(){try{const n=await(await X()).select("SELECT * FROM invoices ORDER BY invoice_date DESC"),s=[];for(const r of n)try{const a=await Re(r.id);s.push(G(r,a))}catch(a){console.error(`Failed to get items for invoice ${r.id}:`,a),s.push(G(r,[]))}return s}catch(e){throw console.error("getAllInvoices error:",e),e}}function Ye(){const e=new Date().getMonth();return e<3?1:e<6?2:e<9?3:4}function _e(e={}){const{year:n=new Date().getFullYear(),quarter:s=Ye(),autoFetch:r=!0}=e,[a,o]=l.useState(null),[i,c]=l.useState(!1),[x,m]=l.useState(null),[p,F]=l.useState(n),[v,I]=l.useState(s),E=l.useCallback((u,k,w)=>{const y=u.filter(f=>f.date.getFullYear()===p),C=k.filter(f=>f.date.getFullYear()===p),R=y.reduce((f,A)=>f+A.grossAmount,0),L=C.reduce((f,A)=>f+A.grossAmount,0),b=R-L,M=w.filter(f=>f.status==="sent"||f.status==="overdue"),h=M.length,g=M.reduce((f,A)=>f+A.total,0),Y=new Date(p,(v-1)*3,1),oe=new Date(p,v*3,0),ie=y.filter(f=>f.date>=Y&&f.date<=oe).reduce((f,A)=>f+A.vatAmount,0);return{totalIncome:Math.round(R*100)/100,totalExpenses:Math.round(L*100)/100,profit:Math.round(b*100)/100,pendingInvoices:h,pendingAmount:Math.round(g*100)/100,currentQuarterVat:Math.round(ie*100)/100}},[p,v]),N=l.useCallback(async()=>{c(!0),m(null);try{const[u,k,w]=await Promise.all([de(),ue(),Le()]),y=E(u,k,w);o(y)}catch(u){m(u instanceof Error?u.message:"Failed to load stats"),o(null)}finally{c(!1)}},[E]),j=l.useCallback(async()=>{await N()},[N]);return l.useEffect(()=>{r&&N()},[r,N]),{stats:a,isLoading:i,error:x,refresh:j,year:p,quarter:v,setYear:F,setQuarter:I}}function V(e,n,s){const r=Array.from({length:12},(a,o)=>({year:s,month:o+1,income:0,expenses:0,profit:0,vatCollected:0,vatPaid:0,transactionCount:0}));return e.filter(a=>a.date.getFullYear()===s).forEach(a=>{const o=a.date.getMonth();r[o].income+=a.netAmount,r[o].vatCollected+=a.vatAmount,r[o].transactionCount+=1}),n.filter(a=>a.date.getFullYear()===s).forEach(a=>{const o=a.date.getMonth();r[o].expenses+=a.netAmount,r[o].vatPaid+=a.vatAmount,r[o].transactionCount+=1}),r.forEach(a=>{a.profit=a.income-a.expenses}),r}function Oe(e){if(e.length===0)return[];const n=Ve(e),s=J(e,"netAmount");return Object.entries(n).map(([a,o])=>{const i=J(o,"netAmount"),c=o.length,x=me[a],m=(x==null?void 0:x.label)??a;return{category:a,label:m,amount:i,percentage:s>0?i/s*100:0,transactionCount:c,averageTransaction:c>0?i/c:0}}).sort((a,o)=>o.amount-a.amount)}function Qe(e,n,s){const r=[];if(r.push(_("totalIncome","Total Income",e.totalIncome,n.totalIncome,"currency")),r.push(_("totalExpenses","Total Expenses",e.totalExpenses,n.totalExpenses,"currency")),r.push(_("profit","Net Profit",e.profit,n.profit,"currency")),e.totalIncome>0||n.totalIncome>0){const a=e.totalIncome>0?e.profit/e.totalIncome*100:0,o=n.totalIncome>0?n.profit/n.totalIncome*100:0;r.push(_("profitMargin","Profit Margin",a,o,"percent"))}return r}function _(e,n,s,r,a){const o=s-r,i=ze(s,r);return{metric:e,label:n,currentYear:s,previousYear:r,change:o,changePercent:i,trend:Ge(o),format:a}}function $e(e){return e.map(n=>({month:se(n.month),monthIndex:n.month,income:n.income,expenses:n.expenses,profit:n.profit}))}function Ue(e){let n=0;return e.map(s=>(n+=s.profit,{month:se(s.month),monthIndex:s.month,profit:s.profit,cumulativeProfit:n}))}function Be(e){const n=["hsl(222.2, 47.4%, 11.2%)","hsl(142, 76%, 36%)","hsl(38, 92%, 50%)","hsl(199, 89%, 48%)","hsl(0, 84.2%, 60.2%)","hsl(280, 65%, 60%)","hsl(180, 60%, 45%)","hsl(30, 80%, 55%)"];return e.map((s,r)=>({name:s.label,value:s.amount,percentage:s.percentage,color:n[r%n.length]}))}const qe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Ke=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function se(e,n="en"){const r=Math.max(1,Math.min(12,e))-1;return n==="de"?Ke[r]:qe[r]}function ze(e,n){return n===0&&e===0?0:n===0?100:(e-n)/n*100}function Ge(e){return e>0?"up":e<0?"down":"neutral"}function J(e,n){return e.reduce((s,r)=>{const a=r[n];return s+(typeof a=="number"?a:0)},0)}function Ve(e){const n={};return e.forEach(s=>{const r=s.euerCategory;n[r]||(n[r]=[]),n[r].push(s)}),n}function Je(e,n,s){return e.length===0?0:re(e,"income")*3}function We(e,n,s){return e.length===0?0:re(e,"expenses")*3}function re(e,n){if(e.length===0)return 0;const s=[...e].sort((o,i)=>o.year!==i.year?o.year-i.year:o.month-i.month);let r=0,a=0;return s.forEach((o,i)=>{const c=Math.pow(1.2,i);a+=o[n]*c,r+=c}),r>0?a/r:0}function He(e,n){return e-n}function Ze(e){return e<3?"low":e<6?"medium":"high"}function Xe(e,n){const r={low:.3,medium:.2,high:.1}[n];return{low:e*(1-r),high:e*(1+r)}}function et(e,n,s){let a=n*3-1+1+(s?1:0),o=e;return a>11&&(a=a-12,o=e+1),new Date(o,a,10)}function tt(e,n,s,r){const a=Je(e),o=We(e),i=a*.19,c=o*.19,x=He(i,c),m=e.length,p=Ze(m),F=Xe(x,p),v=et(n,s,r);return{period:rt(n,s),year:n,quarter:s,projectedIncome:a,projectedExpenses:o,projectedUmsatzsteuer:i,projectedVorsteuer:c,estimatedZahllast:x,confidence:p,dueDate:v,hasDauerfrist:r,dataPointsUsed:m,projectionRange:F}}function nt(e){return Math.ceil(e/3)}function st(){const e=new Date().getMonth()+1;return nt(e)}function rt(e,n){return`${e}-Q${n}`}function at(e){const{year:n,previousYear:s=n-1,hasDauerfrist:r=!1}=e,{income:a,isLoading:o,error:i}=xe({autoFetch:!0}),{expenses:c,isLoading:x,error:m}=pe({autoFetch:!0}),p=o||x,F=i||m,v=l.useMemo(()=>a.filter(b=>b.date.getFullYear()===n),[a,n]),I=l.useMemo(()=>c.filter(b=>b.date.getFullYear()===n),[c,n]),E=l.useMemo(()=>a.filter(b=>b.date.getFullYear()===s),[a,s]),N=l.useMemo(()=>c.filter(b=>b.date.getFullYear()===s),[c,s]),j=l.useMemo(()=>V(v,I,n),[v,I,n]),u=l.useMemo(()=>V(E,N,s),[E,N,s]),k=l.useMemo(()=>$e(j),[j]),w=l.useMemo(()=>Ue(j),[j]),y=l.useMemo(()=>Oe(I),[I]),C=l.useMemo(()=>Be(y),[y]),R=l.useMemo(()=>{const b=j.filter(Y=>Y.income>0||Y.expenses>0);if(b.length===0)return null;const M=st(),h=M===4?1:M+1,g=M===4?n+1:n;return tt(b,g,h,r)},[j,n,r]),L=l.useMemo(()=>{const b={totalIncome:j.reduce((h,g)=>h+g.income,0),totalExpenses:j.reduce((h,g)=>h+g.expenses,0),profit:j.reduce((h,g)=>h+g.profit,0)},M={totalIncome:u.reduce((h,g)=>h+g.income,0),totalExpenses:u.reduce((h,g)=>h+g.expenses,0),profit:u.reduce((h,g)=>h+g.profit,0)};return Qe(b,M)},[j,u,n]);return{plChartData:k,profitTrendData:w,expenseDonutData:C,categoryBreakdown:y,taxForecast:R,yearComparison:L,currentYear:n,previousYear:s,isLoading:p,error:F}}function ot(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function it({active:e,payload:n,label:s}){return!e||!n||n.length===0?null:t.jsxs("div",{className:"rounded-lg border bg-background p-3 shadow-md",children:[t.jsx("p",{className:"font-medium text-sm mb-2",children:s}),n.map((r,a)=>t.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": ",ot(r.value)]},a))]})}function ct({data:e,title:n,height:s=300,className:r}){return!e||e.length===0?t.jsx("div",{className:d("flex items-center justify-center",r),style:{height:s},children:t.jsx("p",{className:"text-muted-foreground text-sm",children:"No data available"})}):t.jsxs("div",{className:d("w-full",r),children:[n&&t.jsx("h3",{className:"text-lg font-semibold mb-4",children:n}),t.jsx(U,{width:"100%",height:s,children:t.jsxs(je,{data:e,margin:{top:10,right:30,left:0,bottom:0},role:"img","aria-label":"Income vs Expenses chart",children:[t.jsx(ee,{strokeDasharray:"3 3",className:"stroke-muted"}),t.jsx(te,{dataKey:"month",tick:{fontSize:12},className:"text-muted-foreground"}),t.jsx(ne,{tick:{fontSize:12},tickFormatter:a=>Math.abs(a)>=1e3?`${(a/1e3).toFixed(1)}k`:a.toFixed(0),className:"text-muted-foreground"}),t.jsx(B,{content:t.jsx(it,{})}),t.jsx(q,{wrapperStyle:{paddingTop:"10px"},formatter:a=>t.jsx("span",{className:"text-sm text-foreground",children:a})}),t.jsx(K,{dataKey:"income",name:"Income",fill:P.income,radius:[4,4,0,0]}),t.jsx(K,{dataKey:"expenses",name:"Expenses",fill:P.expenses,radius:[4,4,0,0]})]})})]})}function lt(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function dt({active:e,payload:n,label:s}){return!e||!n||n.length===0?null:t.jsxs("div",{className:"rounded-lg border bg-background p-3 shadow-md",children:[t.jsx("p",{className:"font-medium text-sm mb-2",children:s}),n.map((r,a)=>t.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": ",lt(r.value)]},a))]})}function ut({data:e,title:n,height:s=300,showCumulative:r=!0,className:a}){return!e||e.length===0?t.jsx("div",{className:d("flex items-center justify-center",a),style:{height:s},children:t.jsx("p",{className:"text-muted-foreground text-sm",children:"No data available"})}):t.jsxs("div",{className:d("w-full",a),children:[n&&t.jsx("h3",{className:"text-lg font-semibold mb-4",children:n}),t.jsx(U,{width:"100%",height:s,children:t.jsxs(be,{data:e,margin:{top:10,right:30,left:0,bottom:0},role:"img","aria-label":"Profit trend chart",children:[t.jsx(ee,{strokeDasharray:"3 3",className:"stroke-muted"}),t.jsx(te,{dataKey:"month",tick:{fontSize:12},className:"text-muted-foreground"}),t.jsx(ne,{tick:{fontSize:12},tickFormatter:o=>Math.abs(o)>=1e3?`${(o/1e3).toFixed(1)}k`:o.toFixed(0),className:"text-muted-foreground"}),t.jsx(B,{content:t.jsx(dt,{})}),t.jsx(q,{wrapperStyle:{paddingTop:"10px"},formatter:o=>t.jsx("span",{className:"text-sm text-foreground",children:o})}),t.jsx(z,{type:"monotone",dataKey:"profit",name:"Monthly Profit",stroke:P.profit,strokeWidth:2,dot:{fill:P.profit,r:4},activeDot:{r:6}}),r&&t.jsx(z,{type:"monotone",dataKey:"cumulativeProfit",name:"Cumulative Profit",stroke:P.income,strokeWidth:2,strokeDasharray:"5 5",dot:{fill:P.income,r:4},activeDot:{r:6}})]})})]})}function ae(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function mt({active:e,payload:n}){if(!e||!n||n.length===0)return null;const s=n[0].payload;return t.jsxs("div",{className:"rounded-lg border bg-background p-3 shadow-md",children:[t.jsx("p",{className:"font-medium text-sm mb-1",children:s.name}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:[ae(s.value)," (",s.percentage.toFixed(1),"%)"]})]})}function xt({data:e,title:n,height:s=300,showTotal:r=!1,className:a}){if(!e||e.length===0)return t.jsx("div",{className:d("flex items-center justify-center",a),style:{height:s},children:t.jsx("p",{className:"text-muted-foreground text-sm",children:"No data available"})});const o=e.reduce((i,c)=>i+c.value,0);return t.jsxs("div",{className:d("w-full",a),children:[n&&t.jsx("h3",{className:"text-lg font-semibold mb-4",children:n}),t.jsxs("div",{className:"relative",children:[t.jsx(U,{width:"100%",height:s,children:t.jsxs(ve,{role:"img","aria-label":"Expense breakdown chart",children:[t.jsx(Ne,{data:e,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:2,dataKey:"value",nameKey:"name",children:e.map((i,c)=>t.jsx(ye,{fill:i.color},`cell-${c}`))}),t.jsx(B,{content:t.jsx(mt,{})}),t.jsx(q,{verticalAlign:"bottom",height:36,formatter:i=>t.jsx("span",{className:"text-sm text-foreground",children:i})})]})}),r&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:t.jsxs("div",{className:"text-center",style:{marginBottom:"36px"},children:[t.jsx("p",{className:"text-2xl font-bold",children:ae(o)}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"})]})})]})]})}function T(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function W(e){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(e)}function ft(e){const n="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium";switch(e){case"high":return d(n,"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200");case"medium":return d(n,"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200");case"low":return d(n,"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200")}}function pt({forecast:e,variant:n="default",className:s}){const r=e.estimatedZahllast<0,a=n==="compact";return t.jsxs("div",{className:d("rounded-lg border bg-card p-6",s),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Tax Forecast"}),t.jsx("p",{className:"text-2xl font-bold text-foreground",children:e.period})]}),t.jsxs("div",{className:"flex flex-col items-end gap-2",children:[t.jsxs("span",{className:ft(e.confidence),children:[e.confidence.charAt(0).toUpperCase()+e.confidence.slice(1)," confidence"]}),e.hasDauerfrist&&t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",children:"Dauerfrist"})]})]}),t.jsxs("div",{className:"mb-6 p-4 rounded-lg bg-muted/50",children:[t.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:["Estimated ",r?"Refund (Erstattung)":"Payment (Zahllast)"]}),t.jsxs("p",{className:d("text-3xl font-bold",r?"text-green-600 dark:text-green-400":"text-foreground"),children:[r?"-":"",T(Math.abs(e.estimatedZahllast))]}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Range: ",T(e.projectionRange.low)," – ",T(e.projectionRange.high)]})]}),!a&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Projected Income"}),t.jsx("p",{className:"text-lg font-semibold",children:T(e.projectedIncome)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Projected Expenses"}),t.jsx("p",{className:"text-lg font-semibold",children:T(e.projectedExpenses)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"USt (Collected)"}),t.jsx("p",{className:"text-lg font-semibold",children:T(e.projectedUmsatzsteuer)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Vorsteuer (Paid)"}),t.jsx("p",{className:"text-lg font-semibold",children:T(e.projectedVorsteuer)})]})]}),t.jsxs("div",{className:"flex items-center justify-between pt-4 border-t text-sm text-muted-foreground",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Due Date:"})," ",W(e.dueDate)]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Based on:"})," ",e.dataPointsUsed," months of data"]})]})]}),a&&t.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[t.jsxs("span",{children:["Due: ",W(e.dueDate)]}),t.jsxs("span",{children:[e.dataPointsUsed," months data"]})]})]})}function H(e,n){switch(n){case"currency":return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);case"percent":return new Intl.NumberFormat("de-DE",{style:"percent",minimumFractionDigits:1,maximumFractionDigits:1}).format(e/100);case"number":default:return new Intl.NumberFormat("de-DE").format(e)}}function ht(e,n){return n===0&&e===0?0:n===0?100:(e-n)/n*100}function gt(e){return e>0?"up":e<0?"down":"neutral"}function jt(e,n){if(e==="neutral")return"text-muted-foreground";const s=e==="up";return(n?s:!s)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}function bt({trend:e,className:n}){switch(e){case"up":return t.jsx(we,{"data-testid":"trend-up",className:n});case"down":return t.jsx(Ee,{"data-testid":"trend-down",className:n});case"neutral":default:return t.jsx(De,{"data-testid":"trend-neutral",className:n})}}function vt({title:e,currentValue:n,previousValue:s,format:r,positiveIsGood:a=!0,className:o}){const i=n-s,c=ht(n,s),x=gt(i),m=jt(x,a);return t.jsxs("div",{className:d("rounded-lg border bg-card p-4",o),children:[t.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:e}),t.jsx("p",{className:"text-2xl font-bold mb-2",children:H(n,r)}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(bt,{trend:x,className:d("h-4 w-4",m)}),t.jsxs("span",{className:d("text-sm font-medium",m),children:[Math.abs(c).toFixed(1),"%"]}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:["vs ",H(s,r)]})]})]})}function Nt(e){return!["totalExpenses","expenses","vatPaid","taxOwed"].includes(e)}function yt({comparisons:e,currentYear:n,previousYear:s,title:r,className:a}){if(!e||e.length===0)return t.jsx("div",{className:d("flex items-center justify-center p-8",a),children:t.jsx("p",{className:"text-muted-foreground text-sm",children:"No data available"})});const o=r||`${n} vs ${s}`;return t.jsxs("div",{className:d("space-y-4",a),children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsx("h2",{className:"text-xl font-semibold",children:o})}),t.jsx("div",{"data-testid":"comparison-grid",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:e.map(i=>t.jsx(vt,{title:i.label,currentValue:i.currentYear,previousValue:i.previousYear,format:i.format,positiveIsGood:Nt(i.metric)},i.metric))})]})}function D(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e)}function Z(e){return`Q${e}`}function O({title:e,value:n,subtitle:s,icon:r,testId:a,colorClass:o,onClick:i,tabIndex:c=0,ariaLabel:x}){return t.jsx("div",{"data-testid":a,className:d("rounded-lg border bg-card p-6 shadow-sm",o,i&&"cursor-pointer hover:bg-accent/50 transition-colors"),onClick:i,onKeyDown:m=>{i&&(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),i())},tabIndex:i?c:void 0,role:i?"button":void 0,"aria-label":x||e,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:e}),t.jsx("p",{className:"text-2xl font-bold mt-1",children:n}),s&&t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s})]}),t.jsx("div",{className:"flex items-center justify-center",children:r})]})})}function Dt({onNavigate:e,className:n}){const{stats:s,isLoading:r,error:a,refresh:o,year:i,quarter:c,setYear:x}=_e(),[m,p]=l.useState(!1),[F,v]=l.useState(!1),[I,E]=l.useState(!1),[N,j]=l.useState(!0),u=at({year:i,hasDauerfrist:!1});if(r)return t.jsx("div",{className:d("space-y-6",n),children:t.jsxs("div",{className:"flex items-center justify-center p-12",children:[t.jsx(Q,{className:"h-8 w-8 animate-spin text-muted-foreground"}),t.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading..."})]})});if(a)return t.jsx("div",{className:d("space-y-6",n),children:t.jsxs("div",{className:"rounded-lg border border-destructive bg-destructive/10 p-6",children:[t.jsx("p",{className:"text-destructive",children:ce(a)}),t.jsxs(S,{variant:"outline",onClick:o,className:"mt-4",children:[t.jsx(Q,{className:"mr-2 h-4 w-4"}),"Retry"]})]})});const k=s?s.profit>0?"text-green-600":s.profit<0?"text-red-600":"":"",w=new Date().getFullYear(),y=[w-2,w-1,w];return t.jsxs("div",{className:d("space-y-6",n),children:[t.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Dashboard"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(le,{htmlFor:"year-select",className:"hidden sm:inline",children:"Period"}),t.jsx("select",{id:"year-select","aria-label":"Period",className:"flex h-9 rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",value:i,onChange:C=>x(Number(C.target.value)),children:y.map(C=>t.jsx("option",{value:C,children:C},C))})]}),t.jsxs(S,{variant:"outline",size:"sm",onClick:o,children:[t.jsx(Q,{className:"mr-2 h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]})]}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Current Quarter: ",Z(c)," ",i]}),t.jsxs("div",{className:"grid gap-4 grid-cols-2 sm:grid-cols-3 lg:grid-cols-5",children:[t.jsx(O,{title:"Total Income",value:D(s?s.totalIncome:0),icon:t.jsx(Ce,{className:"h-6 w-6 text-green-600"}),testId:"income-card",ariaLabel:"Total Income",onClick:()=>e==null?void 0:e("income"),tabIndex:0}),t.jsx(O,{title:"Total Expenses",value:D(s?s.totalExpenses:0),icon:t.jsx(Ie,{className:"h-6 w-6 text-red-600"}),testId:"expenses-card",ariaLabel:"Total Expenses",onClick:()=>e==null?void 0:e("expenses"),tabIndex:0}),t.jsx("div",{"data-testid":"profit-card",className:d("rounded-lg border bg-card p-6 shadow-sm",k),"aria-label":"Profit",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Profit"}),t.jsx("p",{className:"text-2xl font-bold mt-1",children:D(s?s.profit:0)}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s&&s.profit>0?"Net gain":s&&s.profit<0?"Net loss":"Break even"})]}),t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(Me,{className:"h-6 w-6"})})]})}),t.jsx(O,{title:"Pending Invoices",value:s?s.pendingInvoices.toString():"0",subtitle:D(s?s.pendingAmount:0),icon:t.jsx(Fe,{className:"h-6 w-6 text-orange-600"}),testId:"pending-card",ariaLabel:"Pending Invoices",onClick:()=>e==null?void 0:e("invoices"),tabIndex:0}),t.jsx(O,{title:"VAT (USt)",value:D(s?s.currentQuarterVat:0),subtitle:`${Z(c)} ${i}`,icon:t.jsx(ke,{className:"h-6 w-6 text-blue-600"}),testId:"vat-card",ariaLabel:"Current Quarter VAT"})]}),t.jsxs("div",{className:"rounded-lg border bg-card p-6 shadow-sm","data-testid":"quick-actions",children:[t.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"flex flex-wrap gap-3",children:[t.jsxs(S,{onClick:()=>p(!0),"data-testid":"add-income-btn",children:[t.jsx($,{className:"mr-2 h-4 w-4"}),"Add Income"]}),t.jsxs(S,{variant:"outline",onClick:()=>v(!0),"data-testid":"add-expense-btn",children:[t.jsx($,{className:"mr-2 h-4 w-4"}),"Add Expense"]}),t.jsxs(S,{variant:"outline",onClick:()=>E(!0),"data-testid":"add-asset-btn",children:[t.jsx($,{className:"mr-2 h-4 w-4"}),"Add Asset"]})]})]}),t.jsxs("div",{className:"rounded-lg border bg-card shadow-sm","data-testid":"reports-section",children:[t.jsxs("button",{className:"flex w-full items-center justify-between p-6 text-left",onClick:()=>j(!N),"aria-expanded":N,"aria-controls":"reports-content",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ae,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("h2",{className:"text-lg font-semibold",children:"Reports & Analytics"})]}),N?t.jsx(Te,{className:"h-5 w-5 text-muted-foreground"}):t.jsx(Pe,{className:"h-5 w-5 text-muted-foreground"})]}),N&&t.jsxs("div",{id:"reports-content",className:"space-y-6 px-6 pb-6",children:[t.jsx(yt,{comparisons:u.yearComparison,currentYear:u.currentYear,previousYear:u.previousYear}),u.taxForecast&&t.jsx(pt,{forecast:u.taxForecast}),t.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[t.jsx("div",{className:"rounded-lg border bg-background p-4",children:t.jsx(ct,{data:u.plChartData,title:"Income vs Expenses",height:280})}),t.jsx("div",{className:"rounded-lg border bg-background p-4",children:t.jsx(ut,{data:u.profitTrendData,title:"Profit Trend",height:280})})]}),t.jsx("div",{className:"rounded-lg border bg-background p-4",children:t.jsx(xt,{data:u.expenseDonutData,title:"Expense Breakdown",height:300,showTotal:!0})})]})]}),t.jsx(fe,{open:m,onOpenChange:p,income:null,onClose:()=>p(!1)}),t.jsx(he,{open:F,onOpenChange:v,expense:null,onClose:()=>v(!1)}),t.jsx(ge,{open:I,onOpenChange:E,asset:null,onClose:()=>E(!1)})]})}function Vt(){return t.jsx(Dt,{})}export{Vt as AccountingPage};
