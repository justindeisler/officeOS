import{r as n,j as e}from"./vendor-react-wuMqdllU.js";import{m as M,z as te,B as ae,a as p,L as i,I as d}from"./index-BJ9hpEov.js";import{C as ne,c as re}from"./card-BOU-q13f.js";import{D as ie,a as le,b as de,c as G}from"./dropdown-menu-Dz1PdlGq.js";import{C as W}from"./confirm-delete-dialog-D3P6PPsQ.js";import{B as ce,a5 as oe,V as me,a6 as he,G as X,a7 as xe,t as H,U as ue}from"./vendor-icons-ssgfUAX_.js";import{D as ge,a as je,b as pe,c as ve,d as fe,e as Ne}from"./dialog-BPcAFwmD.js";import{T as Ce}from"./textarea-D5YM9rKe.js";import{S as Z,a as K,b as q,c as J,d as u}from"./select-DW4QIkWb.js";import"./vendor-markdown-C3iCDuOK.js";import"./vendor-recharts-tRgwS7-V.js";import"./vendor-radix-DqeMb71O.js";import"./vendor-floating-ui-BD6aHMKr.js";import"./vendor-router-Cm8Qzw9U.js";import"./alert-dialog-CMM_3WOV.js";const be={active:"bg-green-500/10 text-green-500 border-green-500/20",inactive:"bg-gray-500/10 text-gray-500 border-gray-500/20",archived:"bg-red-500/10 text-red-500 border-red-500/20"};function Q({client:a,onEdit:v}){const{deleteClient:s}=M(),c=te(a.id),o=c.filter(l=>l.status==="active").length,[g,m]=n.useState(!1),h=()=>{s(a.id),m(!1)};return e.jsxs(ne,{className:"group",children:[e.jsx(re,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-medium truncate",children:a.name}),e.jsx(ae,{variant:"outline",className:be[a.status],children:a.status})]}),a.company&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground mb-2",children:[e.jsx(ce,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"truncate",children:a.company})]}),a.email&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground mb-2",children:[e.jsx(oe,{className:"h-3.5 w-3.5"}),e.jsx("a",{href:`mailto:${a.email}`,className:"truncate hover:text-foreground transition-colors",children:a.email})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[c.length," projects"]}),o>0&&e.jsxs("span",{className:"text-green-500",children:[o," active"]})]})]}),e.jsxs(ie,{children:[e.jsx(le,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsxs(de,{align:"end",children:[e.jsxs(G,{onClick:()=>v(a),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(G,{onClick:()=>m(!0),className:"text-destructive focus:text-destructive",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})}),e.jsx(W,{open:g,onOpenChange:m,title:`Delete ${a.name}?`,description:"This will permanently delete the client. This action cannot be undone.",onConfirm:h})]})}function ye({open:a,onOpenChange:v,client:s,onClose:c}){const{addClient:o,updateClient:g,deleteClient:m}=M(),[h,l]=n.useState(""),[j,r]=n.useState(""),[U,b]=n.useState(""),[L,y]=n.useState(""),[V,D]=n.useState(""),[O,S]=n.useState("active"),[w,I]=n.useState(""),[F,E]=n.useState(""),[T,k]=n.useState(""),[R,A]=n.useState("Deutschland"),[x,z]=n.useState("domestic"),[B,P]=n.useState(""),[Y,_]=n.useState(!1),f=!!s;n.useEffect(()=>{var t,C,N,$;s?(l(s.name),r(s.email||""),b(s.company||""),y(s.contactInfo||""),D(s.notes||""),S(s.status),I(((t=s.address)==null?void 0:t.street)||""),E(((C=s.address)==null?void 0:C.zip)||""),k(((N=s.address)==null?void 0:N.city)||""),A((($=s.address)==null?void 0:$.country)||"Deutschland"),z(s.clientType||"domestic"),P(s.vatId||"")):(l(""),r(""),b(""),y(""),D(""),S("active"),I(""),E(""),k(""),A("Deutschland"),z("domestic"),P(""))},[s,a]);const ee=t=>{if(t.preventDefault(),!h.trim())return;const C=w.trim()||F.trim()||T.trim(),N={name:h.trim(),email:j.trim()||void 0,company:U.trim()||void 0,contactInfo:L.trim()||void 0,notes:V.trim()||void 0,status:O,address:C?{street:w.trim()||void 0,zip:F.trim()||void 0,city:T.trim()||void 0,country:R.trim()||"Deutschland"}:void 0,clientType:x||"domestic",vatId:B.trim()||void 0};f&&s?g(s.id,N):o(N),c()},se=()=>{s&&(m(s.id),_(!1),c())};return e.jsx(ge,{open:a,onOpenChange:v,children:e.jsxs(je,{className:"w-[calc(100vw-2rem)] max-w-[540px] max-h-[90vh] overflow-y-auto",children:[e.jsxs("form",{onSubmit:ee,children:[e.jsxs(pe,{children:[e.jsx(ve,{children:f?"Client bearbeiten":"Neuer Client"}),e.jsx(fe,{children:f?"Clientdaten aktualisieren.":"Neuen Client für Projekte und Rechnungen anlegen."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"name",children:"Name *"}),e.jsx(d,{id:"name",value:h,onChange:t=>l(t.target.value),placeholder:"Vor- und Nachname oder Firmenname",autoFocus:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"company",children:"Firma"}),e.jsx(d,{id:"company",value:U,onChange:t=>b(t.target.value),placeholder:"Firmenname (optional)"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"email",children:"E-Mail"}),e.jsx(d,{id:"email",type:"email",value:j,onChange:t=>r(t.target.value),placeholder:"client@example.com"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"contactInfo",children:"Telefon / Sonstiges"}),e.jsx(d,{id:"contactInfo",value:L,onChange:t=>y(t.target.value),placeholder:"+49 123 456789"})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(i,{className:"text-sm font-medium",children:"Adresse"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"street",className:"text-xs text-muted-foreground",children:"Straße und Hausnummer"}),e.jsx(d,{id:"street",value:w,onChange:t=>I(t.target.value),placeholder:"Musterstraße 1"})]}),e.jsxs("div",{className:"grid grid-cols-[110px_1fr] gap-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"zip",className:"text-xs text-muted-foreground",children:"PLZ"}),e.jsx(d,{id:"zip",value:F,onChange:t=>E(t.target.value),placeholder:"10115",maxLength:10})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"city",className:"text-xs text-muted-foreground",children:"Stadt"}),e.jsx(d,{id:"city",value:T,onChange:t=>k(t.target.value),placeholder:"Berlin"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"country",className:"text-xs text-muted-foreground",children:"Land"}),e.jsx(d,{id:"country",value:R,onChange:t=>A(t.target.value),placeholder:"Deutschland"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"clientType",children:"Kundentyp"}),e.jsxs(Z,{value:x,onValueChange:t=>z(t),children:[e.jsx(K,{children:e.jsx(q,{})}),e.jsxs(J,{children:[e.jsx(u,{value:"domestic",children:"Inland"}),e.jsx(u,{value:"eu_b2b",children:"EU B2B"}),e.jsx(u,{value:"eu_b2c",children:"EU B2C"}),e.jsx(u,{value:"third_country",children:"Drittland"})]})]}),x==="eu_b2b"&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Reverse-Charge: Steuerschuldnerschaft geht auf den Leistungsempfänger über (§13b UStG)."})]}),(x==="eu_b2b"||x==="eu_b2c")&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(i,{htmlFor:"vatId",children:["USt-IdNr. ",x==="eu_b2b"&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(d,{id:"vatId",value:B,onChange:t=>P(t.target.value),placeholder:"z.B. ATU12345678"}),x==="eu_b2b"&&!B&&e.jsx("p",{className:"text-xs text-orange-600",children:"Für Reverse-Charge ist die USt-IdNr. erforderlich."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"status",children:"Status"}),e.jsxs(Z,{value:O,onValueChange:t=>S(t),children:[e.jsx(K,{children:e.jsx(q,{})}),e.jsxs(J,{children:[e.jsx(u,{value:"active",children:"Aktiv"}),e.jsx(u,{value:"inactive",children:"Inaktiv"}),e.jsx(u,{value:"archived",children:"Archiviert"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"notes",children:"Notizen"}),e.jsx(Ce,{id:"notes",value:V,onChange:t=>D(t.target.value),placeholder:"Interne Notizen...",rows:3})]})]}),e.jsxs(Ne,{className:"flex justify-between",children:[f&&e.jsxs(p,{type:"button",variant:"destructive",size:"sm",onClick:()=>_(!0),children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),"Löschen"]}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx(p,{type:"button",variant:"outline",onClick:c,children:"Abbrechen"}),e.jsx(p,{type:"submit",children:f?"Speichern":"Erstellen"})]})]})]}),e.jsx(W,{open:Y,onOpenChange:_,title:`${s==null?void 0:s.name} löschen?`,description:"Der Client wird dauerhaft gelöscht. Diese Aktion kann nicht rückgängig gemacht werden.",onConfirm:se})]})})}function Le(){const{clients:a}=M(),[v,s]=n.useState(!1),[c,o]=n.useState(null),g=()=>{o(null),s(!0)},m=r=>{o(r),s(!0)},h=()=>{s(!1),o(null)},l=a.filter(r=>r.status==="active"),j=a.filter(r=>r.status!=="active");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Clients"})}),e.jsxs(p,{onClick:g,className:"w-full sm:w-auto",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Add Client"]})]}),a.length===0?e.jsxs("div",{className:"rounded-lg border bg-card p-12 text-center",children:[e.jsx(ue,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No clients yet"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"Add your first client to start managing projects and invoices."}),e.jsxs(p,{onClick:g,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Add Client"]})]}):e.jsxs("div",{className:"space-y-6",children:[l.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm font-medium text-muted-foreground mb-3",children:["Active (",l.length,")"]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:l.map(r=>e.jsx(Q,{client:r,onEdit:m},r.id))})]}),j.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm font-medium text-muted-foreground mb-3",children:["Inactive/Archived (",j.length,")"]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:j.map(r=>e.jsx(Q,{client:r,onEdit:m},r.id))})]})]}),e.jsx(ye,{open:v,onOpenChange:s,client:c,onClose:h})]})}export{Le as ClientsPage};
