import{r as f,j as e}from"./vendor-react-wuMqdllU.js";import{u as I}from"./clientAuthStore-BiU0w-K1.js";import{a as K}from"./index-BVfXMJeG.js";import{aW as M,aX as C,aa as k,aY as U}from"./vendor-icons-lkZWRnZW.js";import"./vendor-markdown-C3iCDuOK.js";import"./client-D5AfTN0W.js";import"./vendor-recharts-tRgwS7-V.js";import"./vendor-radix-BCh4MJnw.js";import"./vendor-floating-ui-BD6aHMKr.js";import"./vendor-router-Cm8Qzw9U.js";const N={tables:[{name:"User",fields:[{name:"id",type:"uuid",isPrimaryKey:!0},{name:"email",type:"varchar"},{name:"name",type:"varchar"},{name:"role",type:"enum"},{name:"partnerId",type:"uuid",isForeignKey:!0}],x:50,y:50},{name:"Course",fields:[{name:"id",type:"uuid",isPrimaryKey:!0},{name:"title",type:"varchar"},{name:"slug",type:"varchar"},{name:"status",type:"enum"},{name:"instructorId",type:"uuid",isForeignKey:!0},{name:"price",type:"decimal"}],x:350,y:50},{name:"Module",fields:[{name:"id",type:"uuid",isPrimaryKey:!0},{name:"courseId",type:"uuid",isForeignKey:!0},{name:"title",type:"varchar"},{name:"type",type:"enum"},{name:"order",type:"int"},{name:"releaseAfterDays",type:"int?"}],x:650,y:50},{name:"Lesson",fields:[{name:"id",type:"uuid",isPrimaryKey:!0},{name:"moduleId",type:"uuid",isForeignKey:!0},{name:"title",type:"varchar"},{name:"type",type:"enum"},{name:"order",type:"int"}],x:950,y:50},{name:"Partner",fields:[{name:"id",type:"uuid",isPrimaryKey:!0},{name:"slug",type:"varchar"},{name:"name",type:"varchar"},{name:"status",type:"enum"}],x:50,y:330},{name:"Enrollment",fields:[{name:"id",type:"uuid",isPrimaryKey:!0},{name:"userId",type:"uuid",isForeignKey:!0},{name:"courseId",type:"uuid",isForeignKey:!0},{name:"enrolledAt",type:"timestamp"},{name:"completedAt",type:"timestamp"}],x:350,y:330},{name:"UserProgress",fields:[{name:"id",type:"uuid",isPrimaryKey:!0},{name:"userId",type:"uuid",isForeignKey:!0},{name:"lessonId",type:"uuid",isForeignKey:!0},{name:"completed",type:"boolean"}],x:950,y:330},{name:"Order",fields:[{name:"id",type:"uuid",isPrimaryKey:!0},{name:"userId",type:"uuid",isForeignKey:!0},{name:"orderNumber",type:"varchar"},{name:"status",type:"enum"},{name:"total",type:"decimal"}],x:50,y:600},{name:"Payment",fields:[{name:"id",type:"uuid",isPrimaryKey:!0},{name:"orderId",type:"uuid",isForeignKey:!0},{name:"amount",type:"decimal"},{name:"status",type:"enum"}],x:350,y:600},{name:"Certificate",fields:[{name:"id",type:"uuid",isPrimaryKey:!0},{name:"userId",type:"uuid",isForeignKey:!0},{name:"courseId",type:"uuid",isForeignKey:!0},{name:"certificateNumber",type:"varchar"}],x:650,y:600}],relationships:[{from:"User",fromField:"partnerId",to:"Partner",toField:"id"},{from:"Course",fromField:"instructorId",to:"User",toField:"id"},{from:"Module",fromField:"courseId",to:"Course",toField:"id"},{from:"Lesson",fromField:"moduleId",to:"Module",toField:"id"},{from:"Enrollment",fromField:"userId",to:"User",toField:"id"},{from:"Enrollment",fromField:"courseId",to:"Course",toField:"id"},{from:"UserProgress",fromField:"userId",to:"User",toField:"id"},{from:"UserProgress",fromField:"lessonId",to:"Lesson",toField:"id"},{from:"Order",fromField:"userId",to:"User",toField:"id"},{from:"Payment",fromField:"orderId",to:"Order",toField:"id"},{from:"Certificate",fromField:"userId",to:"User",toField:"id"},{from:"Certificate",fromField:"courseId",to:"Course",toField:"id"}]};function Y({table:c,isHighlighted:x,isDimmed:l,onHover:h,onLeave:u}){return e.jsxs("div",{className:`absolute bg-white rounded-lg shadow-md border-2 min-w-[200px] transition-all duration-200 cursor-pointer ${x?"border-amber-400 shadow-lg shadow-amber-100 scale-105 z-20":l?"border-gray-200 opacity-40":"border-gray-200 hover:border-blue-300 hover:shadow-lg z-10"}`,style:{left:c.x,top:c.y},onMouseEnter:h,onMouseLeave:u,children:[e.jsx("div",{className:`px-4 py-2 rounded-t-lg font-semibold text-sm text-white ${x?"bg-amber-500":"bg-slate-800"}`,children:c.name}),e.jsx("div",{className:"divide-y divide-gray-100",children:c.fields.map(r=>e.jsxs("div",{className:"px-4 py-1.5 flex items-center justify-between gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[r.isPrimaryKey&&e.jsx("span",{className:"text-amber-500 font-bold text-xs",title:"Primary Key",children:"PK"}),r.isForeignKey&&e.jsx("span",{className:"text-blue-500 font-bold text-xs",title:"Foreign Key",children:"FK"}),e.jsx("span",{className:r.isPrimaryKey?"font-medium":"",children:r.name})]}),e.jsx("span",{className:"text-gray-400 text-xs",children:r.type})]},r.name))})]})}function z({tables:c,relationships:x,highlightedTable:l}){const h=u=>{const r=c.find(i=>i.name===u);if(!r)return{x:0,y:0,width:200,height:150};const s=r.fields.length;return{x:r.x,y:r.y,width:200,height:40+s*28}};return e.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:5},children:[e.jsxs("defs",{children:[e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#3b82f6"})}),e.jsx("marker",{id:"arrowhead-highlight",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#f59e0b"})})]}),x.map((u,r)=>{const s=h(u.from),i=h(u.to),g=l&&(u.from===l||u.to===l),p=l&&!g,j=s.x+s.width/2,v=s.y+s.height/2,F=i.x+i.width/2,w=i.y+i.height/2;let o,a,d,n;Math.abs(v-w)<100?(j<F?(o=s.x+s.width,d=i.x):(o=s.x,d=i.x+i.width),a=v,n=w):(o=j,d=F,v<w?(a=s.y+s.height,n=i.y):(a=s.y,n=i.y+i.height));const b=(o+d)/2,t=(a+n)/2,m=20;let y;return Math.abs(a-n)<50?y=`M ${o} ${a} C ${o+m} ${a}, ${d-m} ${n}, ${d} ${n}`:Math.abs(o-d)<50?y=`M ${o} ${a} C ${o} ${a+m}, ${d} ${n-m}, ${d} ${n}`:y=`M ${o} ${a} Q ${b} ${a} ${b} ${t} Q ${b} ${n} ${d} ${n}`,e.jsxs("g",{children:[e.jsx("path",{d:y,fill:"none",stroke:"white",strokeWidth:"5",opacity:p?.3:1}),e.jsx("path",{d:y,fill:"none",stroke:g?"#f59e0b":"#3b82f6",strokeWidth:g?"3":"2",opacity:p?.2:1,markerEnd:g?"url(#arrowhead-highlight)":"url(#arrowhead)"})]},r)})]})}function H(){const{client:c}=I(),[x,l]=f.useState(1),[h,u]=f.useState({x:0,y:0}),[r,s]=f.useState(!1),[i,g]=f.useState({x:0,y:0}),[p,j]=f.useState(null),v=f.useRef(null),F=(c==null?void 0:c.company)==="Wellfy GmbH",w=()=>l(t=>Math.min(t+.2,2)),o=()=>l(t=>Math.max(t-.2,.4)),a=()=>{l(1),u({x:0,y:0})},d=t=>{t.button===0&&(s(!0),g({x:t.clientX-h.x,y:t.clientY-h.y}))},n=t=>{r&&u({x:t.clientX-i.x,y:t.clientY-i.y})},b=()=>{s(!1)};return f.useEffect(()=>{const t=v.current;if(!t)return;const m=y=>{if(y.ctrlKey||y.metaKey){y.preventDefault();const $=y.deltaY>0?-.1:.1;l(P=>Math.min(Math.max(P+$,.4),2))}};return t.addEventListener("wheel",m,{passive:!1}),()=>t.removeEventListener("wheel",m)},[]),F?e.jsxs("div",{className:"space-y-4 h-[calc(100vh-8rem)]",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Architecture"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Wellfy database schema"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-lg border shadow-sm p-1",children:[e.jsx(K,{variant:"ghost",size:"icon",onClick:o,title:"Zoom out",children:e.jsx(M,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm text-muted-foreground w-12 text-center",children:[Math.round(x*100),"%"]}),e.jsx(K,{variant:"ghost",size:"icon",onClick:w,title:"Zoom in",children:e.jsx(C,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-px h-6 bg-border"}),e.jsx(K,{variant:"ghost",size:"icon",onClick:a,title:"Reset view",children:e.jsx(k,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{ref:v,className:"relative bg-slate-50 rounded-lg border overflow-hidden flex-1",style:{height:"calc(100% - 60px)",cursor:r?"grabbing":"grab"},onMouseDown:d,onMouseMove:n,onMouseUp:b,onMouseLeave:b,children:[e.jsxs("div",{className:"absolute top-3 left-3 z-10 flex items-center gap-2 text-xs text-muted-foreground bg-white/80 px-2 py-1 rounded",children:[e.jsx(U,{className:"h-3 w-3"}),"Drag to pan â€¢ Ctrl+scroll to zoom"]}),e.jsxs("div",{className:"absolute",style:{transform:`translate(${h.x}px, ${h.y}px) scale(${x})`,transformOrigin:"0 0",width:"1400px",height:"900px"},children:[e.jsx(z,{tables:N.tables,relationships:N.relationships,highlightedTable:p}),N.tables.map(t=>e.jsx(Y,{table:t,isHighlighted:p===t.name,isDimmed:p!==null&&p!==t.name&&!N.relationships.some(m=>m.from===p&&m.to===t.name||m.to===p&&m.from===t.name),onHover:()=>j(t.name),onLeave:()=>j(null)},t.name))]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Architecture"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Database schema visualization"})]}),e.jsx("div",{className:"flex items-center justify-center h-[60vh] bg-muted/30 rounded-lg border-2 border-dashed",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No architecture diagram available for this client."})})})]})}export{H as ClientArchitecturePage};
