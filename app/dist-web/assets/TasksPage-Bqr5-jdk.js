import{j as e,r as i}from"./vendor-react-wuMqdllU.js";import{i as O,j as te,a as B,I as ee,L as z,k as J,l as K,B as Ge,u as q,e as je,m as Qe,n as be,o as We,t as Xe}from"./index-JZoliObr.js";import{u as ve,a as ie,s as ye,K as Ne,P as we,b as Ye,D as ke,c as Ze,S as Se,v as Ce,d as Te,C as De,e as He,f as et,g as tt}from"./vendor-dnd-DTa4U0Pz.js";import{X as de,u as st,r as se,v as ue,w as at,x as Fe,y as he,z as me,E as ge,G as Ie,U as nt,J as rt,d as Oe,j as le,K as ot,N as it,O as lt,Q as ct,V as dt,m as ut}from"./vendor-icons-CHGo4Fp8.js";import{g as mt,T as xt,h as ht,C as Ee}from"./vendor-radix-BCh4MJnw.js";import{D as Ae,a as Re,b as Pe,c as Je,d as ze,e as Me}from"./dialog-BM5s3xjO.js";import"./alert-dialog-WF8eNeVO.js";import{f as Le}from"./vendor-date-fns-D0ugVOfH.js";import{T as gt}from"./textarea-CvD7_vDa.js";import{S as G,a as Q,b as W,c as X,d as F}from"./select-Btjdd6HG.js";import{S as pt}from"./switch-BX48Ujxy.js";import{C as Be}from"./confirm-delete-dialog-CQVr6K2O.js";import{e as ft,g as jt,d as bt}from"./markdown-DZSA0cWY.js";import{u as vt}from"./confettiStore-BwB9PceD.js";import"./vendor-markdown-C3iCDuOK.js";import"./vendor-recharts-tRgwS7-V.js";import"./vendor-router-Cm8Qzw9U.js";import"./vendor-floating-ui-BD6aHMKr.js";function yt(a){const t=a.replace("#",""),s=parseInt(t.substring(0,2),16),o=parseInt(t.substring(2,4),16),x=parseInt(t.substring(4,6),16);return(.299*s+.587*o+.114*x)/255>.55?"#000000":"#ffffff"}function ce({tag:a,onRemove:t,className:s,size:o="sm"}){const x=a.color||"#6b7280",g=yt(x);return e.jsxs("span",{className:O("inline-flex items-center gap-1 rounded-full font-medium whitespace-nowrap",o==="sm"?"px-1.5 py-0.5 text-[10px] leading-tight":"px-2 py-0.5 text-xs",s),style:{backgroundColor:x,color:g},children:[a.name,t&&e.jsx("button",{type:"button",onClick:d=>{d.stopPropagation(),t()},className:"ml-0.5 rounded-full hover:opacity-80 focus:outline-none",style:{color:g},children:e.jsx(de,{className:o==="sm"?"h-2.5 w-2.5":"h-3 w-3"})})]})}const Ke=mt,Ve=xt,xe=i.forwardRef(({className:a,align:t="center",sideOffset:s=4,...o},x)=>e.jsx(ht,{children:e.jsx(Ee,{ref:x,align:t,sideOffset:s,className:O("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...o})}));xe.displayName=Ee.displayName;function Nt({selectedIds:a,onChange:t}){const{tags:s,createTag:o}=te(),[x,g]=i.useState(!1),[d,r]=i.useState(""),[m,j]=i.useState(!1),w=s.filter(n=>n.name.toLowerCase().includes(d.toLowerCase())),k=s.filter(n=>a.includes(n.id)),b=n=>{a.includes(n)?t(a.filter(l=>l!==n)):t([...a,n])},y=async()=>{if(!d.trim()||m)return;j(!0);const n=await o({name:d.trim()});n&&(t([...a,n.id]),r("")),j(!1)},T=d.trim()&&w.length===0;return e.jsxs(Ke,{open:x,onOpenChange:g,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(B,{type:"button",variant:"outline",role:"combobox","aria-expanded":x,className:"w-full justify-between h-auto min-h-10",children:[k.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:k.map(n=>e.jsx(ce,{tag:n,onRemove:()=>b(n.id)},n.id))}):e.jsx("span",{className:"text-muted-foreground",children:"Select tags..."}),e.jsx(st,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsxs(xe,{className:"w-[280px] p-2",align:"start",children:[e.jsx(ee,{placeholder:"Search or create tag...",value:d,onChange:n=>r(n.target.value),className:"mb-2 h-8 text-sm",onKeyDown:n=>{n.key==="Enter"&&T&&(n.preventDefault(),y())}}),e.jsxs("div",{className:"max-h-48 overflow-y-auto",children:[w.map(n=>e.jsx(wt,{tag:n,selected:a.includes(n.id),onToggle:()=>b(n.id)},n.id)),T&&e.jsxs("button",{type:"button",onClick:y,disabled:m,className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm text-muted-foreground hover:bg-accent hover:text-accent-foreground",children:[e.jsx(se,{className:"h-3.5 w-3.5"}),'Create "',d.trim(),'"']}),!d&&s.length===0&&e.jsx("p",{className:"px-2 py-3 text-center text-sm text-muted-foreground",children:"No tags yet. Type to create one."})]})]})]})}function wt({tag:a,selected:t,onToggle:s}){return e.jsxs("button",{type:"button",onClick:s,className:O("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-accent hover:text-accent-foreground",t&&"bg-accent/50"),children:[e.jsx("span",{className:"h-3 w-3 rounded-full shrink-0 border border-white/20",style:{backgroundColor:a.color||"#6b7280"}}),e.jsx("span",{className:"flex-1 text-left truncate",children:a.name}),t&&e.jsx(ue,{className:"h-3.5 w-3.5 text-primary shrink-0"})]})}function kt(){const{tags:a,filterTagIds:t,setFilterTagIds:s}=te(),[o,x]=i.useState(!1);if(a.length===0)return null;const g=r=>{t.includes(r)?s(t.filter(m=>m!==r)):s([...t,r])},d=()=>s([]);return e.jsxs(Ke,{open:o,onOpenChange:x,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(B,{variant:"outline",size:"sm",className:"h-10 gap-2",children:[e.jsx(at,{className:"h-4 w-4"}),"Tags",t.length>0&&e.jsx("span",{className:"ml-1 flex h-5 w-5 items-center justify-center rounded-full bg-primary text-[10px] font-bold text-primary-foreground",children:t.length})]})}),e.jsxs(xe,{className:"w-56 p-2",align:"start",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 pb-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Filter by tag"}),t.length>0&&e.jsxs("button",{onClick:d,className:"text-xs text-muted-foreground hover:text-foreground flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),"Clear"]})]}),e.jsx("div",{className:"max-h-56 overflow-y-auto space-y-0.5",children:a.map(r=>{const m=t.includes(r.id);return e.jsxs("button",{onClick:()=>g(r.id),className:O("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-accent transition-colors",m&&"bg-accent"),children:[e.jsx("span",{className:O("h-3 w-3 rounded-full shrink-0 border-2 transition-colors",m?"border-primary":"border-transparent"),style:{backgroundColor:r.color||"#6b7280"}}),e.jsx("span",{className:"flex-1 text-left truncate",children:r.name}),m&&e.jsx("span",{className:"text-xs text-primary font-medium",children:"âœ“"})]},r.id)})})]})]})}const oe=["#ef4444","#f97316","#f59e0b","#eab308","#22c55e","#14b8a6","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#a855f7","#ec4899","#6b7280","#1e293b"];function St({open:a,onOpenChange:t}){const{tags:s,createTag:o,updateTag:x,deleteTag:g}=te(),[d,r]=i.useState(null),[m,j]=i.useState(""),[w,k]=i.useState(oe[0]),[b,y]=i.useState(null),[T,n]=i.useState(!1),l=()=>{r(null),j(""),k(oe[0])},p=u=>{r(u),j(u.name),k(u.color||oe[0])},h=async u=>{if(u.preventDefault(),!(!m.trim()||T)){n(!0);try{d?(await x(d.id,{name:m.trim(),color:w}),J.success(`Tag "${m.trim()}" updated`)):await o({name:m.trim(),color:w})&&J.success(`Tag "${m.trim()}" created`),l()}finally{n(!1)}}},v=async()=>{b&&(await g(b.id),J.success(`Tag "${b.name}" deleted`),y(null),(d==null?void 0:d.id)===b.id&&l())};return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{open:a,onOpenChange:u=>{t(u),u||l()},children:e.jsxs(Re,{className:"w-[calc(100vw-2rem)] max-w-[480px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Pe,{children:[e.jsxs(Je,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5"}),"Manage Tags"]}),e.jsx(ze,{children:"Create, edit, and delete tags used to organize your tasks."})]}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"tag-name",children:d?"Edit Tag":"New Tag"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ee,{id:"tag-name",value:m,onChange:u=>j(u.target.value),placeholder:"Tag name...",className:"flex-1",autoComplete:"off"}),e.jsx(B,{type:"submit",size:"sm",disabled:!m.trim()||T,children:d?e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"h-3.5 w-3.5 mr-1"}),"Save"]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-3.5 w-3.5 mr-1"}),"Add"]})}),d&&e.jsx(B,{type:"button",variant:"ghost",size:"sm",onClick:l,children:"Cancel"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{children:"Color"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[oe.map(u=>e.jsx("button",{type:"button",onClick:()=>k(u),className:"h-7 w-7 rounded-full border-2 transition-all hover:scale-110",style:{backgroundColor:u,borderColor:w===u?"var(--primary)":"transparent",boxShadow:w===u?"0 0 0 2px var(--background), 0 0 0 4px var(--primary)":void 0},title:u},u)),e.jsxs("label",{className:"relative h-7 w-7 rounded-full border-2 border-dashed border-muted-foreground/40 flex items-center justify-center cursor-pointer hover:border-muted-foreground/70 transition-colors",title:"Custom color",children:[e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground",children:"#"}),e.jsx("input",{type:"color",value:w,onChange:u=>k(u.target.value),className:"absolute inset-0 opacity-0 cursor-pointer"})]})]}),m.trim()&&e.jsxs("div",{className:"pt-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground mr-2",children:"Preview:"}),e.jsx(ce,{tag:{id:"preview",name:m.trim(),color:w},size:"md"})]})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsxs("h4",{className:"text-sm font-medium mb-3",children:["Existing Tags (",s.length,")"]}),s.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No tags yet. Create one above!"}):e.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:s.map(u=>e.jsxs("div",{className:"flex items-center justify-between rounded-md px-2 py-1.5 hover:bg-muted/50 group",children:[e.jsx(ce,{tag:u,size:"md"}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>p(u),className:"p-1 rounded hover:bg-muted",title:"Edit tag",children:e.jsx(he,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsx("button",{onClick:()=>y(u),className:"p-1 rounded hover:bg-destructive/10",title:"Delete tag",children:e.jsx(me,{className:"h-3.5 w-3.5 text-destructive"})})]})]},u.id))})]}),e.jsx(Me,{children:e.jsx(B,{variant:"outline",onClick:()=>t(!1),children:"Done"})})]})}),e.jsx(Be,{open:!!b,onOpenChange:u=>{u||y(null)},title:`Delete tag "${b==null?void 0:b.name}"?`,description:"This will remove the tag from all tasks. This action cannot be undone.",onConfirm:v})]})}function Ct(a){const t={};for(const[s,o]of Object.entries(a)){const x=s.replace(/_([a-z])/g,(g,d)=>d.toUpperCase());t[x]=o}return t}function pe(a){const t=Ct(a);return{id:t.id,taskId:t.taskId,title:t.title,completed:!!t.completed,sortOrder:t.sortOrder??0,createdAt:t.createdAt}}function Tt({taskId:a,enabled:t=!0}){const[s,o]=i.useState([]),[x,g]=i.useState(!1),[d,r]=i.useState(null),m=i.useRef(!1),j=i.useCallback(async()=>{if(!(!a||!t)){g(!0),r(null);try{const l=(await K.getSubtasks(a)).map(pe);o(l),m.current=!0}catch(n){console.error("Failed to fetch subtasks:",n),r("Failed to load subtasks")}finally{g(!1)}}},[a,t]);i.useEffect(()=>{t&&!m.current&&j()},[t,j]),i.useEffect(()=>{m.current=!1,o([])},[a]);const w=i.useCallback(async n=>{if(!n.trim())return;const l=crypto.randomUUID(),p={id:l,taskId:a,title:n.trim(),completed:!1,sortOrder:s.length,createdAt:new Date().toISOString()};o(h=>[...h,p]);try{const h=await K.createSubtask(a,n.trim()),v=pe(h);o(u=>u.map(I=>I.id===l?v:I))}catch(h){console.error("Failed to create subtask:",h),o(v=>v.filter(u=>u.id!==l)),J.error("Failed to add subtask")}},[a,s.length]),k=i.useCallback(async(n,l)=>{o(p=>p.map(h=>h.id===n?{...h,completed:l}:h));try{await K.updateSubtask(n,{completed:l?1:0})}catch(p){console.error("Failed to toggle subtask:",p),o(h=>h.map(v=>v.id===n?{...v,completed:!l}:v)),J.error("Failed to update subtask")}},[]),b=i.useCallback(async(n,l)=>{var h;if(!l.trim())return;const p=(h=s.find(v=>v.id===n))==null?void 0:h.title;o(v=>v.map(u=>u.id===n?{...u,title:l.trim()}:u));try{await K.updateSubtask(n,{title:l.trim()})}catch(v){console.error("Failed to update subtask:",v),p&&o(u=>u.map(I=>I.id===n?{...I,title:p}:I)),J.error("Failed to update subtask")}},[s]),y=i.useCallback(async n=>{const l=s;o(p=>p.filter(h=>h.id!==n));try{await K.deleteSubtask(n)}catch(p){console.error("Failed to delete subtask:",p),o(l),J.error("Failed to delete subtask")}},[s]),T=i.useCallback(async n=>{const l=s,p=n.map(h=>s.find(v=>v.id===h)).filter(h=>h!==void 0).map((h,v)=>({...h,sortOrder:v}));o(p);try{await K.reorderSubtasks(a,n)}catch(h){console.error("Failed to reorder subtasks:",h),o(l),J.error("Failed to reorder subtasks")}},[a,s]);return{subtasks:s,isLoading:x,error:d,addSubtask:w,toggleSubtask:k,updateSubtask:b,deleteSubtask:y,reorderSubtasks:T,refresh:j}}function Dt({subtask:a,onToggle:t,onDelete:s}){const{attributes:o,listeners:x,setNodeRef:g,transform:d,transition:r,isDragging:m}=Te({id:a.id}),j={transform:De.Transform.toString(d),transition:r};return e.jsxs("div",{ref:g,style:j,className:O("group flex items-center gap-2 py-1.5 px-1 rounded-md transition-colors",m&&"opacity-50 bg-muted",!m&&"hover:bg-muted/50"),children:[e.jsx("button",{className:"cursor-grab touch-none opacity-0 group-hover:opacity-60 transition-opacity shrink-0",...o,...x,children:e.jsx(Ie,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsx("button",{onClick:()=>t(a.id,!a.completed),className:O("shrink-0 w-4 h-4 rounded-full border-2 flex items-center justify-center transition-all duration-200",a.completed?"bg-green-500 border-green-500":"border-muted-foreground/50 hover:border-green-500"),children:a.completed&&e.jsx(ue,{className:"h-2.5 w-2.5 text-white",strokeWidth:3})}),e.jsx("span",{className:O("flex-1 text-sm transition-all",a.completed&&"text-muted-foreground line-through"),children:a.title}),e.jsx("button",{onClick:()=>s(a.id),className:"opacity-0 group-hover:opacity-60 hover:opacity-100 transition-opacity p-0.5 hover:text-destructive",children:e.jsx(me,{className:"h-3.5 w-3.5"})})]})}function Ft({onAdd:a,onCancel:t}){const[s,o]=i.useState(""),x=i.useRef(null);i.useEffect(()=>{var r;(r=x.current)==null||r.focus()},[]);const g=()=>{s.trim()&&(a(s.trim()),o(""))},d=r=>{r.key==="Enter"?(r.preventDefault(),g()):r.key==="Escape"&&t()};return e.jsxs("div",{className:"flex items-center gap-2 py-1.5 px-1",children:[e.jsx("div",{className:"w-3.5"})," ",e.jsx("div",{className:"shrink-0 w-4 h-4 rounded-full border-2 border-muted-foreground/30"}),e.jsx("input",{ref:x,type:"text",value:s,onChange:r=>o(r.target.value),onKeyDown:d,onBlur:()=>{s.trim()||t()},placeholder:"Add subtask...",className:"flex-1 text-sm bg-transparent border-none outline-none placeholder:text-muted-foreground/50"}),e.jsx("button",{onClick:g,className:"p-0.5 text-green-500 hover:text-green-600 transition-colors",disabled:!s.trim(),children:e.jsx(ue,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:t,className:"p-0.5 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(de,{className:"h-3.5 w-3.5"})})]})}function It({taskId:a,counts:t,onCountChange:s}){const[o,x]=i.useState(!1),[g,d]=i.useState(!1),{subtasks:r,isLoading:m,addSubtask:j,toggleSubtask:w,deleteSubtask:k,reorderSubtasks:b}=Tt({taskId:a,enabled:o});i.useEffect(()=>{if(s&&r.length>0){const p={total:r.length,completed:r.filter(h=>h.completed).length};s(p)}},[r,s]);const y=ve(ie(we,{activationConstraint:{distance:5}}),ie(Ne,{coordinateGetter:ye})),T=i.useCallback(p=>{const{active:h,over:v}=p;if(!v||h.id===v.id)return;const u=r.findIndex(A=>A.id===h.id),I=r.findIndex(A=>A.id===v.id);if(u!==I){const A=Ye(r,u,I);b(A.map(_=>_.id))}},[r,b]),n=i.useCallback(async p=>{await j(p)},[j]),l=o?{total:r.length,completed:r.filter(p=>p.completed).length}:t||{total:0,completed:0};return!o&&l.total===0?null:e.jsxs("div",{className:"mt-2",children:[!o&&l.total>0&&e.jsxs("button",{onClick:()=>x(!0),className:O("inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-colors","bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400","hover:bg-slate-200 dark:hover:bg-slate-700"),children:[e.jsx(ge,{className:"h-3 w-3"}),e.jsxs("span",{children:[l.completed,"/",l.total," Sub-Tasks"]})]}),o&&e.jsxs("div",{className:"rounded-lg border bg-card/50 p-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("button",{onClick:()=>x(!1),className:"text-xs font-medium text-muted-foreground hover:text-foreground flex items-center gap-1 transition-colors",children:[e.jsx(ge,{className:"h-3 w-3 rotate-90"}),"Subtasks"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[l.completed,"/",l.total]})]}),m&&r.length===0?e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"Loading..."}):e.jsx(ke,{sensors:y,collisionDetection:Ze,onDragEnd:T,children:e.jsx(Se,{items:r.map(p=>p.id),strategy:Ce,children:e.jsx("div",{className:"space-y-0.5",children:r.map(p=>e.jsx(Dt,{subtask:p,onToggle:w,onDelete:k},p.id))})})}),g?e.jsx(Ft,{onAdd:n,onCancel:()=>d(!1)}):e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 py-1.5 px-1 mt-1 text-xs text-muted-foreground hover:text-foreground transition-colors w-full",children:[e.jsx("div",{className:"w-3.5"}),e.jsx(se,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Add subtask"})]})]})]})}const Ot={1:"bg-destructive/20 text-destructive",2:"bg-warning/20 text-warning",3:"bg-muted text-muted-foreground"},Et={wellfy:"bg-blue-500/20 text-blue-600 dark:text-blue-400",freelance:"bg-green-500/20 text-green-600 dark:text-green-400",personal:"bg-purple-500/20 text-purple-600 dark:text-purple-400"},qe=["bg-orange-500/20 text-orange-700 dark:text-orange-400","bg-emerald-500/20 text-emerald-700 dark:text-emerald-400","bg-violet-500/20 text-violet-700 dark:text-violet-400","bg-rose-500/20 text-rose-700 dark:text-rose-400","bg-cyan-500/20 text-cyan-700 dark:text-cyan-400","bg-amber-500/20 text-amber-700 dark:text-amber-400","bg-fuchsia-500/20 text-fuchsia-700 dark:text-fuchsia-400","bg-sky-600/20 text-sky-700 dark:text-sky-300"];function At(a){let t=2166136261;for(let s=0;s<a.length;s++)t^=a.charCodeAt(s),t=t*16777619>>>0;return t%qe.length}const _e=i.forwardRef(function({task:t,onEdit:s,onAssignToJames:o,isDragging:x,subtaskCounts:g,projects:d,prds:r,taskTags:m,dragHandleProps:j,style:w},k){var n;const b=m[t.id]||[],y=t.projectId?d.find(l=>l.id===t.projectId):null,T=t.prdId?r.find(l=>l.id===t.prdId):null;return e.jsx("div",{ref:k,style:w,className:O("group rounded-lg border bg-card p-3 shadow-sm transition-all",x&&"opacity-50 shadow-lg ring-2 ring-primary",!x&&"hover:shadow-md"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("button",{className:"mt-0.5 cursor-grab touch-none opacity-50 md:opacity-0 transition-opacity md:group-hover:opacity-100 min-h-[44px] min-w-[32px] flex items-center justify-center -ml-1",...(j==null?void 0:j.attributes)??{},...(j==null?void 0:j.listeners)??{},children:e.jsx(Ie,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("button",{onClick:()=>s(t),className:"text-left w-full min-h-[44px] py-1",children:e.jsx("h4",{className:"font-medium text-sm leading-tight hover:text-primary transition-colors",children:t.title})}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:t.description}),e.jsx(It,{taskId:t.id,counts:g}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.jsxs(Ge,{variant:"secondary",className:O("text-xs capitalize inline-flex items-center gap-1",Et[t.area]),children:[e.jsx(nt,{className:"h-3 w-3"}),t.area]}),y&&e.jsxs("span",{className:O("inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium max-w-[140px]",qe[At(y.name)]),title:y.name,children:[e.jsx(rt,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:y.name})]}),T&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-teal-500/20 text-teal-700 dark:text-teal-400 max-w-[140px]",title:`PRD: ${T.featureName}`,children:[e.jsx(Oe,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:T.featureName})]}),t.assignee==="james"&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-indigo-500/20 text-indigo-700 dark:text-indigo-400",title:"Assigned to James",children:[e.jsx(le,{className:"h-3 w-3 shrink-0"}),"James"]}),!!t.quickCapture&&((n=t.createdBy)==null?void 0:n.includes("@"))&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-pink-500/20 text-pink-700 dark:text-pink-400",title:`Client request from ${t.createdBy}`,children:[e.jsx(ot,{className:"h-3 w-3 shrink-0"}),"Request"]}),b.map(l=>e.jsx(ce,{tag:l},l.id)),e.jsx("span",{className:O("inline-flex items-center rounded px-1.5 py-0.5 text-xs font-medium",Ot[t.priority]),children:t.priority===1?"High":t.priority===2?"Med":"Low"}),t.dueDate&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(it,{className:"h-3 w-3"}),Le(new Date(t.dueDate),"MMM d")]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[t.assignee!=="james"&&o&&e.jsx("button",{onClick:l=>{l.stopPropagation(),o(t)},className:"p-1 rounded hover:bg-indigo-100 dark:hover:bg-indigo-900/30 transition-colors",title:"Assign to James",children:e.jsx(le,{className:"h-4 w-4 text-indigo-600 dark:text-indigo-400"})}),e.jsx("button",{onClick:()=>s(t),className:"p-1 rounded hover:bg-muted transition-colors",children:e.jsx(lt,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"})})]})]})})});function Rt({task:a,onEdit:t,onAssignToJames:s,isDragging:o,subtaskCounts:x,projects:g,prds:d,taskTags:r}){const{attributes:m,listeners:j,setNodeRef:w,transform:k,transition:b,isDragging:y}=Te({id:a.id}),T={transform:De.Transform.toString(k),transition:b},n=o||y;return e.jsx(_e,{ref:w,style:T,task:a,onEdit:t,onAssignToJames:s,isDragging:n,subtaskCounts:x,projects:g,prds:d,taskTags:r,dragHandleProps:{attributes:m,listeners:j}})}const Pt={backlog:"border-t-slate-400",queue:"border-t-blue-400",in_progress:"border-t-amber-400",done:"border-t-green-400"};function Jt({id:a,title:t,tasks:s,onAddTask:o,onEditTask:x,onAssignToJames:g,subtaskCounts:d,projects:r,prds:m,taskTags:j}){const{setNodeRef:w,isOver:k}=He({id:a});return e.jsxs("div",{className:O("flex flex-col rounded-lg border border-t-4 bg-muted/30",Pt[a]),children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:t}),e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-muted px-2 py-0.5 text-xs font-medium text-muted-foreground",children:s.length})]}),e.jsx("button",{onClick:()=>o(a),className:"rounded p-2 hover:bg-accent transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center",title:"Add task",children:e.jsx(se,{className:"h-5 w-5 text-muted-foreground"})})]}),e.jsxs("div",{ref:w,className:O("flex-1 p-2 space-y-2 min-h-[200px] transition-colors",k&&"bg-accent/50"),children:[e.jsx(Se,{items:s.map(b=>b.id),strategy:Ce,children:s.map(b=>e.jsx(Rt,{task:b,onEdit:x,onAssignToJames:g,subtaskCounts:d==null?void 0:d[b.id],projects:r,prds:m,taskTags:j},b.id))}),s.length===0&&e.jsx("div",{className:"flex items-center justify-center h-20 text-sm text-muted-foreground",children:"No tasks"})]})]})}function $e({open:a,onOpenChange:t,task:s,defaultStatus:o,onClose:x}){const{addTask:g,updateTask:d,deleteTask:r}=q(),{projects:m}=je(),{clients:j}=Qe(),{prds:w}=be(),{taskTags:k,syncTaskTags:b}=te(),[y,T]=i.useState(""),[n,l]=i.useState(""),[p,h]=i.useState("backlog"),[v,u]=i.useState(2),[I,A]=i.useState("freelance"),[_,Y]=i.useState(""),[ae,Z]=i.useState(void 0),[ne,H]=i.useState(void 0),[re,f]=i.useState(null),[C,D]=i.useState([]),[R,E]=i.useState(!1),M=!!s;i.useEffect(()=>{if(s){T(s.title),l(s.description||""),h(s.status),u(s.priority),A(s.area),Y(s.dueDate?Le(new Date(s.dueDate),"yyyy-MM-dd"):""),Z(s.projectId),H(s.prdId),f(s.assignee||null);const c=k[s.id]||[];D(c.map(S=>S.id))}else T(""),l(""),h(o||"backlog"),u(2),A("freelance"),Y(""),Z(void 0),H(void 0),f(null),D([])},[s,o,a]);const U=async c=>{if(c.preventDefault(),!y.trim())return;const S={title:y.trim(),description:n.trim()||void 0,status:p,priority:v,area:I,dueDate:_?new Date(_).toISOString():void 0,projectId:ae,prdId:ne,assignee:re};if(M&&s)await d(s.id,S),await b(s.id,C);else{await g(S);const V=q.getState().tasks.find($=>$.title===S.title&&$.status===S.status);V&&C.length>0&&await b(V.id,C)}x()},N=()=>{s&&(r(s.id),E(!1),x())},P=()=>{if(!s)return;const c=s.projectId?m.find(L=>L.id===s.projectId):void 0,S=c!=null&&c.clientId?j.find(L=>L.id===c.clientId):void 0,V=ft(s,{project:c,client:S}),$=jt(s.title);bt(V,$),J.success(`Exported "${s.title}" to markdown`)};return e.jsx(Ae,{open:a,onOpenChange:t,children:e.jsxs(Re,{className:"w-[calc(100vw-2rem)] max-w-[500px] max-h-[90vh] overflow-y-auto overflow-x-hidden",children:[e.jsxs("form",{onSubmit:U,children:[e.jsxs(Pe,{children:[e.jsx(Je,{children:M?"Edit Task":"New Task"}),e.jsx(ze,{children:M?"Update the task details below.":"Create a new task by filling out the form below."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"title",children:"Title"}),e.jsx(ee,{id:"title",value:y,onChange:c=>T(c.target.value),placeholder:"Task title...",autoFocus:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"description",children:"Description"}),e.jsx(gt,{id:"description",value:n,onChange:c=>l(c.target.value),placeholder:"Add details...",rows:3})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"project",children:"Project"}),e.jsxs(G,{value:ae||"none",onValueChange:c=>Z(c==="none"?void 0:c),children:[e.jsx(Q,{children:e.jsx(W,{placeholder:"Select a project..."})}),e.jsxs(X,{children:[e.jsx(F,{value:"none",children:"No project"}),m.map(c=>e.jsx(F,{value:c.id,children:c.name},c.id))]})]})]}),w.length>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(z,{htmlFor:"prd",className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"PRD"]}),e.jsxs(G,{value:ne||"none",onValueChange:c=>H(c==="none"?void 0:c),children:[e.jsx(Q,{children:e.jsx(W,{placeholder:"Link to a PRD..."})}),e.jsxs(X,{children:[e.jsx(F,{value:"none",children:"No PRD"}),w.map(c=>e.jsxs(F,{value:c.id,children:[c.featureName," (v",c.version,")"]},c.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"status",children:"Status"}),e.jsxs(G,{value:p,onValueChange:c=>h(c),children:[e.jsx(Q,{children:e.jsx(W,{})}),e.jsxs(X,{children:[e.jsx(F,{value:"backlog",children:"Backlog"}),e.jsx(F,{value:"queue",children:"Queue"}),e.jsx(F,{value:"in_progress",children:"In Progress"}),e.jsx(F,{value:"done",children:"Done"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"priority",children:"Priority"}),e.jsxs(G,{value:String(v),onValueChange:c=>u(Number(c)),children:[e.jsx(Q,{children:e.jsx(W,{})}),e.jsxs(X,{children:[e.jsx(F,{value:"1",children:"High"}),e.jsx(F,{value:"2",children:"Medium"}),e.jsx(F,{value:"3",children:"Low"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"area",children:"Area"}),e.jsxs(G,{value:I,onValueChange:c=>A(c),children:[e.jsx(Q,{children:e.jsx(W,{})}),e.jsxs(X,{children:[e.jsx(F,{value:"wellfy",children:"Wellfy"}),e.jsx(F,{value:"freelance",children:"Freelance"}),e.jsx(F,{value:"personal",children:"Personal"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"dueDate",children:"Due Date"}),e.jsx(ee,{id:"dueDate",type:"date",value:_,onChange:c=>Y(c.target.value),className:"h-10"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{children:"Tags"}),e.jsx(Nt,{selectedIds:C,onChange:D})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(z,{htmlFor:"assignJames",className:"text-sm font-medium",children:"Assign to James"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"James will pick up this task automatically"})]})]}),e.jsx(pt,{id:"assignJames",checked:re==="james",onCheckedChange:c=>f(c?"james":null)})]})]}),e.jsxs(Me,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsx("div",{className:"flex gap-1.5",children:M&&e.jsxs(e.Fragment,{children:[e.jsx(B,{type:"button",variant:"destructive",size:"sm",onClick:()=>E(!0),children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(B,{type:"button",variant:"outline",size:"sm",onClick:P,children:e.jsx(ct,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx(B,{type:"button",variant:"outline",size:"sm",onClick:x,children:"Cancel"}),e.jsx(B,{type:"submit",size:"sm",children:M?"Save":"Create"})]})]})]}),e.jsx(Be,{open:R,onOpenChange:E,title:"Delete task?",description:"This will permanently delete this task. This action cannot be undone.",onConfirm:N})]})})}const fe=[{id:"backlog",title:"Backlog"},{id:"queue",title:"Queue"},{id:"in_progress",title:"In Progress"},{id:"done",title:"Done"}];function zt(){const[a,t]=i.useState(null),[s,o]=i.useState(null),[x,g]=i.useState(!1),[d,r]=i.useState(null),m=i.useRef(null),[j,w]=i.useState({}),{moveTaskLocal:k,persistColumnOrder:b}=q(),y=We(),T=vt(f=>f.trigger),{loadTaskTags:n,taskTags:l}=te(),{projects:p}=je(),{prds:h}=be(),v=i.useRef([]),u=y.map(f=>f.id).join(",");i.useEffect(()=>{const f=y.map(D=>D.id);if(f.length===0)return;(async()=>{try{const D=await K.getSubtaskCounts(f);w(D)}catch(D){console.error("Failed to fetch subtask counts:",D)}})(),n(f)},[u]);const I=ve(ie(we,{activationConstraint:{distance:8}}),ie(Ne,{coordinateGetter:ye})),A=i.useMemo(()=>{const f={backlog:[],queue:[],in_progress:[],done:[]};return y.forEach(C=>{f[C.status].push(C)}),Object.keys(f).forEach(C=>{f[C].sort((D,R)=>D.sortOrder-R.sortOrder)}),f},[y]),_=f=>{const C=y.find(D=>D.id===f.active.id);C&&(t(C),m.current=C.status,v.current=q.getState().tasks)},Y=f=>{const{active:C,over:D}=f;if(!D)return;const R=C.id,E=D.id,M=y.find(N=>N.id===R);if(!M)return;if(fe.some(N=>N.id===E)){const N=E;if(M.status!==N){const P=A[N];k(R,N,P.length)}}else{const N=y.find(P=>P.id===E);if(N&&M.status!==N.status){const c=A[N.status].findIndex(S=>S.id===E);k(R,N.status,c)}}},ae=f=>{const{active:C,over:D}=f,R=m.current,E=C.id,M=v.current;t(null),m.current=null,v.current=[];const U=q.getState().tasks,N=U.find(P=>P.id===E);if((N==null?void 0:N.status)==="done"&&R!=="done"&&T(),D){const P=D.id;if(E!==P){const c=U.find(S=>S.id===P);if(c&&N&&N.status===c.status){const S=U.filter(L=>L.status===N.status).sort((L,Ue)=>L.sortOrder-Ue.sortOrder),V=S.findIndex(L=>L.id===E),$=S.findIndex(L=>L.id===P);V!==$&&k(E,N.status,$)}}}if(N&&(b(E,N.status,M),R&&R!==N.status)){const c=q.getState().tasks.filter(S=>S.status===R).sort((S,V)=>S.sortOrder-V.sortOrder).map(S=>S.id);c.length>0&&Xe.reorderTasks(c,R).catch(S=>{console.error("Failed to persist source column order:",S)})}},Z=f=>{r(f),o(null),g(!0)},ne=f=>{o(f),r(null),g(!0)},H=()=>{g(!1),o(null),r(null)},re=async f=>{try{const{updateTask:C}=q.getState();C(f.id,{assignee:"james"}),await K.triggerJames(),J.success(`Assigned "${f.title}" to James`,{description:"James will start working on it shortly"})}catch(C){console.error("Failed to assign to James:",C),J.error("Failed to assign task to James")}};return e.jsxs(e.Fragment,{children:[e.jsxs(ke,{sensors:I,collisionDetection:et,onDragStart:_,onDragOver:Y,onDragEnd:ae,children:[e.jsx("div",{className:"flex flex-col gap-4 sm:grid sm:grid-cols-2 lg:grid-cols-4",children:fe.map(f=>e.jsx("div",{className:"w-full",children:e.jsx(Jt,{id:f.id,title:f.title,tasks:A[f.id],onAddTask:Z,onEditTask:ne,onAssignToJames:re,subtaskCounts:j,projects:p,prds:h,taskTags:l})},f.id))}),e.jsx(tt,{children:a?e.jsx(_e,{task:a,onEdit:()=>{},isDragging:!0,subtaskCounts:j[a.id],projects:p,prds:h,taskTags:l}):null})]}),e.jsx($e,{open:x,onOpenChange:g,task:s,defaultStatus:d,onClose:H})]})}function Mt(){const{filter:a,setFilter:t}=q();return e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 sm:max-w-sm",children:[e.jsx(dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ee,{placeholder:"Search tasks...",value:a.search,onChange:s=>t({search:s.target.value}),className:"pl-9"})]}),e.jsxs(G,{value:a.area,onValueChange:s=>t({area:s}),children:[e.jsx(Q,{className:"w-[150px]",children:e.jsx(W,{placeholder:"All areas"})}),e.jsxs(X,{children:[e.jsx(F,{value:"all",children:"All Areas"}),e.jsx(F,{value:"wellfy",children:"Wellfy"}),e.jsx(F,{value:"freelance",children:"Freelance"}),e.jsx(F,{value:"personal",children:"Personal"})]})]}),e.jsx(kt,{})]})}function as(){const[a,t]=i.useState(!1),[s,o]=i.useState(!1),[x,g]=i.useState(!1),d=()=>{t(!0)},r=()=>{t(!1)},m=async()=>{g(!0);try{await K.triggerJames(),J.success("James is checking for new tasks...",{description:"He'll start working on any assigned tasks.",icon:"ðŸ¤–"})}catch{J.error("Failed to ping James")}finally{g(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Tasks"})}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("button",{onClick:m,disabled:x,className:"relative inline-flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-black bg-white border border-transparent rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden group min-h-[44px]",children:[e.jsx("span",{className:"absolute inset-0 rounded-md p-[2px] bg-gradient-to-r from-pink-500 via-purple-500 via-blue-500 via-cyan-500 via-green-500 via-yellow-500 to-pink-500 bg-[length:400%_100%] animate-shimmer"}),e.jsx("span",{className:"absolute inset-[2px] rounded-[4px] bg-white"}),e.jsxs("span",{className:"relative flex items-center gap-2",children:[x?e.jsx(ut,{className:"h-4 w-4 animate-spin"}):e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"James"})]})]}),e.jsx(B,{variant:"outline",size:"icon",onClick:()=>o(!0),title:"Manage Tags",className:"min-h-[44px] min-w-[44px]",children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsxs(B,{onClick:d,className:"flex-1 sm:flex-none min-h-[44px]",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Add Task"]})]})]}),e.jsx(Mt,{}),e.jsx(zt,{}),e.jsx($e,{open:a,onOpenChange:t,task:null,defaultStatus:"backlog",onClose:r}),e.jsx(St,{open:s,onOpenChange:o})]})}export{as as TasksPage};
