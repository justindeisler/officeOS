import{j as e,r as o}from"./vendor-react-nkeu7MKf.js";import{c as de,j as R,X as ue,k as X,a as J,I as te,L,l as M,m as q,f as be,n as ve,B as He,U as Ge,F as ye,o as oe,u as V,p as Qe,q as We,t as Xe,r as Ye}from"./index-VWTpo9YE.js";import{u as Ne,a as ie,s as we,K as ke,P as Se,b as Ze,D as Ce,c as et,S as Te,v as De,d as Fe,C as Ie,e as tt,f as st,g as at}from"./vendor-dnd-CdmezjDq.js";import{g as rt,T as nt,h as ot,C as Oe}from"./vendor-radix-Oq5tdvA1.js";import{D as Ee,a as Ae,b as Pe,c as Re,d as Me,e as Le}from"./dialog-51XU7P6U.js";import"./alert-dialog-CqCK1JhP.js";import{C as he}from"./chevron-right-GD6lX6YZ.js";import{P as se}from"./plus-D7a74Tqd.js";import{G as ze}from"./grip-vertical-2cSZB8Xs.js";import{C as me,S as H,a as G,b as Q,c as W,d as T}from"./select-Xdan6Flm.js";import{T as xe}from"./trash-2-B0d4PkE_.js";import{F as it}from"./folder-open-DT_NA5Pt.js";import{M as lt}from"./message-square-CuRje3aT.js";import{C as ct}from"./calendar-BveN5Qpa.js";import{E as dt}from"./ellipsis-EZAKS5Mg.js";import{f as Je}from"./vendor-date-fns-D0ugVOfH.js";import{T as ut}from"./textarea-Bnlrt7my.js";import{S as mt}from"./switch-DWE95ffI.js";import{C as Be}from"./confirm-delete-dialog-DsrF8Kt3.js";import{e as xt,g as gt,d as ht}from"./markdown-DZSA0cWY.js";import{D as pt}from"./download-DY_rwJ5C.js";import{u as ft}from"./confettiStore-Dwq2wY8P.js";import{S as jt}from"./search-BmN2R2N2.js";import{P as pe}from"./pencil-D2IMxk9Y.js";import"./vendor-markdown-zaQAhtrl.js";import"./vendor-recharts-COauwCrp.js";import"./vendor-router-bCYKpmtI.js";import"./vendor-floating-ui-_Y3uXdsy.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=de("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=de("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=de("Tags",[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]]);function yt(t){const a=t.replace("#",""),s=parseInt(a.substring(0,2),16),i=parseInt(a.substring(2,4),16),h=parseInt(a.substring(4,6),16);return(.299*s+.587*i+.114*h)/255>.55?"#000000":"#ffffff"}function le({tag:t,onRemove:a,className:s,size:i="sm"}){const h=t.color||"#6b7280",f=yt(h);return e.jsxs("span",{className:R("inline-flex items-center gap-1 rounded-full font-medium whitespace-nowrap",i==="sm"?"px-1.5 py-0.5 text-[10px] leading-tight":"px-2 py-0.5 text-xs",s),style:{backgroundColor:h,color:f},children:[t.name,a&&e.jsx("button",{type:"button",onClick:c=>{c.stopPropagation(),a()},className:"ml-0.5 rounded-full hover:opacity-80 focus:outline-none",style:{color:f},children:e.jsx(ue,{className:i==="sm"?"h-2.5 w-2.5":"h-3 w-3"})})]})}const qe=rt,Ve=nt,ge=o.forwardRef(({className:t,align:a="center",sideOffset:s=4,...i},h)=>e.jsx(ot,{children:e.jsx(Oe,{ref:h,align:a,sideOffset:s,className:R("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...i})}));ge.displayName=Oe.displayName;function Nt({selectedIds:t,onChange:a}){const{tags:s,createTag:i}=X(),[h,f]=o.useState(!1),[c,n]=o.useState(""),[d,b]=o.useState(!1),k=s.filter(r=>r.name.toLowerCase().includes(c.toLowerCase())),S=s.filter(r=>t.includes(r.id)),N=r=>{t.includes(r)?a(t.filter(u=>u!==r)):a([...t,r])},y=async()=>{if(!c.trim()||d)return;b(!0);const r=await i({name:c.trim()});r&&(a([...t,r.id]),n("")),b(!1)},D=c.trim()&&k.length===0;return e.jsxs(qe,{open:h,onOpenChange:f,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(J,{type:"button",variant:"outline",role:"combobox","aria-expanded":h,className:"w-full justify-between h-auto min-h-10",children:[S.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:S.map(r=>e.jsx(le,{tag:r,onRemove:()=>N(r.id)},r.id))}):e.jsx("span",{className:"text-muted-foreground",children:"Select tags..."}),e.jsx(bt,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsxs(ge,{className:"w-[280px] p-2",align:"start",children:[e.jsx(te,{placeholder:"Search or create tag...",value:c,onChange:r=>n(r.target.value),className:"mb-2 h-8 text-sm",onKeyDown:r=>{r.key==="Enter"&&D&&(r.preventDefault(),y())}}),e.jsxs("div",{className:"max-h-48 overflow-y-auto",children:[k.map(r=>e.jsx(wt,{tag:r,selected:t.includes(r.id),onToggle:()=>N(r.id)},r.id)),D&&e.jsxs("button",{type:"button",onClick:y,disabled:d,className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm text-muted-foreground hover:bg-accent hover:text-accent-foreground",children:[e.jsx(se,{className:"h-3.5 w-3.5"}),'Create "',c.trim(),'"']}),!c&&s.length===0&&e.jsx("p",{className:"px-2 py-3 text-center text-sm text-muted-foreground",children:"No tags yet. Type to create one."})]})]})]})}function wt({tag:t,selected:a,onToggle:s}){return e.jsxs("button",{type:"button",onClick:s,className:R("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-accent hover:text-accent-foreground",a&&"bg-accent/50"),children:[e.jsx("span",{className:"h-3 w-3 rounded-full shrink-0 border border-white/20",style:{backgroundColor:t.color||"#6b7280"}}),e.jsx("span",{className:"flex-1 text-left truncate",children:t.name}),a&&e.jsx(me,{className:"h-3.5 w-3.5 text-primary shrink-0"})]})}function kt(){const{tags:t,filterTagIds:a,setFilterTagIds:s}=X(),[i,h]=o.useState(!1);if(t.length===0)return null;const f=n=>{a.includes(n)?s(a.filter(d=>d!==n)):s([...a,n])},c=()=>s([]);return e.jsxs(qe,{open:i,onOpenChange:h,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(J,{variant:"outline",size:"sm",className:"h-10 gap-2",children:[e.jsx(vt,{className:"h-4 w-4"}),"Tags",a.length>0&&e.jsx("span",{className:"ml-1 flex h-5 w-5 items-center justify-center rounded-full bg-primary text-[10px] font-bold text-primary-foreground",children:a.length})]})}),e.jsxs(ge,{className:"w-56 p-2",align:"start",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 pb-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Filter by tag"}),a.length>0&&e.jsxs("button",{onClick:c,className:"text-xs text-muted-foreground hover:text-foreground flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3"}),"Clear"]})]}),e.jsx("div",{className:"max-h-56 overflow-y-auto space-y-0.5",children:t.map(n=>{const d=a.includes(n.id);return e.jsxs("button",{onClick:()=>f(n.id),className:R("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-accent transition-colors",d&&"bg-accent"),children:[e.jsx("span",{className:R("h-3 w-3 rounded-full shrink-0 border-2 transition-colors",d?"border-primary":"border-transparent"),style:{backgroundColor:n.color||"#6b7280"}}),e.jsx("span",{className:"flex-1 text-left truncate",children:n.name}),d&&e.jsx("span",{className:"text-xs text-primary font-medium",children:"âœ“"})]},n.id)})})]})]})}const ne=["#ef4444","#f97316","#f59e0b","#eab308","#22c55e","#14b8a6","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#a855f7","#ec4899","#6b7280","#1e293b"];function St({open:t,onOpenChange:a}){const{tags:s,createTag:i,updateTag:h,deleteTag:f}=X(),[c,n]=o.useState(null),[d,b]=o.useState(""),[k,S]=o.useState(ne[0]),[N,y]=o.useState(null),[D,r]=o.useState(!1),u=()=>{n(null),b(""),S(ne[0])},p=l=>{n(l),b(l.name),S(l.color||ne[0])},g=async l=>{if(l.preventDefault(),!(!d.trim()||D)){r(!0);try{c?(await h(c.id,{name:d.trim(),color:k}),M.success(`Tag "${d.trim()}" updated`)):await i({name:d.trim(),color:k})&&M.success(`Tag "${d.trim()}" created`),u()}finally{r(!1)}}},m=async()=>{N&&(await f(N.id),M.success(`Tag "${N.name}" deleted`),y(null),(c==null?void 0:c.id)===N.id&&u())};return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{open:t,onOpenChange:l=>{a(l),l||u()},children:e.jsxs(Ae,{className:"w-[calc(100vw-2rem)] max-w-[480px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Pe,{children:[e.jsxs(Re,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5"}),"Manage Tags"]}),e.jsx(Me,{children:"Create, edit, and delete tags used to organize your tasks."})]}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"tag-name",children:c?"Edit Tag":"New Tag"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{id:"tag-name",value:d,onChange:l=>b(l.target.value),placeholder:"Tag name...",className:"flex-1",autoComplete:"off"}),e.jsx(J,{type:"submit",size:"sm",disabled:!d.trim()||D,children:c?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-3.5 w-3.5 mr-1"}),"Save"]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-3.5 w-3.5 mr-1"}),"Add"]})}),c&&e.jsx(J,{type:"button",variant:"ghost",size:"sm",onClick:u,children:"Cancel"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{children:"Color"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[ne.map(l=>e.jsx("button",{type:"button",onClick:()=>S(l),className:"h-7 w-7 rounded-full border-2 transition-all hover:scale-110",style:{backgroundColor:l,borderColor:k===l?"var(--primary)":"transparent",boxShadow:k===l?"0 0 0 2px var(--background), 0 0 0 4px var(--primary)":void 0},title:l},l)),e.jsxs("label",{className:"relative h-7 w-7 rounded-full border-2 border-dashed border-muted-foreground/40 flex items-center justify-center cursor-pointer hover:border-muted-foreground/70 transition-colors",title:"Custom color",children:[e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground",children:"#"}),e.jsx("input",{type:"color",value:k,onChange:l=>S(l.target.value),className:"absolute inset-0 opacity-0 cursor-pointer"})]})]}),d.trim()&&e.jsxs("div",{className:"pt-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground mr-2",children:"Preview:"}),e.jsx(le,{tag:{id:"preview",name:d.trim(),color:k},size:"md"})]})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsxs("h4",{className:"text-sm font-medium mb-3",children:["Existing Tags (",s.length,")"]}),s.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No tags yet. Create one above!"}):e.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:s.map(l=>e.jsxs("div",{className:"flex items-center justify-between rounded-md px-2 py-1.5 hover:bg-muted/50 group",children:[e.jsx(le,{tag:l,size:"md"}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>p(l),className:"p-1 rounded hover:bg-muted",title:"Edit tag",children:e.jsx(pe,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsx("button",{onClick:()=>y(l),className:"p-1 rounded hover:bg-destructive/10",title:"Delete tag",children:e.jsx(xe,{className:"h-3.5 w-3.5 text-destructive"})})]})]},l.id))})]}),e.jsx(Le,{children:e.jsx(J,{variant:"outline",onClick:()=>a(!1),children:"Done"})})]})}),e.jsx(Be,{open:!!N,onOpenChange:l=>{l||y(null)},title:`Delete tag "${N==null?void 0:N.name}"?`,description:"This will remove the tag from all tasks. This action cannot be undone.",onConfirm:m})]})}function Ct(t){const a={};for(const[s,i]of Object.entries(t)){const h=s.replace(/_([a-z])/g,(f,c)=>c.toUpperCase());a[h]=i}return a}function fe(t){const a=Ct(t);return{id:a.id,taskId:a.taskId,title:a.title,completed:!!a.completed,sortOrder:a.sortOrder??0,createdAt:a.createdAt}}function Tt({taskId:t,enabled:a=!0}){const[s,i]=o.useState([]),[h,f]=o.useState(!1),[c,n]=o.useState(null),d=o.useRef(!1),b=o.useCallback(async()=>{if(!(!t||!a)){f(!0),n(null);try{const u=(await q.getSubtasks(t)).map(fe);i(u),d.current=!0}catch(r){console.error("Failed to fetch subtasks:",r),n("Failed to load subtasks")}finally{f(!1)}}},[t,a]);o.useEffect(()=>{a&&!d.current&&b()},[a,b]),o.useEffect(()=>{d.current=!1,i([])},[t]);const k=o.useCallback(async r=>{if(!r.trim())return;const u=crypto.randomUUID(),p={id:u,taskId:t,title:r.trim(),completed:!1,sortOrder:s.length,createdAt:new Date().toISOString()};i(g=>[...g,p]);try{const g=await q.createSubtask(t,r.trim()),m=fe(g);i(l=>l.map(E=>E.id===u?m:E))}catch(g){console.error("Failed to create subtask:",g),i(m=>m.filter(l=>l.id!==u)),M.error("Failed to add subtask")}},[t,s.length]),S=o.useCallback(async(r,u)=>{i(p=>p.map(g=>g.id===r?{...g,completed:u}:g));try{await q.updateSubtask(r,{completed:u?1:0})}catch(p){console.error("Failed to toggle subtask:",p),i(g=>g.map(m=>m.id===r?{...m,completed:!u}:m)),M.error("Failed to update subtask")}},[]),N=o.useCallback(async(r,u)=>{var g;if(!u.trim())return;const p=(g=s.find(m=>m.id===r))==null?void 0:g.title;i(m=>m.map(l=>l.id===r?{...l,title:u.trim()}:l));try{await q.updateSubtask(r,{title:u.trim()})}catch(m){console.error("Failed to update subtask:",m),p&&i(l=>l.map(E=>E.id===r?{...E,title:p}:E)),M.error("Failed to update subtask")}},[s]),y=o.useCallback(async r=>{const u=s;i(p=>p.filter(g=>g.id!==r));try{await q.deleteSubtask(r)}catch(p){console.error("Failed to delete subtask:",p),i(u),M.error("Failed to delete subtask")}},[s]),D=o.useCallback(async r=>{const u=s,p=r.map(g=>s.find(m=>m.id===g)).filter(g=>g!==void 0).map((g,m)=>({...g,sortOrder:m}));i(p);try{await q.reorderSubtasks(t,r)}catch(g){console.error("Failed to reorder subtasks:",g),i(u),M.error("Failed to reorder subtasks")}},[t,s]);return{subtasks:s,isLoading:h,error:c,addSubtask:k,toggleSubtask:S,updateSubtask:N,deleteSubtask:y,reorderSubtasks:D,refresh:b}}function Dt({subtask:t,onToggle:a,onDelete:s}){const{attributes:i,listeners:h,setNodeRef:f,transform:c,transition:n,isDragging:d}=Fe({id:t.id}),b={transform:Ie.Transform.toString(c),transition:n};return e.jsxs("div",{ref:f,style:b,className:R("group flex items-center gap-2 py-1.5 px-1 rounded-md transition-colors",d&&"opacity-50 bg-muted",!d&&"hover:bg-muted/50"),children:[e.jsx("button",{className:"cursor-grab touch-none opacity-0 group-hover:opacity-60 transition-opacity shrink-0",...i,...h,children:e.jsx(ze,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsx("button",{onClick:()=>a(t.id,!t.completed),className:R("shrink-0 w-4 h-4 rounded-full border-2 flex items-center justify-center transition-all duration-200",t.completed?"bg-green-500 border-green-500":"border-muted-foreground/50 hover:border-green-500"),children:t.completed&&e.jsx(me,{className:"h-2.5 w-2.5 text-white",strokeWidth:3})}),e.jsx("span",{className:R("flex-1 text-sm transition-all",t.completed&&"text-muted-foreground line-through"),children:t.title}),e.jsx("button",{onClick:()=>s(t.id),className:"opacity-0 group-hover:opacity-60 hover:opacity-100 transition-opacity p-0.5 hover:text-destructive",children:e.jsx(xe,{className:"h-3.5 w-3.5"})})]})}function Ft({onAdd:t,onCancel:a}){const[s,i]=o.useState(""),h=o.useRef(null);o.useEffect(()=>{var n;(n=h.current)==null||n.focus()},[]);const f=()=>{s.trim()&&(t(s.trim()),i(""))},c=n=>{n.key==="Enter"?(n.preventDefault(),f()):n.key==="Escape"&&a()};return e.jsxs("div",{className:"flex items-center gap-2 py-1.5 px-1",children:[e.jsx("div",{className:"w-3.5"})," ",e.jsx("div",{className:"shrink-0 w-4 h-4 rounded-full border-2 border-muted-foreground/30"}),e.jsx("input",{ref:h,type:"text",value:s,onChange:n=>i(n.target.value),onKeyDown:c,onBlur:()=>{s.trim()||a()},placeholder:"Add subtask...",className:"flex-1 text-sm bg-transparent border-none outline-none placeholder:text-muted-foreground/50"}),e.jsx("button",{onClick:f,className:"p-0.5 text-green-500 hover:text-green-600 transition-colors",disabled:!s.trim(),children:e.jsx(me,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:a,className:"p-0.5 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(ue,{className:"h-3.5 w-3.5"})})]})}function It({taskId:t,counts:a,onCountChange:s}){const[i,h]=o.useState(!1),[f,c]=o.useState(!1),{subtasks:n,isLoading:d,addSubtask:b,toggleSubtask:k,deleteSubtask:S,reorderSubtasks:N}=Tt({taskId:t,enabled:i});o.useEffect(()=>{if(s&&n.length>0){const p={total:n.length,completed:n.filter(g=>g.completed).length};s(p)}},[n,s]);const y=Ne(ie(Se,{activationConstraint:{distance:5}}),ie(ke,{coordinateGetter:we})),D=o.useCallback(p=>{const{active:g,over:m}=p;if(!m||g.id===m.id)return;const l=n.findIndex(z=>z.id===g.id),E=n.findIndex(z=>z.id===m.id);if(l!==E){const z=Ze(n,l,E);N(z.map(U=>U.id))}},[n,N]),r=o.useCallback(async p=>{await b(p)},[b]),u=i?{total:n.length,completed:n.filter(p=>p.completed).length}:a||{total:0,completed:0};return!i&&u.total===0?null:e.jsxs("div",{className:"mt-2",children:[!i&&u.total>0&&e.jsxs("button",{onClick:()=>h(!0),className:R("inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-colors","bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400","hover:bg-slate-200 dark:hover:bg-slate-700"),children:[e.jsx(he,{className:"h-3 w-3"}),e.jsxs("span",{children:[u.completed,"/",u.total," Sub-Tasks"]})]}),i&&e.jsxs("div",{className:"rounded-lg border bg-card/50 p-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("button",{onClick:()=>h(!1),className:"text-xs font-medium text-muted-foreground hover:text-foreground flex items-center gap-1 transition-colors",children:[e.jsx(he,{className:"h-3 w-3 rotate-90"}),"Subtasks"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[u.completed,"/",u.total]})]}),d&&n.length===0?e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"Loading..."}):e.jsx(Ce,{sensors:y,collisionDetection:et,onDragEnd:D,children:e.jsx(Te,{items:n.map(p=>p.id),strategy:De,children:e.jsx("div",{className:"space-y-0.5",children:n.map(p=>e.jsx(Dt,{subtask:p,onToggle:k,onDelete:S},p.id))})})}),f?e.jsx(Ft,{onAdd:r,onCancel:()=>c(!1)}):e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 py-1.5 px-1 mt-1 text-xs text-muted-foreground hover:text-foreground transition-colors w-full",children:[e.jsx("div",{className:"w-3.5"}),e.jsx(se,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Add subtask"})]})]})]})}const Ot={1:"bg-destructive/20 text-destructive",2:"bg-warning/20 text-warning",3:"bg-muted text-muted-foreground"},Et={wellfy:"bg-blue-500/20 text-blue-600 dark:text-blue-400",freelance:"bg-green-500/20 text-green-600 dark:text-green-400",personal:"bg-purple-500/20 text-purple-600 dark:text-purple-400"},Ue=["bg-orange-500/20 text-orange-700 dark:text-orange-400","bg-emerald-500/20 text-emerald-700 dark:text-emerald-400","bg-violet-500/20 text-violet-700 dark:text-violet-400","bg-rose-500/20 text-rose-700 dark:text-rose-400","bg-cyan-500/20 text-cyan-700 dark:text-cyan-400","bg-amber-500/20 text-amber-700 dark:text-amber-400","bg-fuchsia-500/20 text-fuchsia-700 dark:text-fuchsia-400","bg-sky-600/20 text-sky-700 dark:text-sky-300"];function At(t){let a=2166136261;for(let s=0;s<t.length;s++)a^=t.charCodeAt(s),a=a*16777619>>>0;return a%Ue.length}function _e({task:t,onEdit:a,onAssignToJames:s,isDragging:i,subtaskCounts:h}){var g;const{projects:f}=be(),{prds:c}=ve(),n=X(m=>m.taskTags[t.id]||[]),d=t.projectId?f.find(m=>m.id===t.projectId):null,b=t.prdId?c.find(m=>m.id===t.prdId):null,{attributes:k,listeners:S,setNodeRef:N,transform:y,transition:D,isDragging:r}=Fe({id:t.id}),u={transform:Ie.Transform.toString(y),transition:D},p=i||r;return e.jsx("div",{ref:N,style:u,className:R("group rounded-lg border bg-card p-3 shadow-sm transition-all",p&&"opacity-50 shadow-lg ring-2 ring-primary",!p&&"hover:shadow-md"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("button",{className:"mt-0.5 cursor-grab touch-none opacity-0 transition-opacity group-hover:opacity-100",...k,...S,children:e.jsx(ze,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("button",{onClick:()=>a(t),className:"text-left w-full",children:e.jsx("h4",{className:"font-medium text-sm leading-tight hover:text-primary transition-colors",children:t.title})}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:t.description}),e.jsx(It,{taskId:t.id,counts:h}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.jsxs(He,{variant:"secondary",className:R("text-xs capitalize inline-flex items-center gap-1",Et[t.area]),children:[e.jsx(Ge,{className:"h-3 w-3"}),t.area]}),d&&e.jsxs("span",{className:R("inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium max-w-[140px]",Ue[At(d.name)]),title:d.name,children:[e.jsx(it,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:d.name})]}),b&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-teal-500/20 text-teal-700 dark:text-teal-400 max-w-[140px]",title:`PRD: ${b.featureName}`,children:[e.jsx(ye,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"truncate",children:b.featureName})]}),t.assignee==="james"&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-indigo-500/20 text-indigo-700 dark:text-indigo-400",title:"Assigned to James",children:[e.jsx(oe,{className:"h-3 w-3 shrink-0"}),"James"]}),!!t.quickCapture&&((g=t.createdBy)==null?void 0:g.includes("@"))&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium bg-pink-500/20 text-pink-700 dark:text-pink-400",title:`Client request from ${t.createdBy}`,children:[e.jsx(lt,{className:"h-3 w-3 shrink-0"}),"Request"]}),n.map(m=>e.jsx(le,{tag:m},m.id)),e.jsx("span",{className:R("inline-flex items-center rounded px-1.5 py-0.5 text-xs font-medium",Ot[t.priority]),children:t.priority===1?"High":t.priority===2?"Med":"Low"}),t.dueDate&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ct,{className:"h-3 w-3"}),Je(new Date(t.dueDate),"MMM d")]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[t.assignee!=="james"&&s&&e.jsx("button",{onClick:m=>{m.stopPropagation(),s(t)},className:"p-1 rounded hover:bg-indigo-100 dark:hover:bg-indigo-900/30 transition-colors",title:"Assign to James",children:e.jsx(oe,{className:"h-4 w-4 text-indigo-600 dark:text-indigo-400"})}),e.jsx("button",{onClick:()=>a(t),className:"p-1 rounded hover:bg-muted transition-colors",children:e.jsx(dt,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"})})]})]})})}const Pt={backlog:"border-t-slate-400",queue:"border-t-blue-400",in_progress:"border-t-amber-400",done:"border-t-green-400"};function Rt({id:t,title:a,tasks:s,onAddTask:i,onEditTask:h,onAssignToJames:f,subtaskCounts:c}){const{setNodeRef:n,isOver:d}=tt({id:t});return e.jsxs("div",{className:R("flex flex-col rounded-lg border border-t-4 bg-muted/30",Pt[t]),children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:a}),e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-muted px-2 py-0.5 text-xs font-medium text-muted-foreground",children:s.length})]}),e.jsx("button",{onClick:()=>i(t),className:"rounded p-1 hover:bg-accent transition-colors",title:"Add task",children:e.jsx(se,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsxs("div",{ref:n,className:R("flex-1 p-2 space-y-2 min-h-[200px] transition-colors",d&&"bg-accent/50"),children:[e.jsx(Te,{items:s.map(b=>b.id),strategy:De,children:s.map(b=>e.jsx(_e,{task:b,onEdit:h,onAssignToJames:f,subtaskCounts:c==null?void 0:c[b.id]},b.id))}),s.length===0&&e.jsx("div",{className:"flex items-center justify-center h-20 text-sm text-muted-foreground",children:"No tasks"})]})]})}function $e({open:t,onOpenChange:a,task:s,defaultStatus:i,onClose:h}){const{addTask:f,updateTask:c,deleteTask:n}=V(),{projects:d}=be(),{clients:b}=Qe(),{prds:k}=ve(),{taskTags:S,syncTaskTags:N}=X(),[y,D]=o.useState(""),[r,u]=o.useState(""),[p,g]=o.useState("backlog"),[m,l]=o.useState(2),[E,z]=o.useState("freelance"),[U,Y]=o.useState(""),[ae,Z]=o.useState(void 0),[j,w]=o.useState(void 0),[C,A]=o.useState(null),[P,B]=o.useState([]),[_,v]=o.useState(!1),F=!!s;o.useEffect(()=>{if(s){D(s.title),u(s.description||""),g(s.status),l(s.priority),z(s.area),Y(s.dueDate?Je(new Date(s.dueDate),"yyyy-MM-dd"):""),Z(s.projectId),w(s.prdId),A(s.assignee||null);const x=S[s.id]||[];B(x.map(O=>O.id))}else D(""),u(""),g(i||"backlog"),l(2),z("freelance"),Y(""),Z(void 0),w(void 0),A(null),B([])},[s,i,t]);const K=async x=>{if(x.preventDefault(),!y.trim())return;const O={title:y.trim(),description:r.trim()||void 0,status:p,priority:m,area:E,dueDate:U?new Date(U).toISOString():void 0,projectId:ae,prdId:j,assignee:C};if(F&&s)await c(s.id,O),await N(s.id,P);else{await f(O);const $=V.getState().tasks.find(re=>re.title===O.title&&re.status===O.status);$&&P.length>0&&await N($.id,P)}h()},I=()=>{s&&(n(s.id),v(!1),h())},ee=()=>{if(!s)return;const x=s.projectId?d.find(ce=>ce.id===s.projectId):void 0,O=x!=null&&x.clientId?b.find(ce=>ce.id===x.clientId):void 0,$=xt(s,{project:x,client:O}),re=gt(s.title);ht($,re),M.success(`Exported "${s.title}" to markdown`)};return e.jsx(Ee,{open:t,onOpenChange:a,children:e.jsxs(Ae,{className:"w-[calc(100vw-2rem)] max-w-[500px] max-h-[90vh] overflow-y-auto overflow-x-hidden",children:[e.jsxs("form",{onSubmit:K,children:[e.jsxs(Pe,{children:[e.jsx(Re,{children:F?"Edit Task":"New Task"}),e.jsx(Me,{children:F?"Update the task details below.":"Create a new task by filling out the form below."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"title",children:"Title"}),e.jsx(te,{id:"title",value:y,onChange:x=>D(x.target.value),placeholder:"Task title...",autoFocus:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"description",children:"Description"}),e.jsx(ut,{id:"description",value:r,onChange:x=>u(x.target.value),placeholder:"Add details...",rows:3})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"project",children:"Project"}),e.jsxs(H,{value:ae||"none",onValueChange:x=>Z(x==="none"?void 0:x),children:[e.jsx(G,{children:e.jsx(Q,{placeholder:"Select a project..."})}),e.jsxs(W,{children:[e.jsx(T,{value:"none",children:"No project"}),d.map(x=>e.jsx(T,{value:x.id,children:x.name},x.id))]})]})]}),k.length>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(L,{htmlFor:"prd",className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"PRD"]}),e.jsxs(H,{value:j||"none",onValueChange:x=>w(x==="none"?void 0:x),children:[e.jsx(G,{children:e.jsx(Q,{placeholder:"Link to a PRD..."})}),e.jsxs(W,{children:[e.jsx(T,{value:"none",children:"No PRD"}),k.map(x=>e.jsxs(T,{value:x.id,children:[x.featureName," (v",x.version,")"]},x.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"status",children:"Status"}),e.jsxs(H,{value:p,onValueChange:x=>g(x),children:[e.jsx(G,{children:e.jsx(Q,{})}),e.jsxs(W,{children:[e.jsx(T,{value:"backlog",children:"Backlog"}),e.jsx(T,{value:"queue",children:"Queue"}),e.jsx(T,{value:"in_progress",children:"In Progress"}),e.jsx(T,{value:"done",children:"Done"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"priority",children:"Priority"}),e.jsxs(H,{value:String(m),onValueChange:x=>l(Number(x)),children:[e.jsx(G,{children:e.jsx(Q,{})}),e.jsxs(W,{children:[e.jsx(T,{value:"1",children:"High"}),e.jsx(T,{value:"2",children:"Medium"}),e.jsx(T,{value:"3",children:"Low"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"area",children:"Area"}),e.jsxs(H,{value:E,onValueChange:x=>z(x),children:[e.jsx(G,{children:e.jsx(Q,{})}),e.jsxs(W,{children:[e.jsx(T,{value:"wellfy",children:"Wellfy"}),e.jsx(T,{value:"freelance",children:"Freelance"}),e.jsx(T,{value:"personal",children:"Personal"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"dueDate",children:"Due Date"}),e.jsx(te,{id:"dueDate",type:"date",value:U,onChange:x=>Y(x.target.value),className:"h-10"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{children:"Tags"}),e.jsx(Nt,{selectedIds:P,onChange:B})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(L,{htmlFor:"assignJames",className:"text-sm font-medium",children:"Assign to James"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"James will pick up this task automatically"})]})]}),e.jsx(mt,{id:"assignJames",checked:C==="james",onCheckedChange:x=>A(x?"james":null)})]})]}),e.jsxs(Le,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsx("div",{className:"flex gap-1.5",children:F&&e.jsxs(e.Fragment,{children:[e.jsx(J,{type:"button",variant:"destructive",size:"sm",onClick:()=>v(!0),children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(J,{type:"button",variant:"outline",size:"sm",onClick:ee,children:e.jsx(pt,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx(J,{type:"button",variant:"outline",size:"sm",onClick:h,children:"Cancel"}),e.jsx(J,{type:"submit",size:"sm",children:F?"Save":"Create"})]})]})]}),e.jsx(Be,{open:_,onOpenChange:v,title:"Delete task?",description:"This will permanently delete this task. This action cannot be undone.",onConfirm:I})]})})}const je=[{id:"backlog",title:"Backlog"},{id:"queue",title:"Queue"},{id:"in_progress",title:"In Progress"},{id:"done",title:"Done"}];function Mt(){const[t,a]=o.useState(null),[s,i]=o.useState(null),[h,f]=o.useState(!1),[c,n]=o.useState(null),d=o.useRef(null),[b,k]=o.useState({}),{moveTaskLocal:S,persistColumnOrder:N}=V(),y=We(),D=ft(j=>j.trigger),{loadTaskTags:r}=X(),u=o.useRef([]),p=y.map(j=>j.id).join(",");o.useEffect(()=>{const j=y.map(C=>C.id);if(j.length===0)return;(async()=>{try{const C=await q.getSubtaskCounts(j);k(C)}catch(C){console.error("Failed to fetch subtask counts:",C)}})(),r(j)},[p]);const g=Ne(ie(Se,{activationConstraint:{distance:8}}),ie(ke,{coordinateGetter:we})),m=o.useMemo(()=>{const j={backlog:[],queue:[],in_progress:[],done:[]};return y.forEach(w=>{j[w.status].push(w)}),Object.keys(j).forEach(w=>{j[w].sort((C,A)=>C.sortOrder-A.sortOrder)}),j},[y]),l=j=>{const w=y.find(C=>C.id===j.active.id);w&&(a(w),d.current=w.status,u.current=V.getState().tasks)},E=j=>{const{active:w,over:C}=j;if(!C)return;const A=w.id,P=C.id,B=y.find(v=>v.id===A);if(!B)return;if(je.some(v=>v.id===P)){const v=P;if(B.status!==v){const F=m[v];S(A,v,F.length)}}else{const v=y.find(F=>F.id===P);if(v&&B.status!==v.status){const K=m[v.status].findIndex(I=>I.id===P);S(A,v.status,K)}}},z=j=>{const{active:w,over:C}=j,A=d.current,P=w.id,B=u.current;a(null),d.current=null,u.current=[];const _=V.getState().tasks,v=_.find(F=>F.id===P);if((v==null?void 0:v.status)==="done"&&A!=="done"&&D(),C){const F=C.id;if(P!==F){const K=_.find(I=>I.id===F);if(K&&v&&v.status===K.status){const I=_.filter(O=>O.status===v.status).sort((O,$)=>O.sortOrder-$.sortOrder),ee=I.findIndex(O=>O.id===P),x=I.findIndex(O=>O.id===F);ee!==x&&S(P,v.status,x)}}}if(v&&(N(P,v.status,B),A&&A!==v.status)){const K=V.getState().tasks.filter(I=>I.status===A).sort((I,ee)=>I.sortOrder-ee.sortOrder).map(I=>I.id);K.length>0&&Xe.reorderTasks(K,A).catch(I=>{console.error("Failed to persist source column order:",I)})}},U=j=>{n(j),i(null),f(!0)},Y=j=>{i(j),n(null),f(!0)},ae=()=>{f(!1),i(null),n(null)},Z=async j=>{try{const{updateTask:w}=V.getState();w(j.id,{assignee:"james"}),await q.triggerJames(),M.success(`Assigned "${j.title}" to James`,{description:"James will start working on it shortly"})}catch(w){console.error("Failed to assign to James:",w),M.error("Failed to assign task to James")}};return e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{sensors:g,collisionDetection:st,onDragStart:l,onDragOver:E,onDragEnd:z,children:[e.jsx("div",{className:"flex flex-col gap-4 sm:grid sm:grid-cols-2 lg:grid-cols-4",children:je.map(j=>e.jsx("div",{className:"w-full",children:e.jsx(Rt,{id:j.id,title:j.title,tasks:m[j.id],onAddTask:U,onEditTask:Y,onAssignToJames:Z,subtaskCounts:b})},j.id))}),e.jsx(at,{children:t?e.jsx(_e,{task:t,onEdit:()=>{},isDragging:!0,subtaskCounts:b[t.id]}):null})]}),e.jsx($e,{open:h,onOpenChange:f,task:s,defaultStatus:c,onClose:ae})]})}function Lt(){const{filter:t,setFilter:a}=V();return e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 sm:max-w-sm",children:[e.jsx(jt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(te,{placeholder:"Search tasks...",value:t.search,onChange:s=>a({search:s.target.value}),className:"pl-9"})]}),e.jsxs(H,{value:t.area,onValueChange:s=>a({area:s}),children:[e.jsx(G,{className:"w-[150px]",children:e.jsx(Q,{placeholder:"All areas"})}),e.jsxs(W,{children:[e.jsx(T,{value:"all",children:"All Areas"}),e.jsx(T,{value:"wellfy",children:"Wellfy"}),e.jsx(T,{value:"freelance",children:"Freelance"}),e.jsx(T,{value:"personal",children:"Personal"})]})]}),e.jsx(kt,{})]})}function ms(){const[t,a]=o.useState(!1),[s,i]=o.useState(!1),[h,f]=o.useState(!1),c=()=>{a(!0)},n=()=>{a(!1)},d=async()=>{f(!0);try{await q.triggerJames(),M.success("James is checking for new tasks...",{description:"He'll start working on any assigned tasks.",icon:"ðŸ¤–"})}catch{M.error("Failed to ping James")}finally{f(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Tasks"})}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("button",{onClick:d,disabled:h,className:"relative inline-flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-black bg-white border border-transparent rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden group",children:[e.jsx("span",{className:"absolute inset-0 rounded-md p-[2px] bg-gradient-to-r from-pink-500 via-purple-500 via-blue-500 via-cyan-500 via-green-500 via-yellow-500 to-pink-500 bg-[length:400%_100%] animate-shimmer"}),e.jsx("span",{className:"absolute inset-[2px] rounded-[4px] bg-white"}),e.jsxs("span",{className:"relative flex items-center gap-2",children:[h?e.jsx(Ye,{className:"h-4 w-4 animate-spin"}):e.jsx(oe,{className:"h-4 w-4"}),"James"]})]}),e.jsx(J,{variant:"outline",size:"icon",onClick:()=>i(!0),title:"Manage Tags",children:e.jsx(Ke,{className:"h-4 w-4"})}),e.jsxs(J,{onClick:c,className:"flex-1 sm:flex-none",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Add Task"]})]})]}),e.jsx(Lt,{}),e.jsx(Mt,{}),e.jsx($e,{open:t,onOpenChange:a,task:null,defaultStatus:"backlog",onClose:n}),e.jsx(St,{open:s,onOpenChange:i})]})}export{ms as TasksPage};
