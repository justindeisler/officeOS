import{r as m,j as e}from"./vendor-react-nkeu7MKf.js";import{u as F,A as E}from"./AssetDialog-Dtjyeb6B.js";import{j as A,r as B,P as I,a as j,I as R,B as S,F as M}from"./index-Bq9JOXc-.js";import{T as O,a as Y,b as D,c as o,d as $,e as l}from"./table-BiZRjCQP.js";import{C as q}from"./confirm-delete-dialog-CbLLPDpZ.js";import{a as z}from"./assets-CuCwnBCD.js";import{P as H}from"./plus-BhjAJXQ5.js";import{S as U}from"./search-DSVa55tI.js";import{T as G}from"./trash-2-DOeLg31B.js";import"./card-DcYCBqFU.js";import"./vendor-markdown-zaQAhtrl.js";import"./dialog-2k1ua57g.js";import"./vendor-radix-Oq5tdvA1.js";import"./vendor-floating-ui-_Y3uXdsy.js";import"./vendor-forms-BDwCPqGD.js";import"./index-uXN-dP3D.js";import"./select-DhYjehN7.js";import"./vendor-framer-motion-Dlt2pHhV.js";import"./upload-xhU2Fwad.js";import"./circle-alert-BiA_wvNL.js";import"./alert-dialog-BY0J32tz.js";import"./external-link-BCNbHkKI.js";import"./info-CBSAcddX.js";import"./vendor-recharts-COauwCrp.js";import"./vendor-router-bCYKpmtI.js";import"./db-DAzY1nu-.js";function g(t){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)}function J(t){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(t)}function K(t){return{computer:"Computer",phone:"Phone",furniture:"Furniture",equipment:"Equipment",software:"Software"}[t]}function Q(t){return{active:"Active",disposed:"Disposed",sold:"Sold"}[t]}function W(t){return{active:"default",disposed:"secondary",sold:"outline"}[t]}function P(t){const r=new Date().getFullYear(),i=t.depreciationSchedule.filter(n=>n.year<=r).sort((n,u)=>u.year-n.year)[0];return(i==null?void 0:i.bookValue)??t.purchasePrice}function X({onAddAsset:t,onEditAsset:r,className:i,refreshTrigger:n}){const{assets:u,isLoading:v,error:p,deleteAsset:N,setSelectedAsset:b,refresh:f}=F(),[c,T]=m.useState(""),[w,y]=m.useState(null);m.useEffect(()=>{n&&n>0&&f()},[n,f]);const h=m.useMemo(()=>{if(!c)return u;const s=c.toLowerCase();return u.filter(a=>{var d,x;return a.name.toLowerCase().includes(s)||(((d=a.vendor)==null?void 0:d.toLowerCase().includes(s))??!1)||(((x=a.description)==null?void 0:x.toLowerCase().includes(s))??!1)||a.category.toLowerCase().includes(s)})},[u,c]),C=m.useMemo(()=>{const s=h.filter(a=>a.status==="active");return{purchaseValue:h.reduce((a,d)=>a+d.purchasePrice,0),bookValue:h.reduce((a,d)=>a+P(d),0),activeCount:s.length}},[h]),k=s=>{b(s),r==null||r(s)},L=(s,a)=>{s.stopPropagation(),y(a)},V=async()=>{w&&(await N(w),y(null))};return v?e.jsxs("div",{className:A("flex items-center justify-center p-8",i),children:[e.jsx(B,{className:"h-8 w-8 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading..."})]}):p?e.jsxs("div",{className:A("p-8 text-center",i),children:[e.jsx("p",{className:"text-destructive",children:I(p)}),e.jsx(j,{variant:"outline",className:"mt-4",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:A("space-y-4",i),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold tracking-tight",children:"Assets"}),e.jsxs(j,{onClick:t,className:"w-full sm:w-auto",children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Add Asset"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(R,{placeholder:"Search assets...",value:c,onChange:s=>T(s.target.value),className:"pl-10"})]}),h.length===0?e.jsx("div",{className:"rounded-lg border border-dashed p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:c?"No assets match your search":"No assets yet. Add your first asset to get started."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(O,{className:"min-w-[900px]",children:[e.jsx(Y,{children:e.jsxs(D,{children:[e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Vendor"}),e.jsx(o,{children:"Category"}),e.jsx(o,{children:"Purchase Date"}),e.jsx(o,{className:"text-right",children:"Purchase Price"}),e.jsx(o,{className:"text-right",children:"Book Value"}),e.jsx(o,{children:"AfA"}),e.jsx(o,{children:"Status"}),e.jsx(o,{className:"w-[40px]"}),e.jsx(o,{className:"w-[50px]"})]})}),e.jsx($,{children:h.map(s=>e.jsxs(D,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>k(s),children:[e.jsx(l,{className:"font-medium",children:s.name}),e.jsx(l,{className:"text-muted-foreground",children:s.vendor||"â€”"}),e.jsx(l,{children:e.jsx(S,{variant:"outline",children:K(s.category)})}),e.jsx(l,{children:J(s.purchaseDate)}),e.jsx(l,{className:"text-right",children:g(s.purchasePrice)}),e.jsx(l,{className:"text-right font-medium",children:g(P(s))}),e.jsx(l,{children:e.jsx("span",{className:"text-sm text-muted-foreground",children:s.afaMethod==="immediate"?"Immediate":`${s.afaYears} years`})}),e.jsx(l,{children:e.jsx(S,{variant:W(s.status),children:Q(s.status)})}),e.jsx(l,{className:"text-center",children:s.billPath&&e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:async a=>{a.stopPropagation(),console.log(`[AssetList] Opening attachment for asset ${s.id}:`,s.billPath);try{await z.openAttachment(s.billPath)}catch(d){const x=d instanceof Error?d.message:"Unknown error";console.error("[AssetList] Failed to open attachment:",x),alert(`Failed to open attachment: ${x}`)}},title:"View attached bill",children:e.jsx(M,{className:"h-4 w-4 text-muted-foreground hover:text-primary"})})}),e.jsx(l,{children:e.jsx(j,{variant:"ghost",size:"icon",onClick:a=>L(a,s.id),"aria-label":"Delete",children:e.jsx(G,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"})})})]},s.id))})]})}),e.jsx("div",{className:"flex justify-start sm:justify-end",children:e.jsxs("div",{className:"rounded-lg bg-muted p-3 sm:p-4 w-full sm:w-auto",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Summary"}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 gap-2 sm:gap-6 text-right",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Purchase"}),e.jsx("div",{className:"font-medium text-sm sm:text-base",children:g(C.purchaseValue)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Book Value"}),e.jsx("div",{className:"font-semibold text-sm sm:text-base",children:g(C.bookValue)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Active Assets"}),e.jsxs("div",{className:"font-medium text-sm sm:text-base",children:[C.activeCount," active"]})]})]})]})})]}),e.jsx(q,{open:!!w,onOpenChange:s=>!s&&y(null),title:"Delete asset?",description:"This will permanently delete this asset. This action cannot be undone.",onConfirm:V})]})}function Ce(){const[t,r]=m.useState(!1),[i,n]=m.useState(null),[u,v]=m.useState(0),p=()=>{n(null),r(!0)},N=c=>{n(c),r(!0)},b=()=>{r(!1),n(null)},f=()=>{v(c=>c+1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsx(X,{onAddAsset:p,onEditAsset:N,refreshTrigger:u})}),e.jsx(E,{open:t,onOpenChange:r,asset:i,onClose:b,onSuccess:f})]})}export{Ce as AssetsPage};
